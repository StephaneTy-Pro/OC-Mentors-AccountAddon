// ==UserScript==
// @name         Facturier
// @namespace    http://tampermonkey.net/
// @version      1.10.0006
// @description  Un addon pour vous aider dans votre facturation
// @author       Stéphane TORCHY
// @updateURL    https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/dist/app.min.js
// @downloadURL  https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/dist/app.min.js
// @icon         https://mirrors.creativecommons.org/presskit/icons/heart.red.png
// multiple usage
// @match        https://openclassrooms.com/fr/mentorship/dashboard/mentorship-sessions-history*
// @match        https://openclassrooms.com/fr/mentorship/dashboard/sessions
// @match        https://openclassrooms.com/fr/mentorship/dashboard/booked-mentorship-sessions

// Start at document start https://www.tampermonkey.net/documentation.php#_run_at
// @run-at document-start   

// @grant        unsafeWindow
// @grant        GM_addStyle
// @grant        GM_getResourceText
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        GM.xmlHttpRequest
// @grant        GM_notification

// @require      https://cdn.jsdelivr.net/npm/lodash@4.17.19/lodash.min.js
// @require      https://unpkg.com/lowdb@0.17/dist/low.min.js
// @require      https://unpkg.com/lowdb@0.17/dist/LocalStorage.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/dayjs.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/locale/fr.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isBetween.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isSameOrBefore.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isSameOrAfter.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/customParseFormat.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/localeData.min.js


// GM_Config
// require      https://openuserjs.org/src/libs/sizzle/GM_config.js (cassé ce jour 28/08/2020);
// @require      https://raw.githubusercontent.com/sizzlemctwizzle/GM_config/master/gm_config.js

//// sweetalert 2
// require      https://cdn.jsdelivr.net/npm/sweetalert2@9/dist/sweetalert2.all.min.js
// @require      https://cdn.jsdelivr.net/npm/sweetalert2@10

//// draggabilly
// @require      https://cdnjs.cloudflare.com/ajax/libs/draggabilly/2.2.0/draggabilly.pkgd.min.js

//// toastify 
// @require     https://cdn.jsdelivr.net/npm/toastify-js@1.8.0/src/toastify.min.js
// @resource    toastifycss https://raw.githubusercontent.com/apvarun/toastify-js/master/src/toastify.css

// https://github.com/uzairfarooq/arrive --> included manually
// require     https://raw.githubusercontent.com/uzairfarooq/arrive/master/minified/arrive.min.js

////simple-datatables
//// https://github.com/fiduswriter/Simple-DataTables
// @require     https://cdn.jsdelivr.net/npm/simple-datatables@latest
// @resource    simpledatatablecss https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css


//// MEMOIZATION
//// TODO : check best function
// require https://raw.githubusercontent.com/anywhichway/nano-memoize/master/dist/nano-memoize.min.js
// https://github.com/planttheidea/moize#usage
// @require https://cdn.jsdelivr.net/npm/moize@5.4.7/dist/moize.min.js
// require https://cdn.jsdelivr.net/npm/moize@6.0.2/dist/moize.min.js -> probleme 20210701
// require https://cdn.jsdelivr.net/npm/moize@6.0.3/dist/moize.min.js -> probleme 20210701
// USAGE OF https://caolan.github.io/async/v3/docs.html
// FONCTIONNE PAS require https://cdn.jsdelivr.net/npm/async@3.2.0/memoize.min.js probleme export
// @require https://cdn.jsdelivr.net/npm/async@3.2.0/dist/async.min.js
// TOTEST https://github.com/sindresorhus/p-memoize
// Ne fonctionne pasrequire https://cdn.skypack.dev/p-memoize

//// FETCH INJECT --> included manually
// require https://cdn.jsdelivr.net/npm/fetch-inject

//// PARSER MKDOWN
// @require 	 https://cdn.jsdelivr.net/npm/showdown@1.9.1/dist/showdown.min.js

//// PDF https://pdf-lib.js.org/docs/api/
// @require      https://unpkg.com/pdf-lib@1.9.0/dist/pdf-lib.min.js
// @require      https://unpkg.com/downloadjs@1.4.7/download.js

//// HTMX https://htmx.org --> included dynamically
// require https://unpkg.com/htmx.org@1.1.0/dist/htmx.min.js

//// ALPINE JS --> included dynamically
// require https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.js


// ProgressBar 
// https://loading.io/progress/
// require https://raw.githubusercontent.com/loadingio/loading-bar/master/dist/loading-bar.js
// resource loading_barcss https://raw.githubusercontent.com/loadingio/loading-bar/master/dist/loading-bar.css
// @require https://loadingio.github.io/loading-bar/dist/loading-bar.js
// @resource loading_barcss https://loadingio.github.io/loading-bar/dist/loading-bar.min.css

// https://www.cssscript.com/demo/text-progress-bar-ascii-loader/
// https://github.com/kimmobrunfeldt/progressbar.js - fonctionne mais probleme avec le easing dans mon popup progress bar
// require https://raw.githubusercontent.com/kimmobrunfeldt/progressbar.js/master/dist/progressbar.min.js
// require https://raw.githubusercontent.com/kimmobrunfeldt/progressbar.js/master/dist/progressbar.js
// https://pvdlg.github.io/uprogress/js-api/#UProgress+start
// https://ricostacruz.com/nprogress


// @require https://unpkg.com/nprogress@0.2.0/nprogress.js
// @resource nprogress https://unpkg.com/nprogress@0.2.0/nprogress.css


// semble cassé
// https://github.com/webosorg/Process
// https://unpkg.com/@webos/process@0.2.0/dist/process.js
// https://cdn.jsdelivr.net/npm/@webos/process@0.2.0/dist/process.min.js
// bof ... je ne parviens pas à faire fonctionner l'exemple
// https://cdn.jsdelivr.net/npm/worker-function@2.0.1/WorkerFunction.min.js
// Threading 
// require  https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/Thread.js
// require   https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/ThreadPool.js
// require   https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/ThreadQueue.js
// semble cassé
// https://cdn.jsdelivr.net/npm/threads@1.6.3/dist/index.min.js
// https://unpkg.com/paralleljs@1.0/lib/parallel.js
// https://cdn.jsdelivr.net/npm/threads@1.6.3/dist/index.min.js
// Freelancer
// https://github.com/Wildhoney/Freelancer
// fonctionne require https://raw.githubusercontent.com/arqex/worker-function/master/WorkerFunction.js
// ne fonctonne pas https://raw.githubusercontent.com/duart38/Thread/master/Thread.bundle.js
// require      https://cdn.jsdelivr.net/npm/paralleljs@1.0.1/lib/parallel.min.js


/*
 * History
 * cf https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon/blob/master/CHANGELOG.md
 */
// ==/UserScript==
(()=>{var xn=Object.create,At=Object.defineProperty;var Cn=Object.getOwnPropertyDescriptor;var Mn=Object.getOwnPropertyNames;var Tn=Object.getPrototypeOf,Dn=Object.prototype.hasOwnProperty;var Yn=(p,o,n)=>o in p?At(p,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):p[o]=n;var Bn=p=>At(p,"__esModule",{value:!0});var $n=(p,o)=>()=>(o||p((o={exports:{}}).exports,o),o.exports);var kn=(p,o,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of Mn(o))!Dn.call(p,a)&&a!=="default"&&At(p,a,{get:()=>o[a],enumerable:!(n=Cn(o,a))||n.enumerable});return p},In=p=>kn(Bn(At(p!=null?xn(Tn(p)):{},"default",p&&p.__esModule&&"default"in p?{get:()=>p.default,enumerable:!0}:{value:p,enumerable:!0})),p);var U=(p,o,n)=>(Yn(p,typeof o!="symbol"?o+"":o,n),n);var dn=$n((It,Ot)=>{(function(p,o){typeof define=="function"&&define.amd?define([],o):typeof Ot=="object"&&typeof It!="undefined"?Ot.exports=o():p.Papa=o()})(It,function p(){"use strict";var o=typeof self!="undefined"?self:typeof window!="undefined"?window:o!==void 0?o:{},n=!o.document&&!!o.postMessage,a=n&&/blob:/i.test((o.location||{}).protocol),e={},t=0,l={parse:function(h,s){var w=(s=s||{}).dynamicTyping||!1;if(v(w)&&(s.dynamicTypingFunction=w,w={}),s.dynamicTyping=w,s.transform=!!v(s.transform)&&s.transform,s.worker&&l.WORKERS_SUPPORTED){var C=function(){if(!l.WORKERS_SUPPORTED)return!1;var Q=(A=o.URL||o.webkitURL||null,S=p.toString(),l.BLOB_URL||(l.BLOB_URL=A.createObjectURL(new Blob(["(",S,")();"],{type:"text/javascript"})))),E=new o.Worker(Q),A,S;return E.onmessage=g,E.id=t++,e[E.id]=E}();return C.userStep=s.step,C.userChunk=s.chunk,C.userComplete=s.complete,C.userError=s.error,s.step=v(s.step),s.chunk=v(s.chunk),s.complete=v(s.complete),s.error=v(s.error),delete s.worker,void C.postMessage({input:h,config:s,workerId:C.id})}var P=null;return l.NODE_STREAM_INPUT,typeof h=="string"?P=s.download?new d(s):new i(s):h.readable===!0&&v(h.read)&&v(h.on)?P=new y(s):(o.File&&h instanceof File||h instanceof Object)&&(P=new f(s)),P.stream(h)},unparse:function(h,s){var w=!1,C=!0,P=",",Q=`\r
`,E='"',A=E+E,S=!1,Y=null,I=!1;(function(){if(typeof s=="object"){if(typeof s.delimiter!="string"||l.BAD_DELIMITERS.filter(function(L){return s.delimiter.indexOf(L)!==-1}).length||(P=s.delimiter),(typeof s.quotes=="boolean"||typeof s.quotes=="function"||Array.isArray(s.quotes))&&(w=s.quotes),typeof s.skipEmptyLines!="boolean"&&typeof s.skipEmptyLines!="string"||(S=s.skipEmptyLines),typeof s.newline=="string"&&(Q=s.newline),typeof s.quoteChar=="string"&&(E=s.quoteChar),typeof s.header=="boolean"&&(C=s.header),Array.isArray(s.columns)){if(s.columns.length===0)throw new Error("Option columns is empty");Y=s.columns}s.escapeChar!==void 0&&(A=s.escapeChar+E),typeof s.escapeFormulae=="boolean"&&(I=s.escapeFormulae)}})();var R=new RegExp(m(E),"g");if(typeof h=="string"&&(h=JSON.parse(h)),Array.isArray(h)){if(!h.length||Array.isArray(h[0]))return j(null,h,S);if(typeof h[0]=="object")return j(Y||O(h[0]),h,S)}else if(typeof h=="object")return typeof h.data=="string"&&(h.data=JSON.parse(h.data)),Array.isArray(h.data)&&(h.fields||(h.fields=h.meta&&h.meta.fields),h.fields||(h.fields=Array.isArray(h.data[0])?h.fields:O(h.data[0])),Array.isArray(h.data[0])||typeof h.data[0]=="object"||(h.data=[h.data])),j(h.fields||[],h.data||[],S);throw new Error("Unable to serialize unrecognized input");function O(L){if(typeof L!="object")return[];var oe=[];for(var me in L)oe.push(me);return oe}function j(L,oe,me){var ce="";typeof L=="string"&&(L=JSON.parse(L)),typeof oe=="string"&&(oe=JSON.parse(oe));var fe=Array.isArray(L)&&0<L.length,be=!Array.isArray(oe[0]);if(fe&&C){for(var ne=0;ne<L.length;ne++)0<ne&&(ce+=P),ce+=k(L[ne],ne);0<oe.length&&(ce+=Q)}for(var ie=0;ie<oe.length;ie++){var he=fe?L.length:oe[ie].length,de=!1,se=fe?Object.keys(oe[ie]).length===0:oe[ie].length===0;if(me&&!fe&&(de=me==="greedy"?oe[ie].join("").trim()==="":oe[ie].length===1&&oe[ie][0].length===0),me==="greedy"&&fe){for(var ae=[],te=0;te<he;te++){var G=be?L[te]:te;ae.push(oe[ie][G])}de=ae.join("").trim()===""}if(!de){for(var pe=0;pe<he;pe++){0<pe&&!se&&(ce+=P);var we=fe&&be?L[pe]:pe;ce+=k(oe[ie][we],pe)}ie<oe.length-1&&(!me||0<he&&!se)&&(ce+=Q)}}return ce}function k(L,oe){if(L==null)return"";if(L.constructor===Date)return JSON.stringify(L).slice(1,25);I===!0&&typeof L=="string"&&L.match(/^[=+\-@].*$/)!==null&&(L="'"+L);var me=L.toString().replace(R,A),ce=typeof w=="boolean"&&w||typeof w=="function"&&w(L,oe)||Array.isArray(w)&&w[oe]||function(fe,be){for(var ne=0;ne<be.length;ne++)if(-1<fe.indexOf(be[ne]))return!0;return!1}(me,l.BAD_DELIMITERS)||-1<me.indexOf(P)||me.charAt(0)===" "||me.charAt(me.length-1)===" ";return ce?E+me+E:me}}};if(l.RECORD_SEP=String.fromCharCode(30),l.UNIT_SEP=String.fromCharCode(31),l.BYTE_ORDER_MARK="\uFEFF",l.BAD_DELIMITERS=["\r",`
`,'"',l.BYTE_ORDER_MARK],l.WORKERS_SUPPORTED=!n&&!!o.Worker,l.NODE_STREAM_INPUT=1,l.LocalChunkSize=10485760,l.RemoteChunkSize=5242880,l.DefaultDelimiter=",",l.Parser=b,l.ParserHandle=B,l.NetworkStreamer=d,l.FileStreamer=f,l.StringStreamer=i,l.ReadableStreamStreamer=y,o.jQuery){var u=o.jQuery;u.fn.parse=function(h){var s=h.config||{},w=[];return this.each(function(Q){if(!(u(this).prop("tagName").toUpperCase()==="INPUT"&&u(this).attr("type").toLowerCase()==="file"&&o.FileReader)||!this.files||this.files.length===0)return!0;for(var E=0;E<this.files.length;E++)w.push({file:this.files[E],inputElem:this,instanceConfig:u.extend({},s)})}),C(),this;function C(){if(w.length!==0){var Q,E,A,S,Y=w[0];if(v(h.before)){var I=h.before(Y.file,Y.inputElem);if(typeof I=="object"){if(I.action==="abort")return Q="AbortError",E=Y.file,A=Y.inputElem,S=I.reason,void(v(h.error)&&h.error({name:Q},E,A,S));if(I.action==="skip")return void P();typeof I.config=="object"&&(Y.instanceConfig=u.extend(Y.instanceConfig,I.config))}else if(I==="skip")return void P()}var R=Y.instanceConfig.complete;Y.instanceConfig.complete=function(O){v(R)&&R(O,Y.file,Y.inputElem),P()},l.parse(Y.file,Y.instanceConfig)}else v(h.complete)&&h.complete()}function P(){w.splice(0,1),C()}}}function c(h){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(s){var w=$(s);w.chunkSize=parseInt(w.chunkSize),s.step||s.chunk||(w.chunkSize=null),this._handle=new B(w),(this._handle.streamer=this)._config=w}.call(this,h),this.parseChunk=function(s,w){if(this.isFirstChunk&&v(this._config.beforeFirstChunk)){var C=this._config.beforeFirstChunk(s);C!==void 0&&(s=C)}this.isFirstChunk=!1,this._halted=!1;var P=this._partialLine+s;this._partialLine="";var Q=this._handle.parse(P,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var E=Q.meta.cursor;this._finished||(this._partialLine=P.substring(E-this._baseIndex),this._baseIndex=E),Q&&Q.data&&(this._rowCount+=Q.data.length);var A=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(a)o.postMessage({results:Q,workerId:l.WORKER_ID,finished:A});else if(v(this._config.chunk)&&!w){if(this._config.chunk(Q,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);Q=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(Q.data),this._completeResults.errors=this._completeResults.errors.concat(Q.errors),this._completeResults.meta=Q.meta),this._completed||!A||!v(this._config.complete)||Q&&Q.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),A||Q&&Q.meta.paused||this._nextChunk(),Q}this._halted=!0},this._sendError=function(s){v(this._config.error)?this._config.error(s):a&&this._config.error&&o.postMessage({workerId:l.WORKER_ID,error:s,finished:!1})}}function d(h){var s;(h=h||{}).chunkSize||(h.chunkSize=l.RemoteChunkSize),c.call(this,h),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(w){this._input=w,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(s=new XMLHttpRequest,this._config.withCredentials&&(s.withCredentials=this._config.withCredentials),n||(s.onload=D(this._chunkLoaded,this),s.onerror=D(this._chunkError,this)),s.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var w=this._config.downloadRequestHeaders;for(var C in w)s.setRequestHeader(C,w[C])}if(this._config.chunkSize){var P=this._start+this._config.chunkSize-1;s.setRequestHeader("Range","bytes="+this._start+"-"+P)}try{s.send(this._config.downloadRequestBody)}catch(Q){this._chunkError(Q.message)}n&&s.status===0&&this._chunkError()}},this._chunkLoaded=function(){s.readyState===4&&(s.status<200||400<=s.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:s.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(w){var C=w.getResponseHeader("Content-Range");return C===null?-1:parseInt(C.substring(C.lastIndexOf("/")+1))}(s),this.parseChunk(s.responseText)))},this._chunkError=function(w){var C=s.statusText||w;this._sendError(new Error(C))}}function f(h){var s,w;(h=h||{}).chunkSize||(h.chunkSize=l.LocalChunkSize),c.call(this,h);var C=typeof FileReader!="undefined";this.stream=function(P){this._input=P,w=P.slice||P.webkitSlice||P.mozSlice,C?((s=new FileReader).onload=D(this._chunkLoaded,this),s.onerror=D(this._chunkError,this)):s=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var P=this._input;if(this._config.chunkSize){var Q=Math.min(this._start+this._config.chunkSize,this._input.size);P=w.call(P,this._start,Q)}var E=s.readAsText(P,this._config.encoding);C||this._chunkLoaded({target:{result:E}})},this._chunkLoaded=function(P){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(P.target.result)},this._chunkError=function(){this._sendError(s.error)}}function i(h){var s;c.call(this,h=h||{}),this.stream=function(w){return s=w,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var w,C=this._config.chunkSize;return C?(w=s.substring(0,C),s=s.substring(C)):(w=s,s=""),this._finished=!s,this.parseChunk(w)}}}function y(h){c.call(this,h=h||{});var s=[],w=!0,C=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(P){this._input=P,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){C&&s.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),s.length?this.parseChunk(s.shift()):w=!0},this._streamData=D(function(P){try{s.push(typeof P=="string"?P:P.toString(this._config.encoding)),w&&(w=!1,this._checkIsFinished(),this.parseChunk(s.shift()))}catch(Q){this._streamError(Q)}},this),this._streamError=D(function(P){this._streamCleanUp(),this._sendError(P)},this),this._streamEnd=D(function(){this._streamCleanUp(),C=!0,this._streamData("")},this),this._streamCleanUp=D(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function B(h){var s,w,C,P=Math.pow(2,53),Q=-P,E=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,A=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,S=this,Y=0,I=0,R=!1,O=!1,j=[],k={data:[],errors:[],meta:{}};if(v(h.step)){var L=h.step;h.step=function(ne){if(k=ne,ce())me();else{if(me(),k.data.length===0)return;Y+=ne.data.length,h.preview&&Y>h.preview?w.abort():(k.data=k.data[0],L(k,S))}}}function oe(ne){return h.skipEmptyLines==="greedy"?ne.join("").trim()==="":ne.length===1&&ne[0].length===0}function me(){if(k&&C&&(be("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+l.DefaultDelimiter+"'"),C=!1),h.skipEmptyLines)for(var ne=0;ne<k.data.length;ne++)oe(k.data[ne])&&k.data.splice(ne--,1);return ce()&&function(){if(!k)return;function ie(de,se){v(h.transformHeader)&&(de=h.transformHeader(de,se)),j.push(de)}if(Array.isArray(k.data[0])){for(var he=0;ce()&&he<k.data.length;he++)k.data[he].forEach(ie);k.data.splice(0,1)}else k.data.forEach(ie)}(),function(){if(!k||!h.header&&!h.dynamicTyping&&!h.transform)return k;function ie(de,se){var ae,te=h.header?{}:[];for(ae=0;ae<de.length;ae++){var G=ae,pe=de[ae];h.header&&(G=ae>=j.length?"__parsed_extra":j[ae]),h.transform&&(pe=h.transform(pe,G)),pe=fe(G,pe),G==="__parsed_extra"?(te[G]=te[G]||[],te[G].push(pe)):te[G]=pe}return h.header&&(ae>j.length?be("FieldMismatch","TooManyFields","Too many fields: expected "+j.length+" fields but parsed "+ae,I+se):ae<j.length&&be("FieldMismatch","TooFewFields","Too few fields: expected "+j.length+" fields but parsed "+ae,I+se)),te}var he=1;return!k.data.length||Array.isArray(k.data[0])?(k.data=k.data.map(ie),he=k.data.length):k.data=ie(k.data,0),h.header&&k.meta&&(k.meta.fields=j),I+=he,k}()}function ce(){return h.header&&j.length===0}function fe(ne,ie){return he=ne,h.dynamicTypingFunction&&h.dynamicTyping[he]===void 0&&(h.dynamicTyping[he]=h.dynamicTypingFunction(he)),(h.dynamicTyping[he]||h.dynamicTyping)===!0?ie==="true"||ie==="TRUE"||ie!=="false"&&ie!=="FALSE"&&(function(de){if(E.test(de)){var se=parseFloat(de);if(Q<se&&se<P)return!0}return!1}(ie)?parseFloat(ie):A.test(ie)?new Date(ie):ie===""?null:ie):ie;var he}function be(ne,ie,he,de){var se={type:ne,code:ie,message:he};de!==void 0&&(se.row=de),k.errors.push(se)}this.parse=function(ne,ie,he){var de=h.quoteChar||'"';if(h.newline||(h.newline=function(te,G){te=te.substring(0,1048576);var pe=new RegExp(m(G)+"([^]*?)"+m(G),"gm"),we=(te=te.replace(pe,"")).split("\r"),Ye=te.split(`
`),Me=1<Ye.length&&Ye[0].length<we[0].length;if(we.length===1||Me)return`
`;for(var Oe=0,Se=0;Se<we.length;Se++)we[Se][0]===`
`&&Oe++;return Oe>=we.length/2?`\r
`:"\r"}(ne,de)),C=!1,h.delimiter)v(h.delimiter)&&(h.delimiter=h.delimiter(ne),k.meta.delimiter=h.delimiter);else{var se=function(te,G,pe,we,Ye){var Me,Oe,Se,Le;Ye=Ye||[",","	","|",";",l.RECORD_SEP,l.UNIT_SEP];for(var Ce=0;Ce<Ye.length;Ce++){var Ve=Ye[Ce],ut=0,ye=0,Ne=0;Se=void 0;for(var Be=new b({comments:we,delimiter:Ve,newline:G,preview:10}).parse(te),Ue=0;Ue<Be.data.length;Ue++)if(pe&&oe(Be.data[Ue]))Ne++;else{var $e=Be.data[Ue].length;ye+=$e,Se!==void 0?0<$e&&(ut+=Math.abs($e-Se),Se=$e):Se=$e}0<Be.data.length&&(ye/=Be.data.length-Ne),(Oe===void 0||ut<=Oe)&&(Le===void 0||Le<ye)&&1.99<ye&&(Oe=ut,Me=Ve,Le=ye)}return{successful:!!(h.delimiter=Me),bestDelimiter:Me}}(ne,h.newline,h.skipEmptyLines,h.comments,h.delimitersToGuess);se.successful?h.delimiter=se.bestDelimiter:(C=!0,h.delimiter=l.DefaultDelimiter),k.meta.delimiter=h.delimiter}var ae=$(h);return h.preview&&h.header&&ae.preview++,s=ne,w=new b(ae),k=w.parse(s,ie,he),me(),R?{meta:{paused:!0}}:k||{meta:{paused:!1}}},this.paused=function(){return R},this.pause=function(){R=!0,w.abort(),s=v(h.chunk)?"":s.substring(w.getCharIndex())},this.resume=function(){S.streamer._halted?(R=!1,S.streamer.parseChunk(s,!0)):setTimeout(S.resume,3)},this.aborted=function(){return O},this.abort=function(){O=!0,w.abort(),k.meta.aborted=!0,v(h.complete)&&h.complete(k),s=""}}function m(h){return h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(h){var s,w=(h=h||{}).delimiter,C=h.newline,P=h.comments,Q=h.step,E=h.preview,A=h.fastMode,S=s=h.quoteChar===void 0?'"':h.quoteChar;if(h.escapeChar!==void 0&&(S=h.escapeChar),(typeof w!="string"||-1<l.BAD_DELIMITERS.indexOf(w))&&(w=","),P===w)throw new Error("Comment character same as delimiter");P===!0?P="#":(typeof P!="string"||-1<l.BAD_DELIMITERS.indexOf(P))&&(P=!1),C!==`
`&&C!=="\r"&&C!==`\r
`&&(C=`
`);var Y=0,I=!1;this.parse=function(R,O,j){if(typeof R!="string")throw new Error("Input must be a string");var k=R.length,L=w.length,oe=C.length,me=P.length,ce=v(Q),fe=[],be=[],ne=[],ie=Y=0;if(!R)return Ce();if(A||A!==!1&&R.indexOf(s)===-1){for(var he=R.split(C),de=0;de<he.length;de++){if(ne=he[de],Y+=ne.length,de!==he.length-1)Y+=C.length;else if(j)return Ce();if(!P||ne.substring(0,me)!==P){if(ce){if(fe=[],Me(ne.split(w)),Ve(),I)return Ce()}else Me(ne.split(w));if(E&&E<=de)return fe=fe.slice(0,E),Ce(!0)}}return Ce()}for(var se=R.indexOf(w,Y),ae=R.indexOf(C,Y),te=new RegExp(m(S)+m(s),"g"),G=R.indexOf(s,Y);;)if(R[Y]!==s)if(P&&ne.length===0&&R.substring(Y,Y+me)===P){if(ae===-1)return Ce();Y=ae+oe,ae=R.indexOf(C,Y),se=R.indexOf(w,Y)}else{if(se!==-1&&(se<ae||ae===-1)){if(!(se<G)){ne.push(R.substring(Y,se)),Y=se+L,se=R.indexOf(w,Y);continue}var pe=ut(se,G,ae);if(pe&&pe.nextDelim!==void 0){se=pe.nextDelim,G=pe.quoteSearch,ne.push(R.substring(Y,se)),Y=se+L,se=R.indexOf(w,Y);continue}}if(ae===-1)break;if(ne.push(R.substring(Y,ae)),Le(ae+oe),ce&&(Ve(),I))return Ce();if(E&&fe.length>=E)return Ce(!0)}else for(G=Y,Y++;;){if((G=R.indexOf(s,G+1))===-1)return j||be.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:fe.length,index:Y}),Se();if(G===k-1)return Se(R.substring(Y,G).replace(te,s));if(s!==S||R[G+1]!==S){if(s===S||G===0||R[G-1]!==S){se!==-1&&se<G+1&&(se=R.indexOf(w,G+1)),ae!==-1&&ae<G+1&&(ae=R.indexOf(C,G+1));var we=Oe(ae===-1?se:Math.min(se,ae));if(R[G+1+we]===w){ne.push(R.substring(Y,G).replace(te,s)),R[Y=G+1+we+L]!==s&&(G=R.indexOf(s,Y)),se=R.indexOf(w,Y),ae=R.indexOf(C,Y);break}var Ye=Oe(ae);if(R.substring(G+1+Ye,G+1+Ye+oe)===C){if(ne.push(R.substring(Y,G).replace(te,s)),Le(G+1+Ye+oe),se=R.indexOf(w,Y),G=R.indexOf(s,Y),ce&&(Ve(),I))return Ce();if(E&&fe.length>=E)return Ce(!0);break}be.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:fe.length,index:Y}),G++}}else G++}return Se();function Me(ye){fe.push(ye),ie=Y}function Oe(ye){var Ne=0;if(ye!==-1){var Be=R.substring(G+1,ye);Be&&Be.trim()===""&&(Ne=Be.length)}return Ne}function Se(ye){return j||(ye===void 0&&(ye=R.substring(Y)),ne.push(ye),Y=k,Me(ne),ce&&Ve()),Ce()}function Le(ye){Y=ye,Me(ne),ne=[],ae=R.indexOf(C,Y)}function Ce(ye){return{data:fe,errors:be,meta:{delimiter:w,linebreak:C,aborted:I,truncated:!!ye,cursor:ie+(O||0)}}}function Ve(){Q(Ce()),fe=[],be=[]}function ut(ye,Ne,Be){var Ue={nextDelim:void 0,quoteSearch:void 0},$e=R.indexOf(s,Ne+1);if(Ne<ye&&ye<$e&&($e<Be||Be===-1)){var Dt=R.indexOf(w,$e);if(Dt===-1)return Ue;$e<Dt&&($e=R.indexOf(s,$e+1)),Ue=ut(Dt,$e,Be)}else Ue={nextDelim:ye,quoteSearch:Ne};return Ue}},this.abort=function(){I=!0},this.getCharIndex=function(){return Y}}function g(h){var s=h.data,w=e[s.workerId],C=!1;if(s.error)w.userError(s.error,s.file);else if(s.results&&s.results.data){var P={abort:function(){C=!0,x(s.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:M,resume:M};if(v(w.userStep)){for(var Q=0;Q<s.results.data.length&&(w.userStep({data:s.results.data[Q],errors:s.results.errors,meta:s.results.meta},P),!C);Q++);delete s.results}else v(w.userChunk)&&(w.userChunk(s.results,P,s.file),delete s.results)}s.finished&&!C&&x(s.workerId,s.results)}function x(h,s){var w=e[h];v(w.userComplete)&&w.userComplete(s),w.terminate(),delete e[h]}function M(){throw new Error("Not implemented.")}function $(h){if(typeof h!="object"||h===null)return h;var s=Array.isArray(h)?[]:{};for(var w in h)s[w]=$(h[w]);return s}function D(h,s){return function(){h.apply(s,arguments)}}function v(h){return typeof h=="function"}return a&&(o.onmessage=function(h){var s=h.data;if(l.WORKER_ID===void 0&&s&&(l.WORKER_ID=s.workerId),typeof s.input=="string")o.postMessage({workerId:l.WORKER_ID,results:l.parse(s.input,s.config),finished:!0});else if(o.File&&s.input instanceof File||s.input instanceof Object){var w=l.parse(s.input,s.config);w&&o.postMessage({workerId:l.WORKER_ID,results:w,finished:!0})}}),(d.prototype=Object.create(c.prototype)).constructor=d,(f.prototype=Object.create(c.prototype)).constructor=f,(i.prototype=Object.create(i.prototype)).constructor=i,(y.prototype=Object.create(c.prototype)).constructor=y,l})});var Je={async XHR(p){let o=window.GM_xmlhttpRequest||(GM?GM.xmlHttpRequest:null);return o?new Promise((n,a)=>{Object.assign(p,{onabort:a,onerror:a,onload:n,ontimeout:a}),o(p)}):Promise.reject()},async getValue(p,o=null){return window.GM_getValue?Promise.resolve(GM_getValue(p)||o):await GM.getValue(p)||o},async setValue(p,o){window.GM_setValue?GM_setValue(p,o):GM.setValue(p,o)}};var Ft="OC-Addons",to="St\xE9phane TORCHY",T="background-color:green;color:white",no="background-color:black;color:white",Ge="background-color:coral;color:white",oo="background-color:cyan;color:white",le="background-color:red;color:white",Pe="background-color:blue;color:white",qe="auto-financ\xE9",De="financ\xE9 par un tiers",Ze="autre",Xe="r\xE9alis\xE9e",et="annul\xE9e",tt="annul\xE9e tardivement",nt="\xE9tudiant absent",mt="\xE9tudiante absente",ot=6,Ht=30,Nt=35,Ut=40,Gt=45,qt=50,Qt=55,z=0,W=1,K=2,ro=[{pathId:158,path:"158-trouvez-lemploi-qui-vous-correspond",value:2}],Z=0,X=1,V=2,ee=3,F=0,H=1,N=2,zt=0,Wt="completed",Kt="canceled",Vt="late canceled",Jt="marked student as absent",ht="table";var Zt=function(){return new Promise(p=>{document.readyState=="loading"?document.addEventListener("DOMContentLoaded",p):p()})},gt=async function(p="",o="",n=!1){console.info(`%cfetch() waiting return from : ${p}`,T);let a=await Je.XHR({method:"GET",url:p,responseType:"text/html",headers:{"User-Agent":"Mozilla/5.0"},onprogress:function(c){}}).catch(c=>{console.error(`%cError ${c}`,le)}),t=new DOMParser().parseFromString(a.responseText.replace(/\n/mg,""),"text/html");if(t.querySelector("meta[id=captcha-bypass]")!==null)throw console.error(`%cError CloudFlare CAPTCHA : ${t.querySelector("title").innerText}`,T),new Error("Must Respond to Cloudflare Captcha or waiting....");var u={};return n===!0?u=t.querySelectorAll(o):u=t.querySelector(o),u};var Ke=function(p,o=-1){try{var n=(p.querySelector("a").href||"/").split("/");return n[n.length+o]}catch(a){console.error(`%cError in getkey${a.stack||a}`,le)}},Xt=function(p){var o=p.trim().split(" ");try{var n=dayjs_locale_fr.months.findIndex(a=>a===o[1])+1}catch(a){console.error(`%cError in extractDate${a.stack||a}`,le)}return`${o[2]}-${n}-${o[0]}T${o[4]}`};var Re=function(p){return new Promise(o=>setTimeout(o,p))},en=function(p){return p.substring(p.lastIndexOf(".")+1,p.length)||p},bt=function(p,o){for(var n=p.split("."),a=o.split("."),e=0;e<3;e++){var t=Number(n[e]),l=Number(a[e]);if(t>l)return 1;if(l>t)return-1;if(!isNaN(t)&&isNaN(l))return 1;if(isNaN(t)&&!isNaN(l))return-1}return 0},tn=function(o,n){return console.info("Reading:",o),fetch(o,{mode:"same-origin"}).then(function(a){return a.blob()}).then(function(a){var e=new FileReader;e.addEventListener("loadend",function(){n(this.result)}),e.readAsText(a)})},nn=function(p){let o=p,n=p.reduce(function(f,i){return f*i});var a=new Array(n);let e=function(...f){let i=f.pop();if(f.length!==p.length)throw"Wrong matrix dimensions, need "+p.length+", you provide "+i.length+"!";if(d(f)===0)throw"Wrong type for set need one or more int has dimension, check type of!";let y=c(f);return a[y]=i,i},t=function(...f){if(f.length!==p.length)throw"Wrong matrix dimensions, need "+p.length+", you provide "+f.length+"!";if(d(f)===0)throw"Wrong type for set need one or more int has dimension, check type of!";let i=c(f);return a[i]},l=function(...f){let i=c(f);return a[i]=void 0,a[i]===void 0},u=function(){console.group("dump table"),console.table(a),console.groupEnd("dump table")},c=function(f){return f.reduce(function(i,y,B,m){let b=o.slice(B+1),g=b.length>0?b.reduce(function(x,M){return x*M}):1;return i+y*g},0)},d=function(f){return f.reduce((i,y)=>i&typeof y=="number",1)};return Object.freeze({set:e,get:t,del:l,toConsole:u})},on=function(p,o=0){let n=3735928559^o,a=1103547991^o;for(let e=0,t;e<p.length;e++)t=p.charCodeAt(e),n=Math.imul(n^t,2654435761),a=Math.imul(a^t,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(a^a>>>13,3266489909),a=Math.imul(a^a>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&a)+(n>>>0)},re=function(p,o,n=Error){if(!p)throw new n(o)};var Yt=p=>Array.isArray(p),rn=p=>p.toString().trim().length<="function(){}".length;var St=function(p){var o;return function(){var n=this,a=arguments;o&&window.cancelAnimationFrame(o),o=window.requestAnimationFrame(function(){p.apply(n,a)})}};var sn=function(p){let o=Date.now(),n=null;do n=Date.now();while(n-o<p)};HTMLElement.prototype.appendFirst=function(p){this.firstChild?this.insertBefore(p,this.firstChild):this.appendChild(p)};var ct=async function(p=null,o=null,n=!0){var a="";a+="<style>",a+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",a+="form input {background: #fff;border: 1px solid #9c9c9c;}",a+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",a+="form button:hover {background: gold;}",a+="form label {padding: 0.5em 0.5em 0.5em 0;}",a+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",a+="form input:focus {outline: 3px solid gold;}",a+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}form label {text-align: right;grid-column: 1 / 2;}form input, form button {grid-column: 2 / 3;}}",a+="</style>",a+='<form class="form1" action="">',a+='<label for="dtFrom" class="date">Date de d\xE9but</label>',p?a+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(p).format("YYYY-MM-DD")+'">':a+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31">',a+='<label for="dtTo" class="date">Date de fin</label>',p?a+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(o).format("YYYY-MM-DD")+'">':a+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31">',a+="</form>";let{value:e}=await Swal.fire({title:"<strong>Choix de la p\xE9riode</strong>",icon:"info",html:a,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:"Choisissez la p\xE9riode pour la s\xE9lection des temps factur\xE9s",showLoaderOnConfirm:!0,preConfirm:()=>[document.getElementById("dtFrom").value,document.getElementById("dtTo").value],onRender:t=>{},onOpen:t=>{n===!0&&t.querySelector("#dtFrom").addEventListener("change",_handler=function(){document.getElementById("dtTo").value=dayjs(document.getElementById("dtFrom").value).endOf("month").format("YYYY-MM-DD")})},onClose:t=>{n===!0&&t.querySelector("#dtFrom").removeEventListener("change",_handler)},onAfterClose:t=>{},onDestroy:t=>{}});return p=dayjs(e[0]),o=dayjs(e[1]),await Re(250),[p,o]},Et=async function(p){await Swal.fire({position:"top-end",icon:"success",title:p,showConfirmButton:!1,timer:1500})};var Qe=class{},rt=Qe;U(rt,"tbl_name","f_archives"),U(rt,"add",async function(o){let n=q.Cfg.dbase,a=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]"),e={id:o[0].to.format("YYYYMM"),data:o,created_at:o[0].now};console.log(`%cWill create archive for id ${o[0].to.format("YYYYMM")} (YYYYMM)`,T),n.get(Qe.tbl_name).push(JSON.parse(JSON.stringify(e))).write()}),U(rt,"exists",function(o){return q.Cfg.dbase.get(Qe.tbl_name).find({id:o}).value()!==void 0}),U(rt,"get",function(o){var a=q.Cfg.dbase.get(Qe.tbl_name).find({id:o}).value();if(a===void 0)throw Error("Erreur qui ne devrait jamais arriver en Archive.get");return console.log(`%cWill use archive for id ${o} (YYYYMM)`,T),a}),U(rt,"delete",function(o=null,n=null){let a=q.Cfg.dbase;if(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),o===null&&n==null){console.log("%cWanna suppress ALL Archives from DB ",T),a.get(Qe.tbl_name).remove().write();return}if(n==null){a.get(Qe.tbl_name).remove(function(e){return dayjs(e.id,"YYYYMM").isBefore(n),"month"}).write();return}if(o==null){a.get(Qe.tbl_name).remove(function(e){return dayjs(e.id,"YYYYMM").isAfter(o,"month")}).write();return}a.get(Qe.tbl_name).remove(function(e){return dayjs(e.id,"YYYYMM").isBetween(o,n,"month","[]")}).write()});var it=rt;var Bt=class{},yt=Bt;U(yt,"isInOldMode",function(o){var n=null;typeof o=="string"?n=dayjs(o):n=o;try{return n.isBefore(Bt.getOldModeDate())}catch(a){throw Error("Erreur qui ne devrait jamais arriver en IsInOldMode (probablement un probleme sur la conversion de la date en objet dayjs:"+a.stack||a)}}),U(yt,"getOldModeDate",function(){return dayjs("2020-06-01")}),U(yt,"getAppVersion",function(){return GM.info.script.version});var Ae=yt;var On=function(){let p="students_history",o=1,n=2,a=function(y){if(y.toUpperCase()==="FUNDING")return o;if(y.toUpperCase()==="PATH")return n;throw Error("Erreur qui ne devrait jamais arriver en getype")},e=function(y,B,m=null){return l(y,o,B,m)},t=function(y,B,m=null){return l(y,n,B,m)},l=function(y,B,m,b=null){let g=!1;typeof y=="number"&&(y=y.toString(10)),re(typeof y=="string","You must provide a string.",TypeError);let x=q.Cfg.dbase;typeof b=="string"&&(b=dayjs(b)),b===null&&(b=dayjs()),re(b instanceof dayjs,"created date must be a string, a dayjs instance or null.",TypeError);let M={id:y,type:0|B,value:m,date:b.valueOf(),humanDate:b.format("YYYY-MM-DDTHH:mm:ssZZ")};return g===!0&&console.log(`%cAdd in student history at date ${dayjs(M.date).format("YYYY-MM-DDTHH:mm:ssZZ")} data ${m} with type:${B} cf const of object`,T),x.get(p).push(JSON.parse(JSON.stringify(M))).write()},u=function(y,B=null,m=null){let b=q.Cfg.dbase;return y==null&&B==null&&m==null?(console.log("%cRemove all in student history",T),b.get(p).remove().write()):(typeof m=="string"&&(m=dayjs(m)),m==null?B==null?(console.log(`%cRemove for student id:${y} history for all type of event`,T),b.get(p).remove({id:y}).write()):(console.log(`%cRemove for student id:${y} history with event type:${B} cf const of object`,T),b.get(p).remove({id:y,type:B}).write()):(console.log(`%cRemove for student id:${y} history at date ${m.format("DD/MM/YYYY")} with event type:${B} cf const of object`,T),b.get(p).remove({id:y,type:B,date:m.valueOf()}).write()))},c=function(y,B,m=null){let b=!1,g=q.Cfg.dbase;typeof m=="string"&&(m=dayjs(m)),m===null&&(m=dayjs()),b===!0&&console.log("%cSearching in student history at date %o ",T,m),b===!0&&console.log(`%cSearching in student history at date ${m.format("DD/MM/YYYY")} any data with type:${B} cf const of object`,T);var x=+m.valueOf(),M=g.get(p).filter(v=>v.id===y&&v.type&B).map(v=>v.date-x).filter(v=>v>=0).value();if(M.length==0){b===!0&&console.log(`%cThere is no data in student history at date ${m.format("DD/MM/YYYY")} with type:${B} cf const of object`,T);return}let D=x+(v=>Math.min(...v))(M);return g.get(p).filter(v=>v.id===y&&v.type&B&&v.date==D).value()[0]},d=function(y){return i(y,o)},f=function(y){return i(y,n)},i=function(y,B){return y.type&B};return Object.freeze({addFunding:e,addPath:t,getType:a,remove:u,find:c,isFunding:d,isPath:f,tbl_name:p})},jn=On(),je=jn;var ue=class{static modifyFunding(o,n,a){typeof n=="string"&&(n=dayjs(n)),re(created instanceof dayjs,"modifyFunding date must be a string, a dayjs instance or null.",TypeError);let e=ue.getFunding(o,n);if(a.toLower()===e.toLower()){console.log(`%cFundingMode ${a} is identical as current: ${sCurrent}, nothing to do`,T);return}(a!==qe||a!=De||a!==Ze)&&console.log(`%cWarning this state is unknown ${a}`,Ge);let t=q.Cfg.dbase,l=dayjs().format("YYYY-MM-DDTHH:mm:ssZZ");if(n===null&&(n=l),oLastHistory=je.find(o,je.getType("FUNDING"),n),t.get(ue.tbl_name).find({id:o}).assign({funding:a}).write(),je.addFunding(o,e,l),n.isSameOrAfter(Ae.getOldModeDate()))var u=t.get("sessions").filter(function(d){return d.who_id===o&&dayjs(d.when).isSameOrAfter(n,"day")});else var u=t.get("sessions").filter(function(f){f.who_id===o&&dayjs(f.when).isSameOrAfter(Ae.getOldModeDate(),"day")});for(var c=u.value().length;c-=1;)console.log(`There is ${c} elements left to update`,T),u.get(c).assign({funding:a}).write()}},_e=ue;U(_e,"tbl_name","students"),U(_e,"add",function(o,n="noname",a="nopath",e="unknown",t){let l=q.Cfg.dbase;var u=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");let c={id:o,fullname:n,path:a,funding:e,created:u};ue._save(c)}),U(_e,"_checkObject",function(o){!1===!0&&console.log("%cChecking object student:%o ",T,o),re(typeof o.id=="string","Student object id need to be a string.",TypeError),re(typeof o.fullname=="string","Student object fullname need to be a number.",TypeError),re(typeof o.path=="string","Student object path need to be a string.",TypeError),re(typeof o.funding=="string","Student object funding need to be a string.",TypeError),re(typeof o.created=="string","Student object created need to be a string.",TypeError)}),U(_e,"_save",function(o){let n=!1;ue._checkObject(o),n===!0&&console.log("%cSaving student %o to DB",T,o),q.Cfg.dbase.get(ue.tbl_name).push(JSON.parse(JSON.stringify(o))).write()}),U(_e,"exists",function(o,n=null){let a=!1,e=ue.findById(o,n);return a===!0&&console.log(`%cStudent ${o} exists in db ? ${e!==void 0}`,T),e!==void 0}),U(_e,"findById",function(o,n=null){let a=!0;return typeof o=="number"&&(o=o.toString(10)),re(typeof o=="string","You must provide a string.",TypeError),typeof n=="string"&&(n=dayjs(n)),n==null?a===!1?ue._findById(o,n):ue.m_findById(o,"null"):a===!1?ue._findById(o,n.toISOString()):ue.m_findById(o,n.toISOString())}),U(_e,"_findById",function(o,n=null){let a=!1,e=q.Cfg.dbase;typeof n=="string"&&(n=dayjs(n)),a===!0&&console.log(`%c_findById() searching student with id:(${typeof o})${o} in db`,T);var t=e.get(ue.tbl_name).find({id:o}).value();if(a===!0&&console.log("%c_findById() student %o is found",T,t),t!==void 0){if(n!==null){var l={...t},u=je.find(o,je.getType("FUNDING"),n);u!==void 0&&(l.funding=u.value);var c=je.find(o,je.getType("PATH"),n);return c!==void 0&&(l.path=c.value),l}return a===!0&&console.log("%c_findById() student final %o is found",T,t),t}}),U(_e,"m_findById",moize.default(ue._findById,{maxAge:6e5,isSerialized:!0})),U(_e,"getFunding",async function(o,n=null){return typeof n=="string"&&(n=dayjs(n)),await ue.m_getFunding(o,n)}),U(_e,"_getFunding",async function(o,n=null){let a=ue.findById(o,n);return a===void 0?(console.log('%c[Student._getFunding()]Student %s is not in db, fetching data:"funded mode" from webpage',T,o),a=await ue.getFundingFomDashboard(o),console.log("%c[Student._getFunding()]Student %s funding is %o",T,o,a),a.toLowerCase()):a.funding.toLowerCase()}),U(_e,"m_getFunding",moize.default(ue._getFunding,{maxAge:6e5,isSerialized:!0,isPromise:!0})),U(_e,"isAutoFunded",function(o){return console.log("%cFUNCTION DEPRECATED !!!!!!!!!!!!!!!!!!!!!! ",le),ue.getFunded(o).toLowerCase()===qe}),U(_e,"getFundingFomDashboard",async function(o){return(await gt(`https://openclassrooms.com/fr/mentorship/students/${o}/dashboard`,".mentorshipStudent__details > p")).innerText.trim()}),U(_e,"getPath",async function(o,n=null){let a=ue.findById(o,n);if(a==null){console.log(`%cStudent ${o} is not in db, fetching data: 'path' from webpage ....`,T);let e=await gt(`https://openclassrooms.com/fr/mentorship/students/${o}/dashboard`,"a[href*='paths/']");return e.innerText.length==0&&console.error(`%cStudent path is not readable from url : https://openclassrooms.com/fr/mentorship/students/${o}/dashboard`,le),e.innerText.trim()}else return a.path}),U(_e,"delete",function(o=null,n=null){let a=q.Cfg.dbase;if(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),o===null&&n==null){console.log("%cWanna suppress ALL Students from DB",T),a.get(ue.tbl_name).remove().write();return}if(n==null){a.get(ue.tbl_name).remove(function(e){return dayjs(e.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isBefore(n,"day")}).write();return}if(o==null){a.get(ue.tbl_name).remove(function(e){return dayjs(e.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isAfter(o,"day")}).write();return}a.get(ue.tbl_name).remove(function(e){return dayjs(e.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isBetween(o,n,"day","[]")}).write()}),U(_e,"deleteById",function(o,n=null){q.Cfg.dbase.get("students").remove(e=>e.id===o).write(),console.log(`%cAll students with id:${o} are removed from DataBase`,T)}),U(_e,"getAll",async(o,n)=>{let a=!0;var e=!1;let t=q.Cfg.dbase;var l="table.crud-list tbody";bDebug===!0&&console.log("%cgetAll() Enter function",T);let u=await gt("https://openclassrooms.com/fr/mentorship/dashboard/students",'script[id="mentorshipDashboardConfiguration"]');var c=JSON.parse(u.innerText.trim()),d=c.mentorStudents;bDebug===!0&&console.log("%cgetAll() collect this array of stundent %o",T,d);let f=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");var i=performance.now();await ue.getFundingFomDashboard(d[0].studentId),bDebug===!0&&console.log(`%cEstimated time for updating : ${(performance.now()-i)*d.length} ms`,T),Swal.fire({position:"top-end",icon:"info",toast:!0,title:`mise \xE0 jour de la base de donn\xE9e des \xE9tudiants...
cela peut prendre du temps ~ ${(performance.now()-i)*d.length/1e3} s`,showConfirmButton:!1,timer:1e3}),await Re(1e3),bDebug===!0&&console.log("%cWill process all students of board",T);for(let b of d){var y=b.studentId.toString(10),B=b.studentDisplayableName;bDebug===!0&&console.log('%c Working on student "%s"',T,B),Et(`Collecte les donn\xE9es de l'\xE9tudiant : ${B}`);var m=b.followedProjectSlug;m.length==0&&(m="non d\xE9fini"),bDebug===!0&&console.log('%cWill collect student "%s" funding',T,B);let g=await ue.getFundingFomDashboard(y);re(typeof y=="string","sStudentId need to be a string.",TypeError);var c=ue.m_findById(y,null);if(c===void 0){bDebug===!0&&console.log(`%cStudent ${B} (id:${y}) not present in student database will create it`,T),ue.add(y,B,m,g,f);continue}g.toLowerCase()!==c.funding.toLowerCase()&&(t.get(ue.tbl_name).find({id:y}).assign({funding:g.toLowerCase()}).write(),je.addFunding(y,c.funding.toLowerCase(),dayjs()),console.log(`%c[Student.getAll]Student ${B}(id:${y}) was already present in database but change of funding was detected (from ${c.funding.toLowerCase()} to ${g.toLowerCase()})`,T)),m!==c.path&&(t.get(ue.tbl_name).find({id:y}).assign({path:m}).write(),je.addPath(y,c.path,dayjs()),console.log(`%c[Student.getAll]Student ${B}(id:${y}) was already present in database but change of path was detected (from ${c.path} to ${m})`,T))}}),U(_e,"showList",function(){let n=q.Cfg.dbase.get(ue.tbl_name).value();var a="";a+="<table>",a+="<caption>Liste des \xE9tudiant</caption>",a+="<thead>",a+="<tr>",a+="<th>Nom</th><th>Parcours</th><th>Financement</th><th>Date de cr\xE9ation</th><th>Edition</th>",a+="</tr>",a+="</thead>",a+="<tbody>";for(var e in n)a+="<tr>",a+=`<td>${n[e].fullname}</td><td>${n[e].path}</td><td>${n[e].funding}</td>`,a+=`<td>${dayjs(n[e].created,"YYYY-MM-DDTHH:mm:ssZ[Z]").format("DD/MM/YYYY \xE0 HH:mm")}</td>`,a+=`<td><a href="https://openclassrooms.com/fr/mentorship/students/${n[e].id}/dashboard">${n[e].id}</a></td>`,a+="</tr>";a+="</tbody>",a+="</table>",Swal.fire({title:"<strong>Liste des Etudiants</strong>",icon:"info",html:a,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"fullscreen",onOpen:t=>{var l=t.querySelector("table"),u=new simpleDatatables.DataTable(l)}})}),U(_e,"createManually",async function(o,n,a){let e=["non pr\xE9sent dans la liste","Chef de projet digital","Chef de projet SI","D\xE9veloppeur d'application - Frontend","D\xE9veloppeur Web","Expert en strat\xE9gie marketing et communication ","Production de contenu web avec CMS et Content Marketing ","Tech lead"];var t="";t+="<style>",t+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",t+="form input {background: #fff;border: 1px solid #9c9c9c;}",t+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",t+="form button:hover {background: gold;}",t+="form label {padding: 0.5em 0.5em 0.5em 0;}",t+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",t+="form input:focus {outline: 3px solid gold;}",t+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}label {text-align: right;grid-column: 1 / 2;}input,button {grid-column: 2 / 3;}}",t+="</style>",t+='<form class="form1" action="">',t+='<label for="student_id" class="name">Reference</label>',t+='<input id="student_id" type="text" value="'+o+'">',t+='<label for="student_name" class="name">Name</label>',t+='<input id="student_name" type="text" value="'+n+'">',t+='<label for="funding">Autofinanc\xE9</label>',t+='<input id="funding" type="checkbox" value="autofunded">',t+='<label for="student_path">Parcours</label>',t+='<input id="student_path" name="student_path" type="text" list="student_path-list">',t+='<datalist id="student_path-list">';for(var l in e)t+=`<option>${e[l]}</option>`;t+="/<datalist>",t+='<label for="session_date">Date</label>',t+='<input id="session_date" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(a).format("YYYY-MM-DD")+'">',t+="</form>";let{value:u}=await Swal.fire({title:"<strong>Ajout d'un \xE9tudiant en mode manuel</strong>",icon:"info",html:t,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:`votre \xE9tudiant(e) ${n} n'a pas \xE9t\xE9 trouv\xE9`,preConfirm:()=>({student_id:document.getElementById("student_id").value,student_name:document.getElementById("student_name").value,student_path:document.getElementById("student_path").value,student_funding:document.getElementById("funding").checked,session_date:document.getElementById("session_date").value})});if(u&&u.hasOwnProperty("student_id")){var c="";u.student_funding===!0?c=qe:c=De,ue.add(u.student_id,u.student_name,u.student_path,c,u.session_date)}});var ge=_e;var Ln=function(){let p="refs",o=0,n=1,a=2,e={DEFAULT:0,SESSIONID_DATEREFID:1},t=function(){q.Cfg.dbase.get("refs").value()===void 0&&(console.log("%cDb dont' contain ref table create it",T),q.Cfg.dbase.assign({refs:[]}).write())},l=function(y,B,m=e.DEFAULT){let b=q.Cfg.dbase;var g=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");let M=u({key1:y,key2:B,type:m,created:g,updated:g});sn(50),re(Array.isArray(M)&&M.length>0,"Database insertion fail")},u=function(y){return q.Cfg.dbase.get(st.tbl_name).push(JSON.parse(JSON.stringify(y))).write()};return Object.freeze({tbl_name:p,TYPE:e,add:l,updKey1:function(y,B,m=e.DEFAULT){let b=q.Cfg.dbase,g;g=b.get(st.tbl_name).find(x=>x.key2===y&&x.type===m).assign({key1:B}).write(),console.log("%cNeedle  %o mValue %o sType %o",T,y,B,m),console.log("%c_r %o",T,g),re(Array.isArray(g)&&g.length>0,"Database insertion fail")},updKey2:function(y,B,m=e.DEFAULT){let b=q.Cfg.dbase,g;g=b.get(st.tbl_name).find(x=>x.key1===y&&x.type===m).assign({key2:B}).write(),console.log("%cNeedle  %o mValue %o sType %o",T,y,B,m),console.log("%c_r %o",T,g),re(Array.isArray(g)&&g.length>0,"Database insertion fail")},checkSupport:t,exists:function(y,B,m=e.DEFAULT){let b=st.getByKey(y,B,m);return console.log(`%cRef ${y} exists in db ? ${b!==void 0}`,T),b!==void 0},getByKey:function(y,B=1,m=e.DEFAULT){re(typeof B=="number","You must provide a number as index of key.",TypeError);let b=q.Cfg.dbase,g=null;if(B==1&&(g=b.get(st.tbl_name).find(x=>x.key1===y&&x.type===m).value()),B==2&&(g=b.get(st.tbl_name).find(x=>x.key2===y&&x.type===m).value()),g!=null)return g}})},st=Ln(),Ee=st;var Pn=function(){let p="meta",o=function(c){return re(typeof c=="string","You must provide a string.",TypeError),q.Cfg.dbase.get(_t.tbl_name).find({key:"dbVersion"}).assign({value:c}).write().value},n=function(){let c=q.Cfg.dbase.get(_t.tbl_name).find({key:"dbVersion"}).value();return typeof c=="undefined"?-1:c.value},a=function(){return q.Cfg.dbase.get("meta").remove(c=>!0).write()},e=function(){return console.log("%c resetDbVersion NE FONCTIONNE PAS",le),q.Cfg.dbase.get("meta").find({key:"dbVersion"}).remove(c=>!0).write()},t=function(c){return re(typeof c=="string","You must provide a string.",TypeError),q.Cfg.dbase.get(_t.tbl_name).find({key:"studentLstUpd"}).assign({value:c}).write().value},l=function(){let c=q.Cfg.dbase.get(_t.tbl_name).find({key:"studentLstUpd"}).value();return typeof c=="undefined"?-1:c.value};return Object.freeze({checkSupport:function(){q.Cfg.dbase.get("meta").value()===void 0&&(console.log("%cDb dont' contain meta table create it",T),q.Cfg.dbase.assign({meta:[]}).write()),n()==-1&&q.Cfg.dbase.get("meta").push({key:"dbVersion",value:"1.0.0"}).write(),l()==-1&&q.Cfg.dbase.get("meta").push({key:"studentLstUpd",value:dayjs("19701006").toISOString()}).write()},getDbVersion:n,setDbVersion:o,delDbVersion:e,setStudentListUpd:t,getStudentListUpd:l,tbl_name:p})},_t=Pn(),ke=_t;var Rn=function(){let p={},o="0",n=!0,a="https://api.openclassrooms.com",e="pending",t="canceled",l="completed",u="late canceled",c="marked student as absent",d=async function(){let E=await i();return E=JSON.parse(E),o=E.id,o},f=async function(){if(p.length==0)throw new Error("_header is empty, no xhr have been trapped so could't do some api request")},i=async function(){let E=a+"/me";return await C(E)},y=function(E,A){return{Range:`items=${E}-${A}`}},B=async(E=dayjs(),A=0,S=19)=>await g("AFTER",E,[e],A,S),m=async(E=dayjs(),A=0,S=19)=>await g("BEFORE",E,[e],A,S),b=async(E,A=0,S=19)=>await x(E,A,S),g=async function(E="BEFORE",A,S=[t,l,u,c],Y=0,I=19){bDebug=!0,typeof A=="string"&&(A=dayjs(A)),re(Yt(S)===!0,"You must provide an array as param aFilter.",TypeError),re(A instanceof dayjs,"date must be a string or a dayjs object.",TypeError);let R=S.join(","),O=encodeURIComponent(A.format("YYYY-MM-DDTHH:MM:ss[Z]"));R=encodeURIComponent(R);let j="";o==0&&await d(),E==="AFTER"?(j=`${a}/users/${o}/sessions?actor=expert&after=${O}&life-cycle-status=${R}`,console.log("URL IS %s",j)):(j=`${a}/users/${o}/sessions?actor=expert&before=${O}&life-cycle-status=${R}`,console.log("URL IS %s",j));let k=y(Y,I);return bDebug&&console.log("%c_getSessionOnDate url to call is:%s , params are %o",T,j,k),await v(j,y(Y,I))},x=async function(E=[],A=0,S=19){bDebug=!0,re(Yt(E)===!0,"You must provide an array as param aFilter.",TypeError),E.length==0&&(E=[t,l,u,c]);let Y=E.join(",");Y=encodeURIComponent(Y),o==0&&await d();let I=`${a}/users/${o}/sessions?actor=expert&life-cycle-status=${Y}`,R=y(A,S);bDebug&&console.log("%cUrl to call is:%o , params are %o",T,I,R);let O=await v(I,R);if(O==null)throw console.error("%cAPI have a problem returned value %o is null|undefined",le,O),new Error(`Request:${a}/users/${o}/sessions?actor=expert&life-cycle-status=${Y} have a problem`);return O.errors&&console.log("%cAPI return an error %s",le,O.errors.message),O},M=async function(E){let A=`${a}/users/${E}`;return await v(A)},$=async function(E){await f();let A=`${a}/users/${E}/paths/followed-path`;return await v(A)},D=async function(E){let A=`${a}/users/${E}/paths`;return await v(A)},v=async function(E,A={}){return await f(),await C(E,A)},h=async function(E){return await f(),await P(E,mData)},s=function(E){o=E},w=function(E){return decodeURI(E)!==decodeURIComponent(E)},C=async function(E="",A={},S="json",Y="",I=!0){let R=Object.assign({"User-Agent":"Mozilla/5.0"},p,A);if(S.toLowerCase()==="json")return(await Je.XHR({method:"GET",url:E,responseType:"application/json",headers:R}).catch(k=>{console.error("%c[Api_fetchGer()]Error is %o",le,k)})).responseText;if(S.toLowerCase==="html"){let j=await Je.XHR({method:"GET",url:E,responseType:"application/json",headers:R}).catch(oe=>{console.error("%c[Api_fetchGer()]Error is %o",le,oe)}),L=new DOMParser().parseFromString(j.responseText.replace(/\n/mg,""),"text/html");var O={};return I===!0?O=L.querySelectorAll(Y):O=L.querySelector(Y),O}},P=async function(E="",A={},S={}){};return function(){let E=!1,A="color:DarkSalmon;background-color:AliceBlue;";var S=window.XMLHttpRequest.prototype.open,Y=window.XMLHttpRequest.prototype.send,I=window.XMLHttpRequest.prototype.setRequestHeader,R=function(L,oe,me,ce,fe){return E===!0&&console.log("%cmethod %o url:%o, async:%o, user %o, password:%o",A,L,oe,me,ce,fe),this._url=oe,this._requestHeaders={},this._knox=[],S.apply(this,arguments)},O=function(){if(E===!0&&console.log("%cReady state changed to: %o",A,this.readyState),this.readyState===4&&this.status&&this.status>=200&&this.status<300){if(this._url.match(/^https:\/\/api.openclassrooms.com/g)){E===!0&&console.log("%cOPENCLASSROOMS API",A);for(var L in this._knox)p[this._knox[L].key]=this._knox[L].value;E===!0&&console.log("%c _header is %o",A,p),E===!0&&(w(this._url)?console.log("%cDECODED URL:%s",A,decodeURIComponent(this._url)):console.log("%c DECODED URL:%s",A,decodeURI(this._url)))}E===!0&&console.log("%cResponse is :%o",A,this.response)}if(this._onreadystatechange)return this._onreadystatechange.apply(this,arguments)},j=function(L){return E===!0&&console.log("%csendReplacement(%o)",A,L),this.onreadystatechange&&(this._onreadystatechange=this.onreadystatechange),this.onreadystatechange=O,Y.apply(this,arguments)},k=function(L,oe){return this._url.match(/^https:\/\/api.openclassrooms.com/g)&&this._knox.push({key:L,value:oe}),this._requestHeaders[L]=oe,I.apply(this,arguments)};window.XMLHttpRequest.prototype.open=R,window.XMLHttpRequest.prototype.send=j,window.XMLHttpRequest.prototype.setRequestHeader=k}(),Object.freeze({forge:s,getPendingSessionAfter:B,getPendingSessionBefore:m,getHistorySession:b,getUser:M,getUserFollowedPath:$,getUserPath:D,getMe:i,xGet:v,xPost:h})},Fn=Rn(),xt=Fn;var ze=function(){let o="history_session_cache",n=!1,a=function(){n===!0&&console.log("%cDb dont' contain table history_session_cache table, will create it",T),q.Cfg.dbase.assign({history_session_cache:[]}).write()},e=function(){return q.Cfg.dbase.get(o).value()!==void 0};return{find:function(i){if(e===!1)throw new Error("%c_HistoryDb:DBFindInTable() failed reason : table is not defined",T);return n===!0&&console.log('%c_HistoryDb:DBFindInTable()  Request is App.Cfg.dbase.get("%s").find(%o).value()',T,o,i),q.Cfg.dbase.get(o).find(i).value()},getAll:function(){if(e===!1)throw new Error("%c_HistoryDb:DBGetAll() failed reason : table is not defined",T);return n===!0&&console.log('%c_HistoryDb:DBGetAll()  Request is App.Cfg.dbase.get("%s").value()',T,o),q.Cfg.dbase.get(o).value()},insert:function(i){return e===!1&&a(),n===!0&&console.log("%c_HistoryDb:DBInsertInTable table:%s data:%o)",T,o,i),q.Cfg.dbase.get(o).push(i).write()},remove:function(i={}){if(e===!1)throw new Error("%c_HistoryDb:DBRemove() failed reason : table is not defined",T);return n===!0&&console.log("%c_HistoryDb:DBRemove with filter",T),rn(i)===!0&&console.log("%c_HistoryDb:DBRemove /! filter is empty",T),q.Cfg.dbase.get(o).remove(i).write()},reset:function(){return n===!0&&console.log("%c_History:DBResetTable",T),q.Cfg.dbase.get(o).remove().write()},update:function(i,y){if(e===!1)throw new Error("%c_HistoryDb:DBUpdateInTable() failed reason : table is not defined",T);return q.Cfg.dbase.get(o).find(i).assign(y).write()}}}(),Hn=function(){let p="history_session_cache",o=function(){let d=!0;q.Cfg.dbase.get("history_session_cache").value()===void 0&&(d&&console.log("%cDb dont' contain history_session_cache table create it",T),q.Cfg.dbase.assign({history_session_cache:[]}).write())},n=function(d){let f=!0;typeof d=="string"&&(d=dayjs(d)),re(d instanceof dayjs,"date must be a string or a dayjs object.",TypeError);let i=ze.find({id:+d.format("YYYYMMDD")});return f&&console.log(`%cHistory:_exists ${d.format("YYYYMMDD")} in db ? ${i!==void 0}`,T),i!==void 0},a=function(d){let f=!0;if(typeof d=="string"&&(d=dayjs(d)),re(d instanceof dayjs,"date must be a string or a dayjs object.",TypeError),d.get("day")<d.daysInMonth()&&(d=d.endOf("month")),f===!0&&console.log(`%cSearch in history session cache data for id: ${d.format("DD/MM/YYYY")}`,T),n(d)===!0){if(_r=ze.find({id:+d.format("YYYYMMDD")}),typeof _r.index!==void 0)return _r.index;throw new Error("_getSessionIndex() failed reason : property index is unknown")}return-1},e=function(d){let f=!1;typeof d=="string"&&(d=dayjs(d)),re(d instanceof dayjs,"date must be a string or a dayjs object.",TypeError),f===!0&&console.log(`%cSearch in history session cache NEAREST cached data for id: ${d.format("DD/MM/YYYY")}`,T);let i=+d.format("YYYYMMDD"),y=ze.getAll();if(y.length===0)return f===!0&&console.log("%cHistory session cache is empty",T),-1;y=y.map(b=>+b.id-i).filter(b=>b>0);let B=b=>Math.min(...b);if(y.length==0)return f===!0&&console.log("%cAll indexes  %o are later than your date:%s",T,ze.getAll(),d.format("DD/MM/YYYY")),-1;let m=B(y)+i;if(f===!0&&console.log("%cNearest data in history session cache is data with id: %o",T,m),n(m)===!0){if(y=ze.find({id:+m.format("YYYYMMDD")}),typeof y.index!==void 0)return y.index;throw new Error("[History._getNearestSessionIndex()] failed reason : property index is unknown")}return-1};return Object.freeze({tbl_name:p,getSameOrNearestSessionIndex:function(d){let f=a(d);return f===-1&&(f=e(d)),f},remove:function(d=null,f=null){typeof d=="string"&&(d=dayjs(d)),typeof f=="string"&&(f=dayjs(f));let i=function(){};return d!==null&&f!==null&&(i=function(y){return dayjs(y.id.toString(10)).isBetween(d,f,"day","[]")}),d==null&&f!==null&&(i=function(y){return dayjs(y.id.toString(10)).isBefore(f,"day")}),d!=null&&f==null&&(i=function(y){return dayjs(y.id.toString(10)).isAfter(d,"day")}),ze.remove(i)},reset:function(){return ze.reset()},setSessionIndex:function(d,f=0){typeof d=="string"&&(d=dayjs(d)),re(d instanceof dayjs,"date must be a string or a dayjs object.",TypeError),d.get("day")<d.daysInMonth()&&(d=d.endOf("month"));let i=a(d);return i==-1?i=ze.insert({id:+d.format("YYYYMMDD"),index:f}):i=ze.update({id:+d.format("YYYYMMDD")},{index:f}),i}})},Nn=Hn(),at=Nn;var ve=class{static getBetween(o,n){return typeof o=="string"&&(o=dayjs(o)),typeof n=="string"&&(o=dayjs(n)),q.Cfg.dbase.get(ve.tbl_name).filter(t=>dayjs(t.when).isSameOrBefore(n,"day")&&dayjs(t.when).isSameOrAfter(o,"day")).value()}},Te=ve;U(Te,"tbl_name","sessions"),U(Te,"_checkObject",function(o){!1===!0&&console.log("%cChecking object session:%o ",T,o),re(typeof o.id=="string","Session object id need to be a string.",TypeError),re(typeof o.cid=="number","Session object cid need to be a number.",TypeError),re(typeof o.who_id=="string","Session object who_id need to be a string.",TypeError),re(typeof o.who_name=="string","Session object who_name need to be a string.",TypeError),re(typeof o.status=="string","Session object status need to be a string.",TypeError),re(typeof o.type=="string","Session object type need to be a string.",TypeError),re(typeof o.lvl=="string","Session object lvl need to be a string.",TypeError),re(typeof o.when=="string","Session object when need to be a string.",TypeError),re(typeof o.path=="string","Session object path need to be a string.",TypeError),re(typeof o.funding=="string","Session object funding need to be a string.",TypeError)}),U(Te,"add",async function(o){let n=30,a=!1;a===!0&&console.log("%cSession.add() so you wanna add a session %o to database",T,o);let e=q.Cfg.dbase;if(GM_config.get("checksessionalreadyexists")===!0)var t=!0;if(a===!0&&console.log("%cSession.add() will search if session %o is already in database",T,o),o.id.length>0){if(t===!0&&ve.exists(o.id)===!0){a===!0&&console.info(`%cSession.add() session id:${o.id} already present in database table sessions, skip it!`,T);return}}else if(t===!0&&ve.exists(o.cid)===!0){a===!0&&console.info(`%cSession.add() session cid:${o.cid} already present in database table sessions, skip it!`,T);return}o.type.toLowerCase()==="presentation"&&(o.type="soutenance"),Ae.isInOldMode(dayjs(o.when))?(o.funding=De,o.type.toLowerCase()==="soutenance"?o.path="n/a (defense)":o.path="n/a (old mode)"):o.type.toLowerCase()==="soutenance"?(o.funding=De,o.path="n/a (defense)"):(ge.exists(o.who_id)===!1&&(console.warn("%cStudent %s not in Db, will updating student db by fetching students list from dashboard",Ge,o.who_id),a===!0&&console.log("%cLast Update of Student BDD was %i min ago",T,dayjs(ke.getStudentListUpd()).diff(dayjs(),"m")),dayjs(ke.getStudentListUpd()).diff(dayjs(),"m")<-n?(await ge.getAll(),ke.setStudentListUpd(dayjs().toISOString())):(console.log("%c[Session.add()]last Update of database DB was less than %i min ago",T,n),await ge.createManually(o.who_id,o.who_name,o.when),moize.default.isMoized(ge.m_findById)&&ge.m_findById.has([o.who_id,null])&&(ge.m_findById.remove([o.who_id,null]),a===!0&&console.log("%c[Session.add()]student %s removed from the m_findById function cache",T,o.who_id))),ge.exists(o.who_id,o.when)==!1&&(console.warn(`%c[Session.add()] Student ${o.who_id} which exists at ${o.when} still not exit in Db, have to manually create him/her`,Ge),await ge.createManually(o.who_id,o.who_name,o.when),moize.default.isMoized(ge.m_findById)&&ge.m_findById.has([o.who_id,o.when])&&(ge.m_findById.remove([o.who_id,o.when]),a===!0&&console.log("%c[Session.add()]student %s removed from the m_findById function cache",T,o.who_id)))),o.funding=await ge.getFunding(o.who_id,o.when),o.path=await ge.getPath(o.who_id,o.when)),o.cid===void 0&&(a===!0&&console.log("%c[Session.add()] need to calculate a cid]",T),o.cid=ve.getHashId(o.when,o.who_id)),a===!0&&console.log("%cSession.add() calculated id:%s",T,o.cid),_r=Ee.getByKey(o.cid,2,Ee.TYPE.SESSIONID_DATEREFID),_r!==void 0&&(a===!0&&console.log("%cSession.add() I've found a ref %d by using key (%s)%d",T,_r.key1,typeof o.cid,o.cid),o.id=_r.key1.toString()),ve._save(o)}),U(Te,"_save",function(o){var n=!1;ve._checkObject(o),o.lvl==""&&(o.lvl="2"),o.lvl.lvl=parseInt(o.lvl.lvl,10),bDebug===!0&&console.log(`%c[Session._save()] saving session id:${o.id} of ${o.who_name}[cid:${o.cid}](${o.who_id}) at ${o.when} to DB`,T),q.Cfg.dbase.get(ve.tbl_name).push(JSON.parse(JSON.stringify(o))).write()}),U(Te,"exists",function(o){let n=q.Cfg.dbase;var a=!1;a===!0&&console.log(`%c[Session.exist()] will search existence of session id:(${typeof o})${o} in database`,T);var e=ve.findById(o);return e!==void 0}),U(Te,"findById",function(o){let n=q.Cfg.dbase;var a=n.get(ve.tbl_name).find({id:o}).value();return a===void 0&&(a=n.get(ve.tbl_name).find({cid:o}).value()),a}),U(Te,"delete",function(o=null,n=null){let a=q.Cfg.dbase;if(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),o===null&&n==null){console.log("%cWanna suppress ALL Sessions from DB",T),a.get(ve.tbl_name).remove().write();return}if(n==null){a.get(ve.tbl_name).remove(function(e){return dayjs(e.when).isBefore(n),"day"}).write();return}if(o==null){a.get(ve.tbl_name).remove(function(e){return dayjs(e.when).isAfter(o,"day")}).write();return}a.get(ve.tbl_name).remove(function(e){return dayjs(e.when).isBetween(o,n,"day","[]")}).write()}),U(Te,"deleteById",function(o){q.Cfg.dbase.get("sessions").remove(a=>a.id===o).write(),console.log(`%cSession ${o} suppressed from DB`,T)}),U(Te,"parseTable",function(o){var n=o.children[0].children[0].innerText,a=Ke(o.children[0]),e=o.children[1].children[0].innerText.trim(),t=Ke(o.children[1],-2),l=o.children[2].innerText.trim().toLowerCase(),u=o.children[3].children.length?o.children[3].children[0].innerText.trim().toLowerCase():"session",c=-1;o.children[4].children.length>0&&(c=o.children[4].children[0].innerText.trim()),n=Xt(n);var d={id:a,when:n,who_id:t,who_name:e,status:l,type:u,lvl:c};return d}),U(Te,"getHashId",function(o,n){return o instanceof dayjs&&(o=o.toISOString()),typeof n=="number"&&(n=n.toString(10)),re(typeof o=="string"&&typeof n=="string","getId need two string",TypeError),on(o+n)}),U(Te,"parseRow",function(o){var n=o.children[0].innerText.length>0?o.children[0].innerText.trim().toLowerCase():"session",a=o.children[0].querySelector("svg").getAttribute("aria-label").trim().toLowerCase(),e=o.children[1].querySelector("time").dateTime;e=dayjs(e).toISOString();var t=Ke(o.children[2],-2),l=o.children[2].innerText.trim(),u=ve.getHashId(e,t),c=o.children[3].innerText.trim();c=c.replace(/[^\d]/gmis,"");var d={id:"",cid:u,when:e,who_id:t,who_name:l,status:a,type:n,lvl:c};return d}),U(Te,"getSessionsFromAPI",async function(o,n){let a=!1,e=999,t=0,l=!0,u=0,c=20;typeof o=="string"&&(o=dayjs(o)),re(o instanceof dayjs,"dtFrom must be a string or a dayjs object.",TypeError),typeof n=="string"&&(n=dayjs(n)),re(n instanceof dayjs,"dtTo must be a string or a dayjs object.",TypeError);let d=at.getSameOrNearestSessionIndex(n);for(d!==void 0&&typeof d=="number"&&d>u&&(u=d),NProgress.start();l===!0;){if(t>e){console.error("%c[Session.getSessionsFromAPI()] EMERGENCY EXIT LOOP",le);break}t+=1;var f=u+(c-1),i=await xt.getHistorySession([],u,f);if(i===null)throw new Error("Api.getHistorySession is null");var y=JSON.parse(i);if(y.errors)throw Object.entries(oSession.errors).forEach(m=>console.log("%cApi.getHistorySession send us some errors : %s",Ge,m[1].message)),new Error("Api.getHistorySession send us some errors ");a===!0&&console.log("%cgetSessionsFromAPI() Sessions are %o",T,y),u=f+1,oSession=ve.parseRowFromApi(y[y.length-1]),console.log("%c[Session.getSessionsFromAPI()]La derni\xE8re session r\xE9cuper\xE9e par api date de:%s et nous collectons les sessions entre %s et %s",T,dayjs(oSession.when).format("DD/MM/YYYY"),dayjs(o).format("DD/MM/YYYY"),dayjs(n).format("DD/MM/YYYY")),a===!0&&console.log("%cgetSessionsFromAPI() last session of loaded page is %o",T,oSession),console.log("%c[Session.getSessionsFromAPI()] compare last session date %s avec la date de d\xE9but %s est ce ant\xE9rieur  %o",T,dayjs(oSession.when).format("DD/MM/YYYY"),dayjs(o).format("DD/MM/YYYY"),dayjs(oSession.when).isBefore(o)),dayjs(oSession.when).isBefore(o)===!0&&(l=!1,a===!0&&console.log("%cgetSessionsFromAPI() last session is before start date of parsing %s STOP browsing....",T,dayjs(oSession.dtFrom).format("DD/MM/YYYY")),at.setSessionIndex(oSession.when,u));let B=y.filter(m=>dayjs(m.sessionDate).isBetween(o,n,"day","[]"));a===!0&&console.log("%cgetSessionsFromAPI() Filtered on date Sessions are %o",T,B);for(let m of B){oSession=ve.parseRowFromApi(m),a===!0&&console.log("%cgetSessionsFromAPI()  will call Session.add() on %o",T,oSession);let b=await ve.add(oSession)}u=f+1,NProgress.set(.4)}NProgress.remove()}),U(Te,"parseRowFromApi",function(o){bDebug=!1,bDebug===!0&&console.log("%cparseRowFromApi() oSession is %o",T,o);let n={};return n.id="",n.who_id=o.recipient.id,typeof n.who_id=="number"&&(n.who_id=n.who_id.toString(10)),n.who_name=o.recipient.displayableName,o.status===Wt&&(n.status=Xe),o.status===Kt&&(n.status=et),o.status===Vt&&(n.status=tt),o.status===Jt&&(n.status=nt),n.status===void 0&&(n.status=o.status),n.type=o.type,n.type.toLowerCase()==="mentoring"&&(n.type="mentorat"),n.lvl=o.projectLevel,n.lvl==null&&(n.lvl=""),n.when=dayjs(o.sessionDate).toISOString(),n.path=null,n.funding=null,n.cid=ve.getHashId(n.when,n.who_id),n});var xe=Te;var vt=class{},ft=vt;U(ft,"calculateBill",function(o,n){let a=n.format("YYYYMM");return it.exists(a)===!0?(console.log(`%cUse Archived version ${a} of accounting`,T),it.get(a).data):(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),vt.m_calculateBill(o,n))}),U(ft,"_calculateBill",function(o,n){typeof o=="string"&&(o=dayjs(o)),typeof n=="string"&&(n=dayjs(n));let a=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");var e=0,t=0,l=performance.now();let d=q.Cfg.dbase.get(xe.tbl_name).filter(s=>dayjs(s.when).isSameOrBefore(n,"day")&&dayjs(s.when).isSameOrAfter(o,"day")).value(),f=d.length,i={from:o,to:n,created_at:null,maxLevel:ot,number:0,amount:0,errors:{funding:[],level:[],path:[],status:[],type:[]},flatFee:[]},y=0,B=0,m=[];e=performance.now();let b=vt.getPriceList(o);t=performance.now(),console.log("%cGetPriceList took "+(t-e)+" milliseconds.",Pe);let g=nn([ot+1,ot+1,ot+1,ot+1]);for(var x=0;x<f;x+=1){let s=d[x];var M=0;s.status===Xe&&(M=Z),s.status===et&&(M=X),s.status===tt&&(M=V),(s.status===nt||s.status===mt)&&(M=ee);var $=0;s.type.toLowerCase()==="session"&&($=F),s.type.toLowerCase()==="mentorat"&&($=zt),s.type.toLowerCase()==="soutenance"&&($=H),s.path!=null&&s.path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&s.type!=="soutenance"&&($=N);var D=0;let w=Ae.isInOldMode(o);if(w===!0&&(D=s.isFunded===!0?W:z),s.funding===qe&&(D=z),s.funding===De&&(D=W),s.funding===Ze&&(D=K),s.lvl==""){i.errors.level.push(s);continue}if(typeof s.lvl=="string"&&(s.lvl=parseInt(s.lvl,10)),s.lvl<0){i.errors.level.push(s);continue}if(w===!1&&s.funding!==qe&&s.funding!==De&&s.funding!==Ze){i.errors.funding.push(s);continue}if(s.type.toLowerCase()!=="session"&&s.type.toLowerCase()!=="mentorat"&&$!==H&&$!==N){i.errors.type.push(s);continue}if(s.status!==Xe&&s.status!==et&&s.status!==tt&&s.status!==nt&&s.status!==mt){i.errors.status.push(s);continue}let C=g.get($,M,D,+s.lvl);C===void 0&&(C={number:0,amount:0,data:[]}),C.number+=1,y+=1,s.lvl<0?(C.amount+=0,B+=0):(C.amount+=1*b[s.lvl][$][M][D],B+=1*b[s.lvl][$][M][D]),C.data.push(s),g.set($,M,D,+s.lvl,C),$===F&&D===z&&m.push({id:+s.who_id,who_id:s.who_id,who_name:s.who_name})}var v=[];e=performance.now(),v=_.uniqBy(m,"id"),i.flatFee=v,i.number=y,i.amount=B,i.number+i.errors.funding.length+i.errors.level.length+i.errors.path.length+i.errors.status.length+i.errors.type.length<f&&(console.log(`%cError total number of sessions is ${f} and total number of sessions in bill ${y} + all errors are different`,le),console.log("errors are",i.errors),console.log("sessions are",d)),i.created_at=a,g.set(0,0,0,0,i);var h=performance.now();return console.log("%cFunction took "+(h-l)+" milliseconds.",Pe),i.errors.funding.length+i.errors.level.length+i.errors.path.length+i.errors.status.length+i.errors.type.length>0&&console.log("%cWarning some errors found %o",Ge,i.errors),g}),U(ft,"m_calculateBill",moize.default(vt._calculateBill,{maxAge:12e4,isSerialized:!0})),U(ft,"getPriceList",function(o){typeof o=="string"&&(o=dayjs(o));var n=[0,Ht,Nt,Ut,Gt,qt,Qt];let a=Ae.isInOldMode(o);var e=new Array(7);for(let t=1;t<=ot;t+=1){let l=n[t],u=n[t]/2,c=n[t]/4;a?(e[t]=new Array(3),e[t][F]=new Array(5),e[t][F][Z]=new Array(4),e[t][F][Z][z]=l,e[t][F][Z][W]=l,e[t][F][Z][K]=l,e[t][F][X]=new Array(4),e[t][F][X][z]=0,e[t][F][X][W]=0,e[t][F][X][K]=0,e[t][F][V]=new Array(4),e[t][F][V][z]=u,e[t][F][V][W]=u,e[t][F][V][K]=u,e[t][F][ee]=new Array(4),e[t][F][ee][z]=u,e[t][F][ee][W]=u,e[t][F][ee][K]=u,e[t][H]=new Array(5),e[t][H][Z]=new Array(4),e[t][H][Z][z]=l,e[t][H][Z][W]=l,e[t][H][Z][K]=l,e[t][H][X]=new Array(4),e[t][H][X][z]=0,e[t][H][X][W]=0,e[t][H][X][K]=0,e[t][H][V]=new Array(4),e[t][H][V][z]=u,e[t][H][V][W]=u,e[t][H][V][K]=u,e[t][H][ee]=new Array(4),e[t][H][ee][z]=u,e[t][H][ee][W]=u,e[t][H][ee][K]=u,e[t][N]=new Array(5),e[t][N][Z]=new Array(4),e[t][N][Z][z]=l,e[t][N][Z][W]=l,e[t][N][Z][K]=l,e[t][N][X]=new Array(4),e[t][N][X][z]=0,e[t][N][X][W]=0,e[t][N][X][K]=0,e[t][N][V]=new Array(4),e[t][N][V][z]=u,e[t][N][V][W]=u,e[t][N][V][K]=u,e[t][N][ee]=new Array(4),e[t][N][ee][z]=u,e[t][N][ee][W]=u,e[t][N][ee][K]=u):(e[t]=new Array(3),e[t][F]=new Array(5),e[t][F][Z]=new Array(4),e[t][F][Z][z]=u,e[t][F][Z][W]=l,e[t][F][Z][K]=l,e[t][F][X]=new Array(4),e[t][F][X][z]=0,e[t][F][X][W]=0,e[t][F][X][K]=0,e[t][F][V]=new Array(4),e[t][F][V][z]=0,e[t][F][V][W]=0,e[t][F][V][K]=0,e[t][F][ee]=new Array(4),e[t][F][ee][z]=c,e[t][F][ee][W]=u,e[t][F][ee][K]=u,e[t][H]=new Array(5),e[t][H][Z]=new Array(4),e[t][H][Z][z]=l,e[t][H][Z][W]=l,e[t][H][Z][K]=l,e[t][H][X]=new Array(4),e[t][H][X][z]=0,e[t][H][X][W]=0,e[t][H][X][K]=0,e[t][H][V]=new Array(4),e[t][H][V][z]=0,e[t][H][V][W]=0,e[t][H][V][K]=0,e[t][H][ee]=new Array(4),e[t][H][ee][z]=u,e[t][H][ee][W]=u,e[t][H][ee][K]=u,e[t][N]=new Array(5),e[t][N][Z]=new Array(4),e[t][N][Z][z]=l,e[t][N][Z][W]=l,e[t][N][Z][K]=l,e[t][N][X]=new Array(4),e[t][N][X][z]=0,e[t][N][X][W]=0,e[t][N][X][K]=0,e[t][N][V]=new Array(4),e[t][N][V][z]=0,e[t][N][V][W]=0,e[t][N][V][K]=0,e[t][N][ee]=new Array(4),e[t][N][ee][z]=u,e[t][N][ee][W]=u,e[t][N][ee][K]=u)}return e});var He=ft;var $t=function(p,o){let n=[[0,1,2,3,4,5,5],[5,1,2,3,4,5,5],[4,5,1,2,3,4,4],[3,4,5,1,2,3,3],[2,3,4,5,1,2,2],[1,2,3,4,5,1,1],[0,1,2,3,4,5,0]];return Math.trunc(o.diff(p,"days")/7)*5+n[p.day()][o.day()]};var pt=class{};U(pt,"detail_bill","truc"),U(pt,"getListDetailBill",function(o,n){let e=q.Cfg.dbase.get(xe.tbl_name).filter(x=>dayjs(x.when).isSameOrBefore(n,"day")&&dayjs(x.when).isSameOrAfter(o,"day")).sortBy(function(x){return dayjs(x.when).valueOf()}).value(),t=Ae.getOldModeDate(),l=He.getPriceList(t.subtract(1,"day")),u=He.getPriceList(t),c=0;var d=_.cloneDeep(e);for(var f in d){var i=0,y=0,B=!0,m=0;d[f].status===Xe&&(m=Z),d[f].status===et&&(m=X),d[f].status===tt&&(m=V),(d[f].status===nt||d[f].status===mt)&&(m=ee);var b=0;d[f].type.toLowerCase()==="session"&&(b=F),d[f].type.toLowerCase()==="soutenance"&&(b=H),d[f].path!=null&&d[f].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&d[f].type!=="soutenance"&&(b=N);var g=0;d[f].funding===qe&&(g=z),d[f].funding===De&&(g=W),d[f].funding===Ze&&(g=K),Ae.isInOldMode(dayjs(d[f].when))?i=+d[f].lvl>0?l[+d[f].lvl][b][m][g]:0:(B=!1,i=+d[f].lvl>0?u[+d[f].lvl][b][m][g]:0),c+=i,d[f].iPu=i,d[f].oldMode=B,d[f].iCumul=c}return d}),U(pt,"getListStatistic",function(o,n){let a=o.clone(),e=a.endOf("month"),t=[],l=[],u=0,c=n.diff(o,"month");for(var d=performance.now();a.isSameOrBefore(n,"day");)t.push(He.calculateBill(a,e)),a=a.add(1,"month"),e=a.endOf("month");var f=performance.now();console.log("%cComputed data between the two dates in"+(f-d)+" milliseconds.",Pe),a=o.clone(),e=a.endOf("month");let i=0,y=0,B=0,m=0,b=0,g=0,x=0;for(;u<=c;){let $=t[u].get(0,0,0,0),D=$.maxLevel;l[u]={header:{dtFrom:null,dtTo:null,created_at:null},sessions:{total:0,nb:0,pu:0,nbc:0},defenses:{total:0,nb:0,pu:0,nbc:0},coaches:{total:0,nb:0,pu:0,nbc:0},bonus:0,kpi:{jrs:0,hrs:0,hrsp:0}};let v=1;for(;v<D;){let s=0,w=0,C=0,P=0;i=t[u].get(F,Z,z,v),B=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(F,Z,W,v),y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(F,Z,K,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,Ae.isInOldMode(a)?(l[u].kpi.hrs+=(i+y+B)*(45/60),l[u].kpi.hrsp+=(i+y+B)*(GM_config.get("nbHrsS")/60)):(l[u].kpi.hrs+=B*(30/60),l[u].kpi.hrsp+=B*(GM_config.get("nbHrsAfM")/60),l[u].kpi.hrs+=(i+y)*(45/60),l[u].kpi.hrsp+=(i+y)*(GM_config.get("nbHrsfM")/60)),i=t[u].get(F,X,z,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(F,X,W,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(F,X,K,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,Ae.isInOldMode(a)?(i=t[u].get(F,V,z,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(F,V,W,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(F,V,K,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount):(i=t[u].get(F,V,z,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(F,V,W,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(F,V,K,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount),i=t[u].get(F,ee,z,v),B=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(F,ee,W,v),y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(F,ee,K,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i,l[u].kpi.hrs+=(i+y+B)*(15/60),l[u].kpi.hrsp+=(i+y+B)*(15/60),s=l[u].sessions.total,w=l[u].sessions.nb,C=l[u].sessions.pu,P=l[u].sessions.nbc,l[u].sessions={total:b+s,nb:m+w,pu:(b+s)/(m+w),nbc:g+P},s=0,w=0,C=0,P=0,m=0,b=0,g=0,x=0,i=t[u].get(H,Z,z,v),B=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(H,Z,W,v),y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(H,Z,K,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,l[u].kpi.hrs+=(i+y+B)*(45/60),l[u].kpi.hrsp+=(i+y+B)*(GM_config.get("nbHrsD")/60),i=t[u].get(H,X,z,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(H,X,W,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(H,X,K,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(H,V,z,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(H,V,W,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(H,V,K,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(H,ee,z,v),B=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(H,ee,W,v),y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(H,ee,K,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,l[u].kpi.hrs+=(i+y+B)*(15/60),l[u].kpi.hrsp+=(i+y+B)*(15/60),s=l[u].defenses.total,w=l[u].defenses.nb,C=l[u].defenses.pu,P=l[u].defenses.nbc,l[u].defenses={total:b+s,nb:m+w,pu:(b+s)/(m+w),nbc:g+P},s=0,s=0,w=0,C=0,P=0,m=0,b=0,g=0,x=0,i=t[u].get(N,Z,z,v),B=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(N,Z,W,v),y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(N,Z,K,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,l[u].kpi.hrs+=(i+y+B)*(45/60),l[u].kpi.hrsp+=(i+y+B)*(GM_config.get("nbHrsC")/60),i=t[u].get(N,X,z,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(N,X,W,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(N,X,K,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(N,V,z,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(N,V,W,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(N,V,K,v),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[u].get(N,ee,z,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(N,ee,W,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[u].get(N,ee,K,v),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,s=l[u].coaches.total,w=l[u].coaches.nb,C=l[u].coaches.pu,P=l[u].coaches.nbc,i=typeof i=="undefined"?0:i.number,l[u].kpi.hrs+=i*(15/60),l[u].kpi.hrsp+=i*(15/60),l[u].coaches={total:b+s,nb:m+w,pu:(b+s)/(m+w),nbc:g+P},v+=1}let h=$.flatFee.length;for(var M=0;M<h;M+=1)l[u].bonus+=30;e.isAfter(n,"day")&&(e=n.clone()),l[u].kpi.jrs=$t(a,e),l[u].header.dtFrom=a.format("YYYY-MM-DD"),l[u].header.dtTo=e.format("YYYY-MM-DD"),l[u].header.created_at=dayjs().format("YYYY-MM-DD HH:mm:ss"),a=a.add(1,"month"),e=a.endOf("month"),u+=1}return l}),U(pt,"getListStatisticOld",function(o,n){let a=o.clone(),e=a.endOf("month"),t=[],l=[],u=n.get("month")-o.get("month");for(var c=performance.now();a.isSameOrBefore(n,"day");)t.push(He.calculateBill(a,e)),a=a.add(1,"month"),e=a.endOf("month");var d=performance.now();console.log("%cComputed data between the two dates in"+(d-c)+" milliseconds.",Pe);let f=0;for(a=o.clone(),e=a.endOf("month"),console.log(t);f<=u;){let i=t[f][0].max_level;l[f]={header:{dtFrom:null,dtTo:null,created_at:null},sessions:{total:0,nb:0,pu:0,nbc:0},defenses:{total:0,nb:0,pu:0,nbc:0},coaches:{total:0,nb:0,pu:0,nbc:0},bonus:0,kpi:{jrs:0,hrs:0,hrsp:0}};let y=1;for(;y<i;){let B=[...Array(8).keys()];for(let m=0;m<B.length;m+=1)l[f].sessions.total+=t[f][y].sessions.number[m]*t[f][y].sessions.pu[m],l[f].sessions.nb+=t[f][y].sessions.number[m],l[f].defenses.total+=t[f][y].defenses.number[m]*t[f][y].defenses.pu[m],l[f].defenses.nb+=t[f][y].defenses.number[m],Ae.isInOldMode(a)?[1,5].includes(m)&&(l[f].sessions.nbc+=t[f][y].sessions.number[m],l[f].defenses.nbc+=t[f][y].defenses.number[m]):[1,2,5,6].includes(m)&&(l[f].sessions.nbc+=t[f][y].sessions.number[m],l[f].defenses.nbc+=t[f][y].defenses.number[m]),Ae.isInOldMode(a)?(l[f].kpi.hrs+=(t[f][y].sessions.number[m]-t[f][y].defenses.number[m])*(45/60),l[f].kpi.hrsp+=(t[f][y].sessions.number[m]-t[f][y].defenses.number[m])*(GM_config.get("nbHrsfM")/60)):([4,5,6,7].includes(m)&&(l[f].kpi.hrs+=(t[f][y].sessions.number[m]-t[f][y].defenses.number[m])*(30/60),l[f].kpi.hrsp+=(t[f][y].sessions.number[m]-t[f][y].defenses.number[m])*(GM_config.get("nbHrsAfM")/60)),[0,1,2,3].includes(m)&&(l[f].kpi.hrs+=(t[f][y].sessions.number[m]-t[f][y].defenses.number[m])*(45/60),l[f].kpi.hrsp+=(t[f][y].sessions.number[m]-t[f][y].defenses.number[m])*(GM_config.get("nbHrsfM")/60))),l[f].kpi.hrs+=t[f][y].defenses.number[m]*(45/60),l[f].kpi.hrsp+=t[f][y].defenses.number[m]*(GM_config.get("nbHrsD")/60);y+=1}l[f].sessions.pu=l[f].sessions.total/(l[f].sessions.nb-l[f].sessions.nbc),l[f].defenses.pu=l[f].defenses.total/(l[f].defenses.nb-l[f].defenses.nbc),l[f].coaches.total=l[f].sessions.total-l[f].defenses.total,l[f].coaches.nb=l[f].sessions.nb-l[f].defenses.nb,l[f].coaches.nbc=l[f].sessions.nbc-l[f].defenses.nbc,l[f].coaches.pu=l[f].coaches.total/(l[f].coaches.nb-l[f].coaches.nbc);for(let B=0;B<t[f][0].bonus.length;B+=1)l[f].bonus+=t[f][0].bonus[B].sessions>0?30:0;e.isAfter(n,"day")&&(e=n.clone()),l[f].kpi.jrs=$t(a,e),l[f].header.dtFrom=a.format("YYYY-MM-DD"),l[f].header.dtTo=e.format("YYYY-MM-DD"),l[f].header.created_at=dayjs().format("YYYY-MM-DD HH:mm:ss"),a=a.add(1,"month"),e=a.endOf("month"),f+=1}return l});var Ct=pt;var kt=class{static changePgIfNeeded(o,n,a,e){var t=e.getPageCount(),l=e.getPages()[t-1],u=l.fontSize,c=l.getFont(),d=l.lineHeight;return o<n&&(a=1,l=e.addPage(),l.font=c,l.setFontSize(u),l.lineHeight=d),[a,l]}};U(kt,"addFooter",async function(o,n,a={}){let{degrees:e,PDFDocument:t,rgb:l,StandardFonts:u}=PDFLib,c=o.getPageCount(),d="8".repeat(c),f=await o.embedFont(u.TimesRoman),i=12,y=f.widthOfTextAtSize(`page ${d} / ${d}`,i),B=10,m=10,b=1,g=l(0/255,0/255,0/255),x=l(253/255,246/255,227/255),M=5,$=5,D=3,v=3,h=!0;o.getPages().forEach((s,w)=>{if(!(h===!0&&w==0)){let{width:C,height:P}=s.getSize(),Q=i+2*b+D+v;s.moveTo(B+M,i+v),s.setFont(f),s.setFontSize(i),s.setFontColor(l(1,0,0)),n!==void 0&&s.drawText(`${n}`),s.drawText(`page ${w+1} / ${c}`,{x:C-y-$}),s.drawRectangle({x:B,y:10,width:C-(B+m),height:Q,color:x,opacity:.6,borderColor:g,borderWidth:b})}})});var We=kt;var an=async function(){let p=q.Cfg.dbase;return await Swal.mixin({confirmButtonText:"Suivant &rarr;",showCancelButton:!0,progressSteps:["0","1","2","3","4","5"],onOpen:function(i){console.log("...onOpen")},onRender:function(i){console.log("....onUpdate")},onClose:function(i){console.log(".....onClose")},onAfterClose:function(i){console.log("......onAfterClose")},onDestroy:function(i){console.log(".......onDestroy")}}).queue([{title:"Migration de la base",html:"<p>Cette migration va corriger la base et ajouter les nouveaux champs n\xE9cessaires, l`interrpuption du traitement est sans danger (mais ce n' est pas une raison !)</p>"},{title:"Correction de la table \xE9tudiant",html:"<p>Correction de la liste des \xE9tudiants (who_id)",onOpen:async function(i){console.log("%cMigration table des \xE9tudiants correction du who_id",T),Swal.showLoading();var y=dayjs("2020-06-01"),B=p.get("students"),m=B.value(),b=p.get("sessions").filter(D=>dayjs(D.when).isSameOrAfter(y,"day")),g=B.size().value(),x=Swal.getContent().textContent;for(c=0;c<g;c+=1){var M=b.find(v=>v.who_name===m[c].fullname).value();M!==void 0&&B.get(c).assign({who_id:M.who_id}).write();let D=Swal.getContent();D!=null&&(D.innerHTML=`${x}<br /><p>Traitement en cours : ${c}/${m.length}</p>`),await Re(1)}Swal.hideLoading();let $=Swal.getContent();$!=null&&($.textContent=`Traitement termin\xE9 : ${m.length}/${m.length}`)}},{title:"Correction de la table \xE9tudiant",html:"<p>Correction de la liste des \xE9tudiants funded devient funding</p>",onOpen:async function(i){console.log("%cMigration : table des \xE9tudiants suppression de l'ancien champs et ajout du champs funding",T),Swal.showLoading();for(var y=p.get("students"),B=y.size().value(),m=Swal.getContent().textContent,b=0;b<B;b+=1){var g=y.get(b).value().fundedby;if(g===void 0){console.log("%cStudent ${oListStudents.get(i).who_name} already converted, skip it",T);continue}y.get(b).unset(["fundedby"]).assign({funding:g}).write(),console.log("%cStudent ${oListStudents.get(i).who_name} create field funding and remove fundedby",T);let M=Swal.getContent();M!=null&&(M.innerHTML=`${m}<br /><p>Traitement en cours : ${b}/${B}</p>`),await Re(1)}Swal.hideLoading();let x=Swal.getContent();x!=null&&(x.textContent=`Traitement termin\xE9 : ${B}/${B}`)}},{title:"Correction table Etudiants",html:"<p>Correction de la liste des sessions, ajout du path dans la session</p>",onOpen:async function(i){console.log("%cMigration table des sessions correction de id_who",T),Swal.showLoading();var y=dayjs("2020-06-01"),B=p.get("students"),m=B.value(),b=p.get("sessions").filter(v=>dayjs(v.when).isSameOrAfter(y,"day")),g=b.filter(v=>v.type!="soutenance").value(),x=Swal.getContent().textContent;for(c=0;c<g.length;c+=1){var M=B.find({who_id:g[c].who_id}).value();console.log("found",M);var $=M!==void 0&&M.path.length>0?M.path:"0-unknown";p.get("sessions").find({id:g[c].id}).assign({path:$}).write();let v=Swal.getContent();v!=null&&(v.innerHTML=`${x}<br /><p>Traitement en cours : ${c}/${g.length}</p>`),await Re(1)}Swal.hideLoading();let D=Swal.getContent();D!=null&&(D.textContent=`Traitement termin\xE9 : ${c}/${g.length}`)}},{title:"Migration de la table des Sessions",html:'<p>Correction de la liste des sessions, suppression du champs "isFunded"</p>',onOpen:async function(i){console.log("%cMigration : table des sessions suppression de isFunded",T),Swal.showLoading();for(var y=dayjs("2020-06-01"),B=p.get("students").value(),m=p.get("sessions").filter($=>dayjs($.when).isSameOrAfter(y,"day")),b=Swal.getContent().textContent,g=m.value().length;g-=1;){var x=m.get(g);x.value().isFunded===void 0||x.value().isFunded===void 0?console.log(`%cSkip ${x.value()} already converted`,T):x.unset(["isFunded"]).write();let $=Swal.getContent();$!=null&&($.innerHTML=`${b}<br /><p>Traitement en cours : il reste ${g} \xE9lements \xE0 convertir</p>`),await Re(1)}Swal.hideLoading();let M=Swal.getContent();M!=null&&(M.textContent=`Traitement en termin\xE9 : ${m.value().length}/${m.value().length}`)}},{title:"Migration de la table des Sessions",html:"<p>Correction de la liste des sessions, ajout de funding</p>",onOpen:async function(i){console.log("%cMigration : table des sessions ajout de fundedBy",T),Swal.showLoading();for(var y=dayjs("2020-06-01"),B=p.get("students").value(),m=p.get("sessions").filter(v=>dayjs(v.when).isSameOrAfter(y,"day")),b=m.filter(v=>v.type!="soutenance"),g=Swal.getContent().textContent,x=b.value().length;x-=1;){var M=b.get(x);M.value().funding!==void 0?console.log(`%cSkip ${M.value()} already converted`,T):M.assign({funding:ge.getFunding(M.value().who_id)}).write();let v=Swal.getContent();v.innerHTML=`${g}<br /><p>Traitement en cours : il rest ${x}\xE9lements \xE0 convertir</p>`,await Re(1)}for(var $=x,b=m.filter(v=>v.type=="soutenance"),x=0;x<b.value().length;x+=1){b.get(x).assign({funding:De}).write();let h=Swal.getContent();h!=null&&(h.innerHTML=`${g}<br /><p>Traitement en cours : ${$+x}/${m.value().length}</p>`),await Re(1)}Swal.hideLoading();let D=Swal.getContent();D!=null&&(D.textContent=`Traitement termin\xE9 :  ${m.value().length}/${m.value().length}`)}}]).then(i=>{if(i.value){let y=JSON.stringify(i.value);Swal.fire({title:"Traitement termin\xE9!",html:`
			Your answers:
			<pre><code>${y}</code></pre>
		  `,confirmButtonText:"Lovely!"})}else return console.log("%c resultat en erreur",T,i,i.dismiss===Swal.DismissReason.cancel),-1});var n,a,e;for(c=0;c<a.length;c+=1){var t;t!==void 0&&p.get("students").find({fullname:t.who_name}).assign({who_id:t.who_id}).write()}var l;for(c=0;c<l.length;c+=1){var t,u;p.get("sessions").find({id:l[c].id}).assign({path:u}).write()}for(var c;c<e.value().length;c+=1)e.get(c).unset(["isFunded"]).write();for(var d,c;c<d.value().length;c+=1){var f=d.get(c);f.assign({fundedBy:ge.getFunded(f.value().who_id)}).write()}for(var d,c;c<d.value().length;c+=1)d.get(c).assign({fundedBy:De}).write()};var ln=In(dn()),jt=class{},Fe=jt;U(Fe,"save",function(){return console.log("%cWanna save DBASE",T),JSON.stringify(q.Cfg.dbase.getState())}),U(Fe,"load",function(o){return console.log(`%cWanna load ${o} in DBASE`,T),console.log("%c !!!!!! TYPE NOT CHECKED BE CARREFULL",T),q.Cfg.dbase.setState(JSON.parse(o)).write()}),U(Fe,"update",async function(o){console.log(`%cIs there any update to DB to go to version ${o}`,T);let n=[{version:"1.00.0006",action:an}];for(let e=0,t=n.length;e<t;e++)if(bt(o,n[e].version)==0)if(console.log(`%cFound an update to DB version '${n[e].version}' proceed conversion...`,T),await n[e].action()==-1)console.log(`%cError something was wrong during update of database from version: ${ke.getVersion()} to version:${n[e].version}.... you have canceled it`,le),Swal.fire({icon:"error",title:"Oops...",text:`Quelque chose s'est mal pass\xE9 ou vous avez annul\xE9 l'update 

Utiliser l'application dans ces conditions n'est pas garanti  !`,footer:'<a href="https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon/issues">G\xE9n\xE9rer un bug?</a>'});else{let u=ke.setDbVersion(o);console.log(`%cChanged DB to version ${u}`,T)}let a=ke.setDbVersion(o);console.log(`%cChanged DB to version ${a}`,T)}),U(Fe,"erase",function(o){return console.log(`%cErase all data of table: ${o}`,T),q.Cfg.dbase.get(o).remove().write()}),U(Fe,"loadTable",function(o,n){if(table_exist(o))return q.Cfg.dbase.set(o,n).write();throw"Table :"+o+", not exists in DB !"}),U(Fe,"table_exist",o=>q.Cfg.dbase.has(o).value),U(Fe,"table_export",function(o){if(table_exist(o))return JSON.stringify(q.Cfg.dbase.get(o).value());throw"Table :"+o+", not exists id DB !"}),U(Fe,"exportTblToCSV",function(o="",n,a){let e=jt.exportTblToJSON(o,n,a),t={quotes:!1,quoteChar:'"',escapeChar:'"',delimiter:",",header:!0,newline:`\r
`,skipEmptyLines:!1,columns:null};return ln.default.unparse(e,t)}),U(Fe,"exportTblToJSON",function(o="",n,a){if(o=="")return console.log("%cIrrecoverable Error: You forget to define a data table name",le),-1;if(n!==null&&n!==""&&(dtFrom=dayjs(n)),a!==null&&a!==""&&(dtTo=dayjs(a)),q.Cfg.dbase.has(o).value==!1)return console.log(`%cIrrecoverable Error: table ${o} don't exist`,le),-1;if(o===xe.tbl_name){if(typeof dtFrom=="object"&&dtTo==="object")return q.Cfg.dbase.get(o).filter(e=>dayjs(e.when).isSameOrBefore(dtTo,"day")&&dayjs(e.when).isSameOrAfter(dtFrom,"day")).value();if(typeof dtFrom=="object")return q.Cfg.dbase.get(o).filter(e=>dayjs(e.when).isSameOrAfter(dtFrom,"day")).value();if(typeof dtTo=="object")return q.Cfg.dbase.get(o).filter(e=>dayjs(e.when).isSameOrBefore(dtTo,"day")).value()}return q.Cfg.dbase.get(o).value()});var dt=Fe;var un=async function(){var p="";p+="<style>div.about_content {background-color: #fed9ff;/*width: 600px;*/height: var(--heigth, 80%);overflow-x: hidden;overflow-y: auto;text-align: left;padding: 20px;}</style>",p+='<div class="about_content" style="--heigth: 600px;">',p+='<div class="about_content__wrapper">';var n=(await Je.XHR({method:"GET",url:"https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/README.md",responseType:"text/html",headers:{"User-Agent":"Mozilla/5.0"}})).responseText,a=new showdown.Converter,e=a.makeHtml(n);p+=e,p+="</div>",p+="</div>",Swal.fire({title:`<strong>A propos de ${Ft}</strong>`,icon:"info",html:p,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})};var Mt=function(){var p=ht,o=document.querySelector(p),n=!1;if(o===null)throw console.log(`%cERROR:Could'nt find the table which display sessions : ${o}`,le),new Error("!!!! IRRECOVERABLE ERROR NO TABLE OF SESSIONS FOUNDED");if(o.querySelector("[type=checkbox]")===null){var o=document.querySelector(`${p} tbody`);for(let $ of o.children)if($.querySelector("a")!==null){var a=Ke($.children[2],-2),e=document.createElement("input");e.type="checkbox",e.name="name";var t=$.children[1].querySelector("time").dateTime.trim();t=dayjs(t).toISOString();var l=xe.getHashId(t,a);e.value=l,e.onclick=function(D){D.stopPropagation()},n=xe.exists(l),n===!0&&(e.checked=!0);var u=document.createElement("td");u.style="text-align: center",u.appendChild(e),$.appendChild(u)}if(document.querySelector(`${p} thead`)===null){let $=(v,h)=>h.insertAdjacentElement("beforebegin",v);p=`${p} tbody`;var c=document.querySelector(p),e=document.createElement("input");e.type="checkbox",e.name="name",e.value="value",e.id="id",e.onclick=function(){document.querySelectorAll("tbody input[type=checkbox]").forEach(v=>v.checked=!v.checked)},e.style="visibility: hidden;";var d=document.createElement("label");d.innerText="in DB",d.style="display:block;",d.onMouseOver="this.style.cursor=pointer;",d.onMouseOut="this.style.cursor=auto;",d.appendChild(e);var f=document.createElement("td");f.style=`
    font-size: 1rem;
    max-width: 280px;
    font-family: Montserrat;
    font-weight: 400;
    line-height: 1.625rem;
    text-transform: inherit;
`,f.innerText=" ";var i=document.createElement("td");i.style=`
    font-size: 1rem;
    max-width: 280px;
    font-family: Montserrat;
    font-weight: 400;
    line-height: 1.625rem;
    text-transform: inherit;
    margin-left: auto;
`,i.innerText="Fact.(o/n)",i.addEventListener("click",_handler=function(v){document.querySelectorAll("tbody input[type=checkbox]").forEach(h=>h.checked=!h.checked)});var y=document.createElement("tr");y.style=`
    display: flex;
    align-items: center;
    border-bottom: 1px solid #e0e0e0;
    flex-direction: row;
    background-color: #fff;
`,y.appendChild(f),y.appendChild(i);var B=document.createElement("thead");B.style="display: block;",B.appendChild(y),$(B,document.querySelector(p))}}else{for(var m=o.querySelectorAll("[type=checkbox]"),b=m.length,g=new Array(b);b--;g[b]=m[b]);for(var x in g){let M=parseInt(g[x].value,10);n=xe.exists(M),n===!0?g[x].checked=!0:g[x].checked=!1}}},cn=async function(){var[p,o]=await ct(dayjs().startOf("month"),dayjs().endOf("month"));let n=Ct.getListDetailBill(p,o),a="";a+="<table>",a+="<thead>",a+="<tr><th>Quand</th><th>Qui</th><th>Financ\xE9 ?</th><th>Type</th><th>Niveau</th><th>Ancien Mode ?</th><th>Statut</th><th>PU HT</th><th>Cumul</th></tr>",a+="<thead>",a+="<tbody>";for(let e=0;e<n.length;e+=1)a+="<tr>",a+=`<td>${dayjs(n[e].when).format("DD/MM/YYYY \xE0 HH:mm:ss")}</td>`,a+=`<td>${n[e].who_name}</td><td>${n[e].funding}</td>`,sType=n[e].type,n[e].path!=null&&n[e].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&n[e].type!=="soutenance"&&(sType="Coaching"),a+=`<td>${sType}</td><td>${n[e].lvl}</td>`,a+=`<td>${n[e].oldMode===!0?"Oui":"Non"}</td>`,a+=`<td>${n[e].status}</td>`,a+=`<td>${n[e].iPu}</td><td>${n[e].iCumul}\u20AC</td>`,a+="</tr>";a+="</tbody>",a+="</table>",Swal.fire({title:`<strong>Liste d\xE9taill\xE9es des sessions du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,icon:"info",html:a,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen",onOpen:e=>{var t=e.querySelector("table"),l=new simpleDatatables.DataTable(t)}})},fn=async function(){var p=!0,[o,n]=await ct(dayjs().startOf("month"),dayjs().endOf("month"));p==!0&&console.log("%ccollectAuto() Wanna collect from %s to %s",T,o.format("DD/MM/YYYY"),n.format("DD/MM/YYYY"));var a=await xe.getSessionsFromAPI(o,n);p==!0&&console.log("%ccollectAuto() Sessions are is %o",T,a)};var pn=async function(){var p=ht,o=document.querySelectorAll(p);GM_addStyle(".ldBar path.mainline{stroke-width:10;stroke:#09f;stroke-linecap:round}"),GM_addStyle(".ldBar path.baseline{stroke-width:14;stroke:#f1f2f3;stroke-linecap:round;filter:url(#custom-shadow)}");let n='<div id="pbar" class="ldBar label-center" data-value="0" data-path="M0 0 L200 0 L200 1"></div>';Swal.fire({title:"Traitement en cours!",html:n,confirmButtonText:"Lovely!",onBeforeOpen:function(a){var e=new ldBar("#pbar")},onRender:function(a){},onOpen:async function(a){for(var e=document.getElementById("pbar").ldBar,t=0;t<o.length;t+=1){var l=o[t].parentElement.parentElement,u=xe.parseRow(l);await xe.add(u),e.set(t/o.length*100,!1)}e.set(100,!1),Swal.getTitle()&&(Swal.getTitle().innerText="Traitement termin\xE9 !")},onClose:function(a){},onAfterClose:function(a){},onDestroy:function(a){}})},mn=function(){let p=unsafeWindow.Facturier.cfg.dbase,o=unsafeWindow.Facturier.libs.find(c=>c.id=="dayjs").ptr,n=unsafeWindow.Facturier.libs.find(c=>c.id=="fetchInject").ptr,a=unsafeWindow.Facturier.klass.find(c=>c.id=="Session").ptr,e=unsafeWindow.Facturier.klass.find(c=>c.id=="Student").ptr,t=unsafeWindow.Facturier.klass.find(c=>c.id=="History").ptr,l=unsafeWindow.Facturier.klass.find(c=>c.id=="Archive").ptr,u=unsafeWindow.Facturier.klass.find(c=>c.id=="StudentHistory").ptr;console.log("%cd_dbase, d_dayjs, d_Session, d_Student, d_History, d_Archive, d_StudentHistory are exported",T),console.log("%cfor examples write all code after $>",T),console.group("%cd_dbase",T),console.log("example : get last session in db $>d_dbase.get(d_Session.tbl_name).last().value();"),console.log("          get first student in db $>d_dbase.get(d_Student.tbl_name).first().value()"),console.log("          or d_dbase.get(d_Student.tbl_name).get(0).value()"),console.log("          get all sessions grouped by month/yyyy in db $>d_dbase.get(d_Session.tbl_name).groupBy( v => d_dayjs(v.when).format('MM/YYYY')).value()"),console.log("          get all table $> d_dbase.value()"),console.groupEnd(),console.group("%cd_fetchInject",T),console.log("same as fetchInject libs : https://habd.as/code/fetch-inject/"),console.groupEnd(),console.group("%cd_dayjs",T),console.log("same as dayjs libs"),console.groupEnd(),console.group("%cd_Student",T),console.log("find a student by id \xA4 d_Student.findById(STUDENT_ID, (DATE) ); // date is optionnal"),console.groupEnd(),console.group("%cd_Session",T),console.log("get a list of session \xA4 d_Session.getBetween('2020-08-01','2020-08-31')"),console.log("delete a session by id \xA4 d_Session.deleteById(SESSION_ID);"),console.groupEnd(),console.group("%cSome combinated example",T),console.log("Delete last saved session :  d_Session.deleteById( d_dbase.get(d_Session.tbl_name).last().value().id ); "),console.log("Find all session between 01/08/2020 and 31/08/2020 :  d_dbase.get(d_Session.tbl_name).filter( v => d_dayjs(v.when).isSameOrBefore('20200831', 'day') && d_dayjs(v.when).isSameOrAfter('20200801', 'day')).value(); "),console.groupEnd();debugger};var hn=function(){let{degrees:p,PDFDocument:o,rgb:n,StandardFonts:a}=PDFLib;async function e(){let c=await fetch("https://pdf-lib.js.org/assets/with_update_sections.pdf").then(g=>g.arrayBuffer()),d=await o.load(c),f=await d.embedFont(a.Helvetica),y=d.getPages()[0],{width:B,height:m}=y.getSize();y.drawText("This text was added with JavaScript!",{x:5,y:m/2+300,size:50,font:f,color:n(.95,.1,.1),rotate:p(-45)});let b=await d.save();download(b,"pdf-lib_modification_example.pdf","application/pdf")}async function t(){let u=await o.create(),c=await u.embedFont(a.TimesRoman),d=u.addPage(),{width:f,height:i}=d.getSize(),y=30;d.drawText("Creating PDFs in JavaScript is awesome!",{x:50,y:i-4*y,size:y,font:c,color:n(0,.53,.71)});let B=await u.save();download(B,"pdf-lib_modification_example.pdf","application/pdf")}async function l(){var[u,c]=await ct(dayjs().startOf("month"),dayjs().endOf("month"));let d=Ct.getListDetailBill(u,c),f=await o.create(),i=await f.embedFont(a.TimesRoman),y=f.addPage(),{width:B,height:m}=y.getSize(),b=30;y.drawText(`Prestations en d\xE9tail 

 du ${u.format("DD/MM/YYYY")} au ${c.format("DD/MM/YYYY")}`,{x:50,y:m/2-b,size:b,font:i,color:n(116/255,81/255,235/255)});let g=12,x=1.25,M=f.addPage();M.setFontSize(g),M.line_space=x,M.font=i;let $=1,D=20,v=x*g+D,h=m/2,s=function(te){let G="LOrEm ipsum DOLor sit aMet, conSEc/tetUr 25 porttitor. ";return te*1.0925*(i.widthOfTextAtSize(G,g)/G.length)},w=[0,18,36,10,13,8,5,7],C=[w[0],s(w[1]),s(w[2]),s(w[3]),s(w[4]),s(w[5]),s(w[6]),s(w[7])],P=y.lineHeight,Q=25;for(let te=1;te<d.length;te+=1){if(h=m-x*g*$,h<v&&($=1,M=f.addPage(),M.font=i,M.setFontSize(g),M.line_space=x,h=m-x*g*$),$===1){let Oe=["","Quand","Qui","Financ\xE9","Type-Niv.","Statut","Pu","Cumul"],Se=Q;M.moveTo(Se,h);for(let Le=1;Le<Oe.length;Le+=1)M.drawText(Oe[Le],{x:Se}),Se+=C[Le];$+=1,h=m-x*g*$}let G=Q;M.drawText(dayjs(d[te].when).format("DD/MM/YYYY \xE0 HH:mm"),{font:i,size:g,y:h,x:G,lineHeight:P}),G+=C[1],M.drawText(d[te].who_name.trim().slice(0,w[2]),{font:i,size:g,y:h,x:G,lineHeight:P}),G+=C[2];let pe=d[te].funding.trim().slice(0,w[3]);d[te].funding==="auto-financ\xE9"&&(pe="Au. Fin."),d[te].funding==="financ\xE9 par un tiers"&&(pe="Fin."),M.drawText(pe,{font:i,size:g,y:h,x:G,lineHeight:P}),G+=C[3];let we=d[te].type;d[te].path!=null&&d[te].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&d[te].type!=="soutenance"&&(we="Coaching");let Ye=`${we.trim().slice(0,w[4]-2)}-${d[te].lvl.toString()}`;M.drawText(Ye,{font:i,size:g,y:h,x:G,lineHeight:P}),G+=C[4];let Me=d[te].status;d[te].status==="\xE9tudiant absent"&&(Me="absent"),d[te].status==="\xE9tudiante absente"&&(Me="absente"),d[te].status==="annul\xE9e tardivement"&&(Me="an. tard."),M.drawText(Me,{font:i,size:g,y:h,x:G,lineHeight:P}),G+=C[5],M.drawText(d[te].iPu.toString(),{font:i,size:g,y:h,x:G,lineHeight:P}),G+=C[6],M.drawText(d[te].iCumul.toString(),{font:i,size:g,y:h,x:G,lineHeight:P}),$+=1}var E=await He.calculateBill(u,c);let S=E.get(0,0,0,0).maxLevel,Y=Ae.getOldModeDate(),I=He.getPriceList(Y.subtract(1,"day")),R=He.getPriceList(Y);var O=1;let j=!1;var k=[F,H,N],L=["Sessions","Soutenance","Coaching"],oe=[0,1,2,3],me=["R\xE9alis\xE9e","Annul\xE9e","Annul\xE9e tardivement","Etudiant(e) absent(e)"],ce=[z,W,K],fe=["Autofinanc\xE9s","Financ\xE9s","Autres"];$=1,M=f.addPage();let be=["","Quand","Qui","Nb","Pu","Cumul"],ne=[0,18,50,3,5,7],ie=[w[0],s(w[1]),s(w[2]),s(w[3]),s(w[4]),s(w[5])],he="";for(_iSessionType=0,_iSessionTypeLength=k.length;_iSessionType<_iSessionTypeLength;_iSessionType+=1){for(;O<=S;){for([$,M]=We.changePgIfNeeded(h,v,$,f),h=m-x*g*$,_iSessionQuality=0,_iSessionQualityLength=oe.length;_iSessionQuality<_iSessionQualityLength;_iSessionQuality+=1)for(_iFunding=0,_iFundingLength=ce.length;_iFunding<_iFundingLength;_iFunding+=1){if(_i0=E.get(k[_iSessionType],oe[_iSessionQuality],ce[_iFunding],O),typeof _i0=="undefined"&&j===!1)continue;_i0.data=_i0.data.reverse();let te=Q;if(he=`${L[_iSessionType]} de Niveau ${O} Etudiants ${fe[_iFunding]}`,M.moveTo(te,h),M.drawText(he,{font:i,size:g+4,y:h,x:te,lineHeight:P}),te+=15,$+=1,[$,M]=We.changePgIfNeeded(h,v,$,f),h=m-x*g*$,M.moveTo(te,h),M.drawText(me[_iSessionQuality],{font:i,size:g+2,y:h,x:te,lineHeight:P}),te+=15,$+=1,[$,M]=We.changePgIfNeeded(h,v,$,f),h=m-x*g*$,typeof _i0=="undefined"){M.drawText(`d\xE9sol\xE9 pas de r\xE9sultat pour cette section au niveau de facturation (${O})`,{font:i,size:g,y:h,x:te,lineHeight:P}),$+=1,[$,M]=We.changePgIfNeeded(h,v,$,f),h=m-x*g*$;continue}let G=te,pe=0;M.moveTo(te,h);for(let we=1;we<be.length;we+=1)M.drawText(be[we],{font:i,size:g+2,y:h,x:G,lineHeight:P}),G+=ie[we];$+=1,[$,M]=We.changePgIfNeeded(h,v,$,f),h=m-x*g*$,G=te;for(var de=0,se=_i0.data.length;de<se;de+=1)G=te,M.drawText(dayjs(_i0.data[de].when).format("DD/MM/YYYY \xE0 HH:mm"),{font:i,size:g,y:h,x:G,lineHeight:P}),G+=ie[1],M.drawText(_i0.data[de].who_name.trim().slice(0,ne[1]),{font:i,size:g,y:h,x:G,lineHeight:P}),G+=ie[2],M.drawText((de+1).toString(),{font:i,size:g,y:h,x:G,lineHeight:P}),G+=ie[3],Ae.isInOldMode(dayjs(_i0.data[de].when))?iPu=+_i0.data[de].lvl>0?I[O][k[_iSessionType]][oe[_iSessionQuality]][ce[_iFunding]]:0:iPu=+_i0.data[de].lvl>0?R[O][k[_iSessionType]][oe[_iSessionQuality]][ce[_iFunding]]:0,M.drawText(iPu.toString(),{font:i,size:g,y:h,x:G,lineHeight:P}),G+=ie[4],pe+=iPu,M.drawText(pe.toString(),{font:i,size:g,y:h,x:G,lineHeight:P}),$+=1,[$,M]=We.changePgIfNeeded(h,v,$,f),h=m-x*g*$}O+=1,$+=1,[$,M]=We.changePgIfNeeded(h,v,$,f),h=m-x*g*$}O=1}We.addFooter(f,`G\xE9n\xE9r\xE9 avec Facturier version ${Ae.getAppVersion()}`);let ae=await f.save();download(ae,`prestations_facturees_detail_${u.format("YYYYMMDD")}-${c.format("YYYYMMDD")}.pdf`,"application/pdf")}l()},gn=async function(){GM_addStyle('.formgrid{font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;}'),GM_addStyle(`
.swal2-styled[type=button]{background-color:#3085d6;border-radius:.75em;color:#fff;font-size:1.0625em;border-left-color:#3085d6;border-right-color:#3085d6;display:inline-block}
.formgrid{display:grid;grid-template-columns:1fr 1em 1fr;grid-gap:.3em .6em;grid-auto-flow:dense;align-items:center}
.formgrid input,.formgrid output,.formgrid textarea,.formgrid select,.formgrid button{grid-column:2 / 4;width:auto;margin:0}
.formgrid legend{font-size:1.2em;width:100%;border-bottom:1px dotted #99c}
.formgrid fieldset{max-width:40em;padding:4px;margin:2em auto;border:0 none}
`);let p="";p+="<legend>Que voulez vous faire ?</legend>",p+="<fieldset>",p+='<div class="formgrid">',p+='Epurer<button id="answer1" data-action="raz" class="swal2-styled" type="button">RAZ</button>',p+='Sauvegarder toute la base<button id="answer2" data-action="export" class="swal2-styled" type="button">Sauvegarder</button>',p+='Charger toute la base<button id="answer3" data-action="import" class="swal2-styled" type="button">Charger</button>',p+=`Exporter les tables
    <button class="swal2-styled" type="button"
    	hx-get="/views/test-swal-sauvegarde"
		hx-select="body"
        hx-target="#sttPlaceHolder"
        hx-include="[name='email']"
        hx-swap="innerHTML"> Exporter
    </button>
		`,p+="</fieldset>",p+="</div>";let{value:o}=await Swal.fire({title:"Gestion de la base de donn\xE9e",html:p,focusConfirm:!1,preConfirm:()=>[document.getElementById("answer1").value,document.getElementById("answer2").value],didOpen:n=>{console.log("%conOpen popup","color:coral"),htmx.process(document.querySelector(".swal2-container")),console.log("%cHtmx Process done","color:coral"),n.querySelector(".formgrid").addEventListener("click",_handler=function(a){let e=function(u){u.target.matches('button[data-action="raz"]')&&(Swal.close(),qn())},t=function(u){u.target.matches('button[data-action="export"]')&&(Swal.close(),Un())},l=function(u){u.target.matches('button[data-action="import"]')&&(Swal.close(),Gn())};e(a),t(a),l(a)})},onClose:n=>{n.querySelector(".formgrid").removeEventListener("click",_handler),console.log("%conClose popup","color:coral")}});o&&Swal.fire(JSON.stringify(o))},Un=async function(){let p=dt.save();console.log(`%cWanna save : ${p}`,T);let o=dayjs(),n="";n+=`<a id="download" href="data:text/plain;charset=utf-8,${encodeURIComponent(p)}" download="save_${o.format("YYYYMMDD")}.json">save_${o.format("YYYYMMDD")}.json</a>`,Swal.fire({title:"Sauvegarde de la base de donn\xE9e",html:n,focusConfirm:!1,onOpen:a=>{a.querySelector("#download").click()},onClose:a=>{}})};var Gn=async function(){console.log("%cWanna load DATABASE",T);let{value:p}=await Swal.fire({title:"Selection de la sauvegarde (json)",input:"file",inputAttributes:{accept:".json","aria-label":"Upload your database"}});if(p){let o=new FileReader;o.onload=n=>{dt.import(n.target.result),Mt(),Et("Chargement de la base termin\xE9")},o.readAsText(p)}},qn=async function(){GM_addStyle(".form_addon {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}"),GM_addStyle(".form_addon input {background: #fff;border: 1px solid #9c9c9c;}"),GM_addStyle(".form_addon button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}"),GM_addStyle(".form_addon button:hover {background: gold;}"),GM_addStyle(".form_addon label {padding: 0.5em 0.5em 0.5em 0;}"),GM_addStyle(".form_addon input {padding: 0.7em;margin-bottom: 0.5rem;}"),GM_addStyle(".form_addon input:focus {outline: 3px solid gold;}"),GM_addStyle("@media (min-width: 400px) {.form_addon {grid-template-columns: 200px 1fr;grid-gap: 16px;} .form_addon label {text-align: right;grid-column: 1 / 2;} .form_addon input, .form_addon button {grid-column: 2 / 3;}}");var p="";p+='<form id="RAZ" class="form_addon" action="">',p+='<label for="students" class="cbox">Etudiants</label>',p+='<input id="students" type="checkbox" value="del_students_true" checked>',p+='<label for="sessions" class="cbox">Sessions</label>',p+='<input id="sessions" type="checkbox" value="del_sessions_true" checked>',p+='<label for="archives" class="cbox">Archives : factures</label>',p+='<input id="archives" type="checkbox" value="del_archives_true" checked>',p+='<label for="history_cache" class="cbox">Signet historique</label>',p+='<input id="history_cache" type="checkbox" value="del_history_cache_true" checked>',p+='<label for="radio1">filtrer la date</label>',p+='<input type="radio" id="radio1" name="date_filter" value="false" checked>',p+='<label for="radio2">ne pas filtrer</label>',p+='<input type="radio" id="radio2" name="date_filter" value="true">',p+='<label for="dtFrom" class="date">Date de d\xE9but</label>',p+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31">',p+='<label for="dtTo" class="date">Date de fin</label>',p+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31">',p+="<!-- Switch -->",p+='<input type="checkbox" class="switch" name="s1" id="s1">',p+='<label for="s1">Switch</label>',p+="</form>";let{value:o}=await Swal.fire({title:"<strong>RAZ des donn\xE9es</strong>",icon:"info",html:p,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:"Choisissez ce que vous allez supprimer de la base de donn\xE9e",preConfirm:()=>{let c=document.getElementsByName("date_filter"),d="notfound";for(var f in c)c[f].checked===!0&&(d=c[f].value);return console.log(document.getElementById("s1")),[document.getElementById("students").checked,document.getElementById("sessions").checked,document.getElementById("archives").checked,document.getElementById("history_cache").checked,document.getElementById("dtFrom").disabled===!0?null:document.getElementById("dtFrom").value,document.getElementById("dtTo").disabled===!0?null:document.getElementById("dtTo").value,d]},onOpen:c=>{c.querySelector("#radio1").addEventListener("change",function(){console.log(document.getElementById("radio1").checked);let d=document.getElementById("radio1").checked;document.getElementById("dtFrom").disabled=!d,document.getElementById("dtTo").disabled=!d}),c.querySelector("#radio2").addEventListener("change",function(){let d=document.getElementById("radio1").checked;document.getElementById("dtFrom").disabled=!d,document.getElementById("dtTo").disabled=!d}),c.querySelector("#dtFrom").addEventListener("change",function(){document.getElementById("dtTo").value=dayjs(document.getElementById("dtFrom").value).endOf("month").format("YYYY-MM-DD")})},onClose:c=>{c.querySelector("#radio1").removeEventListener("change"),c.querySelector("#radio2").removeEventListener("change"),c.querySelector("#dtFrom").removeEventListener("change")}}),n=o[0],a=o[1],e=o[2],t=o[3];console.log(`%cWanna raz students ? ${n}, wanna raz sessions ? ${a}, wanna raz archives ? ${e}`,T);let l=o[4]?dayjs(o[4]):null,u=o[5]?dayjs(o[5]):null;n===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des \xE9tudiants",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),ge.delete(l,u)),a===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des sessions",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),xe.delete(l,u),Mt()),e===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des archives (financi\xE8res)",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),it.delete(l,u)),t===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base du cache des historique de session",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),at.delete(l,u))};var bn=async function(){var p="";p+="<style>",p+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",p+="form input {background: #fff;border: 1px solid #9c9c9c;}",p+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",p+="form button:hover {background: gold;}",p+="form label {padding: 0.5em 0.5em 0.5em 0;}",p+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",p+="form input:focus {outline: 3px solid gold;}",p+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}label {text-align: right;grid-column: 1 / 2;}input,button {grid-column: 2 / 3;}}",p+="</style>",p+='<form class="form1" action="">',p+='<label for="dd" class="date">Date de d\xE9but</label>',p+='<input id="dd" type="date" max="2030-12-31" min="2010-12-31">',p+='<label for="df" class="date">Date de fin</label>',p+='<input id="df" type="date" max="2030-12-31" min="2010-12-31">',p+="</form>";var[o,n]=await ct(dayjs().startOf("month"),dayjs().endOf("month")),a=await He.calculateBill(o,n);Ae.isInOldMode(o)?Qn(o,n,a):zn(o,n,a)};var Qn=function(p,o,n){let a=n.get(0,0,0,0),e=4;var t="",l=null,u=0,c=0,d=0,f=[[4,"Groupe"],[1,"Niveau 1"],[2,"Niveau 2"],[3,"Niveau 3"]],i=0,y=0,B=!1,m=0,b=0,g=0,x=0,M=0,$=0,D=0,v=0,h=0,s=0,w=0,C=0,P=0,Q=0,E=0,A=0,S=0,Y=0,I=1;n.toConsole(),t+="<style>.wrapper{  display: grid;grid-gap: 10px;grid-template-column: 1fr 1fr;}</style>",t+='<div class="wrapper">',t+="<table>",t+="<thead>",t+="<tr>",t+='<th>Type</th><th><abbr title="nombre">nb</abbr></th><th>PU(<abbr title="hors taxes">HT</abbr>)</th><th>Total(<abbr title="hors taxes">HT</abbr>)</th>',t+="</tr>",t+="</thead>",t+="<tbody>",t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Mentorat</th>',t+="</tr>";for(var i=performance.now();I<=e;)_i0=n.get(F,Z,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : r\xE9alis\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(F,X,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(F,V,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es tard.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(F,ee,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : \xE9tudiant abs.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),I+=1;var y=performance.now();console.log("%cCalculate first array"+(y-i)+" milliseconds.",Pe),t+="<tr>",t+="<td>Total</td>",t+=`<td>${u}</td><td></td><td>${c}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",d+=c,u=0,c=0,t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Soutenance</th>',t+="</tr>",I=1;for(var i=performance.now();I<=e;)_i0=n.get(H,Z,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : r\xE9alis\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(H,X,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(H,V,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es tard.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(H,ee,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : \xE9tudiant abs.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),I+=1;var y=performance.now();console.log("%cCalculate second array"+(y-i)+" milliseconds.",Pe),t+="<tr>",t+="<td>Total</td>",t+=`<td>${u}</td><td></td><td>${c}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",d+=c,u=0,c=0,t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Coaching</th>',t+="</tr>",I=1;for(var i=performance.now();I<=e;)_i0=n.get(N,Z,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : r\xE9alis\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(N,X,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(N,V,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es tard.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(N,ee,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,P=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,(B===!0||s+w+C>0)&&(u+=s,u+=w,u+=C,c+=A,c+=S,c+=Y,t+="<tr>",t+=`<td>Niveau ${I} : \xE9tudiant abs.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),I+=1;var y=performance.now();console.log("%cCalculate third array"+(y-i)+" milliseconds.",Pe),t+="<tr>",t+="<td>Total</td>",t+=`<td>${u}</td><td></td><td>${c}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",d+=c,t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Total G\xE9n\xE9ral</th>',t+="</tr>",t+=`<td colspan="3"></td><td>${d}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",t+="</tbody>",t+="<tfoot>",t+="</tfoot>",t+="</table>",t+=`<p>Soit un total g\xE9n\xE9ral \xE0 facturer de ${d}\u20AC`,Swal.fire({title:`<strong>Liste des formations tarif\xE9es du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,html:t,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})},zn=function(p,o,n){console.log("%cEnter computation bill",T);let a=!1;var e="",t=0,l=0,u=0,c=0,d=0,f=0,i=0,y=0,B=0,m=0,b=0,g=0;let x=n.get(0,0,0,0),M=x.maxLevel;var $=0,D=0,v=0,h=0,s=0,w=0,C=0,P=0,Q=0,E=0,A=0,S=0,Y=0,I=0,R=0,O=0,j=0,k=0,L=1;e+="<style>.wrapper{  display: grid;grid-gap: 10px;grid-template-column: 1fr 1fr;}</style>",e+='<div class="wrapper">',e+="<table>",e+="<thead>",e+="<tr>",e+='<th rowspan="2">Type</th><th colspan="3" scope="colgroup">Auto Financ\xE9s</th><th colspan="3" scope="colgroup">Financ\xE9s</th><th colspan="3" scope="colgroup">Autres</th><th colspan="2" scope="colgroup">Total</th>',e+="</tr>",e+="<tr>",e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+="</tr>",e+="</thead>",e+="<tbody>",e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de mentorat</th>',e+="</tr>";for(var oe=performance.now();L<=M;)_i0=n.get(F,Z,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : r\xE9alis\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(F,X,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(F,V,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es tard.</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(F,ee,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : \xE9tud. absent</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),L+=1;var me=performance.now();for(console.log("%cCalculate first array"+(me-oe)+" milliseconds.",Pe),e+="<tr>",e+="<td>Total</td>",e+=`<td>${t}</td><td></td><td>${c}\u20AC</td>`,e+=`<td>${l}</td><td></td><td>${d}\u20AC</td>`,e+=`<td>${u}</td><td></td><td>${f}\u20AC</td>`,e+=`<td>${t+l+u}</td><td>${c+d+f}\u20AC</td>`,e+="</tr>",e+="<tr>",e+="</tr>",i+=t,y+=l,B+=u,m+=c,b+=d,g+=f,t=0,l=0,u=0,c=0,d=0,f=0,e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de Soutenance</th>',e+="</tr>",L=1;L<=M;)_i0=n.get(H,Z,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : r\xE9alis\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(H,X,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(H,V,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es tard.</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(H,ee,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : \xE9tud. absent</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),L+=1;e+="<tr>",e+="<td>Total</td>",e+=`<td>${t}</td><td></td><td>${c}\u20AC</td>`,e+=`<td>${l}</td><td></td><td>${d}\u20AC</td>`,e+=`<td>${u}</td><td></td><td>${f}\u20AC</td>`,e+=`<td>${t+l+u}</td><td>${c+d+f}\u20AC</td>`,e+="</tr>",e+="<tr>",e+="</tr>",i+=t,y+=l,B+=u,m+=c,b+=d,g+=f,t=0,l=0,u=0,c=0,d=0,f=0,e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de Coaching</th>',e+="</tr>";for(var L=1;L<=M;)_i0=n.get(N,Z,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : r\xE9alis\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(N,X,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(N,V,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es tard.</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(N,ee,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,R=S>0?k/S:k,(a===!0||E+A+S>0)&&(t+=E,l+=A,u+=S,c+=O,d+=j,f+=k,e+="<tr>",e+=`<td>Niveau ${L} : \xE9tud. absent</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${R}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),L+=1;i+=t,y+=l,B+=u,m+=c,b+=d,g+=f,e+="<tr>",e+="<td>Total</td>",e+=`<td>${t}</td><td></td><td>${c}\u20AC</td>`,e+=`<td>${l}</td><td></td><td>${d}\u20AC</td>`,e+=`<td>${u}</td><td></td><td>${f}\u20AC</td>`,e+=`<td>${t+l+u}</td><td>${c+d+f}\u20AC</td>`,e+="</tr>",e+="<tr>",e+="</tr>",e+="</tbody>",e+="<tfoot>",e+="</tfoot>",e+="</table>";var ce=0,fe="";let be=x.flatFee.length;for(var ne=0;ne<be;ne+=1)ce+=30,fe+=x.flatFee[ne].who_name+", ";be>1?e+=`<p class="flat_fee">Calcul du forfait "autofinanc\xE9". Ce mois ci ${be} \xE9tudiants ont eu au moins une session il s'agit de : ${fe.slice(0,-1)}`:e+=`<p class="flat_fee">Calcul du forfait "autofinanc\xE9". Ce mois ci ${be} \xE9tudiant a eu au moins une session il s'agit de : ${fe.slice(0,-1)}`,e+=`. Le forfait est donc de ${ce}\u20AC</p>`,e+=`<p>Soit un total g\xE9n\xE9ral \xE0 facturer de ${m+b+g+ce}\u20AC</p>`,Swal.fire({title:`<strong>Liste des formations tarif\xE9es du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,html:e,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})},yn=async function(){var[p,o]=await ct(dayjs().startOf("month"),dayjs().endOf("month"),!1);if(p===null||o===null)throw console.log("%cError need date from, date to",le),new Error;let n=Ct.getListStatistic(p,o),a="",e=new Array(22),t=Array.apply(null,Array(22)).map(Number.prototype.valueOf,0),l=p.clone(),u=l.endOf("month"),c="";e[0]="<thead><tr><th>Sessions</th>",e[1]="<tbody><tr><td>Sessions</td>",e[2]='<tr class="header"><td>Montant</td>',e[3]="<tr><td>Nb.",e[4]="<tr><td>Pu",e[5]='<tr class="header"><td>Soutenances</td>',e[6]="<tr><td>Montant</td>",e[7]="<tr><td>Nb.",e[8]="<tr><td>Pu",e[9]='<tr class="header"><td>Coaching</td>',e[10]="<tr><td>Montant</td>",e[11]="<tr><td>Nb.",e[12]="<tr><td>Pu",e[13]='<tr class="header"><td>Bonus</td>',e[14]="<tr><td>Bonus AF</td>",e[15]="<tr><td>Total G\xE9n\xE9ral</td>",e[16]='<tr class="header"><td>KPI</td>',e[17]="<tr><td>NbJrs</td>",e[18]="<tr><td>TJM</td>",e[19]="<tr><td>Nb hrs</td>",e[20]="<tr><td>THM</td>",e[21]="<tr><td>Nb hrs (p.)</td>",e[22]="<tr><td>THM (p)</td>";for(var d=0;d<n.length;d+=1){t[2]+=n[d].sessions.total,t[3]+=n[d].sessions.nb-n[d].sessions.nbc,t[4]+=n[d].sessions.pu,t[6]+=n[d].defenses.total,t[7]+=n[d].defenses.nb-n[d].defenses.nbc,t[8]+=n[d].defenses.pu,t[10]+=n[d].coaches.total,t[11]+=n[d].coaches.nb-n[d].coaches.nbc,t[12]+=n[d].coaches.pu,t[14]+=n[d].bonus;let f=n[d].sessions.total+n[d].defenses.total+n[d].coaches.total+n[d].bonus;t[15]+=f,t[16]+=n[d].kpi.jrs,t[18]+=n[d].kpi.hrs,t[20]+=n[d].kpi.hrsp,n.length==1&&(c="</tr>"),d===n.length-1&&n.length>1?u.isAfter(o,"day")?(t[2]-=n[d].sessions.total,t[3]-=n[d].sessions.nb-n[d].sessions.nbc,t[4]-=n[d].sessions.pu,t[6]-=n[d].defenses.total,t[7]-=n[d].defenses.nb-n[d].defenses.nbc,t[8]-=n[d].defenses.pu,t[10]-=n[d].coaches.total,t[11]-=n[d].coaches.nb-n[d].coaches.nbc,t[12]-=n[d].coaches.pu,t[14]-=n[d].bonus,t[15]-=f,t[16]-=n[d].kpi.jrs,t[18]-=n[d].kpi.hrs,t[20]-=n[d].kpi.hrsp,e[0]+=`<td>Total(moy)</td><td>${dayjs(n[d].header.dtTo).format("MMMM")}</td></thead></tr>`,e[1]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[2]+=`<td>${t[2]} (${(t[2]/(n.length-1)).toFixed(2)})</td><td>${n[d].sessions.total}</td></tr>`,e[3]+=`<td>${t[3]} (${(t[3]/(n.length-1)).toFixed(2)})</td><td>${n[d].sessions.nb} (${n[d].sessions.nbc})</td></tr>`,e[4]+=`<td> n/a (${(t[4]/(n.length-1)).toFixed(2)})</td><td>${n[d].sessions.pu.toFixed(2)}</td></tr>`,e[5]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[6]+=`<td>${t[6]} (${(t[6]/(n.length-1)).toFixed(2)})</td><td>${n[d].defenses.total}</td></tr>`,e[7]+=`<td>${t[7]} (${(t[7]/(n.length-1)).toFixed(2)})</td><td>${n[d].defenses.nb} (${n[d].defenses.nbc})</td></tr>`,e[8]+=`<td> n/a (${(t[8]/(n.length-1)).toFixed(2)})</td><td>${n[d].defenses.pu.toFixed(2)}</td></tr>`,e[9]+=`<td>&nbsp;</td>${c}`,e[10]+=`<td>${t[10]} (${(t[10]/(n.length-1)).toFixed(2)})</td><td>${n[d].coaches.total}</td></tr>`,e[11]+=`<td>${t[11]} (${(t[11]/(n.length-1)).toFixed(2)})</td><td>${n[d].coaches.nb} (${n[d].coaches.nbc})</td></tr>`,e[12]+=`<td> n/a (${(t[12]/(n.length-1)).toFixed(2)})</td><td>${n[d].coaches.pu.toFixed(2)}</td></tr>`,e[13]+="<td>&nbsp;</td></tr>",e[14]+=`<td>${t[14]} (${(t[14]/(n.length-1)).toFixed(2)})</td><td>${n[d].bonus}</td></tr>`,e[15]+=`<td>${t[15]} (${(t[15]/(n.length-1)).toFixed(2)})</td><td>${f}</td></tr>`,e[16]+="<td>&nbsp;</td></tr>",e[17]+=`<td>${t[16]} (${(t[16]/(n.length-1)).toFixed(2)})</td><td>${n[d].kpi.jrs}</td></tr>`,e[18]+=`<td> n/a (${(t[15]/t[16]).toFixed(2)})</td><td>${(f/n[d].kpi.jrs).toFixed(2)}</td></tr>`,e[19]+=`<td>${t[18]} (${(t[18]/(n.length-1)).toFixed(2)})</td><td>${n[d].kpi.hrs.toFixed(2)}</td></tr>`,e[20]+=`<td> n/a  (${(t[15]/t[18]).toFixed(2)})</td><td>${(f/n[d].kpi.hrs).toFixed(2)}</td></tr>`,e[21]+=`<td>${t[20].toFixed(2)} (${(t[20]/(n.length-1)).toFixed(2)})</td><td>${n[d].kpi.hrsp.toFixed(2)}</td></tr>`,e[22]+=`<td> n/a  (${(t[15]/t[20]).toFixed(2)})</td><td>${(f/n[d].kpi.hrsp).toFixed(2)}</td></tr>`):(e[0]+=`<td>${dayjs(n[d].header.dtTo).format("MMMM")}</td><td>Tot.</td></thead></tr>`,e[1]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[2]+=`<td>${n[d].sessions.total}</td><td>${t[2]} (${(t[2]/n.length).toFixed(2)})</td></tr>`,e[3]+=`<td>${n[d].sessions.nb} (${n[d].sessions.nbc})</td><td>${t[3]} (${(t[3]/n.length).toFixed(2)})</td></tr>`,e[4]+=`<td>${n[d].sessions.pu.toFixed(2)}</td><td> n/a (${(t[4]/n.length).toFixed(2)})</td></tr>`,e[5]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[6]+=`<td>${n[d].defenses.total}</td><td>${t[6]} (${(t[6]/n.length).toFixed(2)})</td></tr>`,e[7]+=`<td>${n[d].defenses.nb} (${n[d].defenses.nbc})</td><td>${t[7]} (${(t[7]/n.length).toFixed(2)})</td></tr>`,e[8]+=`<td>${n[d].defenses.pu.toFixed(2)}</td><td> n/a (${(t[8]/n.length).toFixed(2)})</td></tr>`,e[9]+=`<td>&nbsp;</td>${c}`,e[10]+=`<td>${n[d].coaches.total}</td><td>${t[10]} (${(t[10]/n.length).toFixed(2)})</td></tr>`,e[11]+=`<td>${n[d].coaches.nb} (${n[d].coaches.nbc})</td><td>${t[11]} (${(t[11]/n.length).toFixed(2)})</td></tr>`,e[12]+=`<td>${n[d].coaches.pu.toFixed(2)}</td><td> n/a (${(t[12]/n.length).toFixed(2)})</td></tr>`,e[13]+="<td>&nbsp;</td></tr>",e[14]+=`<td>${n[d].bonus}</td><td>${t[14]} (${(t[14]/n.length).toFixed(2)})</td></tr>`,e[15]+=`<td>${f}</td><td>${t[15]} (${(t[15]/n.length).toFixed(2)})</td></tr>`,e[16]+="<td>&nbsp;</td></tr>",e[17]+=`<td>${n[d].kpi.jrs}</td><td>${t[16]} (${(t[16]/n.length).toFixed(2)})</td></tr>`,e[18]+=`<td>${(f/n[d].kpi.jrs).toFixed(2)}</td><td> n/a (${(t[15]/t[16]).toFixed(2)})</td></tr>`,e[19]+=`<td>${n[d].kpi.hrs.toFixed(2)}</td><td>${t[18]} (${(t[18]/n.length).toFixed(2)})</td></tr>`,e[20]+=`<td>${(f/n[d].kpi.hrs).toFixed(2)}</td><td> n/a  (${(t[15]/t[18]).toFixed(2)})</td></tr>`,e[21]+=`<td>${n[d].kpi.hrsp.toFixed(2)}</td><td>${t[20].toFixed(2)} (${(t[20]/n.length).toFixed(2)})</td></tr>`,e[22]+=`<td>${(f/n[d].kpi.hrsp).toFixed(2)}</td><td> n/a  (${(t[15]/t[20]).toFixed(2)})</td></tr>`):(e[0]+=`<td>${dayjs(n[d].header.dtTo).format("MMMM")}</td>${c}`,e[1]+=`<td>&nbsp;</td>${c}`,e[2]+=`<td>${n[d].sessions.total}</td>${c}`,e[3]+=`<td>${n[d].sessions.nb} (${n[d].sessions.nbc})</td>${c}`,e[4]+=`<td>${n[d].sessions.pu.toFixed(2)}</td>${c}`,e[5]+=`<td>&nbsp;</td>${c}`,e[6]+=`<td>${n[d].defenses.total}</td>${c}`,e[7]+=`<td>${n[d].defenses.nb} (${n[d].defenses.nbc})</td>${c}`,e[8]+=`<td>${n[d].defenses.pu.toFixed(2)}</td>${c}`,e[9]+=`<td>&nbsp;</td>${c}`,e[10]+=`<td>${n[d].coaches.total}</td>${c}`,e[11]+=`<td>${n[d].coaches.nb} (${n[d].coaches.nbc})</td>${c}`,e[12]+=`<td>${n[d].coaches.pu.toFixed(2)}</td>${c}`,e[13]+=`<td>&nbsp;</td>${c}`,e[14]+=`<td>${n[d].bonus}</td>${c}`,e[15]+=`<td>${f}</td>${c}`,e[16]+=`<td>&nbsp;</td>${c}`,e[17]+=`<td>${n[d].kpi.jrs}</td>${c}`,e[18]+=`<td>${(f/n[d].kpi.jrs).toFixed(2)}</td>${c}`,e[19]+=`<td>${n[d].kpi.hrs.toFixed(2)}</td>${c}`,e[20]+=`<td>${(f/n[d].kpi.hrs).toFixed(2)}</td>${c}`,e[21]+=`<td>${n[d].kpi.hrsp.toFixed(2)}</td>${c}`,e[22]+=`<td>${(f/n[d].kpi.hrsp).toFixed(2)}</td>${c}`),l=l.add(1,"month"),u=l.endOf("month")}a="<table>"+e.join(" ")+`</tbody><tfoot><tr><td colspan=${n.length+1}>la valeur entre parenth\xE8se fait reference aux annul\xE9s</td></tr></tfoot></table>`,Swal.fire({title:`<strong>Statistiques du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,icon:"info",html:a,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen",onOpen:f=>{}})};var Ie=class{},wt=Ie;U(wt,"init",function(){console.log("%cin initUI",T),Ie.build();var o=new Draggabilly(".draggable",{handle:".handle"})}),U(wt,"build",function(){console.log("%c in buildUI","background-color:green;color:white"),GM_addStyle(`
.flow > * + * {
  margin-top: var(--flow-space, 1em);
}
		`),GM_addStyle(".panel {/* because of stacking context : https://stackoverflow.com/questions/5218927/z-index-not-working-with-fixed-positioning */position: relative;z-index: 666; /*seems that 4 is good*/}"),GM_addStyle(".menuBar {padding:7px;/*for handler*/font-size: 1rem; pointer-events: inherit;}"),GM_addStyle(".draggable {background: transparent;border-radius: 10px;padding: 20px;}"),GM_addStyle(".draggable.is-pointer-down {background: #09F;}"),GM_addStyle(".draggable.is-dragging { opacity: 0.7; }"),GM_addStyle(".handle {background: #555;background: hsla(0, 0%, 0%, 0.4);width: 20px;height: 20px; border-radius: 10px; position: relative; top:10px; left:-10px;}"),GM_addStyle(`
.menuBar{
/*Smol Responsive CSS Grid*/
--min: 15ch;
--gap: 1rem;
display: grid;
grid-gap: var(--gap);
/* min() with 100% prevents overflow
in extra narrow spaces */
grid-template-columns: repeat(auto-fit, minmax(min(100%, var(--min)), 1fr)); /* 20 px is size of handle*/ 
}
		`);var o=document.createElement("div"),n=document.createElement("div");n.classList.add("handle"),o.appendChild(n),o.classList.add("panel","draggable"),document.body.insertAdjacentElement("beforeend",o),o.setAttribute("style",`top:-${document.body.offsetHeight-o.offsetHeight}px`);var a=document.createElement("div");a.classList.add("menuBar"),o.appendChild(a),Ie.addButton("collectChecked",pn,{},a),Ie.addButton("CollectAuto",fn,{},a),Ie.addButton("showBill",bn,{},a),Ie.addButton("billInDetails",cn,{},a),Ie.addButton("PDF",hn,{},a),Ie.addButton("SList",ge.showList,{},a),Ie.addButton("DbgMode",mn,{},a),Ie.addButton("statistics",yn,{},a),Ie.addButton("Database",gn,{},a),Ie.addButton("about",un,{},a);let e=document.createElement("div"),t=e.style;e.id="sttPlaceHolder";let l={position:"absolute",bottom:"7%",left:"4%","z-index":999,display:"hidden"};document.body.insertAdjacentElement("beforeend",e),Object.keys(l).forEach(u=>t[u]=l[u])}),U(wt,"addButton",function(o,n,a,e){e=e||document.body,a=a||{position:"absolute",bottom:"7%",left:"4%","z-index":3};let t=document.createElement("button"),l=t.style;return t.classList.add("button--primary","button"),e.appendChild(t),t.innerHTML=o,t.onclick=n,Object.keys(a).forEach(u=>l[u]=a[u]),t});var Lt=class{};U(Lt,"start",function(o){let n=document.getElementById(o),a=c=>n.style.transform=`translateX(${c}px)`,e=0,t=7,l=c=>{a(e),e+=t,e>100?requestAnimationFrame(u):requestAnimationFrame(l)},u=c=>{a(e),e-=t,e<-100?requestAnimationFrame(l):requestAnimationFrame(u)};return requestAnimationFrame(l)}),U(Lt,"stop",function(o){window.cancelAnimationFrame(o)});var _n=wt;var Wn="#OCAddonsCfg {background-color: lightblue;} #OCAddonsCfg .reset_holder {float: left; position: relative; bottom: -1em;} #OCAddonsCfg .saveclose_buttons {margin: .7em;}",Kn="height: 16.7em; width: 30em; border: 1px solid; border-radius: 3px; position: fixed; z-index: 999;";var vn={id:"OCAddonsCfg",title:"Configuration du module",fields:{nbHrsAfM:{section:["Statistiques","param\xE8tres"],label:"Nombre de minutes pour une session d'\xE9tudiant auto financ\xE9",title:"Dur\xE9e moyenne d'une session AF (calcul du THM)",labelPos:"left",type:"input",default:30},nbHrsfM:{label:"Nombre de minutes pour une session d'\xE9tudiant financ\xE9",title:"Dur\xE9e moyenne d'une session Financ\xE9e (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsS:{label:"Nombre de minutes pour une session (avant 01/07/2020)",title:"Dur\xE9e moyenne d'une session avant la s\xE9paration auto financ\xE9 | financ\xE9 (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsD:{label:"Nombre de minutes pour une session de soutenance",title:"Dur\xE9e moyenne d'une sessionde soutenance AF (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsC:{label:"Nombre de minutes pour une session de coaching",title:"Dur\xE9e moyenne d'une session de coachine (calcul du THM)",labelPos:"left",type:"input",default:45},maxfetchpg:{section:["Application","optimisation"],label:"Maximum de page recherch\xE9es dans l'historique",labelPos:"left",type:"input",default:1e3},datacachelifetime:{label:"Temps de conservation des donn\xE9es dans le cache (en ms)",labelPos:"left",type:"input",default:12e4},checksessionalreadyexists:{section:["Application","Base de donn\xE9e"],label:"sessions: v\xE9rifier existence avant insertion",labelPos:"left",type:"checkbox",default:!0},sizeofcontentlist:{section:["Interface","th\xE8me"],label:"taille de la police des listes",labelPos:"left",type:"input",default:"1em;"},use_custom_css:{label:"utiliser des styles personnalis\xE9s",labelPos:"left",type:"checkbox",default:!1},custom_css_url:{label:"url de la feuille de style (si plusieurs les s\xE9parer par des virgules)",labelPos:"left",type:"input",default:""},custom_css_data:{label:"saisir ici le code css \xE0 injecter directement dans la page",title:"Je me demande bien \xE0 quoi sert le titre",labelPos:"left",type:"input",default:""},alwaysaddcbox:{section:["Interface","Gadget"],label:"Toujours ajouter les checkbox sur l'interface",labelPos:"left",type:"checkbox",default:!0},show_throttle:{label:"Afficher le temoin d'utilisation du CPU",title:"Affiche le point rouge qui circule dans la barre de menu. Quand il s'arr\xEAte le CPU est utilis\xE9",labelPos:"left",type:"checkbox",default:!0},hackheaderzindex:{section:["","Hack"],label:"Changer le zindex du bandeau haut",title:"le bandeau haut \xE0 un z-index  (1000) qui le place au dessus de tout ce qui est pr\xE9sent \xE0 l'\xE9cran, ce qui g\xEAne la barre de menu ; activer cette option r\xE9duit ce chiffre \xE0 0",labelPos:"left",type:"checkbox",default:!0},support:{section:["","Support"],label:"StephaneTy-Pro.github.io",title:"more info on https://github.com/StephaneTy-Pro",type:"button",click:()=>{GM_openInTab("https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon",{active:!0,insert:!0,setParent:!0})}}},css:Wn,events:{save:function(){GM_config.close()}}},wn=function(){GM_config.open(),OCAddonsCfg.style=Kn};var Tt=class{};U(Tt,"longTaskTiming",function(){if(window.self===window.top){console.log("LongTasks: Initializing");var o=new window.PerformanceObserver(function(n){for(var a=n.getEntries(),e=0;e<a.length;e++)console.log("LongTasks: ",a[e].name,a[e].duration,a[e].attribution.length,a[e].attribution.length>0?a[e].attribution[0].containerType:null,a[e].attribution.length>0?a[e].attribution[0].containerName:null,a[e].attribution.length>0?a[e].attribution[0].containerSrc:null,a[e].attribution.length>0?a[e].attribution[0].containerId:null,a[e])});typeof window.PerformanceLongTaskTiming!="undefined"?console.log("LongTasks: Appears to be supported"):console.log("LongTasks: Not supported");try{o.observe({entryTypes:["longtask"]})}catch(n){console.log("LongTasks: Not supported")}}}),U(Tt,"paintTiming",function(){if(window.self===window.top){console.log("PaintTiming: Initializing");var o=new window.PerformanceObserver(function(n){for(var a=n.getEntries(),e=0;e<a.length;e++)console.log("PaintTiming: ",a[e].name,a[e].startTime)});if(typeof window.PerformancePaintTiming!="undefined")console.log("PaintTiming: Appears to be supported");else{console.log("PaintTiming: Not supported");return}try{o.observe({entryTypes:["paint"],buffered:!0})}catch(n){console.log("PaintTiming: Not supported")}}});var Pt=Tt;var Rt=function(p,o,n,a,e,t,l){t=o.createElement(n),l=o.getElementsByTagName(n)[0],t.appendChild(o.createTextNode(a.text)),t.onload=e(a),l?l.parentNode.insertBefore(t,l):o.head.appendChild(t)};var Vn=function(p,o){if(!arguments.length)return Promise.reject(new ReferenceError("Failed to execute 'fetchInject': 1 argument required but only 0 present."));if(arguments[0]&&arguments[0].constructor!==Array)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 1 must be of type 'Array'."));if(arguments[1]&&arguments[1].constructor!==Promise)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 2 must be of type 'Promise'."));let n=[],a=o?[].concat(o):[],e=[];return p.forEach(t=>a.push(window.fetch(t).then(l=>[l.clone().text(),l.blob()]).then(l=>Promise.all(l).then(u=>{n.push({text:u[0],blob:u[1]})})))),Promise.all(a).then(()=>(n.forEach(t=>{e.push({then:l=>{t.blob.type.includes("text/css")?Rt(window,document,"style",t,l):Rt(window,document,"script",t,l)}})}),Promise.all(e)))},lt=Vn;var qi=function(p,o,n){"use strict";if(!p.MutationObserver||typeof HTMLElement=="undefined")return;var a=0,e=function(){var m=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(b,g){return b instanceof HTMLElement&&m.call(b,g)},addMethod:function(b,g,x){var M=b[g];b[g]=function(){if(x.length==arguments.length)return x.apply(this,arguments);if(typeof M=="function")return M.apply(this,arguments)}},callCallbacks:function(b,g){g&&g.options.onceOnly&&g.firedElems.length==1&&(b=[b[0]]);for(var x=0,M;M=b[x];x++)M&&M.callback&&M.callback.call(M.elem,M.elem);g&&g.options.onceOnly&&g.firedElems.length==1&&g.me.unbindEventWithSelectorAndCallback.call(g.target,g.selector,g.callback)},checkChildNodesRecursively:function(b,g,x,M){for(var $=0,D;D=b[$];$++)x(D,g,M)&&M.push({callback:g.callback,elem:D}),D.childNodes.length>0&&e.checkChildNodesRecursively(D.childNodes,g,x,M)},mergeArrays:function(b,g){var x={},M;for(M in b)b.hasOwnProperty(M)&&(x[M]=b[M]);for(M in g)g.hasOwnProperty(M)&&(x[M]=g[M]);return x},toElementsArray:function(b){return typeof b!="undefined"&&(typeof b.length!="number"||b===p)&&(b=[b]),b}}}(),t=function(){var m=function(){this._eventsBucket=[],this._beforeAdding=null,this._beforeRemoving=null};return m.prototype.addEvent=function(b,g,x,M){var $={target:b,selector:g,options:x,callback:M,firedElems:[]};return this._beforeAdding&&this._beforeAdding($),this._eventsBucket.push($),$},m.prototype.removeEvent=function(b){for(var g=this._eventsBucket.length-1,x;x=this._eventsBucket[g];g--)if(b(x)){this._beforeRemoving&&this._beforeRemoving(x);var M=this._eventsBucket.splice(g,1);M&&M.length&&(M[0].callback=null)}},m.prototype.beforeAdding=function(b){this._beforeAdding=b},m.prototype.beforeRemoving=function(b){this._beforeRemoving=b},m}(),l=function(m,b){var g=new t,x=this,M={fireOnAttributesModification:!1};return g.beforeAdding(function($){var D=$.target,v;(D===p.document||D===p)&&(D=document.getElementsByTagName("html")[0]),v=new MutationObserver(function(s){b.call(this,s,$)});var h=m($.options);v.observe(D,h),$.observer=v,$.me=x}),g.beforeRemoving(function($){$.observer.disconnect()}),this.bindEvent=function($,D,v){D=e.mergeArrays(M,D);for(var h=e.toElementsArray(this),s=0;s<h.length;s++)g.addEvent(h[s],$,D,v)},this.unbindEvent=function(){var $=e.toElementsArray(this);g.removeEvent(function(D){for(var v=0;v<$.length;v++)if(this===n||D.target===$[v])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function($){var D=e.toElementsArray(this),v=$,h;typeof $=="function"?h=function(s){for(var w=0;w<D.length;w++)if((this===n||s.target===D[w])&&s.callback===v)return!0;return!1}:h=function(s){for(var w=0;w<D.length;w++)if((this===n||s.target===D[w])&&s.selector===$)return!0;return!1},g.removeEvent(h)},this.unbindEventWithSelectorAndCallback=function($,D){var v=e.toElementsArray(this);g.removeEvent(function(h){for(var s=0;s<v.length;s++)if((this===n||h.target===v[s])&&h.selector===$&&h.callback===D)return!0;return!1})},this},u=function(){var m={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function b($){var D={attributes:!1,childList:!0,subtree:!0};return $.fireOnAttributesModification&&(D.attributes=!0),D}function g($,D){$.forEach(function(v){var h=v.addedNodes,s=v.target,w=[],C;h!==null&&h.length>0?e.checkChildNodesRecursively(h,D,x,w):v.type==="attributes"&&x(s,D,w)&&w.push({callback:D.callback,elem:s}),e.callCallbacks(w,D)})}function x($,D,v){return e.matchesSelector($,D.selector)&&($._id===n&&($._id=a++),D.firedElems.indexOf($._id)==-1)?(D.firedElems.push($._id),!0):!1}d=new l(b,g);var M=d.bindEvent;return d.bindEvent=function($,D,v){typeof v=="undefined"?(v=D,D=m):D=e.mergeArrays(m,D);var h=e.toElementsArray(this);if(D.existing){for(var s=[],w=0;w<h.length;w++)for(var C=h[w].querySelectorAll($),P=0;P<C.length;P++)s.push({callback:v,elem:C[P]});if(D.onceOnly&&s.length)return v.call(s[0].elem,s[0].elem);setTimeout(e.callCallbacks,1,s)}M.call(this,$,D,v)},d},c=function(){var m={};function b(){var $={childList:!0,subtree:!0};return $}function g($,D){$.forEach(function(v){var h=v.removedNodes,s=[];h!==null&&h.length>0&&e.checkChildNodesRecursively(h,D,x,s),e.callCallbacks(s,D)})}function x($,D){return e.matchesSelector($,D.selector)}f=new l(b,g);var M=f.bindEvent;return f.bindEvent=function($,D,v){typeof v=="undefined"?(v=D,D=m):D=e.mergeArrays(m,D),M.call(this,$,D,v)},f},d=new u,f=new c;function i(m,b,g){e.addMethod(b,g,m.unbindEvent),e.addMethod(b,g,m.unbindEventWithSelectorOrCallback),e.addMethod(b,g,m.unbindEventWithSelectorAndCallback)}function y(m){m.arrive=d.bindEvent,i(d,m,"unbindArrive"),m.leave=f.bindEvent,i(f,m,"unbindLeave")}o&&y(o.fn),y(HTMLElement.prototype),y(NodeList.prototype),y(HTMLCollection.prototype),y(HTMLDocument.prototype),y(Window.prototype);var B={};return i(d,B,"unbindAllArrive"),i(f,B,"unbindAllLeave"),B}(window,typeof jQuery=="undefined"?null:jQuery,void 0);var An={data:"DwCwLgtgNgfAUKApgQwCb2BRZkAIDGIyATgM7YC8ARAK5gBmAtABxUYCEjjuADgPY1iARxp8AlrjEA7fFEGJcURKUViARitSIaAD1z1xKgPy5GMXgOIWaAN3FWlKgFYDEVxFNwQ+W3KRxSqMhQfFIKXBik+MRiPGB+xPjU4GA8pABcAPSZ+KhSAHROpFpQYjbE+WFgmVI8EJmkAO6I2MFuYABMAAIAjAAMbMAN0bFgkSNxCUlUKWlZmTS1ANYA5vn4fPVBAJ5FvfnM+R09mTtF+RDShaRUuFr0brgwQ1ExcRxcuNZWAJIAoj0eqYzAhXqMpskwKkMtlcgUiiUyhUqpkViBMsEeNJEEUMVAsWEujYOvkdKTTmJ-HiCYhGGJEIDrrd7m5nsM3mMEJxuPxBIplLhkHRiAKpMgbGIVsgwNoyMDxhyITMoXNYXlrojypVsKj0Zjsbj9YTiaTyahKdUjYgmWywe84KCwNslPA1D5trgAN5wL4GKRgRj0ZCXKDbdK4KgAeR4HlwAGVkFIbgAaUzIHg8JSMUjbfyICCpgBCpSkSwAssh8HHczKIAAxUJgVNUOOIFZ8BQAVR+VFTACU+G6wHxU5GdNsVh5GAmk6nO2pFmAaKmAMKJnAiqBQZsACUQUBs2DE+DwADltIhe7g9wejyfUwBBGLBVOkROkbNuMT0ADcuDgAC+CANE6LrASAKDoA6wBuqg2zwAg5o2AQUDIKQpDULWmbSpeGAUjYCGghMnJwI00ioHwjT5CyxAADJ8Gg0grA++LYrgFD6Is+BgGIoS4AAFCeW5qJWSwAJRenAACQUkbEmfBKPkIQrPxVA0YoDHmlIKxUGJP4+l8hlfGRgSUfkaCoH8h7+rRFoeG4-EAORNMEjmpvQXE8Xx-GIBJ3pGUZsmhKQCnWspqmINZ8TOY0rm4CK+CIGUiCoKmFEEMEUAifgSy6fpAWGUF8mKeFvn5QVAVCVlon8XpBkFQBdUVQQwWhUpfAqY5kUePE5BgI5TWGQB+lySFJUdapNH0Yx2ksTSfjYDKqB5XAHkyF5niTmAnbEFAABqJCkLVklGTYJC4GdcocZ6w31Rd508CQYAqBxJkUVRIQnht+QgCK9D5CK2GJfxmQANpGAAZAAugA1PxoMAHoUNDMNiRQ8MI9DABUYmomI7mebxUj8QWSyINsyZnXIvknRVl2kKDZPbFD7H3dT5VfI1HPxdggiePT+lAathN8VtO1QAACiQwb8Y9xDBtgbhpYgQY0FAYBUzQvn+YZl24II+LS1gMpWBx9xCurmuINz378W9ZmfdKRM-X9+TkYgOiRvQstG4rxASeYjA9GJOsFQbcsKybrNi7tB1kLVoMR8bbhQ9zRlAUZIpLsQnjh77JuCw6esURAfaQR6HFrdxRMCX50lZ3zuBhI0uAS8QmyUog-EimNh7seY3oyd+AkUfgNBYP6APl3GOAyuxHFUCEM06XXMlSaP489eZqCWVFtl5mExCqQAIpGZYro2PXTVoy2pj3CmHmJ0lSQBuD7uQklr-ft61fpMlAS-J+t04D8TQtsGQx0KAD2kqNNq4UqAAFJ8D5HyP4J6V4qAbBCMQdIGx5ZQBWlJZAsUxDxBLmXNA2xf4wNauNFSiDch8HwJIFQIpKEYKwXwHBeDgiEP4DwGgPBqFFTGmFCaDCUH5A8LfCMnDuFcN4XVKSgExLULgJkLGPosb6x4qUJ0nF1o1xoOQVAkhTFnBUJSRy-p9YmK0f+XA2ivgNxzgQQQIobFBBlKmR6O8Uq4DImAEAuA+iSHoE3FoN8tGZDgHrLaAAVCCx8cLsSrhtY6g80k118fxUgfkebZ08Lk3AwBcD9AkiYRyfRHK4Bhn4XA4ZSB-gAcXVmzdcDJJlLVeuvNXGg1QPkLadY1ZQAAJooCPhJHxaB+IDK2mWRsIBaow2DtM1AszBnYE6V3MSYkoaFHEMTRyjABqASLg9PgAieCszATIAx1dQi1UHsPfiToYx8HCXGWKUBcDsAoBxRyWTQgDUHiItqbh25HwYT8YgCU+CHnlmoJQb9YVcIwdlVY7dFioEYHI9IIpUp4qRaJQhUkXFSD-i-aS2RgR3AAJf0GkKQmuWgVD7nzD1FQGwIAQEWKQalORgq9RlGkVmoNHI9DcrgRyHQpWOQAMyOShtJJQwrECio4uKyVyYZVKpoUmXq3yACKWstYz3VazL5wQLhiB0NIfioKAD6WE44ZCbiM5MBkZJyUZcQCAhY6DDikPEj2YBwyOTjDQMo65cAQ3lrCn8bkvWyUTIlKAAaoShBDToMN0q250vwHSrQNiIaoQTUmr4MkeDtxWD3Ug5q5h+BFaQT1layXdTIIgDNQa3VgGIFrVtuAZJUzEF4omZZlBvknOGlcChCDBlFcoeIIoRBWM9TJc0qBoweHDECop3gghQFXmvWBdDVKSKtVAdIm7t1SFJTJe2VFzSkEemAQgVker8WfmvdpK5jHDggB+-0TkXJQCld+mSnpcALjUEi5Q4Y+0DruK0MQV6vS4BlDm8MUYADS+RbivwAWvKST9iNKJfqmZ+ZEty3t3SLYm2tv2nrEfQi93z0jUagLe0lAF13r1HWXQIbg6OGO8ge4IIcIPMfaqxtjwRr0CekW4e9UlH3UUpK+99UV+K-v-ZsIDYAQPfKlVBmDcHe39sQMrHAqHwxQcw7myB5gHMkBQPkK2uBCO7OfrxqjqGoArhCOQETDzibiaPaC71tCWPnskfkS9HH-OBb4OQHjfHN3JeC-c9J4XJPEek-AuLKCEsZaC5ecjvmN2juPku9uYZstExJj4CTkWwVnqoEV4r7HN01f8HVtLz9pJc2kvq-wbMtYvVwKDVOKrsBuNhT1Btf9RvxEemEKAjrGggFCpGYgrYlDcVZqCniYBkVSXDSahQdg1aIAAF4XQECoN8tg2wkC0MQJNMlwDQCMuGAABs-YAShJyBBgCubblJKTkHu2BulMpAhayGMD6R8AZLAEZfuVAfVUdSWAEhFCaEMJUAMH62to62CA+kAI+Io7qCEHEIlW4YosB04h4zjD2wYzJFHcW24VtqBSBGYMbkRBAjIoXJmzwshjxLAIGz8IIIZLxIEPED2-BiAmxgoGvitOqDvmaMQHozJpTIEYJWDa1A1dcLAI6zKtxZCE+oKBjo2ZQIpVuG8xA1AJdBrYJGHDQwfehBx3GOlUAC0bUPvyFQOBzNa8l2Y6g+u3AdGNzgM3oXLc6HVzb0Il4CfoSd98l3-hnTu451zqgQe70wH94H7XUgcdDAx1ALH2Am+ohiFBGSf2+PVsQBfKQvqIAhfScgVMahkz4GTKlGmn8ovFRi+Pyf0-Z-kakqq3Azr8w8Fdd+vtHpWvb4gLvw6rMABScZIynnyHLcgsymGb0niINw2x9uIG4lwpyoNmde8wfLqgKGAadzYILWdfKSWEaLGTVSENE-dIK8Y-U-MgdfV+L6QgHyY9GSSAxfaAv7JBP4HQRKOIGuAAEk9EQAAl72lTxR4SgB-AxVrQEECFxQUi4XxRSgGkpRkkvVQW20aAOlKDHVCAnXQmQEnH4j+wnUSAkF8Hp0hysEWAUFZWQ10FwEuQ2lID+3APJX0GCHIC4KIzaxi0v2v1v0Oi7g3gnjAHyBf2IDf3ZU-yPkch-wVlZwZ0vCALEhAOpl2S4OyFtk9w+S3xdTP3+QBWxRVmxFQBqQAB8Yjgid9XV54OJBctw8sh5vYEiT8kiwj3U0jWseDSA+CBDR0nZhDJ0xCu5JC3B8AZC50IdSAxAFCwhkNNBtA9B1CiZNDtDelPAgwoB9Dv1X5v1sDRFcCkFYCkCWFcAyDEDXVKDkxMFWD5F8F70dDPQ8weB0gehUwrZ0g5jDohZ-4+MNFn4nArtkBKRkM7AmjeAnpbjSA+RFDkMZRQs7hHI6VrIOUbE5smhSFCBHhHiHBHJFg1CaBFBHIhQ+0lCBR2UrC2jFA8AX8tY34+jQhQsziFAYxVCtBXio5UIWoDU7j1tNttslBdt39uJUxzivAupPByANc7h0TvheB25HpJwHAFBiA6VHj1ZpRcBJFcAABzvAFov0ULFox6FQZ+LGGJB9fzWjBrbyfcTAgrcROTK9Tjbjdfb9fcGwrWOwyk4cJw-IEnCAMnaIrwiyAzfeeHByRyaXHKKVR1UXVAJQU2JUhjSTKTKA8KPA-AAzXAeJEgLacMMg60DcLaBYpY7BXBBRAhcAn0okq3DXFiDbc3GuSuejHyGwMAdIteW2SKawyM7AC4aUAEo6RyavfpE3DPC3KgFMm3O3Tw-Mk9X0iaf0ggnPXAB8WiWiOXdw3vGMtg2glTLAzINbfcUknbPbBw6wg4q6aVRs23LcRyP8GlDYNWPIRyeIYxBQUhCDGSIs9YdxHqYM4gLafU1-I0r-Zw3-Nw48Dw4AjzDiEwm-PrJib8KhT0PYhs7Pa3FcghRqQ8iA04RABcFYDkrgmSIdHgx0pYQfYfYRYjIdQwmSclaC26fLIVN+f8jXSMMIW3N4rM0TBjXM1sqSQs3M-IEs6ww8iAcsiCSs6srxU3DM0ILPHPR1PPQAgaCi0CycjbLbGco0-IBcybLqPC3PMINc3ADcgQVvKQHc2xfcsAEC48seBbf0c8y82w+wg7Y07-e8--dw3irwl83AN81BPtT8+gb8385cni4C4jKSIdNUlSf0n4JMdoQUJtC1fk-gRojaBpGYz0HgraS7M1EVZZHoaMmg+Msc2C75N2byjXSKxABtH2EkrbaUZXBMQ8ZMcK7AdKzKsSFZUjFyzY0gVBTMR8-iIqsAEq6KsqnYkJVMCVNQTgkCng6QBkxq01DK6KwSx1M06UQq5KiKga0qmGDoCq4jKqmq0oYGBqpq9VZZDoVMPodqnofALqlyoybITfR1NQMATwDiBqxCpo-1BvZCteIdbIY6069YJapYW6mCqSOCl6y6v1N6l+f8YjDCiDLCteDRQUN40hRxOUteRstMoi9JMqCDRsgixAOGxrBGteYbf+IbB0ERVbRMKcnKsAPK8UBQa6Z+E7M7C7FE67JQe7a7J7IUQ8KUYgd7T7KSb7KAc7XAAHNePHMoZNKSHQRgVi6gUOIdGSWPRwOzO6NtKSHoOzMxcMfoVMMAJFdIZyJcYtZ6KVBzcNP4TWsQdcUgGpXzAqNeDoBW0dcMDoLajDNW5ySdLonW0NcNVsdCJ2zzQdQKGSeVS21AcMeVW21Wq9DWmgLW0gF0i0LhbYZ2rDaVHcKOmIF-FQOHMOw2-0Y2z2mW8WqSAAFj9vDFzqDvtpAETu2EdXIHdtCEdRPABNjtzUcgrGEBRPZIUErsaOChNq9sKhkgAFYC7cBe7i6Q7jZkB67w1j5QgpA6UWgVB0xaqvpkpM7Tae6qVZaAIqBv0cdcc1Z4BZbgBuQeYxsgisJUI54Ig7pebT6cJs614haSdqBQZR1djQDEAWZpBcBIw1BzjuIpF-QYhlBXlkBzMxJN6zaZJ0gmZqBydL6ZI96ApebSh4Hva0cqc6AK8-8ASco3QdBbh0hdcrY3ZloGljLCHg6+dX7qAKdwG0dUI1B9wGkH6qBCHydcAhaHNqAyHQ1BhMg6H9xkHV6kcxABHebMhr6ZRt7ccFhYBv0hgkIcde9n5+9vqR9a5+559QLBQY8IIRRpi8AsGlgcGAlSFgkpA+AzFJAvB-19BUMo4ddTFhw+AmMcLuLLUJrsAJZLlBFaorzDS5yuE0zv9PcKADGcGoYn7UBPCuDN8JAOJuKlIPAVgglUxbdYU2lEAW4nx5YqExA9J-qZISd+I-wxAuA-xUniAn6WZrorbuLKmiHUxf99i+A6nf8p8IIcoUomm6mDGUpMb0Lej0NNj0gNrxtEBwxymiMAEsLRo8aSSvFSb58KbEAuaqBLstwBR5mUxn4OauaebcdS8wIsDtEhJpEAGrA0B0wwA6VkNcBZgYRBVsFSg1B1hNhMhsB8BMgRQVgzSHmuEnnGAvmzTGAOhe7MhbmVR7m5EnmXmthKIpAl5UBMgegABOVFsF2U5+DRPhqAaiHCdIdIZAegKOT0OSeHXNKgAAHUQGYHlQADYqAfxArmVQhwxNwnZDwfwlAiXC6+geAdAfxhwtjB6+WfwAIMWCmuEIAvRn1sJ6sLTGWLImIlb8x6DRJGDsVwwABiegZFnVnV+grhd7JWvlvwBSUdXATV-AHa61n8Bii86Qa2kUKVqE8x0JF1215AIWsiVAIJcMWlvoXl-l3xLSFYZViAUV5+M0yQWodBz0BgrFQILV+gZNg1lm4TMpE1sac1zV5F-AXN3NiNiVv1aDBvL0eNpg-21QNEMAWtcmBVneJVkJfIAAdhVe9d9bKQDYQVTaNZCULakijer3SG2wRTLbVYTcrfbFb37ajexa9GDcbb6HyF7vzCbZXalaXfXb7aIyjbQfiE9AXe0nDCXdbfDbtZWGkEYCHAA2PeXadZnclejep3SAMDHhUE9BVxLDGdwHlUzbNdMSndQH7a6CwHNDwBJkvfbZAB5cDb8lNMldtx3j4k9AtMYHEdpCwXHiTGtoDZNZ6HoGIB-FQ6lCFZ6FpZFdfng79UQ4ok8Dnc9AczN1KBWCkFZclHACI67xYLkAgFY7KTktwA6FFYFLNJo51xjabBE4Q4sj4mry9FQ8w94+toE-lVFaIxeDdyb13dQGoD7AfAAC17dUJC9idpOkO70wb6yKdUGJOMHWcP9DG+BcHE8q8jS082LM8qA+oK65yjB7d2myZu9cc52mH8A1AjTdtTw+AwA2BQ8DKiYo9nieA6UYgfAFAjAkdgH+HAcQuuFqAfW6x24IAjPHc1IcI2BtkbnUA6UJdMv6GZGbPqcXOCuiuPdOc-95nbgGKdBqAbbA6g4Xd5UjcvBpBeu+h+gBvGAhv3O6yiYndsBHV5mRrWu7hazUJtIaBKiKBAUPsm9cviB8uia+ASuTPOuYBKvfBGUpA6vsvGv0HdcfXlc2vK9OuvBPWxv+uehBvhvLgpAxuJuvupvhvWLZuOKvOFulvhwZv1uVhNvJxtuCPHIO8zSm8X1EwYAouZRwxkVGV1ZdGgTETVu54WjShLg54X9o8Foq6kwClLBp7lAXg1sFG+8RQVHwwnMNHv01BzwUpKuzZH8rDNkwA-glArDCxtgfh1kqyjTgCemgPv0WvNhWZLCt4toRfviwBxfJenJFeIBnzX6uDHvzH+ex5Be1fReeotepfdf9f2Zv1v1bZufIk+f-kMNLNY0IYBI7gwBCulfciqBbg4jvfldkiIxdJcBWzCjijghSiNoRCp0qipDaibnSAw8P9I9Hhnj5mwT6UNgASYd9G0IYS-A0-QstDoKdD+jBiMb8nlEv4BnWshn5VKNiM9jQZDyVfJ5zeNerenJwu5zZeAuUo+M15O-rDu+xeJfrefeivgDn1gGlBTFcjEN0u8iflwwx+hf1fJ-tfHIbfzLX6R+N0BfVfsBt-Lep+deju5-KQF--Fl-3eTBUj1+mTTfT-heLf-Re+9-r+D-qYINlUGNSlJVn4xboYwfHHyEenUZi1AoepPSjeRNKicZOSlK0jvBtJ2RD4TkedNpEQDOlXS7pVmHugwIwCKouNBaGAG2S+8IAqNPiCRVCw5k8yrWSit7GPK0Uyyb6Jit-hB7sU-u4PG3EtwI6bAzKFFTfBYlZh1hzcggekBUCebVUru6yY3uYD4BEN540qCxHtWIy2wxBuRCIldxSj8V3KqkJBD8D7B9g-gK4SMHtD+B6dCwtEP4LgGsF9hIwfYXAKeD+B-Bj4PZFcCuD+Bxg4wQZSMPGDPj2CHwEsCWLRB+ArgHw8SH4NflwB7QHwfYOML2BApVlx2FbbjmwQJR-giUqEHKImhArgF+mhSaClShcraDVuuwaqnEGIAd8T+XfM-p-016X8f+yuW3iiQ4ggULED+N-g0I-498Wh+-bwmARAp-0t03sRyN4H9AgBgCo1QzFQFGSLDRkjAMsGWEYDHxj4Y5KSOQCgD-RxKYqT0IINUab8J+F-XfkMKtgq0+A16eoeP0aEDDzhv-YYRQUAEoU0K7aEoUDWgpJkxsfUB8HBjypzk+enpBgRRSorFkQypZBihwMAbOFuBnnbzjsPT5+cWyTAoyEdTUDK9bhW-Jod-374GVB+DnFKKUPXjYjThX-QYTP02A383wcGJfr8i3xqAuhZI+4Tv2n5tCvC8-OkazHYCMjDyaFYGkc0s41wIa4rNeH1EoFFcaBXpaCn8IBF8AjS2yDAmnAqjDZmoB1QVDgXgRIJQgt6CwFcg4TLE4yqxQaKqO7pGRSsKWb9pAIkhQJaY6ogKHAINL6V0+t5KjtQOQHAEnW8KRAOgIPgOR-8iYScAgVFyt43ApogKJViGx-wZmxJKcnMKOzk1SElNaVGs30CStpQbNHZv9kBxIQBaQtEWlQDFprxJa8Ge0avXlroYranbdyBmLDSOQigwKFWi7WlSNilKWdGhhbSrGVsbatYv1NKHVr4BSANgcetQWHFd1b6MkWBmvRzob0t6sjXegLQPqfAe48QE+jvjPoK4RGaOdDpOMFqBg8uVACJi-Wpjv1PAX9H+tYR6gAMjopYvJGAwQYQMoGVAGBigwEb70kGe43HHuzs7-4HOODPBgQ1fpEM8GpDYCXMIobUwqG74nOsFyy7r8mGLDYhuw1DScNgJDmHhtixgmiNPxKDIYOh0kZDBFxojeRoNh7ws8B8oQYfOz1tHQIQaYLNCBhh0b7k56cuf8U52MZBIm45jc1hIF5RjZcedjTwOa0cY-D4grjc6u4zACeMrkPjeAf42ICBNnCwTUJk53CajoomEGGJqzHiZKBtIyTLfCQA9LtIsmyAHJnkwgyFNimpTQybCkqZHYamzTMQPsmfpNwFYXTZyZUAVhtMiR-tWpp5Ll59NihjcKDEM1zonitY4zIyYYSmbLZthxqKaiKivJax4YSjfGkJTJKIAKSc5PvOlMW44R10UMLwkEg8D8QBIPcNWHmWgHPxRBjqY+CJA-gcQJB3EKQW4HyBLBjOcg8iPxEUFqEVBrvRyPVKL4aCtBdUhqaTVd66Coi+ZQwdClMHmDLB1gh8LYPsGODnBrg9wZ4IfDeDfB-g+JIEKvxlgQhYQiIVEJiFxCEhSQlIWvDSE5R1WzBPFNkJaixliUOUY2t+nXyA0saG6MaUX2V6-TyAt+PtM-BeQVT1YzwzAjSj7TvgzSjwMDIOHOKq5PA5oCUpcRFDfojqKM1mGDOsKEMCUNAYGKAmTA6BaJAkT0JInHxTYyQmxKGOGDJBWxGoqYG6BJChnywkwUbBGenwwzmMUZQaMUHYQEhMx0gmxCKWMythzVN8pAHcJACgDUApSNzbkryVngMsMZc2XXm0g9TB9jea-LgiMTBaNF+QcuBdJoBSRLpUSa-VMASWz5KUzZ8s6tJ3HNnco4giAB3uEn4iLdjwoMeVOEz6BVNXeK-TAuvCpFSspIcTFGV7PCY9AZsxGI3kOjDmezvZoMDoNHLbJaiOySCHng43MZ7kieCgMgrr1fjcB85R3BYrIiNGjkUC9vAspkQ9n4BQYUcj3l8Frn1z9kL5V3n+S4p24Q4clMFg2jKQQYaUOc0uioATH0MTwOciGrFG0YKA88KlUxB-StACQScb8MBC1B4DbA5qZAu8YmJcqVioM1Y5WnbRDr+Aw6nKUcY5H1pp0jaE4lyl2P3k9jh66tduk7WbFx0I0jtTulnRcq+1uxAdR+aHXDqR1-A0dc+QnWAVJ0JsuAVOmBwzo3ziM+dX+bgCLoq0S6ZdHztTxrqVgII58puhT1bpU8O6SYOBWvH7qIKh6KCkeq0HPmT0pA9PAUPPSWrstlAxCmcbLSOr3YOIF49Pn-RsqAM7xLMsFoU14nnjv63C68fSFvF388kIcQwXeIiZFTX4HiG4goGeIQpZQ7xd2HoD-DIpe6b8MbPLL7QCAbAdKLSb8S7LW4qGf4SyV-j1hiAKAjqW7Ak30kgAg4xTGABQD6DWTGAIg34sGTgyngFYOk27JUxbk0UkUpQ2aZxlwo54rwpAPxUoACVYAihpAcxYyRhivkr875GytpC-IOpSxws+JYgESVWZWK16AGdaEbLxIkUyuN8rkkKXFK0owcxpcrjEhBSyh4o6WdAEsUQYpZMs9JX9mAB4AHucLBFrcF+gqx8uJudIA5gnKoRpAP4edJ2jAAUA6ATAZgMmHDIyA0unYPsJEM2D8AwgwGFJVJVaXMgRlmkTigBTIIJIkkOEWqABGuChA2Ay5a5dgESSIAlRrSx5ddwxAwA-s0FbIL0ugD9LgAPAGAFc3DyLLJwVhG5i8s9BmMqIcwpyEsNGSrCNhA0B5W2MdmWBqqkiIYGCv+Vrwhib8AYgoCgw0pmgASRMGKGiXW5fKSIt4ifTv4DzeGFobGcoEqnPCyyQiPQHaIdSJgxADFNDDoEajgEaUnwUsdzNpUa5TF4k27BQGmzQVJZIqR1I2R0nhzk5Vi7CmnJUi1zN5EGNQA2H7FgA3y6qz2bnX2TyCypvU5Qb-lUENiQoKA9YEP1QAGqjV0IlcHGD2hfB45dci1aaW6lqF1GtqwJQNKHEjivCcvCDI73dXShPVe0CioUyOp2LbajqCABQE2KqqpKTipJiAB-COoxAwANNWUzEAwxUYTAowtAUzWNlQYBaoqSSNtjVqpKtagKS6v4pSQHFt+YxEslr4uVPQNTfGCBQ3RTKPAGwLQDsr2Un488wGVAOUqkRSUqlUAZXPGtyQqqa1daryVgEaVUDmlfAXZEf2IyNMm1OeFtfslaZDqpILYh0uOIvXvCZIRQ9pRjSBrRrvYhqusW+UTVf5k1HilJumuPXW4c1QSfNYWuLVb5S15akCoYP-Ua5T1D6xtWuubUbq5e7aztQIiKJlSL1-avyYOpcqj8R1Wy8dbsovhTrDlhmKyh+RyV2VZkc6ypdUr4C1LoNYAU9Zuqsze8d1Ws3ZGJAPU-p3JjG5jeetw1Hk35bYxyLeqHUPr3hAoiDD0s6WyyqAwAXeirOIxJq5sBan9VvilZxNHFek3NSWqLXhswNZanxb1DrCoYiloa7mnCocX8aFYAER1K8qJq3KukXy2YsEo3WhpKCh5IFVAH6WHkgcwjECoMua7nK0AYyv6JMpwDTLQ0syy4hSkWV9QVlDAFgBss9DWaN1rFOcYJvejwsLlVAMgqQFM0JLbNbAVzTZqwAAR+IpW9zTmmcq4bAtvyvzayr+XPr5qsm9JfJukYwAlNWNb2jwV9RdwSBEtZMd+0cimbCA0glQCsDpTT1FZ7ACtI+I5o5jmodfNHPI3y2yaAIcjMoNhKkiKNwGPqK6t2izRXr6Ih4UMHNtgZ9MpmdUV+IZGAh2hOQged0HhA5rwAgAA",method:"decompressFromEncodedURIComponent"};var Sn=function(){var p=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",a={};function e(l,u){if(!a[l]){a[l]={};for(var c=0;c<l.length;c++)a[l][l.charAt(c)]=c}return a[l][u]}var t={compressToBase64:function(l){if(l==null)return"";var u=t._compress(l,6,function(c){return o.charAt(c)});switch(u.length%4){default:case 0:return u;case 1:return u+"===";case 2:return u+"==";case 3:return u+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:t._decompress(l.length,32,function(u){return e(o,l.charAt(u))})},compressToUTF16:function(l){return l==null?"":t._compress(l,15,function(u){return p(u+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:t._decompress(l.length,16384,function(u){return l.charCodeAt(u)-32})},compressToUint8Array:function(l){for(var u=t.compress(l),c=new Uint8Array(u.length*2),d=0,f=u.length;d<f;d++){var i=u.charCodeAt(d);c[d*2]=i>>>8,c[d*2+1]=i%256}return c},decompressFromUint8Array:function(l){if(l==null)return t.decompress(l);for(var u=new Array(l.length/2),c=0,d=u.length;c<d;c++)u[c]=l[c*2]*256+l[c*2+1];var f=[];return u.forEach(function(i){f.push(p(i))}),t.decompress(f.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":t._compress(l,6,function(u){return n.charAt(u)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),t._decompress(l.length,32,function(u){return e(n,l.charAt(u))}))},compress:function(l){return t._compress(l,16,function(u){return p(u)})},_compress:function(l,u,c){if(l==null)return"";var d,f,i={},y={},B="",m="",b="",g=2,x=3,M=2,$=[],D=0,v=0,h;for(h=0;h<l.length;h+=1)if(B=l.charAt(h),Object.prototype.hasOwnProperty.call(i,B)||(i[B]=x++,y[B]=!0),m=b+B,Object.prototype.hasOwnProperty.call(i,m))b=m;else{if(Object.prototype.hasOwnProperty.call(y,b)){if(b.charCodeAt(0)<256){for(d=0;d<M;d++)D=D<<1,v==u-1?(v=0,$.push(c(D)),D=0):v++;for(f=b.charCodeAt(0),d=0;d<8;d++)D=D<<1|f&1,v==u-1?(v=0,$.push(c(D)),D=0):v++,f=f>>1}else{for(f=1,d=0;d<M;d++)D=D<<1|f,v==u-1?(v=0,$.push(c(D)),D=0):v++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)D=D<<1|f&1,v==u-1?(v=0,$.push(c(D)),D=0):v++,f=f>>1}g--,g==0&&(g=Math.pow(2,M),M++),delete y[b]}else for(f=i[b],d=0;d<M;d++)D=D<<1|f&1,v==u-1?(v=0,$.push(c(D)),D=0):v++,f=f>>1;g--,g==0&&(g=Math.pow(2,M),M++),i[m]=x++,b=String(B)}if(b!==""){if(Object.prototype.hasOwnProperty.call(y,b)){if(b.charCodeAt(0)<256){for(d=0;d<M;d++)D=D<<1,v==u-1?(v=0,$.push(c(D)),D=0):v++;for(f=b.charCodeAt(0),d=0;d<8;d++)D=D<<1|f&1,v==u-1?(v=0,$.push(c(D)),D=0):v++,f=f>>1}else{for(f=1,d=0;d<M;d++)D=D<<1|f,v==u-1?(v=0,$.push(c(D)),D=0):v++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)D=D<<1|f&1,v==u-1?(v=0,$.push(c(D)),D=0):v++,f=f>>1}g--,g==0&&(g=Math.pow(2,M),M++),delete y[b]}else for(f=i[b],d=0;d<M;d++)D=D<<1|f&1,v==u-1?(v=0,$.push(c(D)),D=0):v++,f=f>>1;g--,g==0&&(g=Math.pow(2,M),M++)}for(f=2,d=0;d<M;d++)D=D<<1|f&1,v==u-1?(v=0,$.push(c(D)),D=0):v++,f=f>>1;for(;;)if(D=D<<1,v==u-1){$.push(c(D));break}else v++;return $.join("")},decompress:function(l){return l==null?"":l==""?null:t._decompress(l.length,32768,function(u){return l.charCodeAt(u)})},_decompress:function(l,u,c){var d=[],f,i=4,y=4,B=3,m="",b=[],g,x,M,$,D,v,h,s={val:c(0),position:u,index:1};for(g=0;g<3;g+=1)d[g]=g;for(M=0,D=Math.pow(2,2),v=1;v!=D;)$=s.val&s.position,s.position>>=1,s.position==0&&(s.position=u,s.val=c(s.index++)),M|=($>0?1:0)*v,v<<=1;switch(f=M){case 0:for(M=0,D=Math.pow(2,8),v=1;v!=D;)$=s.val&s.position,s.position>>=1,s.position==0&&(s.position=u,s.val=c(s.index++)),M|=($>0?1:0)*v,v<<=1;h=p(M);break;case 1:for(M=0,D=Math.pow(2,16),v=1;v!=D;)$=s.val&s.position,s.position>>=1,s.position==0&&(s.position=u,s.val=c(s.index++)),M|=($>0?1:0)*v,v<<=1;h=p(M);break;case 2:return""}for(d[3]=h,x=h,b.push(h);;){if(s.index>l)return"";for(M=0,D=Math.pow(2,B),v=1;v!=D;)$=s.val&s.position,s.position>>=1,s.position==0&&(s.position=u,s.val=c(s.index++)),M|=($>0?1:0)*v,v<<=1;switch(h=M){case 0:for(M=0,D=Math.pow(2,8),v=1;v!=D;)$=s.val&s.position,s.position>>=1,s.position==0&&(s.position=u,s.val=c(s.index++)),M|=($>0?1:0)*v,v<<=1;d[y++]=p(M),h=y-1,i--;break;case 1:for(M=0,D=Math.pow(2,16),v=1;v!=D;)$=s.val&s.position,s.position>>=1,s.position==0&&(s.position=u,s.val=c(s.index++)),M|=($>0?1:0)*v,v<<=1;d[y++]=p(M),h=y-1,i--;break;case 2:return b.join("")}if(i==0&&(i=Math.pow(2,B),B++),d[h])m=d[h];else if(h===y)m=x+x.charAt(0);else return null;b.push(m),d[y++]=x+m.charAt(0),i--,x=m,i==0&&(i=Math.pow(2,B),B++)}}};return t}();var Jn=function(){var p=[{id:"/views/test-swal-sauvegarde",path:"views",file:"test-swal-sauvegarde",ptr:An}],o=function(n){oCurView=p.find(t=>t.id==n),oCurView===void 0&&console.log(`%cError view ${n} could't be found`,le),oCurView=oCurView.ptr;let a=oCurView.data;return Sn[oCurView.method](a)};return Object.freeze({load:o})},Zn=Jn(),En=Zn;var J={Cfg:{dbase:null},raf:null,cssMainDataSelector:ht,start:async function(){await Zt();let p=J.checkSupport();console.log(`%cAre all functions supported ? : ${p}`,T);var o="header [class*=MuiAvatar-img]";document.querySelector(o)===null?(console.log(`%c All condition not met, waiting element '${o}' `,T),document.arrive(o,J._warmup),GM_registerMenuCommand("force - loading",J._warmup)):(console.log("%c All condition already met go",T),J._warmup())},checkSupport:function(){return!0},_warmup:function(){console.log("%c in _warmup",T),document.unbindArrive(J._warmup),GM_unregisterMenuCommand("force - loading"),GM===void 0?(console.log("%cI am not in a tamper env",T),J._userscriptless()):console.log(`%cTamper environment detected the version is ${GM.info.version}`,T),GM_addStyle(GM_getResourceText("jspanelcss")),GM_addStyle(GM_getResourceText("toastifycss")),GM_addStyle(GM_getResourceText("simpledatatablecss")),GM_addStyle(GM_getResourceText("loading_barcss")),GM_config.init(vn),GM_registerMenuCommand("configure",wn),GM_registerMenuCommand("force - cbox",J._forceCbox),GM_config.get("hackheaderzindex")===!0&&(document.getElementById("header").style.zIndex=0),GM_addStyle(".swal2-title{font-size:1.275em)");var p=J.cssMainDataSelector;document.querySelector(p)===null?(console.log(`%c All condition not met, waiting element '${p}' `,T),document.arrive(p,J._main)):(console.log("%c All condition already met go",T),J._main())},_forceCbox:function(){J._applyInjectionForSessionsHistory()},pathname:document.location.pathname,_getOCMainClass:function(){try{let o=document.querySelector(J.cssMainDataSelector).classList.value.match(/dom-services-(\d)/);if(o.length==2)return`dom-services-${o[1]}`;throw new Error("_aOCMainSrvId.length must be 2")}catch(p){return console.error("%cError in _getOCMainClass():%s",le,p),""}},_sOCMainSrvClassName:"",_eventMonitor:function(){var p=document.querySelector("body"),o=new MutationObserver(function(a){a.forEach(function(e){e.target.classList.contains(`${J._sOCMainSrvClassName}-MuiTouchRipple-root`),e.target.nodeName==="TBODY"&&e.target.parentElement.nodeName==="TABLE"&&(console.log("%cTable data changed (TBODy,TABLE)",T),console.log("%c=============> Changed data : %o",T,e),St(J._applyInjectionOnPathNameMutation())),e.target.nodeName==="BUTTON"&&e.target.parentElement.parentElement.parentElement.firstElementChild.nodeName==="TABLE"&&(console.log("%cTable data changed (BUTTON, TABLE)",T),console.log("%c=============> Changed data : %o",T,e),St(J._applyInjectionOnPathNameMutation())),e.target.ariaLabel==="Page pr\xE9c\xE9dente",J.pathname!=document.location.pathname&&(J.pathname=document.location.pathname,St(J._applyInjectionOnPathNameMutation()))})}),n={childList:!0,subtree:!0};o.observe(p,n)},_applyInjectionOnPathNameMutation:function(){let p=!1;p===!1&&document.location.pathname.match(/\/sessions$/)&&(p=!0,J._applyInjectionForSessionsToComplete()),p===!1&&document.location.pathname.match(/\/booked-mentorship-sessions$/)&&(p=!0,J._applyInjectionForSessionsBooked()),p===!1&&document.location.pathname.match(/\/mentorship-sessions-history$/)&&(p=!0,J._applyInjectionForSessionsHistory()),p===!1&&console.log("%cUnknow Route so could't guess what to do",le)},_lastMutation:0,_applyInjectionForSessionsToComplete:function(){document.querySelector(J.cssMainDataSelector+" thead")!==null&&(document.querySelector(J.cssMainDataSelector+" thead").style.display="none");var p=Array.from(document.querySelectorAll(J.cssMainDataSelector+" tbody a[href*=sessions]")),o;p.forEach(function(n){let a=n.querySelector("span span");a.innerText=".:"+a.innerText+":.",n.addEventListener("click",o=function(e){e.stopPropagation(),e.preventDefault();var t=n.parentElement.parentElement.parentElement,l=t.children[1].querySelector("time").dateTime.trim(),u=Ke(t.children[2],-2),c=t.children[3].querySelector("a").getAttribute("href-sav"),d=(c||"/").split("/"),f=d[d.length-1];l=dayjs(l).toISOString();var i=xe.getHashId(l,u);let y=parseInt(f,10),B=Ee.exists(y,1,Ee.TYPE.SESSIONID_DATEREFID),m=Ee.exists(i,2,Ee.TYPE.SESSIONID_DATEREFID);B&&(m||(console.log(`[SESSIONID_DATEREFID] iSessionId ${y} est connu mais pas iHash${i}`),Ee.updKey2(y,i,Ee.TYPE.SESSIONID_DATEREFID))),m&&(B||(console.log(`[SESSIONID_DATEREFID] iHash${i} est connu mais pas iSessionId ${y}`),Ee.updKey1(y,i,Ee.TYPE.SESSIONID_DATEREFID))),!B&&!m&&(console.log(`[SESSIONID_DATEREFID] iHash${i} et iSessionId ${y} sont INconnus`),Ee.add(y,i,Ee.TYPE.SESSIONID_DATEREFID)),window.open(c,"blank").focus()}),n.setAttribute("href-sav",n.getAttribute("href")),n.removeAttribute("href")})},_applyInjectionForSessionsBooked:function(){document.querySelector(J.cssMainDataSelector+" thead")!==null&&(document.querySelector(J.cssMainDataSelector+" thead").style.display="none")},_applyInjectionForSessionsHistory:function(p=100){if(console.log("%c[index._applyInjectionForSessionsHistory()] Le panel de gestion des sessions en historique a \xE9t\xE9 activ\xE9, la derni\xE8re mutation date de %i",T,J._lastMutation),document.querySelector(J.cssMainDataSelector+" thead")!==null&&(document.querySelector(J.cssMainDataSelector+" thead").style.display="block"),dayjs().valueOf()-J._lastMutation<p){console.log("%c[index._applyInjectionForSessionsHistory()] Traitement abandonn\xE9e le dernier refresh date de %o limite:%o ms",T,J._lastMutation,p),J._lastMutation=dayjs.valueOf();return}Mt()},_addHeader:function(){J._sOCMainSrvClassName.length===0&&(J._sOCMainSrvClassName=J._getOCMainClass()),J._sOCMainSrvClassName.length===0&&(console.error("%c[index._addHeader()] _sOCMainSrvClassName is still unknow",le),console.log("[index._addHeader()]check this %o",document.querySelector(J.cssMainDataSelector)));let p=`
<a href="" class="${J._sOCMainSrvClassName}-MuiButtonBase-root
 ${J._sOCMainSrvClassName}-MuiTab-root
 ${J._sOCMainSrvClassName}-dom-services73
 ${J._sOCMainSrvClassName}-MuiTab-textColorInherit"
 style="margin-left: auto;">
 <span class="${J._sOCMainSrvClassName}-MuiTab-wrapper">En base de donn\xE9e (21/24)</span>
 <span class="${J._sOCMainSrvClassName}-MuiTouchRipple-root"></span></a>
`,o=document.querySelector("#mainContent > :not(div:empty)").children,n=document.createElement("span");n.innerText="Facturier v."+GM.info.script.version,n.classList.add(`${J._sOCMainSrvClassName}-MuiTab-wrapper`);let a;n.addEventListener("click",a=function(u){document.querySelectorAll("tbody input[type=checkbox]").forEach(c=>c.checked=!c.checked)});let e=document.createElement("span");e.classList.add(`${J._sOCMainSrvClassName}-MuiTouchRipple-root`);let t=document.createElement("a");t.alt="tout s\xE9l\xE9ctionner",t.appendChild(n),t.appendChild(e),t.classList.add(`${J._sOCMainSrvClassName}-MuiButtonBase-root`),t.classList.add(`${J._sOCMainSrvClassName}-MuiTab-root`),t.classList.add(`${J._sOCMainSrvClassName}-MuiTab-textColorInherit`);let l=`
font-size: 1rem;
max-width: 280px;
font-family: Montserrat;
font-weight: 400;
line-height: 1.625rem;
text-transform: inherit;
`;t.style=l+"margin-left: auto",o[2].querySelector("div:nth-child(2) > div").appendChild(t)},_userscriptless(){console.log("%cIm'not in a Tamper environment so i need to load js scripts",T)},_main:function(){console.log("\u200B\u200B\u200B%c[index._main()]MainLoaded\u200B\u200B\u200B",T),document.unbindArrive(J._main),J._eventMonitor(),Pt.paintTiming(),Pt.longTaskTiming();let p=new LocalStorage("db");var o=low(p);o.defaults({students:[],sessions:[],f_archives:[],history_session_cache:[],meta:[],refs:[],students_history:[]}).write(),J.Cfg.dbase=o,dayjs.extend(dayjs_plugin_isSameOrAfter),dayjs.extend(dayjs_plugin_isSameOrBefore),dayjs.extend(dayjs_plugin_isBetween),dayjs.extend(dayjs_plugin_localeData),dayjs.extend(dayjs_plugin_localeData),dayjs.extend(dayjs_plugin_customParseFormat),dayjs.locale("fr"),Ee.checkSupport(),ke.checkSupport(),document.querySelector(".panel.menuBar.flex.draggable")===null&&_n.init(),J._addHeader(),J._applyInjectionOnPathNameMutation();let n=ke.getDbVersion();if(bt(GM.info.script.version,n)==1&&(console.log(`%cDB is in version: ${ke.getDbVersion()} need to go to version ${GM.info.script.version}`,T),dt.update(GM.info.script.version)),lt(["https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"]).then(async function(a){console.log("%cALPINE js fetched",T)}),lt(["https://unpkg.com/htmx.org@1.1.0","https://unpkg.com/htmx.org@1.1.0/dist/ext/debug.js"]).then(async function(a){htmx.on("htmx:configRequest",function(e){}),htmx.on("htmx:beforeRequest",function(e){if(e.detail.pathInfo.finalPath&&en(e.detail.pathInfo.finalPath)!=="html"){e.detail.xhr.addEventListener("abort",function(){}),e.detail.xhr.onloadstart=function(d){this.abort()};let u=En.load(e.detail.pathInfo.finalPath),c=e.detail.target;var t=e.detail.elt.getAttribute("hx-select");if(t){let d=new DOMParser().parseFromString(u,"text/html");oNode=d.querySelector(t),oNode?u=oNode.outerHTML:console.log(`%cWanna select target ${t} in data received from calling ${e.detail.pathInfo.finalPath} but this node could'nt be found so return the whole string`,le)}var l=function(d,f){var i=document.createRange(),y=i.createContextualFragment(d);console.log(y);for(var B=y.childNodes.length-1;B>=0;B--){var m=y.childNodes[B];f.appendChild(m),htmx.process(m)}return f.lastChild};l(u,e.detail.target)}}),htmx.on("htmx:xhr:loadstart",function(e){})}),lt(["https://cdn.jsdelivr.net/npm/sweetalert2@10"]).then(async function(a){console.log("%cSweetAlert fetched",T)}),GM_config.get("use_custom_css")===!0){let e=GM_config.get("custom_css_url").split(",");if(e.length!==0)console.log(`%cWanna inject Custom CSS from URL:${e}`,T),lt(e).then(()=>{console.log(`%cCustom CSS from URL:${e} loaded`,T)}).catch(t=>console.log(`%cError detected when loading dependencies ${t}`,le));else{let t=GM_config.get("custom_css_data");if(t.length()>0){console.log(`%cNeed to inject a custom css in application content is ${t}`,T);let l=document.createElement("style");l.innerHTML=t,document.head.insertAdjacentElement("beforeend",l)}}}unsafeWindow.Facturier={libs:[],cfg:{dbase:null},klass:[]},unsafeWindow.Facturier.cfg.dbase=J.Cfg.dbase,unsafeWindow.Facturier.libs.push({id:"fetchInject",ptr:lt}),unsafeWindow.Facturier.libs.push({id:"dayjs",ptr:dayjs}),unsafeWindow.Facturier.klass.push({id:"Student",ptr:ge}),unsafeWindow.Facturier.klass.push({id:"Session",ptr:xe}),unsafeWindow.Facturier.klass.push({id:"Archive",ptr:it}),unsafeWindow.Facturier.klass.push({id:"History",ptr:at}),unsafeWindow.Facturier.klass.push({id:"StudentHistory",ptr:je}),unsafeWindow.Facturier.klass.push({id:"Ref",ptr:Ee}),unsafeWindow.Facturier.klass.push({id:"Dbase",ptr:dt}),unsafeWindow.Facturier.klass.push({id:"Meta",ptr:ke}),unsafeWindow.Facturier.klass.push({id:"Ref",ptr:Ee}),unsafeWindow.Facturier.klass.push({id:"Api",ptr:xt}),GM.info.script.downloadURL==="http://localhost:8000/dist/app-facturier.iife.js"?(console.log("%cALERTE .... version locale !!!!!! ","background-color:coral;color:white"),console.log("%c test readfile",T),tn("file:////media/pwyll/USB120Go/DevStt/UserScripts/SttAddon/src/update_data_base.js",function(a){console.log(a)}),J.loadDependencies()):console.log(`%c GM.info.script.downloadURL url : ${GM.info.script.downloadURL}`,T)},loadDependencies:function(){let p=[];p.push("http://localhost:8000/src/branch01/sandbox.js"),p.push("http://localhost:8000/src/branch01/sandbox.css"),lt(p).then(()=>{console.log(`dependencies ${p} loaded`)})},dbUpdate:function(){console.log("%c Need to update DB",T),bt(GM.info.script.version,"1.00.0006")==0&&(console.log("%c Need to update DB to version '1.00.0006'",T),dt.update("1.00.0006"))}};window.Facturier!==void 0?window.Facturier.start():J.start();var q=J;})();
/* @license
Papa Parse
v5.3.0
https://github.com/mholt/PapaParse
License: MIT
*/
/**
 * Fetch Inject module.
 *
 * @module fetchInject
 * @license Zlib
 * @param {(USVString[]|Request[])} inputs Resources you wish to fetch.
 * @param {Promise} [promise] A promise to await before attempting injection.
 * @throws {Promise<ReferenceError>} Rejects with error when given no arguments.
 * @throws {Promise<TypeError>} Rejects with error on invalid arguments.
 * @throws {Promise<Error>} Whatever `fetch` decides to throw.
 * @throws {SyntaxError} Via DOM upon attempting to parse unexpected tokens.
 * @returns {Promise<Object[]>} A promise which resolves to an `Array` of
 *     Objects containing `Response` `Body` properties used by the module.
 */
//# sourceMappingURL=app.min.js.map
