// ==UserScript==
// @name         Facturier (alpha)
// @namespace    http://tampermonkey.net/
// @version      1.10.0000
// @description  Un addon pour vous aider dans votre facturation
// @author       Stéphane TORCHY
// @updateURL    https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/dist/app.min.js
// @downloadURL  https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/dist/app.min.js
// @match        https://openclassrooms.com/fr/mentorship/dashboard/mentorship-sessions-history*

// Start at document start https://www.tampermonkey.net/documentation.php#_run_at
// @run-at document-start   

// @grant        unsafeWindow
// @grant        GM_addStyle
// @grant        GM_getResourceText
// @grant        GM_registerMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        GM.xmlHttpRequest
// @grant        GM_notification

// @require      https://cdn.jsdelivr.net/npm/lodash@4.17.19/lodash.min.js
// @require      https://unpkg.com/lowdb@0.17/dist/low.min.js
// @require      https://unpkg.com/lowdb@0.17/dist/LocalStorage.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/dayjs.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/locale/fr.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isBetween.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isSameOrBefore.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isSameOrAfter.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/customParseFormat.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/localeData.min.js


// GM_Config
// require      https://openuserjs.org/src/libs/sizzle/GM_config.js (cassé ce jour 28/08/2020);
// @require      https://raw.githubusercontent.com/sizzlemctwizzle/GM_config/master/gm_config.js

// sweetalert 2
// @require      https://cdn.jsdelivr.net/npm/sweetalert2@9/dist/sweetalert2.all.min.js

// draggabilly
// @require      https://cdnjs.cloudflare.com/ajax/libs/draggabilly/2.2.0/draggabilly.pkgd.min.js

// toastify
// @require     https://cdn.jsdelivr.net/npm/toastify-js@1.8.0/src/toastify.min.js
// @resource    toastifycss https://raw.githubusercontent.com/apvarun/toastify-js/master/src/toastify.css

// https://github.com/uzairfarooq/arrive --> included manually
// require     https://raw.githubusercontent.com/uzairfarooq/arrive/master/minified/arrive.min.js

// simple-datatables
// @require     https://cdn.jsdelivr.net/npm/simple-datatables@latest
// @resource    simpledatatablecss https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css

// require https://raw.githubusercontent.com/anywhichway/nano-memoize/master/dist/nano-memoize.min.js
// @require https://cdn.jsdelivr.net/npm/moize@5.4.7/dist/moize.min.js

// require https://raw.githubusercontent.com/StephaneTy-Pro/userscripts/master/fetch-inject.umd.min.js
// j'utilisais celui là mais désormais je le livre dans l'application directement require https://cdn.jsdelivr.net/npm/fetch-inject

// PARSER MKDOWN
// @require 	 https://cdn.jsdelivr.net/npm/showdown@1.9.1/dist/showdown.min.js

// PDF https://pdf-lib.js.org/docs/api/
// @require      https://unpkg.com/pdf-lib@1.9.0/dist/pdf-lib.min.js
// @require      https://unpkg.com/downloadjs@1.4.7/download.js



// ProgressBar 
// https://loading.io/progress/
// require https://raw.githubusercontent.com/loadingio/loading-bar/master/dist/loading-bar.js
// resource loading_barcss https://raw.githubusercontent.com/loadingio/loading-bar/master/dist/loading-bar.css
// @require https://loadingio.github.io/loading-bar/dist/loading-bar.js
// @resource loading_barcss https://loadingio.github.io/loading-bar/dist/loading-bar.min.css

// https://www.cssscript.com/demo/text-progress-bar-ascii-loader/
// https://github.com/kimmobrunfeldt/progressbar.js - fonctionne mais probleme avec le easing dans mon popup progress bar
// require https://raw.githubusercontent.com/kimmobrunfeldt/progressbar.js/master/dist/progressbar.min.js
// require https://raw.githubusercontent.com/kimmobrunfeldt/progressbar.js/master/dist/progressbar.js
// https://pvdlg.github.io/uprogress/js-api/#UProgress+start
// https://ricostacruz.com/nprogress

// semble cassé
// https://github.com/webosorg/Process
// https://unpkg.com/@webos/process@0.2.0/dist/process.js
// https://cdn.jsdelivr.net/npm/@webos/process@0.2.0/dist/process.min.js
// bof ... je ne parviens pas à faire fonctionner l'exemple
// https://cdn.jsdelivr.net/npm/worker-function@2.0.1/WorkerFunction.min.js
// Threading 
// @require  https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/Thread.js
// @require   https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/ThreadPool.js
// @require   https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/ThreadQueue.js
// semble cassé
// https://cdn.jsdelivr.net/npm/threads@1.6.3/dist/index.min.js
// https://unpkg.com/paralleljs@1.0/lib/parallel.js
// https://cdn.jsdelivr.net/npm/threads@1.6.3/dist/index.min.js
// Freelancer
// https://github.com/Wildhoney/Freelancer
// fonctionne require https://raw.githubusercontent.com/arqex/worker-function/master/WorkerFunction.js
// ne fonctonne pas https://raw.githubusercontent.com/duart38/Thread/master/Thread.bundle.js
// require      https://cdn.jsdelivr.net/npm/paralleljs@1.0.1/lib/parallel.min.js


/*
 * History
 * cf https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon/blob/master/CHANGELOG.md
 */
// ==/UserScript==
(()=>{var mt=Object.defineProperty,wn=Object.prototype.hasOwnProperty,Sn=(t,a)=>()=>(a||(a={exports:{}},t(a.exports,a)),a.exports),Ut=t=>mt(t,"__esModule",{value:!0}),xn=(t,a)=>{Ut(t);for(var n in a)mt(t,n,{get:a[n],enumerable:!0})},$n=(t,a)=>{if(Ut(t),typeof a=="object"||typeof a=="function")for(let n in a)!wn.call(t,n)&&n!=="default"&&mt(t,n,{get:()=>a[n],enumerable:!0});return t},we=t=>t&&t.__esModule?t:$n(mt({},"default",{value:t,enumerable:!0}),t);var ge=Sn(Tn=>{xn(Tn,{APP_AUTHOR:()=>Jt,APP_DEBUG_STYLE:()=>C,APP_ERROR_STYLE:()=>ce,APP_INFO_STYLE:()=>Xt,APP_LOG_STYLE:()=>Qt,APP_NAME:()=>pt,APP_PERF_STYLE:()=>pe,APP_WARN_STYLE:()=>We,BILL_AUTOFUNDED:()=>U,BILL_BILLMODIFICATORS:()=>Kt,BILL_FUNDED:()=>q,BILL_OTHER:()=>G,OC_AUTOFUNDED:()=>_e,OC_FUNDED:()=>le,OC_MAX_LEVEL:()=>$e,OC_OTHER:()=>xe,OC_PRICE1:()=>gt,OC_PRICE2:()=>ht,OC_PRICE3:()=>bt,OC_PRICE4:()=>_t,OC_PRICE5:()=>yt,OC_PRICE6:()=>vt,OC_STATUS_0:()=>Fe,OC_STATUS_1:()=>Be,OC_STATUS_2:()=>Ie,OC_STATUS_3_F:()=>He,OC_STATUS_3_M:()=>Re,SESSION_CANCEL:()=>J,SESSION_CANCEL_LATE:()=>W,SESSION_DONE:()=>Z,SESSION_STUDENT_AWAY:()=>Q,TYPE_COACHING:()=>I,TYPE_DEFENSE:()=>B,TYPE_SESSION:()=>N,default:()=>Zt});const be={Cfg:{dbase:null},raf:null,start:async function(){await qt();const t=be.checkSupport();console.log(`%cAre all functions supported ? : ${t}`,C),document.querySelector(".MuiAvatar-img")===null?(console.log("%c All condition not met, waiting element '.MuiAvatar-img' ",C),document.arrive(".MuiAvatar-img",be._warmup)):(console.log("%c All condition already met go",C),be._warmup())},checkSupport:function(){return!0},_warmup:function(){console.log("%c in _warmup",C),document.unbindArrive(be._warmup),GM===void 0?(console.log("%cI am not in a tamper env"),be._userscriptless()):console.log(`%cTamper environment detected the version is ${GM.info.version}`,C),GM_addStyle(GM_getResourceText("jspanelcss")),GM_addStyle(GM_getResourceText("toastifycss")),GM_addStyle(GM_getResourceText("simpledatatablecss")),GM_addStyle(GM_getResourceText("loading_barcss")),GM_config.init(Wt),GM_registerMenuCommand("OC Facturier - configure",Vt),GM_config.get("hackheaderzindex")===!0&&(document.getElementById("header").style.zIndex=0),GM_addStyle(".swal2-title{font-size:1.275em)"),be._main()},_userscriptless(){console.log("%cIm'not in a Tamper environment so i need to load js scripts",C)},_main:function(){console.log("​​​%cMainLoaded​​​",C),jt.paintTiming(),jt.longTaskTiming();let t=new LocalStorage("db");var a=low(t);a.defaults({students:[],sessions:[],f_archives:[],history_session_cache:[],meta:[],students_history:[]}).write(),be.Cfg.dbase=a,dayjs.extend(dayjs_plugin_isSameOrAfter),dayjs.extend(dayjs_plugin_isSameOrBefore),dayjs.extend(dayjs_plugin_isBetween),dayjs.extend(dayjs_plugin_localeData),dayjs.extend(dayjs_plugin_localeData),dayjs.extend(dayjs_plugin_customParseFormat),document.querySelector(".panel.menuBar.flex.draggable")===null&&zt.init(),GM_config.get("alwaysaddcbox")===!0&&nt(),dayjs.locale("fr"),a.get("meta").value()===void 0&&(console.log("%cDb dont' contain meta table create it",C),a.assign({meta:[]}).write());let n=a.get("meta").find({key:"dbVersion"}).value().value;if(n===void 0&&(console.log(a.get("meta").value()),console.log("%cDb dont' contain dbVersion field in meta table create it",C),a.get("meta").push({key:"dbVersion",value:"1.0.0"}).write(),n=a.get("meta").find({key:"dbVersion"}).value().value),ot(GM.info.script.version,n)==1&&(console.log(`%cDB is in version: ${a.get("meta").value().dbVersion} need to go to version ${GM.info.script.version}`,C),Ge.update(GM.info.script.version)),it(["https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"]).then(async function(s){console.log("apline js fetched",s)}),GM_config.get("use_custom_css")===!0){let s=GM_config.get("custom_css_url"),e=s.split(",");if(e.length!==0)console.log(`%cWanna inject Custom CSS from URL:${e}`,C),it([e]).then(()=>{console.log(`%cCustom CSS from URL:${e} loaded`,C)}).catch(o=>console.log(`%cError detected when loading dependencies ${o}`,APP_ERROR_STYLE));else{let o=GM_config.get("custom_css_data");if(o.length()>0){console.log(`%cNeed to inject a custom css in application content is ${o}`,C);const l=document.createElement("style");l.innerHTML=o,document.head.insertAdjacentElement("beforeend",l)}}}GM.info.script.downloadURL==="http://localhost:8000/dist/app-facturier.iife.js"?(console.log("%cALERTE .... version locale !!!!!! ","background-color:coral;color:white"),unsafeWindow.Facturier={libs:[],cfg:{dbase:null},klass:[]},unsafeWindow.Facturier.cfg.dbase=be.Cfg.dbase,unsafeWindow.Facturier.libs.push({id:"fetchInject",ptr:it}),unsafeWindow.Facturier.libs.push({id:"dayjs",ptr:dayjs}),unsafeWindow.Facturier.klass.push({id:"Student",ptr:de}),unsafeWindow.Facturier.klass.push({id:"Session",ptr:fe}),unsafeWindow.Facturier.klass.push({id:"Archive",ptr:Ne}),unsafeWindow.Facturier.klass.push({id:"History",ptr:ze}),unsafeWindow.Facturier.klass.push({id:"StudentHistory",ptr:me}),console.log("%cImportants values are exported in unsafeWindow.Facturier",C),console.log("%c test readfile",C),Gt("file:////media/pwyll/USB120Go/DevStt/UserScripts/SttAddon/src/update_data_base.js",function(s){console.log(s)}),be.loadDependencies()):console.log(`%c GM.info.script.downloadURL url : ${GM.info.script.downloadURL}`,C)},loadDependencies:function(){let t=[];t.push("http://localhost:8000/src/branch01/sandbox.js"),t.push("http://localhost:8000/src/branch01/sandbox.css"),it(t).then(()=>{console.log(`dependencies ${t} loaded`)})},dbUpdate:function(){console.log("%c Need to update DB",C),ot(GM.info.script.version,"1.00.0006")==0&&(console.log("%c Need to update DB to version '1.00.0006'",C),Ge.update("1.00.0006"))},overrideDebug:function(){var t=window.XMLHttpRequest.prototype.open,a=window.XMLHttpRequest.prototype.send;function n(o,l,g,u,d){return this._url=l,t.apply(this,arguments)}function s(o){return this.onreadystatechange&&(this._onreadystatechange=this.onreadystatechange),console.log(`%c Request sent : ${o}`,C),this.onreadystatechange=e,a.apply(this,arguments)}function e(){if(console.log(`%c Ready state changed to: ${this.readyState}`,C),this._onreadystatechange)return this._onreadystatechange.apply(this,arguments)}window.XMLHttpRequest.prototype.open=n,window.XMLHttpRequest.prototype.send=s}};window.Facturier!==void 0?window.Facturier.start():be.start();var Zt=be});var wt={async XHR(t){const a=window.GM_xmlhttpRequest||(GM?GM.xmlHttpRequest:null);return a?new Promise((n,s)=>{Object.assign(t,{onabort:s,onerror:s,onload:n,ontimeout:s}),a(t)}):Promise.reject()},async getValue(t,a=null){return window.GM_getValue?Promise.resolve(GM_getValue(t)||a):await GM.getValue(t)||a},async setValue(t,a){window.GM_setValue?GM_setValue(t,a):GM.setValue(t,a)}};const pt="OC-Addons",Jt="Stéphane TORCHY",C="background-color:green;color:white",Qt="background-color:black;color:white",We="background-color:coral;color:white",Xt="background-color:cyan;color:white",ce="background-color:red;color:white",pe="background-color:blue;color:white",_e="auto-financé",le="financé par un tiers",xe="autre",Fe="réalisée",Be="annulée",Ie="annulée tardivement",Re="étudiant absent",He="étudiante absente",$e=6,gt=30,ht=35,bt=40,_t=45,yt=50,vt=55,U=0,q=1,G=2,Kt=[{pathId:158,path:"158-trouvez-lemploi-qui-vous-correspond",value:2}],Z=0,J=1,W=2,Q=3,N=0,B=1,I=2;var qt=function(){return new Promise(t=>{document.readyState=="loading"?document.addEventListener("DOMContentLoaded",t):t()})},rt=async function(t="",a="",n=!1){console.info(`%cfetch() waiting return from : ${t}`,C);const s=await wt.XHR({method:"GET",url:t,responseType:"text/html",headers:{"User-Agent":"Mozilla/5.0"},onprogress:function(u){}}).catch(u=>{console.error(`%cError ${u}`,ce)});let e=new DOMParser,o=e.parseFromString(s.responseText.replace(/\n/mg,""),"text/html"),l=o.querySelector("meta[id=captcha-bypass]");if(l!==null)throw console.error(`%cError CloudFlare CAPTCHA : ${o.querySelector("title").innerText}`,C),new Error("Must Respond to Cloudflare Captcha or waiting....");var g={};return n===!0?g=o.querySelectorAll(a):g=o.querySelector(a),g},je=function(t,a=-1){try{var n=(t.children[0].href||"/").split("/");return n[n.length+a]}catch(s){console.error(`%cError in getkey${s.stack||s}`,ce)}},Pt=function(t){var a=t.trim().split(" ");try{var n=dayjs_locale_fr.months.findIndex(s=>s===a[1])+1}catch(s){console.error(`%cError in extractDate${s.stack||s}`,ce)}return`${a[2]}-${n}-${a[0]}T${a[4]}`},Ot=function(t,a=0){a===-1&&(a=t.children.length-1);var n=t.children[a].children[0].innerText;let s=Pt(n);var e=dayjs(s);return e},ye=function(t){return new Promise(a=>setTimeout(a,t))},ot=function(t,a){for(var n=t.split("."),s=a.split("."),e=0;e<3;e++){var o=Number(n[e]),l=Number(s[e]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0},Gt=function(a,n){return console.info("Reading:",a),fetch(a,{mode:"same-origin"}).then(function(s){return s.blob()}).then(function(s){var e=new FileReader;e.addEventListener("loadend",function(){n(this.result)}),e.readAsText(s)})},en=function(t){const a=t,n=t.reduce(function(i,h){return i*h});var s=new Array(n);const e=function(...i){const h=i.pop();if(i.length!==t.length)throw"Wrong matrix dimensions, need "+t.length+", you provide "+h.length+"!";if(d(i)===0)throw"Wrong type for set need one or more int has dimension, check type of!";const x=u(i);return s[x]=h,h},o=function(...i){if(i.length!==t.length)throw"Wrong matrix dimensions, need "+t.length+", you provide "+i.length+"!";if(d(i)===0)throw"Wrong type for set need one or more int has dimension, check type of!";const h=u(i);return s[h]},l=function(...i){const h=u(i);return s[h]=void 0,s[h]===void 0},g=function(){console.group("dump table"),console.table(s),console.groupEnd("dump table")},u=function(i){return i.reduce(function(h,x,c,f){let p=a.slice(c+1),m=p.length>0?p.reduce(function(j,T){return j*T}):1;return h+x*m},0)},d=function(i){return i.reduce((h,x)=>h&typeof x=="number",1)};return Object.freeze({set:e,get:o,del:l,toConsole:g})},Ve=function(t,a,n=Error){if(!t)throw new n(a)};HTMLElement.prototype.appendFirst=function(t){this.firstChild?this.insertBefore(t,this.firstChild):this.appendChild(t)};var Ze=async function(t=null,a=null,n=!0){var s="";s+="<style>",s+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",s+="form input {background: #fff;border: 1px solid #9c9c9c;}",s+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",s+="form button:hover {background: gold;}",s+="form label {padding: 0.5em 0.5em 0.5em 0;}",s+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",s+="form input:focus {outline: 3px solid gold;}",s+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}label {text-align: right;grid-column: 1 / 2;}input,button {grid-column: 2 / 3;}}",s+="</style>",s+='<form class="form1" action="">',s+='<label for="dtFrom" class="date">Date de début</label>',t?s+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(t).format("YYYY-MM-DD")+'">':s+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31">',s+='<label for="dtTo" class="date">Date de fin</label>',t?s+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(a).format("YYYY-MM-DD")+'">':s+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31">',s+="</form>";const{value:e}=await Swal.fire({title:"<strong>Choix de la période</strong>",icon:"info",html:s,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:"Choisissez la période pour la sélection des temps facturés",showLoaderOnConfirm:!0,preConfirm:()=>[document.getElementById("dtFrom").value,document.getElementById("dtTo").value],onRender:o=>{},onOpen:o=>{n===!0&&o.querySelector("#dtFrom").addEventListener("change",_handler=function(){document.getElementById("dtTo").value=dayjs(document.getElementById("dtFrom").value).endOf("month").format("YYYY-MM-DD")})},onClose:o=>{n===!0&&o.querySelector("#dtFrom").removeEventListener("change",_handler)},onAfterClose:o=>{},onDestroy:o=>{}});return t=dayjs(e[0]),a=dayjs(e[1]),await ye(250),[t,a]},St=async function(t){await Swal.fire({position:"top-end",icon:"success",title:t,showConfirmButton:!1,timer:1500})};const at=we(ge());class Pe{static tbl_name="f_archives";static add=async function(t){let a=at.default.Cfg.dbase,n=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]"),s={id:t[0].to.format("YYYYMM"),data:t,created_at:t[0].now};console.log(`%cWill create archive for id ${t[0].to.format("YYYYMM")} (YYYYMM)`,C),a.get(Pe.tbl_name).push(JSON.parse(JSON.stringify(s))).write()};static exists=function(t){let a=at.default.Cfg.dbase,n=a.get(Pe.tbl_name).find({id:t}).value();return!(n===void 0)};static get=function(t){let a=at.default.Cfg.dbase;var n=a.get(Pe.tbl_name).find({id:t}).value();if(n===void 0)throw Error("Erreur qui ne devrait jamais arriver en Archive.get");return console.log(`%cWill use archive for id ${t} (YYYYMM)`,C),n};static delete=function(t=null,a=null){let n=at.default.Cfg.dbase;if(typeof t=="string"&&(t=t.format("YYYY-MM-DD")),typeof a=="string"&&(a=a.format("YYYY-MM-DD")),t===null&&a==null){console.log("%cWanna suppress ALL Archives from DB ",C),n.get(Pe.tbl_name).remove().write();return}if(a==null){n.get(Pe.tbl_name).remove(function(s){return dayjs(s.id,"YYYYMM").isBefore(a),"month"}).write();return}if(t==null){n.get(Pe.tbl_name).remove(function(s){return dayjs(s.id,"YYYYMM").isAfter(t,"month")}).write();return}n.get(Pe.tbl_name).remove(function(s){return dayjs(s.id,"YYYYMM").isBetween(t,a,"month","[]")}).write()}}var Ne=Pe;class tn{static isInOldMode=function(t){var a=null;typeof t=="string"?a=dayjs(t):a=t;try{return a.isBefore(tn.getOldModeDate())}catch(n){throw Error("Erreur qui ne devrait jamais arriver en IsInOldMode (probablement un probleme sur la conversion de la date en objet dayjs:"+n.stack||n)}};static getOldModeDate=function(){return dayjs("2020-06-01")};static getAppVersion=function(){return GM.info.script.version}}var re=tn;const xt=we(ge());var En=function(){const t="students_history",a=1,n=2,s=function(x){if(x.toUpperCase()==="FUNDING")return a;if(x.toUpperCase()==="PATH")return n;throw Error("Erreur qui ne devrait jamais arriver en getype")},e=function(x,c,f=null){return l(x,a,c,f)},o=function(x,c,f=null){return l(x,n,c,f)},l=function(x,c,f,p=null){Ve(typeof x=="string","You must provide a string.",TypeError);const m=xt.default.Cfg.dbase;typeof p=="string"&&(p=dayjs(p)),p===null&&(p=dayjs()),Ve(p instanceof dayjs,"created date must be a string, a dayjs instance or null.",TypeError);let j={id:x,type:0|c,value:f,date:p.valueOf(),humanDate:p.format("YYYY-MM-DDTHH:mm:ssZZ")};return console.log(`%cAdd in student history at date ${dayjs(j.date).format("YYYY-MM-DDTHH:mm:ssZZ")} data ${f} with type:${c}`,C),m.get(t).push(JSON.parse(JSON.stringify(j))).write()},g=function(x,c=null,f=null){const p=xt.default.Cfg.dbase;return x==null&&c==null&&f==null?(console.log("%cRemove all in student history",C),p.get(t).remove().write()):(typeof f=="string"&&(f=dayjs(f)),f==null?c==null?(console.log(`%cRemove for student id:${x} history for all type of event`,C),p.get(t).remove({id:x}).write()):(console.log(`%cRemove for student id:${x} history with event type:${type}`,C),p.get(t).remove({id:x,type:c}).write()):(console.log(`%cRemove for student id:${x} history at date ${f.format("DD/MM/YYYY")} with event type:${type}`,C),p.get(t).remove({id:x,type:c,date:f.valueOf()}).write()))},u=function(x,c,f=null){const p=xt.default.Cfg.dbase;typeof f=="string"&&(f=dayjs(f)),f===null&&(f=dayjs()),console.log(`%cSearching in student history at date ${f.format("DD/MM/YYYY")} any data with type:${c}`,C);var m=+f.valueOf(),j=p.get(t).filter(w=>w.id===x&&w.type&c).map(w=>w.date-m).filter(w=>w>=0).value();if(j.length==0){console.log(`%cThere is no data in student history at date ${f.format("DD/MM/YYYY")} with type:${c}`,C);return}const T=w=>Math.min(...w);let E=m+T(j);return p.get(t).filter(w=>w.id===x&&w.type&c&&w.date==E).value()[0]},d=function(x){return h(x,a)},i=function(x){return h(x,n)},h=function(x,c){return x.type&c};return Object.freeze({addFunding:e,addPath:o,getType:s,remove:g,find:u,isFunding:d,isPath:i,tbl_name:t})};const Cn=En();var me=Cn;const Oe=we(ge());class oe{static tbl_name="students";static add=function(t,a="noname",n="nopath",s="unknown",e){let o=Oe.default.Cfg.dbase;var l=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");let g={id:t,fullname:a,path:n,funding:s,created:l};o.get(oe.tbl_name).push(JSON.parse(JSON.stringify(g))).write()};static exists=function(t,a=null){let n=oe.findById(t,a);return console.log(`%cStudent ${t} exists in db ? ${!(n===void 0)}`,C),!(n===void 0)};static findById=function(t,a=null){return Ve(typeof t=="string","You must provide a string.",TypeError),typeof a=="string"&&(a=dayjs(a)),a==null?oe.m_findById(t,a):oe.m_findById(t,a.format("YYYY-MM-DDTHH:mm:ssZZ"))};static _findById=function(t,a=null){let n=Oe.default.Cfg.dbase;typeof a=="string"&&(a=dayjs(a)),console.log(`%cSearching student with id:${t} in db`,C);var s=n.get(oe.tbl_name).find({id:t}).value();if(s===void 0)return;if(a!==null){var e={...s},o=me.find(t,me.getType("FUNDING"),a);o!==void 0&&(e.funding=o.value);var l=me.find(t,me.getType("PATH"),a);return l!==void 0&&(e.path=l.value),e}return s};static m_findById=moize.default(oe._findById,{maxAge:6e5,isSerialized:!0,onCacheHit:function(){console.log("%cGet data from cache",C)}});static getFunding=function(t,a=null){return typeof a=="string"&&(a=dayjs(a)),oe.m_getFunding(t,a)};static _getFunding=function(t,a=null){let n=oe.findById(t,a);return n===void 0?(console.log(`%cStudent ${studentId} is not in db, fetchin data:'funded mode' from webpage`,C),oe.getFundingFomDashboard(studentId).toLowerCase()):n.funding.toLowerCase()};static m_getFunding=moize.default(oe._getFunding,{maxAge:6e5,isSerialized:!0});static isAutoFunded=function(t){return console.log("%cFUNCTION DEPRECATED !!!!!!!!!!!!!!!!!!!!!! ",ce),oe.getFunded(t).toLowerCase()===_e};static getFundingFomDashboard=async function(t){const a=await rt(`https://openclassrooms.com/fr/mentorship/students/${t}/dashboard`,".mentorshipStudent__details > p");return a.innerText.trim()};static getPath=async function(t,a=null){let n=oe.findById(t,a);if(n==null){console.log(`%cStudent ${t} is not in db, fetching data: 'path' from webpage ....`,C);const s=await rt(`https://openclassrooms.com/fr/mentorship/students/${t}/dashboard`,"a[href*='paths/']");return s.innerText.length==0&&console.error(`%cStudent path is not readable from url : https://openclassrooms.com/fr/mentorship/students/${t}/dashboard`,ce),s.innerText.trim()}else return n.path};static delete=function(t=null,a=null){let n=Oe.default.Cfg.dbase;if(typeof t=="string"&&(t=t.format("YYYY-MM-DD")),typeof a=="string"&&(a=a.format("YYYY-MM-DD")),t===null&&a==null){console.log("%cWanna suppress ALL Students from DB",C),n.get(oe.tbl_name).remove().write();return}if(a==null){n.get(oe.tbl_name).remove(function(s){return dayjs(s.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isBefore(a),"day"}).write();return}if(t==null){n.get(oe.tbl_name).remove(function(s){return dayjs(s.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isAfter(t,"day")}).write();return}n.get(oe.tbl_name).remove(function(s){return dayjs(s.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isBetween(t,a,"day","[]")}).write()};static deleteById=function(t,a=null){let n=Oe.default.Cfg.dbase;n.get("students").remove(s=>s.id===t).write(),console.log(`%cAll students with id:${t} are removed from DataBase`,C)};static modifyFunding(t,a,n){typeof a=="string"&&(a=dayjs(a)),Ve(created instanceof dayjs,"modifyFunding date must be a string, a dayjs instance or null.",TypeError);const s=oe.getFunding(t,a);if(n.toLower()===s.toLower()){console.log(`%cFundingMode ${n} is identical as current: ${sCurrent}, nothing to do`,C);return}(n!==_e||n!=le||n!==xe)&&console.log(`%cWarning this state is unknown ${n}`,We);const e=Oe.default.Cfg.dbase,o=dayjs().format("YYYY-MM-DDTHH:mm:ssZZ");if(a===null&&(a=o),oLastHistory=me.find(t,me.getType("FUNDING"),a),e.get(oe.tbl_name).find({id:t}).assign({funding:n}).write(),me.addFunding(t,s,o),a.isSameOrAfter(re.getOldModeDate()))var l=e.get("sessions").filter(u=>u.who_id===t&&(d=>dayjs(d.when).isSameOrAfter(a,"day")));else var l=e.get("sessions").filter(d=>d.who_id===t&&(i=>dayjs(i.when).isSameOrAfter(re.getOldModeDate(),"day")));for(var g=l.value().length;g-=1;)console.log(`There is ${g} elements left to update`,C),l.get(g).assign({funding:n}).write()}static getAll=async(t,a)=>{var n=!1;let s=Oe.default.Cfg.dbase;var e="table.crud-list tbody",o=document.querySelectorAll(e)[1];const l=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");var g=performance.now(),u=je(o.children[0].children[0],-2);await oe.getFundingFomDashboard(u),console.log(`%cEstimated time for updating : ${(performance.now()-g)*o.children.length} ms`,C),Swal.fire({position:"top-end",icon:"info",toast:!0,title:`mise à jour de la base de donnée des étudiants...
cela peut prendre du temps ~ ${(performance.now()-g)*o.children.length/1e3} s`,showConfirmButton:!1,timer:1e3}),await ye(1e3);for(const c of o.children){St(`Collecte les données de l'étudiant : ${c.children[0].innerText}`);var d=je(c.children[0],-2),i=c.children[0].innerText,h="non défini";c.children[1].firstElementChild&&(h=c.children[1].firstElementChild.href.split("/").pop());let f=await oe.getFundingFomDashboard(d);var x=oe.m_findById(d,null);if(x===void 0)return console.log(`%cStudent ${i}(id:${d}) not present in database will create it`,C),oe.add(d,i,h,f,l);f.toLowerCase()!==x.funding.toLowerCase()&&(s.get(oe.tbl_name).find({id:d}).assign({funding:f.toLowerCase()}).write(),me.add(d,me.getType("FUNDING"),x.funding.toLowerCase(),dayjs()),console.log(`%cStudent ${i}(id:${d}) was already present in database but change of funding was detected (from ${x.funding.toLowerCase()} to ${f.toLowerCase()})`,C)),h!==x.path&&(s.get(oe.tbl_name).find({id:d}).assign({path:h}).write(),me.add(d,me.getType("PATH"),x.path,dayjs()),console.log(`%cStudent ${i}(id:${d}) was already present in database but change of path was detected (from ${x.path} to ${h})`,C))}};static showList=function(){let t=Oe.default.Cfg.dbase,a=t.get(oe.tbl_name).value();var n="";n+="<table>",n+="<caption>Liste des étudiant</caption>",n+="<thead>",n+="<tr>",n+="<th>Nom</th><th>Parcours</th><th>Financement</th><th>Date de création</th><th>Edition</th>",n+="</tr>",n+="</thead>",n+="<tbody>";for(var s in a)n+="<tr>",n+=`<td>${a[s].fullname}</td><td>${a[s].path}</td><td>${a[s].funding}</td>`,n+=`<td>${dayjs(a[s].created,"YYYY-MM-DDTHH:mm:ssZ[Z]").format("DD/MM/YYYY à HH:mm")}</td>`,n+=`<td><a href="https://openclassrooms.com/fr/mentorship/students/${a[s].id}/dashboard">${a[s].id}</a></td>`,n+="</tr>";n+="</tbody>",n+="</table>",Swal.fire({title:"<strong>Liste des Etudiants</strong>",icon:"info",html:n,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"fullscreen",onOpen:e=>{var o=e.querySelector("table"),l=new simpleDatatables.DataTable(o)}})};static createManually=async function(t,a,n){let s=["non présent dans la liste","Chef de projet digital","Chef de projet SI","Développeur d'application - Frontend","Développeur Web","Expert en stratégie marketing et communication ","Production de contenu web avec CMS et Content Marketing ","Tech lead"];var e="";e+="<style>",e+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",e+="form input {background: #fff;border: 1px solid #9c9c9c;}",e+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",e+="form button:hover {background: gold;}",e+="form label {padding: 0.5em 0.5em 0.5em 0;}",e+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",e+="form input:focus {outline: 3px solid gold;}",e+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}label {text-align: right;grid-column: 1 / 2;}input,button {grid-column: 2 / 3;}}",e+="</style>",e+='<form class="form1" action="">',e+='<label for="student_id" class="name">Reference</label>',e+='<input id="student_id" type="text" value="'+t+'">',e+='<label for="student_name" class="name">Name</label>',e+='<input id="student_name" type="text" value="'+a+'">',e+='<label for="funding">Autofinancé</label>',e+='<input id="funding" type="checkbox" value="autofunded">',e+='<label for="student_path">Parcours</label>',e+='<input id="student_path" name="student_path" type="text" list="student_path-list">',e+='<datalist id="student_path-list">';for(var o in s)e+=`<option>${s[o]}</option>`;e+="/<datalist>",e+='<label for="session_date">Date</label>',e+='<input id="session_date" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(n).format("YYYY-MM-DD")+'">',e+="</form>";const{value:l}=await Swal.fire({title:"<strong>Ajout d'un étudiant en mode manuel</strong>",icon:"info",html:e,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:`votre étudiant(e) ${a} n'a pas été trouvé`,preConfirm:()=>[document.getElementById("student_id").value,document.getElementById("student_name").value,document.getElementById("student_path").value,document.getElementById("funding").checked,document.getElementById("session_date").value]});if(l){var g="";l[3]===!0?sFunding=_e:sFunding=le,oe.add(l[0],l[1],l[2],sFunding,l[4])}}}var de=oe;const Je=we(ge());class Te{static tbl_name="sessions";static add=async function(t){let a=Je.default.Cfg.dbase;if(GM_config.get("checksessionalreadyexists")===!0)var n=!0;if(n===!0&&Te.exists(t.id)===!0)return;if(re.isInOldMode(dayjs(t.when)))console.log("%cWe are in old mode",C),t.funding=le,t.type.toLowerCase()==="soutenance"?(console.log("%cThis is a defense, we DON't need to add the path to the session",C),t.path="this ia a defense no need for path"):t.path="old mode no need for path";else if(t.type.toLowerCase()==="soutenance")console.log("%cThis is a defense nothing to do specially for now",C),t.funding=le;else{if(de.exists(t.who_id)===!1&&(await de.getAll(),de.exists(t.who_id,t.when)==!1))return console.warn(`%cStudent {oSession.who_id} which exists at ${t.when} still not exit in Db, have to manually create him/her`,C),de.createManually(t.who_id,t.who_name,t.when);t.funding=await de.getFunding(t.who_id,t.when),t.path=await de.getPath(t.who_id,t.when)}console.log(`%cSaving session id:${t.id} of ${t.who_name}(${t.who_id}) at ${t.when} to DB`,C),a.get(Te.tbl_name).push(JSON.parse(JSON.stringify(t))).write()};static exists=function(t){let a=Je.default.Cfg.dbase;console.log(`%cWill search existence of session id:${t} in database`,C);var n=a.get(Te.tbl_name).find({id:t}).value();return!(n===void 0)};static delete=function(t=null,a=null){let n=Je.default.Cfg.dbase;if(typeof t=="string"&&(t=t.format("YYYY-MM-DD")),typeof a=="string"&&(a=a.format("YYYY-MM-DD")),t===null&&a==null){console.log("%cWanna suppress ALL Sessions from DB",C),n.get(Te.tbl_name).remove().write();return}if(a==null){n.get(Te.tbl_name).remove(function(s){return dayjs(s.when).isBefore(a),"day"}).write();return}if(t==null){n.get(Te.tbl_name).remove(function(s){return dayjs(s.when).isAfter(t,"day")}).write();return}n.get(Te.tbl_name).remove(function(s){return dayjs(s.when).isBetween(t,a,"day","[]")}).write()};static deleteById=function(t){let a=Je.default.Cfg.dbase;a.get("sessions").remove(n=>n.id===t).write(),console.log(`%cSession ${t} suppressed from DB`,C)};static getBetween(t,a){typeof t=="string"&&(t=dayjs(t)),typeof a=="string"&&(t=dayjs(a));let n=Je.default.Cfg.dbase,s=n.get(Te.tbl_name).filter(e=>dayjs(e.when).isSameOrBefore(a,"day")&&dayjs(e.when).isSameOrAfter(t,"day")).value();return s}static parseTable=function(t){var a=t.children[0].children[0].innerText,n=je(t.children[0]),s=t.children[1].children[0].innerText.trim(),e=je(t.children[1],-2),o=t.children[2].innerText.trim().toLowerCase(),l=t.children[3].children.length?t.children[3].children[0].innerText.trim().toLowerCase():"session",g=-1;t.children[4].children.length>0&&(g=t.children[4].children[0].innerText.trim()),a=Pt(a);var u={id:n,when:a,who_id:e,who_name:s,status:o,type:l,lvl:g};return u}}var fe=Te;const nn=we(ge());class $t{static calculateBill=function(t,a){let n=a.format("YYYYMM");if(Ne.exists(n)===!0){console.log(`%cUse Archived version ${n} of accounting`,C);let s=Ne.get(n);return s.data}return typeof t=="string"&&(t=t.format("YYYY-MM-DD")),typeof a=="string"&&(a=a.format("YYYY-MM-DD")),$t.m_calculateBill(t,a)};static _calculateBill=function(t,a){typeof t=="string"&&(t=dayjs(t)),typeof a=="string"&&(a=dayjs(a));const n=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");var s=0,e=0,o=performance.now();const l=nn.default.Cfg.dbase,g=l.get(fe.tbl_name).filter(S=>dayjs(S.when).isSameOrBefore(a,"day")&&dayjs(S.when).isSameOrAfter(t,"day")),u=g.value(),d=u.length;let i={from:t,to:a,created_at:null,maxLevel:$e,number:0,amount:0,errors:{funding:[],level:[],path:[],status:[],type:[]},flatFee:[]},h=0,x=0,c=[];s=performance.now();const f=$t.getPriceList(t);e=performance.now(),console.log("%cGetPriceList took "+(e-s)+" milliseconds.",pe);let p=en([$e+1,$e+1,$e+1,$e+1]);for(var m=0;m<d;m+=1){const S=u[m];var j=0;S.status===Fe&&(j=Z),S.status===Be&&(j=J),S.status===Ie&&(j=W),(S.status===Re||S.status===He)&&(j=Q);var T=0;S.type.toLowerCase()==="session"&&(T=N),S.type.toLowerCase()==="soutenance"&&(T=B),S.path!=null&&S.path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&S.type!=="soutenance"&&(T=I);var E=0;const v=re.isInOldMode(t);if(v===!0&&(E=S.isFunded===!0?q:U),S.funding===_e&&(E=U),S.funding===le&&(E=q),S.funding===xe&&(E=G),S.lvl<0){i.errors.level.push(S);continue}if(v===!1&&S.funding!==_e&&S.funding!==le&&S.funding!==xe){i.errors.funding.push(S);continue}if(S.type.toLowerCase()!=="session"&&T!==B&&T!==I){i.errors.type.push(S);continue}if(S.status!==Fe&&S.status!==Be&&S.status!==Ie&&S.status!==Re&&S.status!==He){i.errors.status.push(S);continue}let $=p.get(T,j,E,+S.lvl);$===void 0&&($={number:0,amount:0,data:[]}),$.number+=1,h+=1,S.lvl<0?($.amount+=0,x+=0):($.amount+=1*f[S.lvl][T][j][E],x+=1*f[S.lvl][T][j][E]),$.data.push(S),p.set(T,j,E,+S.lvl,$),T===N&&E===U&&c.push({id:+S.who_id,who_id:S.who_id,who_name:S.who_name})}var w=[];s=performance.now(),w=_.uniqBy(c,"id"),i.flatFee=w,i.number=h,i.amount=x,i.number+i.errors.funding.length+i.errors.level.length+i.errors.path.length+i.errors.status.length+i.errors.type.length<d&&(console.log(`%cError total number of sessions is ${d} and total number of sessions in bill ${h} + all errors are different`,ce),console.log("errors are",i.errors),console.log("sessions are",u)),i.created_at=n,p.set(0,0,0,0,i);var z=performance.now();return console.log("%cFunction took "+(z-o)+" milliseconds.",pe),p};static m_calculateBill=moize.default($t._calculateBill,{maxAge:12e4,isSerialized:!0,onCacheAdd:function(t,a,n){console.log("%cAdd data to cache",C)},onCacheHit:function(){console.log("%cGet data from cache",C)}});static getPriceList=function(t){typeof t=="string"&&(t=dayjs(t));var a=[0,gt,ht,bt,_t,yt,vt];const n=re.isInOldMode(t);var s=new Array(7);for(let e=1;e<=$e;e+=1){let o=a[e],l=a[e]/2,g=a[e]/4;n?(s[e]=new Array(3),s[e][N]=new Array(5),s[e][N][Z]=new Array(4),s[e][N][Z][U]=o,s[e][N][Z][q]=o,s[e][N][Z][G]=o,s[e][N][J]=new Array(4),s[e][N][J][U]=0,s[e][N][J][q]=0,s[e][N][J][G]=0,s[e][N][W]=new Array(4),s[e][N][W][U]=l,s[e][N][W][q]=l,s[e][N][W][G]=l,s[e][N][Q]=new Array(4),s[e][N][Q][U]=l,s[e][N][Q][q]=l,s[e][N][Q][G]=l,s[e][B]=new Array(5),s[e][B][Z]=new Array(4),s[e][B][Z][U]=o,s[e][B][Z][q]=o,s[e][B][Z][G]=o,s[e][B][J]=new Array(4),s[e][B][J][U]=0,s[e][B][J][q]=0,s[e][B][J][G]=0,s[e][B][W]=new Array(4),s[e][B][W][U]=l,s[e][B][W][q]=l,s[e][B][W][G]=l,s[e][B][Q]=new Array(4),s[e][B][Q][U]=l,s[e][B][Q][q]=l,s[e][B][Q][G]=l,s[e][I]=new Array(5),s[e][I][Z]=new Array(4),s[e][I][Z][U]=o,s[e][I][Z][q]=o,s[e][I][Z][G]=o,s[e][I][J]=new Array(4),s[e][I][J][U]=0,s[e][I][J][q]=0,s[e][I][J][G]=0,s[e][I][W]=new Array(4),s[e][I][W][U]=l,s[e][I][W][q]=l,s[e][I][W][G]=l,s[e][I][Q]=new Array(4),s[e][I][Q][U]=l,s[e][I][Q][q]=l,s[e][I][Q][G]=l):(s[e]=new Array(3),s[e][N]=new Array(5),s[e][N][Z]=new Array(4),s[e][N][Z][U]=l,s[e][N][Z][q]=o,s[e][N][Z][G]=o,s[e][N][J]=new Array(4),s[e][N][J][U]=0,s[e][N][J][q]=0,s[e][N][J][G]=0,s[e][N][W]=new Array(4),s[e][N][W][U]=0,s[e][N][W][q]=0,s[e][N][W][G]=0,s[e][N][Q]=new Array(4),s[e][N][Q][U]=g,s[e][N][Q][q]=l,s[e][N][Q][G]=l,s[e][B]=new Array(5),s[e][B][Z]=new Array(4),s[e][B][Z][U]=o,s[e][B][Z][q]=o,s[e][B][Z][G]=o,s[e][B][J]=new Array(4),s[e][B][J][U]=0,s[e][B][J][q]=0,s[e][B][J][G]=0,s[e][B][W]=new Array(4),s[e][B][W][U]=0,s[e][B][W][q]=0,s[e][B][W][G]=0,s[e][B][Q]=new Array(4),s[e][B][Q][U]=l,s[e][B][Q][q]=l,s[e][B][Q][G]=l,s[e][I]=new Array(5),s[e][I][Z]=new Array(4),s[e][I][Z][U]=o,s[e][I][Z][q]=o,s[e][I][Z][G]=o,s[e][I][J]=new Array(4),s[e][I][J][U]=0,s[e][I][J][q]=0,s[e][I][J][G]=0,s[e][I][W]=new Array(4),s[e][I][W][U]=0,s[e][I][W][q]=0,s[e][I][W][G]=0,s[e][I][Q]=new Array(4),s[e][I][Q][U]=l,s[e][I][Q][q]=l,s[e][I][Q][G]=l)}return s}}var Se=$t;const Qe=we(ge());class ae{static tbl_name="history_session_cache";static getSessionPage=function(t){t.get("day")<t.daysInMonth()&&(t=t.endOf("month")),console.log(`%cSearch in history session cache data for id: ${t.format("DD/MM/YYYY")}`,C);let a=Qe.default.Cfg.dbase;if(!a.has(ae.tbl_name).value())throw Error(`DB ${ae.db_name} NOT FOUND`);let n=a.get(ae.tbl_name).find({id:+t.format("YYYYMMDD")}).value();return n===void 0?-1:n};static getNearestSessionPage=function(t){t.get("day")<t.daysInMonth()&&(t=t.endOf("month")),console.log(`%cSearch in history session cache NEAREST cached data for id: ${t.format("DD/MM/YYYY")}`,C);let a=Qe.default.Cfg.dbase;if(!a.has(ae.tbl_name).value())throw Error(`DB ${ae.db_name} NOT FOUND`);let n=+t.format("YYYYMMDD"),s=a.get(ae.tbl_name).value().map(l=>+l.id-n).filter(l=>l>0);const e=l=>Math.min(...l);let o=e(s)+n;return console.log(`%cNearest data in history session cache is data with id: ${t.format("DD/MM/YYYY")}`,C),s=a.get(ae.tbl_name).find({id:o}).value(),s===void 0?-1:s};static getSameOrNearestSessionPage=function(t){let a=ae.getSessionPage(t);return a===-1&&(a=ae.getNearestSessionPage(t)),a};static delete=function(t=null,a=null){let n=Qe.default.Cfg.dbase;if(typeof t=="string"&&(t=t.format("YYYY-MM-DD")),typeof a=="string"&&(a=a.format("YYYY-MM-DD")),t===null&&a==null){n.get(ae.tbl_name).remove().write(),console.log("%cWanna suppress ALL History from DB",C);return}if(a==null){n.get(ae.tbl_name).remove(function(s){return dayjs(s.id,"YYYYMMDD").isBefore(a),"day"}).write();return}if(t==null){n.get(ae.tbl_name).remove(function(s){return dayjs(s.id,"YYYYMMDD").isAfter(t,"day")}).write();return}n.get(ae.tbl_name).remove(function(s){return dayjs(s.id,"YYYYMMDD").isBetween(t,a,"day","[]")}).write()};static addOrUpdateSessionPage=function(t=1,a=dayjs("1970-10-06")){ae.getSessionPage(a)==-1?ae.addSessionPage(t,a):ae.updateSessionPage(t,a)};static updateSessionPage=function(t=1,a=dayjs("1970-10-06")){let n=Qe.default.Cfg.dbase,s=ae.getSessionPage(a);if(s==-1)throw Error("session page not found in history");n.get(ae.tbl_name).find({id:+a.format("YYYYMMDD")}).assign({page:t}).write()};static addSessionPage=function(t=1,a=dayjs("1970-10-06")){let n=Qe.default.Cfg.dbase;n.get(ae.tbl_name).push(JSON.parse(JSON.stringify({id:+a.format("YYYYMMDD"),page:t}))).write()}}var ze=ae;var kt=function(t,a){let n=[[0,1,2,3,4,5,5],[5,1,2,3,4,5,5],[4,5,1,2,3,4,4],[3,4,5,1,2,3,3],[2,3,4,5,1,2,2],[1,2,3,4,5,1,1],[0,1,2,3,4,5,0]];return Math.trunc(a.diff(t,"days")/7)*5+n[t.day()][a.day()]};const on=we(ge());class Dn{static detail_bill="truc";static getListDetailBill=function(t,a){let n=on.default.Cfg.dbase,s=n.get(fe.tbl_name).filter(m=>dayjs(m.when).isSameOrBefore(a,"day")&&dayjs(m.when).isSameOrAfter(t,"day")).sortBy(function(m){return dayjs(m.when).valueOf()}).value();const e=re.getOldModeDate();let o=Se.getPriceList(e.subtract(1,"day")),l=Se.getPriceList(e),g=0;var u=_.cloneDeep(s);for(var d in u){var i=0,h=0,x=!0,c=0;u[d].status===Fe&&(c=Z),u[d].status===Be&&(c=J),u[d].status===Ie&&(c=W),(u[d].status===Re||u[d].status===He)&&(c=Q);var f=0;u[d].type.toLowerCase()==="session"&&(f=N),u[d].type.toLowerCase()==="soutenance"&&(f=B),u[d].path!=null&&u[d].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&u[d].type!=="soutenance"&&(f=I);var p=0;u[d].funding===_e&&(p=U),u[d].funding===le&&(p=q),u[d].funding===xe&&(p=G),re.isInOldMode(dayjs(u[d].when))?i=+u[d].lvl>0?o[+u[d].lvl][f][c][p]:0:(x=!1,i=+u[d].lvl>0?l[+u[d].lvl][f][c][p]:0),g+=i,u[d].iPu=i,u[d].oldMode=x,u[d].iCumul=g}return u};static getListStatistic=function(t,a){let n=t.clone(),s=n.endOf("month"),e=[],o=[],l=0,g=a.diff(t,"month");for(var u=performance.now();n.isSameOrBefore(a,"day");)e.push(Se.calculateBill(n,s)),n=n.add(1,"month"),s=n.endOf("month");var d=performance.now();console.log("%cComputed data between the two dates in"+(d-u)+" milliseconds.",pe),n=t.clone(),s=n.endOf("month");let i=0,h=0,x=0,c=0,f=0,p=0,m=0;for(;l<=g;){const T=e[l].get(0,0,0,0),E=T.maxLevel;o[l]={header:{dtFrom:null,dtTo:null,created_at:null},sessions:{total:0,nb:0,pu:0,nbc:0},defenses:{total:0,nb:0,pu:0,nbc:0},coaches:{total:0,nb:0,pu:0,nbc:0},bonus:0,kpi:{jrs:0,hrs:0,hrsp:0}};let w=1;for(;w<E;){let S=0,v=0,$=0,Y=0;i=e[l].get(N,Z,U,w),x=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(N,Z,q,w),h=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(N,Z,G,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=typeof i=="undefined"?0:i.number,re.isInOldMode(n)?(o[l].kpi.hrs+=(i+h+x)*(45/60),o[l].kpi.hrsp+=(i+h+x)*(GM_config.get("nbHrsS")/60)):(o[l].kpi.hrs+=x*(30/60),o[l].kpi.hrsp+=x*(GM_config.get("nbHrsAfM")/60),o[l].kpi.hrs+=(i+h)*(45/60),o[l].kpi.hrsp+=(i+h)*(GM_config.get("nbHrsfM")/60)),i=e[l].get(N,J,U,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(N,J,q,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(N,J,G,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,re.isInOldMode(n)?(i=e[l].get(N,W,U,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(N,W,q,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(N,W,G,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount):(i=e[l].get(N,W,U,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(N,W,q,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(N,W,G,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount),i=e[l].get(N,Q,U,w),x=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(N,Q,q,w),h=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(N,Q,G,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=typeof i=="undefined"?0:i,o[l].kpi.hrs+=(i+h+x)*(15/60),o[l].kpi.hrsp+=(i+h+x)*(15/60),S=o[l].sessions.total,v=o[l].sessions.nb,$=o[l].sessions.pu,Y=o[l].sessions.nbc,o[l].sessions={total:f+S,nb:c+v,pu:(f+S)/(c+v),nbc:p+Y},S=0,v=0,$=0,Y=0,c=0,f=0,p=0,m=0,i=e[l].get(B,Z,U,w),x=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(B,Z,q,w),h=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(B,Z,G,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=typeof i=="undefined"?0:i.number,o[l].kpi.hrs+=(i+h+x)*(45/60),o[l].kpi.hrsp+=(i+h+x)*(GM_config.get("nbHrsD")/60),i=e[l].get(B,J,U,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(B,J,q,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(B,J,G,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(B,W,U,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(B,W,q,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(B,W,G,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(B,Q,U,w),x=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(B,Q,q,w),h=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(B,Q,G,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=typeof i=="undefined"?0:i.number,o[l].kpi.hrs+=(i+h+x)*(15/60),o[l].kpi.hrsp+=(i+h+x)*(15/60),S=o[l].defenses.total,v=o[l].defenses.nb,$=o[l].defenses.pu,Y=o[l].defenses.nbc,o[l].defenses={total:f+S,nb:c+v,pu:(f+S)/(c+v),nbc:p+Y},S=0,S=0,v=0,$=0,Y=0,c=0,f=0,p=0,m=0,i=e[l].get(I,Z,U,w),x=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(I,Z,q,w),h=typeof i=="undefined"?0:i.number,c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(I,Z,G,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=typeof i=="undefined"?0:i.number,o[l].kpi.hrs+=(i+h+x)*(45/60),o[l].kpi.hrsp+=(i+h+x)*(GM_config.get("nbHrsC")/60),i=e[l].get(I,J,U,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(I,J,q,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(I,J,G,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(I,W,U,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(I,W,q,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(I,W,G,w),p=typeof i=="undefined"?p:p+i.number,m=typeof i=="undefined"?m:m+i.amount,i=e[l].get(I,Q,U,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(I,Q,q,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,i=e[l].get(I,Q,G,w),c=typeof i=="undefined"?c:c+i.number,f=typeof i=="undefined"?f:f+i.amount,S=o[l].coaches.total,v=o[l].coaches.nb,$=o[l].coaches.pu,Y=o[l].coaches.nbc,i=typeof i=="undefined"?0:i.number,o[l].kpi.hrs+=i*(15/60),o[l].kpi.hrsp+=i*(15/60),o[l].coaches={total:f+S,nb:c+v,pu:(f+S)/(c+v),nbc:p+Y},w+=1}let z=T.flatFee.length;for(var j=0;j<z;j+=1)o[l].bonus+=30;s.isAfter(a,"day")&&(s=a.clone()),o[l].kpi.jrs=kt(n,s),o[l].header.dtFrom=n.format("YYYY-MM-DD"),o[l].header.dtTo=s.format("YYYY-MM-DD"),o[l].header.created_at=dayjs().format("YYYY-MM-DD HH:mm:ss"),n=n.add(1,"month"),s=n.endOf("month"),l+=1}return o};static getListStatisticOld=function(t,a){let n=t.clone(),s=n.endOf("month"),e=[],o=[],l=a.get("month")-t.get("month");for(var g=performance.now();n.isSameOrBefore(a,"day");)e.push(Se.calculateBill(n,s)),n=n.add(1,"month"),s=n.endOf("month");var u=performance.now();console.log("%cComputed data between the two dates in"+(u-g)+" milliseconds.",pe);let d=0;for(n=t.clone(),s=n.endOf("month"),console.log(e);d<=l;){let i=e[d][0].max_level;o[d]={header:{dtFrom:null,dtTo:null,created_at:null},sessions:{total:0,nb:0,pu:0,nbc:0},defenses:{total:0,nb:0,pu:0,nbc:0},coaches:{total:0,nb:0,pu:0,nbc:0},bonus:0,kpi:{jrs:0,hrs:0,hrsp:0}};let h=1;for(;h<i;){let x=[...Array(8).keys()];for(let c=0;c<x.length;c+=1)o[d].sessions.total+=e[d][h].sessions.number[c]*e[d][h].sessions.pu[c],o[d].sessions.nb+=e[d][h].sessions.number[c],o[d].defenses.total+=e[d][h].defenses.number[c]*e[d][h].defenses.pu[c],o[d].defenses.nb+=e[d][h].defenses.number[c],re.isInOldMode(n)?[1,5].includes(c)&&(o[d].sessions.nbc+=e[d][h].sessions.number[c],o[d].defenses.nbc+=e[d][h].defenses.number[c]):[1,2,5,6].includes(c)&&(o[d].sessions.nbc+=e[d][h].sessions.number[c],o[d].defenses.nbc+=e[d][h].defenses.number[c]),re.isInOldMode(n)?(o[d].kpi.hrs+=(e[d][h].sessions.number[c]-e[d][h].defenses.number[c])*(45/60),o[d].kpi.hrsp+=(e[d][h].sessions.number[c]-e[d][h].defenses.number[c])*(GM_config.get("nbHrsfM")/60)):([4,5,6,7].includes(c)&&(o[d].kpi.hrs+=(e[d][h].sessions.number[c]-e[d][h].defenses.number[c])*(30/60),o[d].kpi.hrsp+=(e[d][h].sessions.number[c]-e[d][h].defenses.number[c])*(GM_config.get("nbHrsAfM")/60)),[0,1,2,3].includes(c)&&(o[d].kpi.hrs+=(e[d][h].sessions.number[c]-e[d][h].defenses.number[c])*(45/60),o[d].kpi.hrsp+=(e[d][h].sessions.number[c]-e[d][h].defenses.number[c])*(GM_config.get("nbHrsfM")/60))),o[d].kpi.hrs+=e[d][h].defenses.number[c]*(45/60),o[d].kpi.hrsp+=e[d][h].defenses.number[c]*(GM_config.get("nbHrsD")/60);h+=1}o[d].sessions.pu=o[d].sessions.total/(o[d].sessions.nb-o[d].sessions.nbc),o[d].defenses.pu=o[d].defenses.total/(o[d].defenses.nb-o[d].defenses.nbc),o[d].coaches.total=o[d].sessions.total-o[d].defenses.total,o[d].coaches.nb=o[d].sessions.nb-o[d].defenses.nb,o[d].coaches.nbc=o[d].sessions.nbc-o[d].defenses.nbc,o[d].coaches.pu=o[d].coaches.total/(o[d].coaches.nb-o[d].coaches.nbc);for(let x=0;x<e[d][0].bonus.length;x+=1)o[d].bonus+=e[d][0].bonus[x].sessions>0?30:0;s.isAfter(a,"day")&&(s=a.clone()),o[d].kpi.jrs=kt(n,s),o[d].header.dtFrom=n.format("YYYY-MM-DD"),o[d].header.dtTo=s.format("YYYY-MM-DD"),o[d].header.created_at=dayjs().format("YYYY-MM-DD HH:mm:ss"),n=n.add(1,"month"),s=n.endOf("month"),d+=1}return o}}var Tt=Dn;class An{static addFooter=async function(t,a,n={}){const{degrees:s,PDFDocument:e,rgb:o,StandardFonts:l}=PDFLib,g=t.getPageCount(),u="8".repeat(g),d=await t.embedFont(l.TimesRoman),i=12,h=d.widthOfTextAtSize(`page ${u} / ${u}`,i),x=10,c=10,f=1,p=o(0/255,0/255,0/255),m=o(253/255,246/255,227/255),j=5,T=5,E=3,w=3,z=!0;t.getPages().forEach((S,v)=>{if(!(z===!0&&v==0)){const{width:$,height:Y}=S.getSize(),X=i+2*f+E+w;S.moveTo(x+j,i+w),S.setFont(d),S.setFontSize(i),S.setFontColor(o(1,0,0)),a!==void 0&&S.drawText(`${a}`),S.drawText(`page ${v+1} / ${g}`,{x:$-h-T}),S.drawRectangle({x,y:10,width:$-(x+c),height:X,color:m,opacity:.6,borderColor:p,borderWidth:f})}})};static changePgIfNeeded(t,a,n,s){var e=s.getPageCount(),o=s.getPages()[e-1],l=o.fontSize,g=o.getFont(),u=o.lineHeight;return t<a&&(n=1,o=s.addPage(),o.font=g,o.setFontSize(l),o.lineHeight=u),[n,o]}}var Ee=An;const Lt=we(ge());var Mn=function(){const t="meta",a=function(s){return Lt.default.Cfg.dbase.get("meta").find({key:"dbVersion"}).assign({value:s}).write()},n=function(){let s=Lt.default.Cfg.dbase.get("meta").find({key:"dbVersion"}).value;return typeof s=="undefined"?-1:s.value};return Object.freeze({getVersion:n,setVersion:a,tbl_name:t})};const Yn=Mn();var Nt=Yn;const rn=we(ge());var an=async function(){let t=rn.default.Cfg.dbase;const a=await Swal.mixin({confirmButtonText:"Suivant &rarr;",showCancelButton:!0,progressSteps:["0","1","2","3","4","5"],onOpen:function(h){console.log("...onOpen")},onRender:function(h){console.log("....onUpdate")},onClose:function(h){console.log(".....onClose")},onAfterClose:function(h){console.log("......onAfterClose")},onDestroy:function(h){console.log(".......onDestroy")}}).queue([{title:"Migration de la base",html:"<p>Cette migration va corriger la base et ajouter les nouveaux champs nécessaires, l`interrpuption du traitement est sans danger (mais ce n' est pas une raison !)</p>"},{title:"Correction de la table étudiant",html:"<p>Correction de la liste des étudiants (who_id)",onOpen:async function(h){console.log("%cMigration table des étudiants correction du who_id",C),Swal.showLoading();var x=dayjs("2020-06-01"),c=t.get("students"),f=c.value(),p=t.get("sessions").filter(w=>dayjs(w.when).isSameOrAfter(x,"day")),m=c.size().value(),j=Swal.getContent().textContent;for(u=0;u<m;u+=1){var T=p.find(z=>z.who_name===f[u].fullname).value();T!==void 0&&c.get(u).assign({who_id:T.who_id}).write();const w=Swal.getContent();w!=null&&(w.innerHTML=`${j}<br /><p>Traitement en cours : ${u}/${f.length}</p>`),await ye(1)}Swal.hideLoading();const E=Swal.getContent();E!=null&&(E.textContent=`Traitement terminé : ${f.length}/${f.length}`)}},{title:"Correction de la table étudiant",html:"<p>Correction de la liste des étudiants funded devient funding</p>",onOpen:async function(h){console.log("%cMigration : table des étudiants suppression de l'ancien champs et ajout du champs funding",C),Swal.showLoading();for(var x=t.get("students"),c=x.size().value(),f=Swal.getContent().textContent,p=0;p<c;p+=1){var m=x.get(p).value().fundedby;if(m===void 0){console.log("%cStudent ${oListStudents.get(i).who_name} already converted, skip it",C);continue}x.get(p).unset(["fundedby"]).assign({funding:m}).write(),console.log("%cStudent ${oListStudents.get(i).who_name} create field funding and remove fundedby",C);const T=Swal.getContent();T!=null&&(T.innerHTML=`${f}<br /><p>Traitement en cours : ${p}/${c}</p>`),await ye(1)}Swal.hideLoading();const j=Swal.getContent();j!=null&&(j.textContent=`Traitement terminé : ${c}/${c}`)}},{title:"Correction table Etudiants",html:"<p>Correction de la liste des sessions, ajout du path dans la session</p>",onOpen:async function(h){console.log("%cMigration table des sessions correction de id_who",C),Swal.showLoading();var x=dayjs("2020-06-01"),c=t.get("students"),f=c.value(),p=t.get("sessions").filter(z=>dayjs(z.when).isSameOrAfter(x,"day")),m=p.filter(z=>z.type!="soutenance").value(),j=Swal.getContent().textContent;for(u=0;u<m.length;u+=1){var T=c.find({who_id:m[u].who_id}).value();console.log("found",T);var E=T!==void 0&&T.path.length>0?T.path:"0-unknown";t.get("sessions").find({id:m[u].id}).assign({path:E}).write();const z=Swal.getContent();z!=null&&(z.innerHTML=`${j}<br /><p>Traitement en cours : ${u}/${m.length}</p>`),await ye(1)}Swal.hideLoading();const w=Swal.getContent();w!=null&&(w.textContent=`Traitement terminé : ${u}/${m.length}`)}},{title:"Migration de la table des Sessions",html:'<p>Correction de la liste des sessions, suppression du champs "isFunded"</p>',onOpen:async function(h){console.log("%cMigration : table des sessions suppression de isFunded",C),Swal.showLoading();for(var x=dayjs("2020-06-01"),c=t.get("students").value(),f=t.get("sessions").filter(E=>dayjs(E.when).isSameOrAfter(x,"day")),p=Swal.getContent().textContent,m=f.value().length;m-=1;){var j=f.get(m);j.value().isFunded===void 0||j.value().isFunded===void 0?console.log(`%cSkip ${j.value()} already converted`,C):j.unset(["isFunded"]).write();const E=Swal.getContent();E!=null&&(E.innerHTML=`${p}<br /><p>Traitement en cours : il reste ${m} élements à convertir</p>`),await ye(1)}Swal.hideLoading();const T=Swal.getContent();T!=null&&(T.textContent=`Traitement en terminé : ${f.value().length}/${f.value().length}`)}},{title:"Migration de la table des Sessions",html:"<p>Correction de la liste des sessions, ajout de funding</p>",onOpen:async function(h){console.log("%cMigration : table des sessions ajout de fundedBy",C),Swal.showLoading();for(var x=dayjs("2020-06-01"),c=t.get("students").value(),f=t.get("sessions").filter(z=>dayjs(z.when).isSameOrAfter(x,"day")),p=f.filter(z=>z.type!="soutenance"),m=Swal.getContent().textContent,j=p.value().length;j-=1;){var T=p.get(j);T.value().funding!==void 0?console.log(`%cSkip ${T.value()} already converted`,C):T.assign({funding:de.getFunding(T.value().who_id)}).write();const z=Swal.getContent();z.innerHTML=`${m}<br /><p>Traitement en cours : il rest ${j}élements à convertir</p>`,await ye(1)}for(var E=j,p=f.filter(z=>z.type=="soutenance"),j=0;j<p.value().length;j+=1){p.get(j).assign({funding:le}).write();const S=Swal.getContent();S!=null&&(S.innerHTML=`${m}<br /><p>Traitement en cours : ${E+j}/${f.value().length}</p>`),await ye(1)}Swal.hideLoading();const w=Swal.getContent();w!=null&&(w.textContent=`Traitement terminé :  ${f.value().length}/${f.value().length}`)}}]).then(h=>{if(h.value){const x=JSON.stringify(h.value);Swal.fire({title:"Traitement terminé!",html:`
			Your answers:
			<pre><code>${x}</code></pre>
		  `,confirmButtonText:"Lovely!"})}else return console.log("%c resultat en erreur",C,h,h.dismiss===Swal.DismissReason.cancel),-1});return a;var n,s,e;for(u=0;u<s.length;u+=1){var o=e.find(h=>h.who_name===s[u].fullname).value();o!==void 0&&t.get("students").find({fullname:o.who_name}).assign({who_id:o.who_id}).write()}var l;for(u=0;u<l.length;u+=1){var o=t.get("students").find({who_id:l[u].who_id}).value(),g=o!==void 0&&o.path.length>0?o.path:"0-unknown";t.get("sessions").find({id:l[u].id}).assign({path:g}).write()}for(var u=0;u<e.value().length;u+=1)e.get(u).unset(["isFunded"]).write();for(var d,u=0;u<d.value().length;u+=1){var i=d.get(u);i.assign({fundedBy:de.getFunded(i.value().who_id)}).write()}for(var d,u=0;u<d.value().length;u+=1)d.get(u).assign({fundedBy:le}).write()};const Et=we(ge());class jn{static export=function(){return console.log("%cWanna export DBASE",C),JSON.stringify(Et.default.Cfg.dbase.getState())};static import=function(t){return console.log(`%cWanna import ${t} in DBASE`,C),console.log("%c !!!!!! TYPE NOT CHECKED BE CARREFULL",C),Et.default.Cfg.dbase.setState(JSON.parse(t)).write()};static update=async function(t){if(console.log(`%cIs there any update to DB to go to version ${t}`,C),ot(t,"1.00.0006")==0){console.log("%cFound an update to DB version '1.00.0006' proceed conversion...",C);let n=await an();if(n==-1)console.log("%cError something was wrong during update.... you have canceled it",APP_ERROR_STYLE),Swal.fire({icon:"error",title:"Oops...",text:`Quelque chose s'est mal passé ou vous avez annulé l'update 

Utiliser l'application dans ces conditions n'est pas garanti  !`,footer:'<a href="https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon/issues">Générer un bug?</a>'});else{let s=Nt.setVersion(t);console.log(`%cChanged DB to version ${s}`,C)}return}let a=Nt.setVersion(t);console.log(`%cChanged DB to version ${a}`,C)};static erase=function(t){return console.log(`%cErase all data of table: ${t}`,C),Et.default.Cfg.dbase.get(t).remove().write()}}var Ge=jn;var sn=async function(){var t="";t+="<style>div.about_content {background-color: #fed9ff;/*width: 600px;*/height: var(--heigth, 80%);overflow-x: hidden;overflow-y: auto;text-align: left;padding: 20px;}</style>",t+='<div class="about_content" style="--heigth: 600px;">',t+='<div class="about_content__wrapper">';const a=await wt.XHR({method:"GET",url:"https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/README.md",responseType:"text/html",headers:{"User-Agent":"Mozilla/5.0"}});var n=a.responseText,s=new showdown.Converter,e=s.makeHtml(n);t+=e,t+="</div>",t+="</div>",Swal.fire({title:`<strong>A propos de ${pt}</strong>`,icon:"info",html:t,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})},nt=function(){var t="table.crud-list tbody",a=document.querySelector(t),n=!1;if(a.querySelector("[type=checkbox]")===null){for(const x of a.children){var s=je(x.children[0]),e=document.createElement("input");e.type="checkbox",e.name="name",e.value=s,e.id="id",n=fe.exists(s),n===!0&&(e.checked=!0);var o=document.createElement("td");o.style="text-align: center",o.appendChild(e),x.appendChild(o)}t="table.crud-list thead tr";var l=document.querySelector(t);e=document.createElement("input"),e.type="checkbox",e.name="name",e.value="value",e.id="id",e.onclick=function(){document.querySelectorAll("tbody input[type=checkbox]").forEach(x=>x.checked=!x.checked)},e.style="visibility: hidden;";var g=document.createElement("label");g.innerText="in DB",g.style="display:block;",g.onMouseOver="this.style.cursor=pointer;",g.onMouseOut="this.style.cursor=auto;",g.appendChild(e),o=document.createElement("td"),o.style="text-align: center",o.appendChild(g),l.appendChild(o)}else{for(var u=a.querySelectorAll("[type=checkbox]"),d=u.length,i=new Array(d);d--;i[d]=u[d]);for(var h in i)n=fe.exists(i[h].value),n===!0?i[h].checked=!0:i[h].checked=!1}},dn=async function(){var[t,a]=await Ze(dayjs().startOf("month"),dayjs().endOf("month"));let n=Tt.getListDetailBill(t,a),s="";s+="<table>",s+="<thead>",s+="<tr><th>Quand</th><th>Qui</th><th>Financé ?</th><th>Type</th><th>Niveau</th><th>Ancien Mode ?</th><th>Statut</th><th>PU HT</th><th>Cumul</th></tr>",s+="<thead>",s+="<tbody>";for(let e=0;e<n.length;e+=1)s+="<tr>",s+=`<td>${dayjs(n[e].when).format("DD/MM/YYYY à HH:mm:ss")}</td>`,s+=`<td>${n[e].who_name}</td><td>${n[e].funding}</td>`,sType=n[e].type,n[e].path!=null&&n[e].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&n[e].type!=="soutenance"&&(sType="Coaching"),s+=`<td>${sType}</td><td>${n[e].lvl}</td>`,s+=`<td>${n[e].oldMode===!0?"Oui":"Non"}</td>`,s+=`<td>${n[e].status}</td>`,s+=`<td>${n[e].iPu}</td><td>${n[e].iCumul}€</td>`,s+="</tr>";s+="</tbody>",s+="</table>",Swal.fire({title:`<strong>Liste détaillées des sessions du ${t.format("DD/MM/YYYY")} au ${a.format("DD/MM/YYYY")}</strong>`,icon:"info",html:s,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen",onOpen:e=>{var o=e.querySelector("table"),l=new simpleDatatables.DataTable(o)}})},ln=async function(){var[t,a]=await Ze(dayjs().startOf("month"),dayjs().endOf("month"));let n=0,s=GM_config.get("maxfetchpg"),e=!0;var o={};let l=[],g=1,u=ze.getSameOrNearestSessionPage(a);for(u!==void 0&&u.page>g&&(g=u.page);e;){if(n>s){console.warn("%cEMERGENCY EXIT LOOP",We);break}try{o=await Pn(t,a,g,l)}catch(h){throw console.error(`%c IRRECOVERABLE ERROR ... ${h}, will exit !!!! `,ce),new Error}o.length>0&&dayjs(o[o.length-1].when).isSameOrBefore(t)===!0&&(e=!1),g+=1,n+=1}GM_addStyle(".ldBar path.mainline{stroke-width:10;stroke:#09f;stroke-linecap:round}"),GM_addStyle(".ldBar path.baseline{stroke-width:14;stroke:#f1f2f3;stroke-linecap:round;filter:url(#custom-shadow)}");let d='<div id="pbar" class="ldBar label-center" data-value="0" data-path="M0 0 L200 0 L200 1"></div>';var i=o.length;Swal.fire({title:"Traitement en cours!",html:d,confirmButtonText:"Lovely!",onBeforeOpen:function(h){var x=new ldBar("#pbar")},onRender:function(h){},onOpen:async function(h){var x=document.getElementById("pbar").ldBar;for(var c in o){if(dayjs(o[c].when).isBefore(t,"day")===!0)break;if(dayjs(o[c].when).isAfter(a,"day")===!0){x.set(c/i*100,!1);continue}dayjs(o[c].when).isBetween(t,a,"day","[]")&&(await fe.add(o[c]),x.set(c/i*100,!1))}x.set(100,!1),Swal.getTitle().innerText="Traitement terminé !"},onClose:function(h){},onAfterClose:function(h){},onDestroy:function(h){}}),nt()},un=async function(){var t="table.crud-list tbody input:checked",a=document.querySelectorAll(t);GM_addStyle(".ldBar path.mainline{stroke-width:10;stroke:#09f;stroke-linecap:round}"),GM_addStyle(".ldBar path.baseline{stroke-width:14;stroke:#f1f2f3;stroke-linecap:round;filter:url(#custom-shadow)}");let n='<div id="pbar" class="ldBar label-center" data-value="0" data-path="M0 0 L200 0 L200 1"></div>';Swal.fire({title:"Traitement en cours!",html:n,confirmButtonText:"Lovely!",onBeforeOpen:function(s){var e=new ldBar("#pbar")},onRender:function(s){},onOpen:async function(s){for(var e=document.getElementById("pbar").ldBar,o=0;o<a.length;o+=1){var l=a[o].parentElement.parentElement,g=fe.parseTable(l);await fe.add(g),e.set(o/a.length*100,!1)}e.set(100,!1),Swal.getTitle()&&(Swal.getTitle().innerText="Traitement terminé !")},onClose:function(s){},onAfterClose:function(s){},onDestroy:function(s){}})},cn=function(){const t=unsafeWindow.Facturier.cfg.dbase,a=unsafeWindow.Facturier.libs.find(u=>u.id=="dayjs").ptr,n=unsafeWindow.Facturier.libs.find(u=>u.id=="fetchInject").ptr,s=unsafeWindow.Facturier.klass.find(u=>u.id=="Session").ptr,e=unsafeWindow.Facturier.klass.find(u=>u.id=="Student").ptr,o=unsafeWindow.Facturier.klass.find(u=>u.id=="History").ptr,l=unsafeWindow.Facturier.klass.find(u=>u.id=="Archive").ptr,g=unsafeWindow.Facturier.klass.find(u=>u.id=="StudentHistory").ptr;console.log("%cd_dbase, d_dayjs, d_Session, d_Student, d_History, d_Archive, d_StudentHistory are exported",C),console.log("%cfor examples write all code after $>",C),console.group("%cd_dbase",C),console.log("example : get last session in db $>d_dbase.get(d_Session.tbl_name).last().value();"),console.log("          get first student in db $>d_dbase.get(d_Student.tbl_name).first().value()"),console.log("          or d_dbase.get(d_Student.tbl_name).get(0).value()"),console.log("          get all sessions grouped by month/yyyy in db $>d_dbase.get(d_Session.tbl_name).groupBy( v => d_dayjs(v.when).format('MM/YYYY')).value()"),console.log("          get all table $> d_dbase.value()"),console.groupEnd(),console.group("%cd_fetchInject",C),console.log("same as fetchInject libs : https://habd.as/code/fetch-inject/"),console.groupEnd(),console.group("%cd_dayjs",C),console.log("same as dayjs libs"),console.groupEnd(),console.group("%cd_Student",C),console.log("find a student by id ¤ d_Student.findById(STUDENT_ID, (DATE) ); // date is optionnal"),console.groupEnd(),console.group("%cd_Session",C),console.log("get a list of session ¤ d_Session.getBetween('2020-08-01','2020-08-31')"),console.log("delete a session by id ¤ d_Session.deleteById(SESSION_ID);"),console.groupEnd(),console.group("%cSome combinated example",C),console.log("Delete last saved session :  d_Session.deleteById( d_dbase.get(d_Session.tbl_name).last().value().id ); "),console.log("Find all session between 01/08/2020 and 31/08/2020 :  d_dbase.get(d_Session.tbl_name).filter( v => d_dayjs(v.when).isSameOrBefore('20200831', 'day') && d_dayjs(v.when).isSameOrAfter('20200801', 'day')).value(); "),console.groupEnd();debugger},Pn=async function(t,a,n=1,s=[]){Swal.fire({position:"top-end",icon:"info",toast:!0,title:`Collecte des sessions de l'historique
du `+t.format("DD/MM/YYYY")+" au "+a.format("DD/MM/YYYY")+` 
page : `+n+`
cela peut prendre du temps...`,showConfirmButton:!1,timer:3e3});let e=null;try{e=await rt(`https://openclassrooms.com/fr/mentorship/dashboard/mentorship-sessions-history?page=${n}`,"table.crud-list tbody")}catch(i){console.error(`%c _historyFetch : ${i}`,ce)}if(e===null)throw new Error(`Something went wrong could'nt collect anything from ${t.format("DD/MM/YYYY")} to ${a.format("DD/MM/YYYY")} working on history page:${n}.... try to navigate forward and backward or click some buttons to change url`);let o=Ot(e),l=Ot(e,-1);if(o.get("month")!=l.get("month")){let i=l.endOf("month");ze.addOrUpdateSessionPage(n,i)}if(l.isAfter(a,"day")===!0)return console.log(`%cOptimization: oldest (last) data from page are at :${l.format("DD/MM/YYYY")}, don't analyze what was before end date of extraction ${a.format("DD/MM/YYYY")}`,C),s;for(var g=0;g<e.children.length;g+=1){var u=e.children[g],d=fe.parseTable(u);s.push(d)}return s},fn=function(){const{degrees:t,PDFDocument:a,rgb:n,StandardFonts:s}=PDFLib;async function e(){const g="https://pdf-lib.js.org/assets/with_update_sections.pdf",u=await fetch(g).then(m=>m.arrayBuffer()),d=await a.load(u),i=await d.embedFont(s.Helvetica),h=d.getPages(),x=h[0],{width:c,height:f}=x.getSize();x.drawText("This text was added with JavaScript!",{x:5,y:f/2+300,size:50,font:i,color:n(.95,.1,.1),rotate:t(-45)});const p=await d.save();download(p,"pdf-lib_modification_example.pdf","application/pdf")}async function o(){const g=await a.create(),u=await g.embedFont(s.TimesRoman),d=g.addPage(),{width:i,height:h}=d.getSize(),x=30;d.drawText("Creating PDFs in JavaScript is awesome!",{x:50,y:h-4*x,size:x,font:u,color:n(0,.53,.71)});const c=await g.save();download(c,"pdf-lib_modification_example.pdf","application/pdf")}async function l(){var[g,u]=await Ze(dayjs().startOf("month"),dayjs().endOf("month"));let d=Tt.getListDetailBill(g,u);const i=await a.create(),h=await i.embedFont(s.TimesRoman),x=i.addPage(),{width:c,height:f}=x.getSize(),p=30;x.drawText(`Prestations en détail 

 du ${g.format("DD/MM/YYYY")} au ${u.format("DD/MM/YYYY")}`,{x:50,y:f/2-p,size:p,font:h,color:n(116/255,81/255,235/255)});let m=12,j=1.25,T=i.addPage();T.setFontSize(m),T.line_space=j,T.font=h;let E=1,w=20,z=j*m+w,S=f/2;const v=function(ee){const te="LOrEm ipsum DOLor sit aMet, conSEc/tetUr 25 porttitor. ";return ee*1.0925*(h.widthOfTextAtSize(te,m)/te.length)};let $=[0,18,36,10,13,8,5,7],Y=[$[0],v($[1]),v($[2]),v($[3]),v($[4]),v($[5]),v($[6]),v($[7])],X=x.lineHeight,ne=25;for(let ee=1;ee<d.length;ee+=1){if(S=f-j*m*E,S<z&&(E=1,T=i.addPage(),T.font=h,T.setFontSize(m),T.line_space=j,S=f-j*m*E),E===1){let Ht=["","Quand","Qui","Financé","Type-Niv.","Statut","Pu","Cumul"],Yt=ne;T.moveTo(Yt,S);for(let ft=1;ft<Ht.length;ft+=1)T.drawText(Ht[ft],{x:Yt}),Yt+=Y[ft];E+=1,S=f-j*m*E}let te=ne;T.drawText(dayjs(d[ee].when).format("DD/MM/YYYY à HH:mm"),{font:h,size:m,y:S,x:te,lineHeight:X}),te+=Y[1],T.drawText(d[ee].who_name.trim().slice(0,$[2]),{font:h,size:m,y:S,x:te,lineHeight:X}),te+=Y[2];let qe=d[ee].funding.trim().slice(0,$[3]);d[ee].funding==="auto-financé"&&(qe="Au. Fin."),d[ee].funding==="financé par un tiers"&&(qe="Fin."),T.drawText(qe,{font:h,size:m,y:S,x:te,lineHeight:X}),te+=Y[3];let Le=d[ee].type;d[ee].path!=null&&d[ee].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&d[ee].type!=="soutenance"&&(Le="Coaching");let vn=`${Le.trim().slice(0,$[4]-2)}-${d[ee].lvl.toString()}`;T.drawText(vn,{font:h,size:m,y:S,x:te,lineHeight:X}),te+=Y[4];let ct=d[ee].status;d[ee].status==="étudiant absent"&&(ct="absent"),d[ee].status==="étudiante absente"&&(ct="absente"),d[ee].status==="annulée tardivement"&&(ct="an. tard."),T.drawText(ct,{font:h,size:m,y:S,x:te,lineHeight:X}),te+=Y[5],T.drawText(d[ee].iPu.toString(),{font:h,size:m,y:S,x:te,lineHeight:X}),te+=Y[6],T.drawText(d[ee].iCumul.toString(),{font:h,size:m,y:S,x:te,lineHeight:X}),E+=1}var D=await Se.calculateBill(g,u);const b=D.get(0,0,0,0),y=b.maxLevel,P=re.getOldModeDate(),L=Se.getPriceList(P.subtract(1,"day")),ie=Se.getPriceList(P);var F=1;const H=!1;var R=[N,B,I],V=["Sessions","Soutenance","Coaching"],Ue=[0,1,2,3],Mt=["Réalisée","Annulée","Annulée tardivement","Etudiant(e) absent(e)"],Me=[U,q,G],Ke=["Autofinancés","Financés","Autres"];E=1,T=i.addPage();let ke=["","Quand","Qui","Nb","Pu","Cumul"],et=[0,18,50,3,5,7],tt=[$[0],v($[1]),v($[2]),v($[3]),v($[4]),v($[5])],Rt="";for(_iSessionType=0,_iSessionTypeLength=R.length;_iSessionType<_iSessionTypeLength;_iSessionType+=1){for(;F<=y;){for([E,T]=Ee.changePgIfNeeded(S,z,E,i),S=f-j*m*E,_iSessionQuality=0,_iSessionQualityLength=Ue.length;_iSessionQuality<_iSessionQualityLength;_iSessionQuality+=1)for(_iFunding=0,_iFundingLength=Me.length;_iFunding<_iFundingLength;_iFunding+=1){if(_i0=D.get(R[_iSessionType],Ue[_iSessionQuality],Me[_iFunding],F),typeof _i0=="undefined"&&H===!1)continue;_i0.data=_i0.data.reverse();let ee=ne;if(Rt=`${V[_iSessionType]} de Niveau ${F} Etudiants ${Ke[_iFunding]}`,T.moveTo(ee,S),T.drawText(Rt,{font:h,size:m+4,y:S,x:ee,lineHeight:X}),ee+=15,E+=1,[E,T]=Ee.changePgIfNeeded(S,z,E,i),S=f-j*m*E,T.moveTo(ee,S),T.drawText(Mt[_iSessionQuality],{font:h,size:m+2,y:S,x:ee,lineHeight:X}),ee+=15,E+=1,[E,T]=Ee.changePgIfNeeded(S,z,E,i),S=f-j*m*E,typeof _i0=="undefined"){T.drawText(`désolé pas de résultat pour cette section au niveau de facturation (${F})`,{font:h,size:m,y:S,x:ee,lineHeight:X}),E+=1,[E,T]=Ee.changePgIfNeeded(S,z,E,i),S=f-j*m*E;continue}let te=ee,qe=0;T.moveTo(ee,S);for(let Le=1;Le<ke.length;Le+=1)T.drawText(ke[Le],{font:h,size:m+2,y:S,x:te,lineHeight:X}),te+=tt[Le];E+=1,[E,T]=Ee.changePgIfNeeded(S,z,E,i),S=f-j*m*E,te=ee;for(var Ye=0,_n=_i0.data.length;Ye<_n;Ye+=1)te=ee,T.drawText(dayjs(_i0.data[Ye].when).format("DD/MM/YYYY à HH:mm"),{font:h,size:m,y:S,x:te,lineHeight:X}),te+=tt[1],T.drawText(_i0.data[Ye].who_name.trim().slice(0,et[1]),{font:h,size:m,y:S,x:te,lineHeight:X}),te+=tt[2],T.drawText((Ye+1).toString(),{font:h,size:m,y:S,x:te,lineHeight:X}),te+=tt[3],re.isInOldMode(dayjs(_i0.data[Ye].when))?iPu=+_i0.data[Ye].lvl>0?L[F][R[_iSessionType]][Ue[_iSessionQuality]][Me[_iFunding]]:0:iPu=+_i0.data[Ye].lvl>0?ie[F][R[_iSessionType]][Ue[_iSessionQuality]][Me[_iFunding]]:0,T.drawText(iPu.toString(),{font:h,size:m,y:S,x:te,lineHeight:X}),te+=tt[4],qe+=iPu,T.drawText(qe.toString(),{font:h,size:m,y:S,x:te,lineHeight:X}),E+=1,[E,T]=Ee.changePgIfNeeded(S,z,E,i),S=f-j*m*E}F+=1,E+=1,[E,T]=Ee.changePgIfNeeded(S,z,E,i),S=f-j*m*E}F=1}Ee.addFooter(i,`Généré avec Facturier version ${re.getAppVersion()}`);const yn=await i.save();download(yn,`prestations_facturees_detail_${g.format("YYYYMMDD")}-${u.format("YYYYMMDD")}.pdf`,"application/pdf")}l()},mn=async function(){GM_addStyle('.formgrid{font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;}'),GM_addStyle(".swal2-styled[type=button]{background-color:#3085d6;border-radius:.75em;color:#fff;font-size:1.0625em;border-left-color:#3085d6;border-right-color:#3085d6;display:inline-block}.formgrid{display:grid;grid-template-columns:1fr 1em 1fr;grid-gap:.3em .6em;grid-auto-flow:dense;align-items:center}input,output,textarea,select,button{grid-column:2 / 4;width:auto;margin:0}legend{font-size:1.2em;width:100%;border-bottom:1px dotted #99c}fieldset{max-width:40em;padding:4px;margin:2em auto;border:0 none}");let t="";t+="<legend>Que voulez vous faire ?</legend>",t+="<fieldset>",t+='<div class="formgrid">',t+='Epurer<button id="answer1" data-action="raz" class="swal2-styled" type="button">RAZ</button>',t+='Exporter<button id="answer2" data-action="export" class="swal2-styled" type="button">Exporter</button>',t+='Importer<button id="answer3" data-action="import" class="swal2-styled" type="button">Importer</button>',t+="</fieldset>",t+="</div>";const{value:a}=await Swal.fire({title:"Gestion de la base de donnée",html:t,focusConfirm:!1,preConfirm:()=>[document.getElementById("answer1").value,document.getElementById("answer2").value],onOpen:n=>{n.querySelector(".formgrid").addEventListener("click",function(s){const e=function(g){g.target.matches('button[data-action="raz"]')&&(Swal.close(),Ln());return},o=function(g){g.target.matches('button[data-action="export"]')&&(Swal.close(),On());return},l=function(g){g.target.matches('button[data-action="import"]')&&(Swal.close(),kn());return};e(s),o(s),l(s)}),console.log("%conOpen popup","color:coral")},onClose:n=>{n.querySelector(".formgrid").removeEventListener("click"),console.log("%conClose popup","color:coral")}});a&&Swal.fire(JSON.stringify(a))},On=async function(){let t=Ge.export();console.log(`%cWanna export : ${t}`,C);let a=dayjs(),n="";n+=`<a id="download" href="data:text/plain;charset=utf-8,${encodeURIComponent(t)}" download="export_${a.format("YYYYMMDD")}.json" style="display:none"></a>`,n+=`<a id="download" href="data:text/plain;charset=utf-8,${encodeURIComponent(t)}" download="export_${a.format("YYYYMMDD")}.json">export_${a.format("YYYYMMDD")}.json</a>`,Swal.fire({title:"Export de la base de donnée",html:n,focusConfirm:!1,onOpen:s=>{s.querySelector("#download").click()},onClose:s=>{}})},kn=async function(){console.log("%cWanna import DATABASE",C);const{value:t}=await Swal.fire({title:"Selection de la sauvegarde (json)",input:"file",inputAttributes:{accept:".json","aria-label":"Upload your database"}});if(t){const a=new FileReader;a.onload=n=>{Ge.import(n.target.result),nt(),St("Import terminé")},a.readAsText(t)}},Ln=async function(){GM_addStyle(".form_addon {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}"),GM_addStyle(".form_addon input {background: #fff;border: 1px solid #9c9c9c;}"),GM_addStyle(".form_addon button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}"),GM_addStyle(".form_addon button:hover {background: gold;}"),GM_addStyle(".form_addon label {padding: 0.5em 0.5em 0.5em 0;}"),GM_addStyle(".form_addon input {padding: 0.7em;margin-bottom: 0.5rem;}"),GM_addStyle(".form_addon input:focus {outline: 3px solid gold;}"),GM_addStyle("@media (min-width: 400px) {.form_addon {grid-template-columns: 200px 1fr;grid-gap: 16px;} .form_addon label {text-align: right;grid-column: 1 / 2;} .form_addon input, .form_addon button {grid-column: 2 / 3;}}");var t="";t+='<form id="RAZ" class="form_addon" action="">',t+='<label for="students" class="cbox">Etudiants</label>',t+='<input id="students" type="checkbox" value="del_students_true" checked>',t+='<label for="sessions" class="cbox">Sessions</label>',t+='<input id="sessions" type="checkbox" value="del_sessions_true" checked>',t+='<label for="archives" class="cbox">Archives : factures</label>',t+='<input id="archives" type="checkbox" value="del_archives_true" checked>',t+='<label for="history_cache" class="cbox">Signet historique</label>',t+='<input id="history_cache" type="checkbox" value="del_history_cache_true" checked>',t+='<label for="radio1">filtrer la date</label>',t+='<input type="radio" id="radio1" name="date_filter" value="false" checked>',t+='<label for="radio2">ne pas filtrer</label>',t+='<input type="radio" id="radio2" name="date_filter" value="true">',t+='<label for="dtFrom" class="date">Date de début</label>',t+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31">',t+='<label for="dtTo" class="date">Date de fin</label>',t+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31">',t+="<!-- Switch -->",t+='<input type="checkbox" class="switch" name="s1" id="s1">',t+='<label for="s1">Switch</label>',t+="</form>";const{value:a}=await Swal.fire({title:"<strong>RAZ des données</strong>",icon:"info",html:t,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:"Choisissez ce que vous allez supprimer de la base de donnée",preConfirm:()=>{let u=document.getElementsByName("date_filter"),d="notfound";for(var i in u)u[i].checked===!0&&(d=u[i].value);return console.log(document.getElementById("s1")),[document.getElementById("students").checked,document.getElementById("sessions").checked,document.getElementById("archives").checked,document.getElementById("history_cache").checked,document.getElementById("dtFrom").disabled===!0?null:document.getElementById("dtFrom").value,document.getElementById("dtTo").disabled===!0?null:document.getElementById("dtTo").value,d]},onOpen:u=>{u.querySelector("#radio1").addEventListener("change",function(){console.log(document.getElementById("radio1").checked);let d=document.getElementById("radio1").checked;document.getElementById("dtFrom").disabled=!d,document.getElementById("dtTo").disabled=!d}),u.querySelector("#radio2").addEventListener("change",function(){let d=document.getElementById("radio1").checked;document.getElementById("dtFrom").disabled=!d,document.getElementById("dtTo").disabled=!d}),u.querySelector("#dtFrom").addEventListener("change",function(){document.getElementById("dtTo").value=dayjs(document.getElementById("dtFrom").value).endOf("month").format("YYYY-MM-DD")})},onClose:u=>{u.querySelector("#radio1").removeEventListener("change"),u.querySelector("#radio2").removeEventListener("change"),u.querySelector("#dtFrom").removeEventListener("change")}});let n=a[0],s=a[1],e=a[2],o=a[3];console.log(`%cWanna raz students ? ${n}, wanna raz sessions ? ${s}, wanna raz archives ? ${e}`,C);let l=a[4]?dayjs(a[4]):null,g=a[5]?dayjs(a[5]):null;n===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des étudiants",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),de.delete(l,g)),s===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des sessions",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),fe.delete(l,g),nt()),e===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des archives (financières)",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),Ne.delete(l,g)),o===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base du cache des historique de session",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),ze.delete(l,g))},pn=async function(){var t="";t+="<style>",t+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",t+="form input {background: #fff;border: 1px solid #9c9c9c;}",t+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",t+="form button:hover {background: gold;}",t+="form label {padding: 0.5em 0.5em 0.5em 0;}",t+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",t+="form input:focus {outline: 3px solid gold;}",t+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}label {text-align: right;grid-column: 1 / 2;}input,button {grid-column: 2 / 3;}}",t+="</style>",t+='<form class="form1" action="">',t+='<label for="dd" class="date">Date de début</label>',t+='<input id="dd" type="date" max="2030-12-31" min="2010-12-31">',t+='<label for="df" class="date">Date de fin</label>',t+='<input id="df" type="date" max="2030-12-31" min="2010-12-31">',t+="</form>";var[a,n]=await Ze(dayjs().startOf("month"),dayjs().endOf("month")),s=await Se.calculateBill(a,n);re.isInOldMode(a)?Nn(a,n,s):Fn(a,n,s)},Nn=function(t,a,n){const s=n.get(0,0,0,0),e=4;var o="",l=null,g=0,u=0,d=0,i=[[4,"Groupe"],[1,"Niveau 1"],[2,"Niveau 2"],[3,"Niveau 3"]],h=0,x=0,c=!1,f=0,p=0,m=0,j=0,T=0,E=0,w=0,z=0,S=0,v=0,$=0,Y=0,X=0,ne=0,D=0,b=0,y=0,P=0,L=1;n.toConsole(),o+="<style>.wrapper{  display: grid;grid-gap: 10px;grid-template-column: 1fr 1fr;}</style>",o+='<div class="wrapper">',o+="<table>",o+="<thead>",o+="<tr>",o+='<th>Type</th><th><abbr title="nombre">nb</abbr></th><th>PU(<abbr title="hors taxes">HT</abbr>)</th><th>Total(<abbr title="hors taxes">HT</abbr>)</th>',o+="</tr>",o+="</thead>",o+="<tbody>",o+="<tr>",o+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Mentorat</th>',o+="</tr>";for(var h=performance.now();L<=e;)_i0=n.get(N,Z,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : réalisées</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),_i0=n.get(N,J,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(N,J,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(N,J,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : annulées</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),_i0=n.get(N,W,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(N,W,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(N,W,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : annulées tard.</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),_i0=n.get(N,Q,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(N,Q,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(N,Q,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : étudiant abs.</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),L+=1;var x=performance.now();console.log("%cCalculate first array"+(x-h)+" milliseconds.",pe),o+="<tr>",o+="<td>Total</td>",o+=`<td>${g}</td><td></td><td>${u}€</td>`,o+="</tr>",o+="<tr>",o+="</tr>",d+=u,g=0,u=0,o+="<tr>",o+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Soutenance</th>',o+="</tr>",L=1;for(var h=performance.now();L<=e;)_i0=n.get(B,Z,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(B,Z,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(B,Z,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : réalisées</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),_i0=n.get(B,J,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(B,J,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(B,J,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : annulées</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),_i0=n.get(B,W,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(B,W,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(B,W,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : annulées tard.</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),_i0=n.get(B,Q,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(B,Q,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(B,Q,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : étudiant abs.</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),L+=1;var x=performance.now();console.log("%cCalculate second array"+(x-h)+" milliseconds.",pe),o+="<tr>",o+="<td>Total</td>",o+=`<td>${g}</td><td></td><td>${u}€</td>`,o+="</tr>",o+="<tr>",o+="</tr>",d+=u,g=0,u=0,o+="<tr>",o+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Coaching</th>',o+="</tr>",L=1;for(var h=performance.now();L<=e;)_i0=n.get(I,Z,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(I,Z,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(I,Z,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : réalisées</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),_i0=n.get(I,J,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(I,J,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(I,J,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : annulées</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),_i0=n.get(I,W,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(I,W,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(I,W,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : annulées tard.</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),_i0=n.get(I,Q,U,L),v=_i0===void 0?0:_i0.number,b=_i0===void 0?0:_i0.amount,_i0=n.get(I,Q,q,L),$=_i0===void 0?0:_i0.number,y=_i0===void 0?0:_i0.amount,_i0=n.get(I,Q,G,L),Y=_i0===void 0?0:_i0.number,P=_i0===void 0?0:_i0.amount,X=v>0?b/v:b,ne=$>0?y/$:y,D=Y>0?P/Y:P,(c===!0||v+$+Y>0)&&(g+=v,g+=$,g+=Y,u+=b,u+=y,u+=P,o+="<tr>",o+=`<td>Niveau ${L} : étudiant abs.</td>`,o+=`<td>${v+$+Y}</td><td>${ne}</td><td>${b+y+P}€</td>`,o+="</tr>"),L+=1;var x=performance.now();console.log("%cCalculate third array"+(x-h)+" milliseconds.",pe),o+="<tr>",o+="<td>Total</td>",o+=`<td>${g}</td><td></td><td>${u}€</td>`,o+="</tr>",o+="<tr>",o+="</tr>",d+=u,o+="<tr>",o+='<th colspan="4" class="pseudoheader" scope="colgroup">Total Général</th>',o+="</tr>",o+=`<td colspan="3"></td><td>${d}€</td>`,o+="</tr>",o+="<tr>",o+="</tr>",o+="</tbody>",o+="<tfoot>",o+="</tfoot>",o+="</table>",o+=`<p>Soit un total général à facturer de ${d}€`,Swal.fire({title:`<strong>Liste des formations tarifées du ${t.format("DD/MM/YYYY")} au ${a.format("DD/MM/YYYY")}</strong>`,html:o,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})},Fn=function(t,a,n){console.log("%cEnter computation bill",C);const s=!1;var e="",o=0,l=0,g=0,u=0,d=0,i=0,h=0,x=0,c=0,f=0,p=0,m=0;const j=n.get(0,0,0,0),T=j.maxLevel;var E=0,w=0,z=0,S=0,v=0,$=0,Y=0,X=0,ne=0,D=0,b=0,y=0,P=0,L=0,ie=0,F=0,H=0,R=0,V=1;e+="<style>.wrapper{  display: grid;grid-gap: 10px;grid-template-column: 1fr 1fr;}</style>",e+='<div class="wrapper">',e+="<table>",e+="<thead>",e+="<tr>",e+='<th rowspan="2">Type</th><th colspan="3" scope="colgroup">Auto Financés</th><th colspan="3" scope="colgroup">Financés</th><th colspan="3" scope="colgroup">Autres</th><th colspan="2" scope="colgroup">Total</th>',e+="</tr>",e+="<tr>",e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+="</tr>",e+="</thead>",e+="<tbody>",e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de mentorat</th>',e+="</tr>";for(var Ue=performance.now();V<=T;)_i0=n.get(N,Z,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : réalisées</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),_i0=n.get(N,J,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(N,J,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(N,J,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : annulées</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),_i0=n.get(N,W,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(N,W,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(N,W,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : annulées tard.</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),_i0=n.get(N,Q,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(N,Q,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(N,Q,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : étud. absent</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),V+=1;var Mt=performance.now();for(console.log("%cCalculate first array"+(Mt-Ue)+" milliseconds.",pe),e+="<tr>",e+="<td>Total</td>",e+=`<td>${o}</td><td></td><td>${u}€</td>`,e+=`<td>${l}</td><td></td><td>${d}€</td>`,e+=`<td>${g}</td><td></td><td>${i}€</td>`,e+=`<td>${o+l+g}</td><td>${u+d+i}€</td>`,e+="</tr>",e+="<tr>",e+="</tr>",h+=o,x+=l,c+=g,f+=u,p+=d,m+=i,o=0,l=0,g=0,u=0,d=0,i=0,e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de Soutenance</th>',e+="</tr>",V=1;V<=T;)_i0=n.get(B,Z,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(B,Z,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(B,Z,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : réalisées</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),_i0=n.get(B,J,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(B,J,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(B,J,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : annulées</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),_i0=n.get(B,W,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(B,W,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(B,W,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : annulées tard.</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),_i0=n.get(B,Q,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(B,Q,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(B,Q,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : étud. absent</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),V+=1;e+="<tr>",e+="<td>Total</td>",e+=`<td>${o}</td><td></td><td>${u}€</td>`,e+=`<td>${l}</td><td></td><td>${d}€</td>`,e+=`<td>${g}</td><td></td><td>${i}€</td>`,e+=`<td>${o+l+g}</td><td>${u+d+i}€</td>`,e+="</tr>",e+="<tr>",e+="</tr>",h+=o,x+=l,c+=g,f+=u,p+=d,m+=i,o=0,l=0,g=0,u=0,d=0,i=0,e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de Coaching</th>',e+="</tr>";for(var V=1;V<=T;)_i0=n.get(I,Z,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(I,Z,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(I,Z,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : réalisées</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),_i0=n.get(I,J,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(I,J,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(I,J,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : annulées</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),_i0=n.get(I,W,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(I,W,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(I,W,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : annulées tard.</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),_i0=n.get(I,Q,U,V),D=_i0===void 0?0:_i0.number,F=_i0===void 0?0:_i0.amount,_i0=n.get(I,Q,q,V),b=_i0===void 0?0:_i0.number,H=_i0===void 0?0:_i0.amount,_i0=n.get(I,Q,G,V),y=_i0===void 0?0:_i0.number,R=_i0===void 0?0:_i0.amount,P=D>0?F/D:F,L=b>0?H/b:H,ie=y>0?R/y:R,(s===!0||D+b+y>0)&&(o+=D,l+=b,g+=y,u+=F,d+=H,i+=R,e+="<tr>",e+=`<td>Niveau ${V} : étud. absent</td>`,e+=`<td>${D}</td><td>${P}</td><td>${F}€</td>`,e+=`<td>${b}</td><td>${L}</td><td>${H}€</td>`,e+=`<td>${y}</td><td>${ie}</td><td>${R}€</td>`,e+=`<td>${D+b+y}</td><td>${F+H+R}€</td>`,e+="</tr>"),V+=1;h+=o,x+=l,c+=g,f+=u,p+=d,m+=i,e+="<tr>",e+="<td>Total</td>",e+=`<td>${o}</td><td></td><td>${u}€</td>`,e+=`<td>${l}</td><td></td><td>${d}€</td>`,e+=`<td>${g}</td><td></td><td>${i}€</td>`,e+=`<td>${o+l+g}</td><td>${u+d+i}€</td>`,e+="</tr>",e+="<tr>",e+="</tr>",e+="</tbody>",e+="<tfoot>",e+="</tfoot>",e+="</table>";var Me=0,Ke="";let ke=j.flatFee.length;for(var et=0;et<ke;et+=1)Me+=30,Ke+=j.flatFee[et].who_name+", ";ke>1?e+=`<p class="flat_fee">Calcul du forfait "autofinancé". Ce mois ci ${ke} étudiants ont eu au moins une session il s'agit de : ${Ke.slice(0,-1)}`:e+=`<p class="flat_fee">Calcul du forfait "autofinancé". Ce mois ci ${ke} étudiant a eu au moins une session il s'agit de : ${Ke.slice(0,-1)}`,e+=`. Le forfait est donc de ${Me}€</p>`,e+=`<p>Soit un total général à facturer de ${f+p+m+Me}€</p>`,Swal.fire({title:`<strong>Liste des formations tarifées du ${t.format("DD/MM/YYYY")} au ${a.format("DD/MM/YYYY")}</strong>`,html:e,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})},gn=async function(){var[t,a]=await Ze(dayjs().startOf("month"),dayjs().endOf("month"),!1);if(t===null||a===null)throw console.log("%cError need date from, date to",ce),new Error;const n=Tt.getListStatistic(t,a);let s="",e=new Array(22),o=Array.apply(null,Array(22)).map(Number.prototype.valueOf,0),l=t.clone(),g=l.endOf("month"),u="";e[0]="<thead><tr><th>Sessions</th>",e[1]="<tbody><tr><td>Sessions</td>",e[2]='<tr class="header"><td>Montant</td>',e[3]="<tr><td>Nb.",e[4]="<tr><td>Pu",e[5]='<tr class="header"><td>Soutenances</td>',e[6]="<tr><td>Montant</td>",e[7]="<tr><td>Nb.",e[8]="<tr><td>Pu",e[9]='<tr class="header"><td>Coaching</td>',e[10]="<tr><td>Montant</td>",e[11]="<tr><td>Nb.",e[12]="<tr><td>Pu",e[13]='<tr class="header"><td>Bonus</td>',e[14]="<tr><td>Bonus AF</td>",e[15]="<tr><td>Total Général</td>",e[16]='<tr class="header"><td>KPI</td>',e[17]="<tr><td>NbJrs</td>",e[18]="<tr><td>TJM</td>",e[19]="<tr><td>Nb hrs</td>",e[20]="<tr><td>THM</td>",e[21]="<tr><td>Nb hrs (p.)</td>",e[22]="<tr><td>THM (p)</td>";for(var d=0;d<n.length;d+=1){o[2]+=n[d].sessions.total,o[3]+=n[d].sessions.nb-n[d].sessions.nbc,o[4]+=n[d].sessions.pu,o[6]+=n[d].defenses.total,o[7]+=n[d].defenses.nb-n[d].defenses.nbc,o[8]+=n[d].defenses.pu,o[10]+=n[d].coaches.total,o[11]+=n[d].coaches.nb-n[d].coaches.nbc,o[12]+=n[d].coaches.pu,o[14]+=n[d].bonus;let i=n[d].sessions.total+n[d].defenses.total+n[d].coaches.total+n[d].bonus;o[15]+=i,o[16]+=n[d].kpi.jrs,o[18]+=n[d].kpi.hrs,o[20]+=n[d].kpi.hrsp,n.length==1&&(u="</tr>"),d===n.length-1&&n.length>1?g.isAfter(a,"day")?(o[2]-=n[d].sessions.total,o[3]-=n[d].sessions.nb-n[d].sessions.nbc,o[4]-=n[d].sessions.pu,o[6]-=n[d].defenses.total,o[7]-=n[d].defenses.nb-n[d].defenses.nbc,o[8]-=n[d].defenses.pu,o[10]-=n[d].coaches.total,o[11]-=n[d].coaches.nb-n[d].coaches.nbc,o[12]-=n[d].coaches.pu,o[14]-=n[d].bonus,o[15]-=i,o[16]-=n[d].kpi.jrs,o[18]-=n[d].kpi.hrs,o[20]-=n[d].kpi.hrsp,e[0]+=`<td>Total(moy)</td><td>${dayjs(n[d].header.dtTo).format("MMMM")}</td></thead></tr>`,e[1]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[2]+=`<td>${o[2]} (${(o[2]/(n.length-1)).toFixed(2)})</td><td>${n[d].sessions.total}</td></tr>`,e[3]+=`<td>${o[3]} (${(o[3]/(n.length-1)).toFixed(2)})</td><td>${n[d].sessions.nb} (${n[d].sessions.nbc})</td></tr>`,e[4]+=`<td> n/a (${(o[4]/(n.length-1)).toFixed(2)})</td><td>${n[d].sessions.pu.toFixed(2)}</td></tr>`,e[5]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[6]+=`<td>${o[6]} (${(o[6]/(n.length-1)).toFixed(2)})</td><td>${n[d].defenses.total}</td></tr>`,e[7]+=`<td>${o[7]} (${(o[7]/(n.length-1)).toFixed(2)})</td><td>${n[d].defenses.nb} (${n[d].defenses.nbc})</td></tr>`,e[8]+=`<td> n/a (${(o[8]/(n.length-1)).toFixed(2)})</td><td>${n[d].defenses.pu.toFixed(2)}</td></tr>`,e[9]+=`<td>&nbsp;</td>${u}`,e[10]+=`<td>${o[10]} (${(o[10]/(n.length-1)).toFixed(2)})</td><td>${n[d].coaches.total}</td></tr>`,e[11]+=`<td>${o[11]} (${(o[11]/(n.length-1)).toFixed(2)})</td><td>${n[d].coaches.nb} (${n[d].coaches.nbc})</td></tr>`,e[12]+=`<td> n/a (${(o[12]/(n.length-1)).toFixed(2)})</td><td>${n[d].coaches.pu.toFixed(2)}</td></tr>`,e[13]+="<td>&nbsp;</td></tr>",e[14]+=`<td>${o[14]} (${(o[14]/(n.length-1)).toFixed(2)})</td><td>${n[d].bonus}</td></tr>`,e[15]+=`<td>${o[15]} (${(o[15]/(n.length-1)).toFixed(2)})</td><td>${i}</td></tr>`,e[16]+="<td>&nbsp;</td></tr>",e[17]+=`<td>${o[16]} (${(o[16]/(n.length-1)).toFixed(2)})</td><td>${n[d].kpi.jrs}</td></tr>`,e[18]+=`<td> n/a (${(o[15]/o[16]).toFixed(2)})</td><td>${(i/n[d].kpi.jrs).toFixed(2)}</td></tr>`,e[19]+=`<td>${o[18]} (${(o[18]/(n.length-1)).toFixed(2)})</td><td>${n[d].kpi.hrs.toFixed(2)}</td></tr>`,e[20]+=`<td> n/a  (${(o[15]/o[18]).toFixed(2)})</td><td>${(i/n[d].kpi.hrs).toFixed(2)}</td></tr>`,e[21]+=`<td>${o[20].toFixed(2)} (${(o[20]/(n.length-1)).toFixed(2)})</td><td>${n[d].kpi.hrsp.toFixed(2)}</td></tr>`,e[22]+=`<td> n/a  (${(o[15]/o[20]).toFixed(2)})</td><td>${(i/n[d].kpi.hrsp).toFixed(2)}</td></tr>`):(e[0]+=`<td>${dayjs(n[d].header.dtTo).format("MMMM")}</td><td>Tot.</td></thead></tr>`,e[1]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[2]+=`<td>${n[d].sessions.total}</td><td>${o[2]} (${(o[2]/n.length).toFixed(2)})</td></tr>`,e[3]+=`<td>${n[d].sessions.nb} (${n[d].sessions.nbc})</td><td>${o[3]} (${(o[3]/n.length).toFixed(2)})</td></tr>`,e[4]+=`<td>${n[d].sessions.pu.toFixed(2)}</td><td> n/a (${(o[4]/n.length).toFixed(2)})</td></tr>`,e[5]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[6]+=`<td>${n[d].defenses.total}</td><td>${o[6]} (${(o[6]/n.length).toFixed(2)})</td></tr>`,e[7]+=`<td>${n[d].defenses.nb} (${n[d].defenses.nbc})</td><td>${o[7]} (${(o[7]/n.length).toFixed(2)})</td></tr>`,e[8]+=`<td>${n[d].defenses.pu.toFixed(2)}</td><td> n/a (${(o[8]/n.length).toFixed(2)})</td></tr>`,e[9]+=`<td>&nbsp;</td>${u}`,e[10]+=`<td>${n[d].coaches.total}</td><td>${o[10]} (${(o[10]/n.length).toFixed(2)})</td></tr>`,e[11]+=`<td>${n[d].coaches.nb} (${n[d].coaches.nbc})</td><td>${o[11]} (${(o[11]/n.length).toFixed(2)})</td></tr>`,e[12]+=`<td>${n[d].coaches.pu.toFixed(2)}</td><td> n/a (${(o[12]/n.length).toFixed(2)})</td></tr>`,e[13]+="<td>&nbsp;</td></tr>",e[14]+=`<td>${n[d].bonus}</td><td>${o[14]} (${(o[14]/n.length).toFixed(2)})</td></tr>`,e[15]+=`<td>${i}</td><td>${o[15]} (${(o[15]/n.length).toFixed(2)})</td></tr>`,e[16]+="<td>&nbsp;</td></tr>",e[17]+=`<td>${n[d].kpi.jrs}</td><td>${o[16]} (${(o[16]/n.length).toFixed(2)})</td></tr>`,e[18]+=`<td>${(i/n[d].kpi.jrs).toFixed(2)}</td><td> n/a (${(o[15]/o[16]).toFixed(2)})</td></tr>`,e[19]+=`<td>${n[d].kpi.hrs.toFixed(2)}</td><td>${o[18]} (${(o[18]/n.length).toFixed(2)})</td></tr>`,e[20]+=`<td>${(i/n[d].kpi.hrs).toFixed(2)}</td><td> n/a  (${(o[15]/o[18]).toFixed(2)})</td></tr>`,e[21]+=`<td>${n[d].kpi.hrsp.toFixed(2)}</td><td>${o[20].toFixed(2)} (${(o[20]/n.length).toFixed(2)})</td></tr>`,e[22]+=`<td>${(i/n[d].kpi.hrsp).toFixed(2)}</td><td> n/a  (${(o[15]/o[20]).toFixed(2)})</td></tr>`):(e[0]+=`<td>${dayjs(n[d].header.dtTo).format("MMMM")}</td>${u}`,e[1]+=`<td>&nbsp;</td>${u}`,e[2]+=`<td>${n[d].sessions.total}</td>${u}`,e[3]+=`<td>${n[d].sessions.nb} (${n[d].sessions.nbc})</td>${u}`,e[4]+=`<td>${n[d].sessions.pu.toFixed(2)}</td>${u}`,e[5]+=`<td>&nbsp;</td>${u}`,e[6]+=`<td>${n[d].defenses.total}</td>${u}`,e[7]+=`<td>${n[d].defenses.nb} (${n[d].defenses.nbc})</td>${u}`,e[8]+=`<td>${n[d].defenses.pu.toFixed(2)}</td>${u}`,e[9]+=`<td>&nbsp;</td>${u}`,e[10]+=`<td>${n[d].coaches.total}</td>${u}`,e[11]+=`<td>${n[d].coaches.nb} (${n[d].coaches.nbc})</td>${u}`,e[12]+=`<td>${n[d].coaches.pu.toFixed(2)}</td>${u}`,e[13]+=`<td>&nbsp;</td>${u}`,e[14]+=`<td>${n[d].bonus}</td>${u}`,e[15]+=`<td>${i}</td>${u}`,e[16]+=`<td>&nbsp;</td>${u}`,e[17]+=`<td>${n[d].kpi.jrs}</td>${u}`,e[18]+=`<td>${(i/n[d].kpi.jrs).toFixed(2)}</td>${u}`,e[19]+=`<td>${n[d].kpi.hrs.toFixed(2)}</td>${u}`,e[20]+=`<td>${(i/n[d].kpi.hrs).toFixed(2)}</td>${u}`,e[21]+=`<td>${n[d].kpi.hrsp.toFixed(2)}</td>${u}`,e[22]+=`<td>${(i/n[d].kpi.hrsp).toFixed(2)}</td>${u}`),l=l.add(1,"month"),g=l.endOf("month")}s="<table>"+e.join(" ")+`</tbody><tfoot><tr><td colspan=${n.length+1}>la valeur entre parenthèse fait reference aux annulés</td></tr></tfoot></table>`,Swal.fire({title:`<strong>Statistiques du ${t.format("DD/MM/YYYY")} au ${a.format("DD/MM/YYYY")}</strong>`,icon:"info",html:s,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen",onOpen:i=>{}})};let se=t=>!isNaN(t),ue=t=>!isNaN(parseInt(t)),Ce=t=>t.split("!"),Ft=(t,a)=>Ce(t).indexOf(a),K=(t,a)=>Ce(t).includes(a),st=t=>se(t)?Xe+Number(t)*.25+"rem":Xe+t,De=(t={})=>Object.assign(Object.create(null),t),ur=new Map,cr=new Map,hn,fr=De({separator:":",screens:{sm:"640px",md:"768px",lg:"1024px",xl:"1280px"}}),Bn=t=>Object.prototype.toString.call(t)==="[object Object]",In=t=>{if(typeof t!="string")throw Error("Hex value is not a hex string.");if(t.startsWith("#")||(t="#"+t),t=t.length===4?t.slice(1).split("").map(a=>a+a).join(""):t.slice(1),!/^[0-9a-f]{6}$/i.test(t))throw Error("Incorrect hex color format.");return t},Rn=new Map;document.styleSheets.length===0?hn=document.head.appendChild(document.createElement("style")).sheet:hn=document.styleSheets[0];let mr=new Map,Hn,pr=De({p:"padding",m:"margin",h:"height",z:"z-index",w:"width"}),Ct=De();for(let t of Ce('box-border|-webkit-box-sizing:border-box;box-sizing:border-box!box-content|-webkit-box-sizing:content-box;box-sizing:content-box!hidden|display:none!object-scale-down|object-fit:scale-down;-o-object-fit:scale-down!scrolling-touch|-webkit-overflow-scrolling:touch!scrolling-auto|-webkit-overflow-scrolling:auto!visible|visibility:visible!invisible|visibility:hidden!order-first|order:-9999!order-last|order:9999!order-none|order:0!grid-cols-none|grid-template-columns:none!col-auto|grid-column:auto!col-start-auto|-ms-grid-column:auto;grid-column-start:auto!col-end-auto|-ms-grid-column-span:auto;grid-column-end:auto!grid-rows-none|-ms-grid-rows:none;grid-template-rows:none!row-auto|grid-row:auto!row-start-auto|-ms-grid-row:auto;grid-row-start:auto!row-end-auto|-ms-grid-row-span:auto;grid-row-end:auto!gap-px|gap:1px!row-gap-px|row-gap:1px!grid-flow-row|grid-auto-flow:row!grid-flow-col|grid-auto-flow:column!grid-flow-row-dense|grid-auto-flow:row dense!grid-flow-col-dense|grid-auto-flow:column dense!min-w-full|min-width:100%!max-w-full|max-width:100%!max-w-screen-sm|max-width:640px!max-w-screen-md|max-width:768px!max-w-screen-lg|max-width:1024px!max-w-screen-xl|max-width:1280px!max-w-none|max-width:none!min-h-full|min-height:100%!min-h-screen|min-height:100vh!max-h-full|max-height:100%!max-h-screen|max-height:100vh!text-2xl|font-size:1.5rem!text-3xl|font-size:1.875rem!text-4xl|font-size:2.25rem!underline|text-decoration:underline!line-through|text-decoration:line-through!no-underline|text-decoration:none!uppercase|text-transform:uppercase!lowercase|text-transform:lowercase!capitalize|text-transform:capitalize!normal-case|text-transform:none!whitespace-no-wrap|white-space:nowrap!break-normal|word-break:normal;overflow-wrap:normal!break-words|overflow-wrap:break-word!break-all|word-break:break-all!truncate|overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap!h-auto|height:auto!max-w-2xl|max-width:42rem!tracking-tighter|letter-spacing:-0.05em!tracking-tight|letter-spacing:-0.025em!tracking-normal|0!tracking-wide:letter-spacing:0.025em!tracking-wider|letter-spacing:0.05em!tracking-widest|letter-spacing: 0.1em!leading-none|line-height:1!leading-tight|line-height:1.25!leading-snug|line-height:1.375!leading-normal|line-height:1.5!leading-relaxed|line-height:1.625!leading-loose|line-height:2!list-none|list-style-type:none!list-disc|list-style-type:disc!list-decimal|list-style-type:decimal!list-inside|list-style-position:inside!list-outside|list-style-position:outside!border|border-width:1px!border-collapse|border-collapse:collapse!border-separate|border-collapse:separate!table-auto|table-layout:auto!table-fixed|table-layout:fixed!appearance-none|-webkit-appearance:none;-moz-appearance:none;appearance:none!outline-none|outline:0!resize-none|resize:none!resize|resize:both!resize-y|resize:vertical!resize-x|resize:horizontal!fill-current|fill:currentColor!stroke-current|stroke:currentColor!sr-only|position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0!not-sr-only|position:static;width:auto;height:auto;padding:0;margin:0;overflow:visible;clip:auto;white-space:normal!font-sans|font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji!font-serif|font-family:Georgia,Cambria,"Times New Roman",Times,serif!font-mono|font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace!sticky|position:-webkit-sticky;position:sticky')){let[a,n]=t.split("|");Ct[a]=n}for(let t of Ce("float-right!float-left!float-none!clear-left!clear-right!clear-both!clear-none"))Ct[t]=t.replace("-",":");for(let t of Ce("block!flow-root!inline-block!inline!flex!grid!inline-grid!table!table-caption!table-cell!table-column!table-column-group!table-footer-group!table-header-group!table-row-group!table-row")){let a=t;t==="flex"?a="-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex":t==="inline-flex"?a="-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex":t==="grid"?a="-ms-grid;display:grid":t==="inline-grid"&&(a="-ms-inline-grid;display:inline-grid"),Ct[t]="display:"+a}for(let t of Ce("static!fixed!absolute!relative"))Ct[t]="position:"+t;let Un=Ce("f7fafc!edf2f7!e2e8f0!cbd5e0!a0aec0!718096!4a5568!2d3748!1a202c!fff5f5!fed7d7!feb2b2!fc8181!f56565!e53e3e!c53030!9b2c2c!742a2a!fffaf0!feebc8!fbd38d!f6ad55!ed8936!dd6b20!c05621!9c4221!7b341e!fffff0!fefcbf!faf089!f6e05e!ecc94b!d69e2e!b7791f!975a16!744210!f0fff4!c6f6d5!9ae6b4!68d391!48bb78!38a169!2f855a!276749!22543d!e6fffa!b2f5ea!81e6d9!4fd1c5!38b2ac!319795!2c7a7b!285e61!234e52!ebf8ff!bee3f8!90cdf4!63b3ed!4299e1!3182ce!2b6cb0!2c5282!2a4365!ebf4ff!c3dafe!a3bffa!7f9cf5!667eea!5a67d8!4c51bf!434190!3c366b!faf5ff!e9d8fd!d6bcfa!b794f4!9f7aea!805ad5!6b46c1!553c9a!44337a!fff5f7!fed7e2!fbb6ce!f687b3!ed64a6!d53f8c!b83280!97266d!702459"),qn=Ce("gray!red!orange!yellow!green!teal!blue!indigo!purple!pink"),Gn=Ce("none!sm!nm!md!lg!full"),Dt=De({l:"left",r:"right",t:"top",b:"bottom"}),dt=t=>{if(M==="opacity"&&se(k))A=`--${t}-opacity:`+(k==="100"?"1":k/100);else{let a=Rn.get(O);if(a)k&&Bn(a)&&(a=a[k]);else if(k){let n=qn.indexOf(M);a=Un[n*9+(Number(k[0])-1)]}else if(M&&M.startsWith("#"))try{a=In(M)}catch{}if(a){let n=t+`:rgba(${parseInt(a.slice(0,2),16)},${parseInt(a.slice(2,4),16)},${parseInt(a.slice(4,6),16)},var(--${t}-opacity,1))`;A=t+`:#${a};`+n}else M==="current"?A=t+":currentColor":A=t+":"+O}},ut=()=>{if(!At&&(K("auto!initial!inherit",Ae)||ue(Ae))){let t=Xe+Ae;k?(ve=1,M==="y"?A=`top:${t};bottom:`+t:M==="x"&&(A=`left:${t};right:`+t)):M&&(lt==="inset"?A=`top:${t};right:${t};bottom:${t};left:`+t:(ve=2,A=lt+":"+t))}},bn=()=>{let t;se(M)?t=M+"ms":ue(M)&&(t=M),t&&(A=`-webkit-transition-${lt}:${t};-o-transition-${lt}:${t};transition-${lt}:`+t)},gr=De({object:()=>{K("contain!cover!fill!none!bottom",O)?A=`-o-object-fit:${O};object-fit:`+O:K("bottom!center!left!left-bottom!left-top!right!right-bottom!right-top!top",O)&&(O=O.replace("-"," "),A=`-o-object-position:${O};object-position:`+O)},overflow:()=>{K("x!y",M)&&(ve=1),A=zn+":"+Ae},clearfix:()=>{Hn="clearfix::after",A='content:"";display:table;clear:both'},text:()=>{let t=Ft("xs!sm!base!lg!xl",M);if(t>-1)A=`font-size:${.75+.125*t}rem`;else if(M.endsWith("xl")){let[a]=M.split("x");se(a)&&(A=`font-size:${Number(a)-2}rem`)}else K("left!center!right!justify",O)?A="text-align:"+O:dt("color")},font:()=>{let t=Ft("hairline!thin!light!normal!medium!semibold!bold!extrabold!black",M);t>-1?A="font-weight:"+100*(1+t):se(M)&&(A="font-weight:"+M)},whitespace:()=>{K("normal!pre!pre-line!pre-wrap",O)&&(A="white-space:"+O)},inset:ut,top:ut,right:ut,bottom:ut,left:ut,flex:()=>{let t=(a,n=1,s="0%")=>`-webkit-box-flex:${a};-ms-flex:${a} ${n} ${s};flex:${a} ${n} `+s;if(K("row!row-reverse!col!col-reverse",O))O=O.replace("col","column"),A=`-webkit-box-orient:${M==="row"?"horizontal":"vertical"};-webkit-box-direction:${k==="reverse"?k:"normal"};-ms-flex-direction:${O};flex-direction:${O}`;else if(K("no-wrap!flex-wrap!wrap-reverse",O))O==="no-wrap"&&(O="nowrap"),A=`-ms-flex-wrap:${O};flex-wrap:${O}`;else if(K("grow!shrink",M)){ve=1;let a=k||1;M==="grow"?A=`-webkit-box-flex:${a};-ms-flex-positive:${a};flex-grow:${a}`:A=`-ms-flex-negative:${a};flex-shrink:${a}`}else O==="initial"?A=t(0,1,"auto"):O==="auto"?A=t(1,1,"auto"):O==="none"?A="-webkit-box-flex:0;-ms-flex:none;flex:none":At?A=t(M,k,At):k?A=t(M,k):A=t(M)},order:()=>{if(se(M)){let t=Xe+M;A=`-webkit-box-ordinal-group:${Number(t)+1};-ms-flex-order:${t};order:`+t}},grid:()=>{se(k)&&(A=De({cols:`-ms-grid-columns:(minmax(0,1fr))[${k}];grid-template-columns: repeat(${k}, minmax(0, 1fr))`,span:`-ms-grid-column-span:${k};grid-column: span ${k} / span `+k,start:`-ms-grid-column:${k};grid-column-start:`+k,end:`-ms-grid-column-span:${k};grid-column-end:`+k,rows:`-ms-grid-rows:(minmax(0,1fr))[${k}];grid-template-rows: repeat(${k}, minmax(0, 1fr))`})[M])},row:()=>{ue(k)&&(A=De({span:`-ms-grid-row-span:${k};grid-row: span ${k} / span ${k}`,start:`-ms-grid-row:${k};grid-row-start:`+k,end:`-ms-grid-row-span:${k};grid-row-end:`+k,gap:"row-gap:"+st(k)})[M])},col:()=>{if(se(k)&&(M==="span"?A=`-ms-grid-column-span:${k};grid-column:span ${k} / span ${k};`:M==="start"?A=`-ms-grid-column:${k};grid-column-start:${k}`:M==="end"&&(A=`-ms-grid-column-span:${k};grid-column-end:${k}`)),ue(k)&&M==="gap"){let t=k==="px"?"1px":st(k);A=`-webkit-column-gap:${t};-moz-column-gap:${t}column-gap:`+t}},gap:()=>{ue(M)&&(A="gap:"+st(M))},space:()=>{if(Bt=[">:not(template)~:not(template)"],k==="px"&&(k="1px"),k)if(ue(k)){let t=st(k);M==="x"?A=`margin-right:calc(${t}*var(--space-x-reverse,0));margin-left:calc(${t}*(1 - var(--space-x-reverse,0)))`:M==="y"&&(A=`margin-top:calc(${t}*(1 - var(--space-y-reverse,0)));margin-bottom:calc(${t}*var(--space-y-reverse,0))`)}else k==="reverse"&&(A=`--space-${M}-reverse:1`)},divide:()=>{if(Bt=[">:not(template)~:not(template)"],ve=1,!At){let t;se(k)?t=k+"px":ue(k)?t=k:k==="reverse"?A=`--divide-${M}-reverse:1`:M&&(t="1px"),t&&(M==="y"?A=`border-top-width:calc(${t}*calc(1 - var(--divide-y-reverse,0)));border-bottom-width:calc(${t}*var(--divide-y-reverse,0)))`:M==="x"&&(A=`border-right-width:calc(${t}*var(--divide-x-reverse,0));border-left-width:calc(${t}*calc(1 - var(--divide-x-reverse,0)))`))}A||dt("border-color")},min:()=>{if(ue(k)&&(M==="w"||M==="h")){let t=M==="w"?"width":"height";A=`min-${t}:`+k}},max:()=>{if(M==="w"){let t=Ft("xs!sm!md!lg!xl",k);t>-1?A=`max-width:${t*4+20}rem`:ue(k)&&(k.endsWith("xl")?A=`max-width:${parseInt(k)*8+24}rem`:A="max-width:"+k)}else M==="h"&&ue(k)&&(A="max-height:"+k)},tracking:()=>{ue(M)&&(A="letter-spacing:"+M)},leading:()=>{se(M)?A=`line-height:${Number(M)*.25}rem`:ue(M)&&(A="line-height:"+M)},placeholder:()=>{Bt.push("::placeholder"),dt("color")},align:()=>{K("baseline!top!middle!bottom!text-top!text-bottom",O)&&(A="vertical-align:"+O)},bg:()=>{O=O.replace("-"," "),K("bottom!center!left!left bottom!left top!right!right bottom!right top!top",O)?A="background-position:"+O:K("repeat!no-repeat!repeat-x!repeat-y",O)?A="background-repeat:"+O:K("repeat-round!repeat-space",O)?A="background-repeat:"+k:K("auto!cover!contain",O)?A="background-size:"+O:K("fixed!local!scroll",M)?A="background-attachment:"+M:dt("background-color")},rounded:()=>{let t,a=Gn.indexOf(Ae);if(ue(Ae)?(t=Ae,a=9):a===5?t="9999px":a>-1?t=a*.125+"rem":(!M||Dt[M]||K("t!b",M[0])&&K("r!l",M[1]))&&(t="0.25rem"),t){let n=Dt[M[0]];!M||!k&&a>-1?A="border-radius:"+t:K("t!b",M)?(ve=1,A=`border-${n}-left-radius:${t};border-${n}-right-radius:`+t):K("l!r",M)?(ve=1,A=`border-top-${n}-radius:${t};border-bottom-${n}-radius:`+t):(ve=2,A=`border-${n}-${Dt[M[1]]}-radius:`+t)}},border:()=>{let t=Dt[M];k&&t?se(k)?(ve=1,A=`border-${t}-width:${k}px`):ue(k)&&(A=`border-${t}-width:`+k):K("solid!dashed!dotted!double!none",M)?A="border-style:"+M:t?(ve=1,A=`border-${t}-width:1px`):se(M)?A=`border-width:${M}px`:ue(M)?A="border-width:"+M:dt("border-color")},opacity:()=>{se(M)&&(A="opacity:"+M/100)},transition:()=>{let t=n=>`-webkit-transition-property:${n};-o-transition-property:${n};transition-property:`+n,a=n=>`-webkit-transition-property:-webkit-${n};transition-property:-webkit-${n};-o-transition-property:${n};transition-property:${n};transition-property:${n},-webkit-${n}`;M?M==="colors"?A=t("background-color,border-color,color,fill,stroke"):M==="shadow"?A=a("box-shadow"):M==="transform"?A=a("transform"):M&&(A=t(M)):(A="-webkit-transition-property:S-webkit-box-shadow,-webkit-transform;transition-property:S-webkit-box-shadow,-webkit-transform;-o-transition-property:Sbox-shadow,transform;transition-property:Sbox-shadow,transform;transition-property:Sbox-shadow,transform,-webkit-box-shadow,-webkit-transform",A=A.replace(/S/g,"background-color,border-color,color,fill,stroke,opacity,"))},duration:bn,delay:bn,ease:()=>{let t=a=>`-webkit-transition-timing-function:${a};-o-transition-timing-function:${a};transition-timing-function:${a}`;O==="in"?A=t("cubic-bezier(0.4,0,1,1)"):O==="out"?A=t("cubic-bezier(0,0,0.2,1)"):O==="in-out"?A=t("cubic-bezier(0.4,0,0.2,1)"):O==="linear"&&(A=t("linear"))},scale:()=>{if(se(Ae)){let t=Ae/100;K("x!y",M)?(ve=1,A=`--transform-scale-${M}:`+t):A=`--transform-scale-x:${t};--transform-scale-y:`+t}},rotate:()=>{se(M)&&(A=`--transform-rotate:${Xe}${M}deg`)},translate:()=>{if(K("x!y",M)){if(k==="px")k="1px";else if(k==="full")k="100%";else if(k.includes("/")){let t=k.split("/");t.length===2&&(k=Number(t[0])/Number(t[1])+"%")}ue(k)&&(A=`--transform-translate-${M}:`+st(k))}},skew:()=>{K("x!y",M)&&se(k)&&(A=`--transform-skew-${M}:${Xe+k}deg`)},transform:()=>{let t="translatex(var(--transform-translate-x,0))translatey(var(--transform-translate-y,0))rotate(var(--transform-rotate,0))skewx(var(--transform-skew-x,0))skewy(var(--transform-skew-y,0))scalex(var(--transform-scale-x,1))scaley(var(--transform-scale-y,1))";A=`-webkit-transform:${t};-ms-transform:${t};transform:`+t},origin:()=>{K("center!top!top-right!right!bottom-right!bottom!bottom-left!left!top-left",O)&&(O=O.replace("-"," "),A=`-webkit-transform-origin:${O};-ms-transform-origin:${O};transform-origin:`+O)},cursor:()=>{K("auto!default!pointer!wait!text!move!not-allowed",O)&&(A="cursor:"+O)},shadow:()=>{let t=De({xs:"0 0 0 1pxR.05)",sm:"0 1px 2px 0R.05)","":"0 1px 3px 0R.1), 0 1px 2px 0R.06)",md:"0 4px 6px -1pxR.1), 0 2px 4px -1pxR.06)",lg:"0 10px 15px -3pxR.1), 0 4px 6px -2pxR.05)",xl:"0 20px 25px -5pxR.1), 0 10px 10px -5pxR.04)","2xl":"0 25px 50px -12pxR.25)",inner:"inset 0 2px 4px 0R.06)",outline:"0 0 0 3px rgba(66, 153, 225, 0.5)",none:"none"}),a=t[M];a&&(a=a.replace(/R/g," rgba(0, 0, 0, 0"),A=`-webkit-box-shadow:${a};box-shadow:`+a)},outline:()=>{M&&(A="outline:"+O.replace("-"," "))},pointer:()=>{M&&(A="pointer-events:"+M)},select:()=>{K("none!auto!text!contain!all!inherit!initial!unset",O)&&(A=`-webkit-user-select:${O};-moz-user-select:${O};-ms-user-select:${O};user-select:`+O)},fill:()=>{M&&(A="fill:"+M)},stroke:()=>{se(M)?A="stroke-width:"+M:M&&(A="stroke:"+M)},items:()=>{K("stretch!start!center!end!baseline",O)&&(A=`-webkit-box-align:${O};-ms-flex-align:${O};align-items:`+(K("start!end",O)?"flex-":"")+O)},content:()=>{if(K("start!center!end!between!around")){let t=O;K("start!end",O)?O="flex-"+O:O==="between"?(t="justify",O="space-"+O):O==="around"&&(t="distribute",O="space-"+O),A=`-ms-flex-line-pack:${t};align-content:`+O}},self:()=>{if(K("auto!start!center!end!stretch",O)){let t=`-ms-grid-row-align:${O};`,a=O;K("start!end",O)&&(O="flex-"+O,t=""),A=`-ms-flex-item-align:${a};${t}align-self:`+O}},justify:()=>{if(K("start!center!end!between!around",O)){let t=O;t==="between"?(t="justify",O="space-"+O):K("start!end")&&(O="flex-"+O);let a=`-webkit-box-pack:${t};`;t==="around"&&(t="distribute",O="space-"+O,a=""),A=a+`-ms-flex-pack:${t};justify-content:`+O}}}),lt,M,k,At,Ae,zn,O,Xe,A,Bt,ve,hr=new Map,br=De({"::placeholder":"::-webkit-input-P!::-moz-P!:-ms-input-P!::-ms-input-P".replace(/P/g,"placeholder"),"::selection":":::-moz-selection"});class he{static init=function(){console.log("%cin initUI",C),he.build();var t=new Draggabilly(".draggable",{handle:".handle"});GM_config.get("hackheaderzindex")===!0&&Wn.start("animation-target")};static build=function(){console.log("%c in buildUI","background-color:green;color:white"),GM_addStyle(".flex > * { margin: 2px 1px; }"),GM_addStyle(".flex > :first-child { margin-left: 0; }"),GM_addStyle(".flex > :last-child { margin-right: 0; }"),GM_addStyle(".panel {display: flex; justify-content: center;z-index:999}"),GM_addStyle(".menuBar {border-top: 1px solid; padding: 10px; font-size: 1rem; pointer-events: inherit;position: relative;top:0px;  flex-flow: row wrap;/*align-content: space-between;justify-content: space-between;*/}"),GM_addStyle(".draggable {background: transparent;border-radius: 10px;padding: 20px;}"),GM_addStyle(".draggable.is-pointer-down {background: #09F;}"),GM_addStyle(".draggable.is-dragging { opacity: 0.7; }"),GM_addStyle(".handle {background: #555;background: hsla(0, 0%, 0%, 0.4);width: 20px;height: 20px; border-radius: 10px;}"),GM_addStyle(".flex > :nth-last-child(2) {page-break-after: always; /* CSS 2.1 syntax */break-after: always; /* New syntax */}"),GM_addStyle("#animation-target {width: 10px;height: 5px;background-color:coral;border-radius: 25%;}");var t=document.createElement("div"),a=document.createElement("div");if(a.classList.add("handle"),t.appendChild(a),t.classList.add("panel","menuBar","flex","draggable"),document.body.appendFirst(t),he.addButton("collectChecked",un,{},t),he.addButton("CollectAuto",ln,{},t),he.addButton("showBill",pn,{},t),he.addButton("billInDetails",dn,{},t),he.addButton("PDF",fn,{},t),he.addButton("SList",de.showList,{},t),he.addButton("DbgMode",cn,{},t),he.addButton("statistics",gn,{},t),he.addButton("Database",mn,{},t),he.addButton("about",sn,{},t),GM_config.get("hackheaderzindex")===!0){var n=document.createElement("div");n.id="animation-target",t.appendChild(n)}};static addButton=function(t,a,n,s){s=s||document.body,n=n||{position:"absolute",bottom:"7%",left:"4%","z-index":3};let e=document.createElement("button"),o=e.style;return e.classList.add("button--primary","button"),s.appendChild(e),e.innerHTML=t,e.onclick=a,Object.keys(n).forEach(l=>o[l]=n[l]),e}}class Wn{static start=function(t){const a=document.getElementById(t),n=g=>a.style.transform=`translateX(${g}px)`;let s=0;const e=7,o=g=>{n(s),s+=e,s>100?requestAnimationFrame(l):requestAnimationFrame(o)},l=g=>{n(s),s-=e,s<-100?requestAnimationFrame(o):requestAnimationFrame(l)};return requestAnimationFrame(o)};static stop=function(t){window.cancelAnimationFrame(t)}}var zt=he;const Vn="#OCAddonsCfg {background-color: lightblue;} #OCAddonsCfg .reset_holder {float: left; position: relative; bottom: -1em;} #OCAddonsCfg .saveclose_buttons {margin: .7em;}",Zn="height: 16.7em; width: 30em; border: 1px solid; border-radius: 3px; position: fixed; z-index: 999;",Wt={id:"OCAddonsCfg",title:"Configuration du module",fields:{nbHrsAfM:{section:["Statistiques","paramètres"],label:"Nombre de minutes pour une session d'étudiant auto financé",title:"Durée moyenne d'une session AF (calcul du THM)",labelPos:"left",type:"input",default:30},nbHrsfM:{label:"Nombre de minutes pour une session d'étudiant financé",title:"Durée moyenne d'une session Financée (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsS:{label:"Nombre de minutes pour une session (avant 01/07/2020)",title:"Durée moyenne d'une session avant la séparation auto financé | financé (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsD:{label:"Nombre de minutes pour une session de soutenance",title:"Durée moyenne d'une sessionde soutenance AF (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsC:{label:"Nombre de minutes pour une session de coaching",title:"Durée moyenne d'une session de coachine (calcul du THM)",labelPos:"left",type:"input",default:45},maxfetchpg:{section:["Application","optimisation"],label:"Maximum de page recherchées dans l'historique",labelPos:"left",type:"input",default:1e3},datacachelifetime:{label:"Temps de conservation des données dans le cache (en ms)",labelPos:"left",type:"input",default:12e4},checksessionalreadyexists:{section:["Application","Base de donnée"],label:"sessions: vérifier existence avant insertion",labelPos:"left",type:"checkbox",default:!0},sizeofcontentlist:{section:["Interface","thème"],label:"taille de la police des listes",labelPos:"left",type:"input",default:"1em;"},use_custom_css:{label:"utiliser des styles personnalisés",labelPos:"left",type:"checkbox",default:!1},custom_css_url:{label:"url de la feuille de style (si plusieurs les séparer par des virgules)",labelPos:"left",type:"input",default:""},custom_css_data:{label:"saisir ici le code css à injecter directement dans la page",title:"Je me demande bien à quoi sert le titre",labelPos:"left",type:"input",default:""},alwaysaddcbox:{section:["Interface","Gadget"],label:"Toujours ajouter les checkbox sur l'interface",labelPos:"left",type:"checkbox",default:!0},show_throttle:{label:"Afficher le temoin d'utilisation du CPU",title:"Affiche le point rouge qui circule dans la barre de menu. Quand il s'arrête le CPU est utilisé",labelPos:"left",type:"checkbox",default:!0},hackheaderzindex:{section:["","Hack"],label:"Changer le zindex du bandeau haut",title:"le bandeau haut à un z-index  (1000) qui le place au dessus de tout ce qui est présent à l'écran, ce qui gêne la barre de menu ; activer cette option réduit ce chiffre à 0",labelPos:"left",type:"checkbox",default:!0},support:{section:["","Support"],label:"StephaneTy-Pro.github.io",title:"more info on https://github.com/StephaneTy-Pro",type:"button",click:()=>{GM_openInTab("https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon",{active:!0,insert:!0,setParent:!0})}}},css:Vn,events:{save:function(){GM_config.close()}}};var Vt=function(){GM_config.open(),OCAddonsCfg.style=Zn};class Jn{static longTaskTiming=function(){if(window.self!==window.top)return;console.log("LongTasks: Initializing");var t=new window.PerformanceObserver(function(a){for(var n=a.getEntries(),s=0;s<n.length;s++)console.log("LongTasks: ",n[s].name,n[s].duration,n[s].attribution.length,n[s].attribution.length>0?n[s].attribution[0].containerType:null,n[s].attribution.length>0?n[s].attribution[0].containerName:null,n[s].attribution.length>0?n[s].attribution[0].containerSrc:null,n[s].attribution.length>0?n[s].attribution[0].containerId:null,n[s])});typeof window.PerformanceLongTaskTiming!="undefined"?console.log("LongTasks: Appears to be supported"):console.log("LongTasks: Not supported");try{t.observe({entryTypes:["longtask"]})}catch(a){console.log("LongTasks: Not supported")}};static paintTiming=function(){if(window.self!==window.top)return;console.log("PaintTiming: Initializing");var t=new window.PerformanceObserver(function(a){for(var n=a.getEntries(),s=0;s<n.length;s++)console.log("PaintTiming: ",n[s].name,n[s].startTime)});if(typeof window.PerformancePaintTiming!="undefined")console.log("PaintTiming: Appears to be supported");else{console.log("PaintTiming: Not supported");return}try{t.observe({entryTypes:["paint"],buffered:!0})}catch(a){console.log("PaintTiming: Not supported")}}}var jt=Jn;const It=function(t,a,n,s,e,o,l){o=a.createElement(n),l=a.getElementsByTagName(n)[0],o.appendChild(a.createTextNode(s.text)),o.onload=e(s),l?l.parentNode.insertBefore(o,l):a.head.appendChild(o)};const Qn=function(t,a){if(!arguments.length)return Promise.reject(new ReferenceError("Failed to execute 'fetchInject': 1 argument required but only 0 present."));if(arguments[0]&&arguments[0].constructor!==Array)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 1 must be of type 'Array'."));if(arguments[1]&&arguments[1].constructor!==Promise)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 2 must be of type 'Promise'."));const n=[],s=a?[].concat(a):[],e=[];return t.forEach(o=>s.push(window.fetch(o).then(l=>[l.clone().text(),l.blob()]).then(l=>Promise.all(l).then(g=>{n.push({text:g[0],blob:g[1]})})))),Promise.all(s).then(()=>(n.forEach(o=>{e.push({then:l=>{o.blob.type.includes("text/css")?It(window,document,"style",o,l):It(window,document,"script",o,l)}})}),Promise.all(e)))};var it=Qn;var Ca=function(t,a,n){"use strict";if(!t.MutationObserver||typeof HTMLElement=="undefined")return;var s=0,e=function(){var f=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(p,m){return p instanceof HTMLElement&&f.call(p,m)},addMethod:function(p,m,j){var T=p[m];p[m]=function(){if(j.length==arguments.length)return j.apply(this,arguments);if(typeof T=="function")return T.apply(this,arguments)}},callCallbacks:function(p,m){m&&m.options.onceOnly&&m.firedElems.length==1&&(p=[p[0]]);for(var j=0,T;T=p[j];j++)T&&T.callback&&T.callback.call(T.elem,T.elem);m&&m.options.onceOnly&&m.firedElems.length==1&&m.me.unbindEventWithSelectorAndCallback.call(m.target,m.selector,m.callback)},checkChildNodesRecursively:function(p,m,j,T){for(var E=0,w;w=p[E];E++)j(w,m,T)&&T.push({callback:m.callback,elem:w}),w.childNodes.length>0&&e.checkChildNodesRecursively(w.childNodes,m,j,T)},mergeArrays:function(p,m){var j={},T;for(T in p)p.hasOwnProperty(T)&&(j[T]=p[T]);for(T in m)m.hasOwnProperty(T)&&(j[T]=m[T]);return j},toElementsArray:function(p){return typeof p!="undefined"&&(typeof p.length!="number"||p===t)&&(p=[p]),p}}}(),o=function(){var f=function(){this._eventsBucket=[],this._beforeAdding=null,this._beforeRemoving=null};return f.prototype.addEvent=function(p,m,j,T){var E={target:p,selector:m,options:j,callback:T,firedElems:[]};return this._beforeAdding&&this._beforeAdding(E),this._eventsBucket.push(E),E},f.prototype.removeEvent=function(p){for(var m=this._eventsBucket.length-1,j;j=this._eventsBucket[m];m--)if(p(j)){this._beforeRemoving&&this._beforeRemoving(j);var T=this._eventsBucket.splice(m,1);T&&T.length&&(T[0].callback=null)}},f.prototype.beforeAdding=function(p){this._beforeAdding=p},f.prototype.beforeRemoving=function(p){this._beforeRemoving=p},f}(),l=function(f,p){var m=new o,j=this,T={fireOnAttributesModification:!1};return m.beforeAdding(function(E){var w=E.target,z;(w===t.document||w===t)&&(w=document.getElementsByTagName("html")[0]),z=new MutationObserver(function(v){p.call(this,v,E)});var S=f(E.options);z.observe(w,S),E.observer=z,E.me=j}),m.beforeRemoving(function(E){E.observer.disconnect()}),this.bindEvent=function(E,w,z){w=e.mergeArrays(T,w);for(var S=e.toElementsArray(this),v=0;v<S.length;v++)m.addEvent(S[v],E,w,z)},this.unbindEvent=function(){var E=e.toElementsArray(this);m.removeEvent(function(w){for(var z=0;z<E.length;z++)if(this===n||w.target===E[z])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function(E){var w=e.toElementsArray(this),z=E,S;typeof E=="function"?S=function(v){for(var $=0;$<w.length;$++)if((this===n||v.target===w[$])&&v.callback===z)return!0;return!1}:S=function(v){for(var $=0;$<w.length;$++)if((this===n||v.target===w[$])&&v.selector===E)return!0;return!1},m.removeEvent(S)},this.unbindEventWithSelectorAndCallback=function(E,w){var z=e.toElementsArray(this);m.removeEvent(function(S){for(var v=0;v<z.length;v++)if((this===n||S.target===z[v])&&S.selector===E&&S.callback===w)return!0;return!1})},this},g=function(){var f={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function p(E){var w={attributes:!1,childList:!0,subtree:!0};return E.fireOnAttributesModification&&(w.attributes=!0),w}function m(E,w){E.forEach(function(z){var S=z.addedNodes,v=z.target,$=[],Y;S!==null&&S.length>0?e.checkChildNodesRecursively(S,w,j,$):z.type==="attributes"&&(j(v,w,$)&&$.push({callback:w.callback,elem:v})),e.callCallbacks($,w)})}function j(E,w,z){return e.matchesSelector(E,w.selector)&&(E._id===n&&(E._id=s++),w.firedElems.indexOf(E._id)==-1)?(w.firedElems.push(E._id),!0):!1}d=new l(p,m);var T=d.bindEvent;return d.bindEvent=function(E,w,z){typeof z=="undefined"?(z=w,w=f):w=e.mergeArrays(f,w);var S=e.toElementsArray(this);if(w.existing){for(var v=[],$=0;$<S.length;$++)for(var Y=S[$].querySelectorAll(E),X=0;X<Y.length;X++)v.push({callback:z,elem:Y[X]});if(w.onceOnly&&v.length)return z.call(v[0].elem,v[0].elem);setTimeout(e.callCallbacks,1,v)}T.call(this,E,w,z)},d},u=function(){var f={};function p(){var E={childList:!0,subtree:!0};return E}function m(E,w){E.forEach(function(z){var S=z.removedNodes,v=[];S!==null&&S.length>0&&e.checkChildNodesRecursively(S,w,j,v),e.callCallbacks(v,w)})}function j(E,w){return e.matchesSelector(E,w.selector)}i=new l(p,m);var T=i.bindEvent;return i.bindEvent=function(E,w,z){typeof z=="undefined"?(z=w,w=f):w=e.mergeArrays(f,w),T.call(this,E,w,z)},i},d=new g,i=new u;function h(f,p,m){e.addMethod(p,m,f.unbindEvent),e.addMethod(p,m,f.unbindEventWithSelectorOrCallback),e.addMethod(p,m,f.unbindEventWithSelectorAndCallback)}function x(f){f.arrive=d.bindEvent,h(d,f,"unbindArrive"),f.leave=i.bindEvent,h(i,f,"unbindLeave")}a&&x(a.fn),x(HTMLElement.prototype),x(NodeList.prototype),x(HTMLCollection.prototype),x(HTMLDocument.prototype),x(Window.prototype);var c={};return h(d,c,"unbindAllArrive"),h(i,c,"unbindAllLeave"),c}(window,typeof jQuery=="undefined"?null:jQuery,void 0);ge();})();
/**
 * Fetch Inject module.
 *
 * @module fetchInject
 * @license Zlib
 * @param {(USVString[]|Request[])} inputs Resources you wish to fetch.
 * @param {Promise} [promise] A promise to await before attempting injection.
 * @throws {Promise<ReferenceError>} Rejects with error when given no arguments.
 * @throws {Promise<TypeError>} Rejects with error on invalid arguments.
 * @throws {Promise<Error>} Whatever `fetch` decides to throw.
 * @throws {SyntaxError} Via DOM upon attempting to parse unexpected tokens.
 * @returns {Promise<Object[]>} A promise which resolves to an `Array` of
 *     Objects containing `Response` `Body` properties used by the module.
 */
//# sourceMappingURL=app-facturier.min.js.map
