// ==UserScript==
// @name         Facturier
// @namespace    http://tampermonkey.net/
// @version      1.10.0008
// @description  Un addon pour vous aider dans votre facturation
// @author       Stéphane TORCHY
// @updateURL    https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/dist/app.min.js
// @downloadURL  https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/dist/app.min.js
// @icon         https://mirrors.creativecommons.org/presskit/icons/heart.red.png
// multiple usage
// @match        https://openclassrooms.com/fr/mentorship/dashboard/mentorship-sessions-history*
// @match        https://openclassrooms.com/fr/mentorship/dashboard/sessions
// @match        https://openclassrooms.com/fr/mentorship/dashboard/booked-mentorship-sessions

// Start at document start https://www.tampermonkey.net/documentation.php#_run_at
// @run-at document-start   

// @grant        unsafeWindow
// @grant        GM_addStyle
// @grant        GM_getResourceText
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        GM.xmlHttpRequest
// @grant        GM_notification

// @require      https://cdn.jsdelivr.net/npm/lodash@4.17.19/lodash.min.js
// @require      https://unpkg.com/lowdb@0.17/dist/low.min.js
// @require      https://unpkg.com/lowdb@0.17/dist/LocalStorage.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/dayjs.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/locale/fr.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isBetween.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isSameOrBefore.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isSameOrAfter.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/customParseFormat.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/localeData.min.js


//// GM_Compat : Portable monkey-patching for userscripts  
// SRC 				https://github.com/chocolateboy/gm-compat
// permet notamment d'utiliser GMCompat.unsafeWindow.notify('loaded', { value: 42 }) sous chrome
// @require       	https://unpkg.com/gm-compat@1.1.0 

//// GM_Config
// SRC 			https://github.com/sizzlemctwizzle/GM_config/wiki
// require      https://openuserjs.org/src/libs/sizzle/GM_config.js (cassé ce jour 28/08/2020);
// @require      https://raw.githubusercontent.com/sizzlemctwizzle/GM_config/master/gm_config.js

//// sweetalert 2
// require      https://cdn.jsdelivr.net/npm/sweetalert2@9/dist/sweetalert2.all.min.js
// @require      https://cdn.jsdelivr.net/npm/sweetalert2@10

//// draggabilly
// @require      https://cdnjs.cloudflare.com/ajax/libs/draggabilly/2.2.0/draggabilly.pkgd.min.js

//// toastify 
// @require     https://cdn.jsdelivr.net/npm/toastify-js@1.8.0/src/toastify.min.js
// @resource    toastifycss https://raw.githubusercontent.com/apvarun/toastify-js/master/src/toastify.css

// https://github.com/uzairfarooq/arrive --> included manually
// require     https://raw.githubusercontent.com/uzairfarooq/arrive/master/minified/arrive.min.js

////simple-datatables
//// https://github.com/fiduswriter/Simple-DataTables
// @require     https://cdn.jsdelivr.net/npm/simple-datatables@latest
// @resource    simpledatatablecss https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css


//// MEMOIZATION
//// TODO : check best function
// require https://raw.githubusercontent.com/anywhichway/nano-memoize/master/dist/nano-memoize.min.js
// https://github.com/planttheidea/moize#usage
// @require https://cdn.jsdelivr.net/npm/moize@5.4.7/dist/moize.min.js
// require https://cdn.jsdelivr.net/npm/moize@6.0.2/dist/moize.min.js -> probleme 20210701
// require https://cdn.jsdelivr.net/npm/moize@6.0.3/dist/moize.min.js -> probleme 20210701
// USAGE OF https://caolan.github.io/async/v3/docs.html
// FONCTIONNE PAS require https://cdn.jsdelivr.net/npm/async@3.2.0/memoize.min.js probleme export
// @require https://cdn.jsdelivr.net/npm/async@3.2.0/dist/async.min.js
// TOTEST https://github.com/sindresorhus/p-memoize
// Ne fonctionne pasrequire https://cdn.skypack.dev/p-memoize

//// FETCH INJECT --> included manually
// require https://cdn.jsdelivr.net/npm/fetch-inject

//// PARSER MKDOWN
// @require 	 https://cdn.jsdelivr.net/npm/showdown@1.9.1/dist/showdown.min.js

//// PDF https://pdf-lib.js.org/docs/api/
// @require      https://unpkg.com/pdf-lib@1.9.0/dist/pdf-lib.min.js
// @require      https://unpkg.com/downloadjs@1.4.7/download.js

//// HTMX https://htmx.org --> included dynamically
// require https://unpkg.com/htmx.org@1.1.0/dist/htmx.min.js

//// ALPINE JS --> included dynamically
// require https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.js


// ProgressBar 
// https://loading.io/progress/
// require https://raw.githubusercontent.com/loadingio/loading-bar/master/dist/loading-bar.js
// resource loading_barcss https://raw.githubusercontent.com/loadingio/loading-bar/master/dist/loading-bar.css
// @require https://loadingio.github.io/loading-bar/dist/loading-bar.js
// @resource loading_barcss https://loadingio.github.io/loading-bar/dist/loading-bar.min.css

// https://www.cssscript.com/demo/text-progress-bar-ascii-loader/
// https://github.com/kimmobrunfeldt/progressbar.js - fonctionne mais probleme avec le easing dans mon popup progress bar
// require https://raw.githubusercontent.com/kimmobrunfeldt/progressbar.js/master/dist/progressbar.min.js
// require https://raw.githubusercontent.com/kimmobrunfeldt/progressbar.js/master/dist/progressbar.js
// https://pvdlg.github.io/uprogress/js-api/#UProgress+start
// https://ricostacruz.com/nprogress


// @require https://unpkg.com/nprogress@0.2.0/nprogress.js
// @resource nprogress_css https://unpkg.com/nprogress@0.2.0/nprogress.css


// semble cassé
// https://github.com/webosorg/Process
// https://unpkg.com/@webos/process@0.2.0/dist/process.js
// https://cdn.jsdelivr.net/npm/@webos/process@0.2.0/dist/process.min.js
// bof ... je ne parviens pas à faire fonctionner l'exemple
// https://cdn.jsdelivr.net/npm/worker-function@2.0.1/WorkerFunction.min.js
// Threading 
// require  https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/Thread.js
// require   https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/ThreadPool.js
// require   https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/ThreadQueue.js
// semble cassé
// https://cdn.jsdelivr.net/npm/threads@1.6.3/dist/index.min.js
// https://unpkg.com/paralleljs@1.0/lib/parallel.js
// https://cdn.jsdelivr.net/npm/threads@1.6.3/dist/index.min.js
// Freelancer
// https://github.com/Wildhoney/Freelancer
// fonctionne require https://raw.githubusercontent.com/arqex/worker-function/master/WorkerFunction.js
// ne fonctonne pas https://raw.githubusercontent.com/duart38/Thread/master/Thread.bundle.js
// require      https://cdn.jsdelivr.net/npm/paralleljs@1.0.1/lib/parallel.min.js


/*
 * History
 * cf https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon/blob/master/CHANGELOG.md
 */
// ==/UserScript==
(()=>{var En=Object.create;var Et=Object.defineProperty;var Cn=Object.getOwnPropertyDescriptor;var xn=Object.getOwnPropertyNames;var Mn=Object.getPrototypeOf,Tn=Object.prototype.hasOwnProperty;var Dn=(p,o,n)=>o in p?Et(p,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):p[o]=n;var Yn=p=>Et(p,"__esModule",{value:!0});var $n=(p,o)=>()=>(o||p((o={exports:{}}).exports,o),o.exports);var Bn=(p,o,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of xn(o))!Tn.call(p,a)&&a!=="default"&&Et(p,a,{get:()=>o[a],enumerable:!(n=Cn(o,a))||n.enumerable});return p},On=p=>Bn(Yn(Et(p!=null?En(Mn(p)):{},"default",p&&p.__esModule&&"default"in p?{get:()=>p.default,enumerable:!0}:{value:p,enumerable:!0})),p);var U=(p,o,n)=>(Dn(p,typeof o!="symbol"?o+"":o,n),n);var ln=$n((It,kt)=>{(function(p,o){typeof define=="function"&&define.amd?define([],o):typeof kt=="object"&&typeof It!="undefined"?kt.exports=o():p.Papa=o()})(It,function p(){"use strict";var o=typeof self!="undefined"?self:typeof window!="undefined"?window:o!==void 0?o:{},n=!o.document&&!!o.postMessage,a=n&&/blob:/i.test((o.location||{}).protocol),e={},t=0,u={parse:function(g,s){var v=(s=s||{}).dynamicTyping||!1;if(y(v)&&(s.dynamicTypingFunction=v,v={}),s.dynamicTyping=v,s.transform=!!y(s.transform)&&s.transform,s.worker&&u.WORKERS_SUPPORTED){var T=function(){if(!u.WORKERS_SUPPORTED)return!1;var Q=(A=o.URL||o.webkitURL||null,S=p.toString(),u.BLOB_URL||(u.BLOB_URL=A.createObjectURL(new Blob(["(",S,")();"],{type:"text/javascript"})))),E=new o.Worker(Q),A,S;return E.onmessage=h,E.id=t++,e[E.id]=E}();return T.userStep=s.step,T.userChunk=s.chunk,T.userComplete=s.complete,T.userError=s.error,s.step=y(s.step),s.chunk=y(s.chunk),s.complete=y(s.complete),s.error=y(s.error),delete s.worker,void T.postMessage({input:g,config:s,workerId:T.id})}var R=null;return u.NODE_STREAM_INPUT,typeof g=="string"?R=s.download?new d(s):new i(s):g.readable===!0&&y(g.read)&&y(g.on)?R=new w(s):(o.File&&g instanceof File||g instanceof Object)&&(R=new f(s)),R.stream(g)},unparse:function(g,s){var v=!1,T=!0,R=",",Q=`\r
`,E='"',A=E+E,S=!1,$=null,I=!1;(function(){if(typeof s=="object"){if(typeof s.delimiter!="string"||u.BAD_DELIMITERS.filter(function(L){return s.delimiter.indexOf(L)!==-1}).length||(R=s.delimiter),(typeof s.quotes=="boolean"||typeof s.quotes=="function"||Array.isArray(s.quotes))&&(v=s.quotes),typeof s.skipEmptyLines!="boolean"&&typeof s.skipEmptyLines!="string"||(S=s.skipEmptyLines),typeof s.newline=="string"&&(Q=s.newline),typeof s.quoteChar=="string"&&(E=s.quoteChar),typeof s.header=="boolean"&&(T=s.header),Array.isArray(s.columns)){if(s.columns.length===0)throw new Error("Option columns is empty");$=s.columns}s.escapeChar!==void 0&&(A=s.escapeChar+E),typeof s.escapeFormulae=="boolean"&&(I=s.escapeFormulae)}})();var P=new RegExp(m(E),"g");if(typeof g=="string"&&(g=JSON.parse(g)),Array.isArray(g)){if(!g.length||Array.isArray(g[0]))return j(null,g,S);if(typeof g[0]=="object")return j($||k(g[0]),g,S)}else if(typeof g=="object")return typeof g.data=="string"&&(g.data=JSON.parse(g.data)),Array.isArray(g.data)&&(g.fields||(g.fields=g.meta&&g.meta.fields),g.fields||(g.fields=Array.isArray(g.data[0])?g.fields:k(g.data[0])),Array.isArray(g.data[0])||typeof g.data[0]=="object"||(g.data=[g.data])),j(g.fields||[],g.data||[],S);throw new Error("Unable to serialize unrecognized input");function k(L){if(typeof L!="object")return[];var oe=[];for(var me in L)oe.push(me);return oe}function j(L,oe,me){var ce="";typeof L=="string"&&(L=JSON.parse(L)),typeof oe=="string"&&(oe=JSON.parse(oe));var fe=Array.isArray(L)&&0<L.length,be=!Array.isArray(oe[0]);if(fe&&T){for(var ne=0;ne<L.length;ne++)0<ne&&(ce+=R),ce+=O(L[ne],ne);0<oe.length&&(ce+=Q)}for(var ie=0;ie<oe.length;ie++){var he=fe?L.length:oe[ie].length,le=!1,se=fe?Object.keys(oe[ie]).length===0:oe[ie].length===0;if(me&&!fe&&(le=me==="greedy"?oe[ie].join("").trim()==="":oe[ie].length===1&&oe[ie][0].length===0),me==="greedy"&&fe){for(var ae=[],te=0;te<he;te++){var G=be?L[te]:te;ae.push(oe[ie][G])}le=ae.join("").trim()===""}if(!le){for(var pe=0;pe<he;pe++){0<pe&&!se&&(ce+=R);var we=fe&&be?L[pe]:pe;ce+=O(oe[ie][we],pe)}ie<oe.length-1&&(!me||0<he&&!se)&&(ce+=Q)}}return ce}function O(L,oe){if(L==null)return"";if(L.constructor===Date)return JSON.stringify(L).slice(1,25);I===!0&&typeof L=="string"&&L.match(/^[=+\-@].*$/)!==null&&(L="'"+L);var me=L.toString().replace(P,A),ce=typeof v=="boolean"&&v||typeof v=="function"&&v(L,oe)||Array.isArray(v)&&v[oe]||function(fe,be){for(var ne=0;ne<be.length;ne++)if(-1<fe.indexOf(be[ne]))return!0;return!1}(me,u.BAD_DELIMITERS)||-1<me.indexOf(R)||me.charAt(0)===" "||me.charAt(me.length-1)===" ";return ce?E+me+E:me}}};if(u.RECORD_SEP=String.fromCharCode(30),u.UNIT_SEP=String.fromCharCode(31),u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!n&&!!o.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=b,u.ParserHandle=Y,u.NetworkStreamer=d,u.FileStreamer=f,u.StringStreamer=i,u.ReadableStreamStreamer=w,o.jQuery){var l=o.jQuery;l.fn.parse=function(g){var s=g.config||{},v=[];return this.each(function(Q){if(!(l(this).prop("tagName").toUpperCase()==="INPUT"&&l(this).attr("type").toLowerCase()==="file"&&o.FileReader)||!this.files||this.files.length===0)return!0;for(var E=0;E<this.files.length;E++)v.push({file:this.files[E],inputElem:this,instanceConfig:l.extend({},s)})}),T(),this;function T(){if(v.length!==0){var Q,E,A,S,$=v[0];if(y(g.before)){var I=g.before($.file,$.inputElem);if(typeof I=="object"){if(I.action==="abort")return Q="AbortError",E=$.file,A=$.inputElem,S=I.reason,void(y(g.error)&&g.error({name:Q},E,A,S));if(I.action==="skip")return void R();typeof I.config=="object"&&($.instanceConfig=l.extend($.instanceConfig,I.config))}else if(I==="skip")return void R()}var P=$.instanceConfig.complete;$.instanceConfig.complete=function(k){y(P)&&P(k,$.file,$.inputElem),R()},u.parse($.file,$.instanceConfig)}else y(g.complete)&&g.complete()}function R(){v.splice(0,1),T()}}}function c(g){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(s){var v=B(s);v.chunkSize=parseInt(v.chunkSize),s.step||s.chunk||(v.chunkSize=null),this._handle=new Y(v),(this._handle.streamer=this)._config=v}.call(this,g),this.parseChunk=function(s,v){if(this.isFirstChunk&&y(this._config.beforeFirstChunk)){var T=this._config.beforeFirstChunk(s);T!==void 0&&(s=T)}this.isFirstChunk=!1,this._halted=!1;var R=this._partialLine+s;this._partialLine="";var Q=this._handle.parse(R,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var E=Q.meta.cursor;this._finished||(this._partialLine=R.substring(E-this._baseIndex),this._baseIndex=E),Q&&Q.data&&(this._rowCount+=Q.data.length);var A=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(a)o.postMessage({results:Q,workerId:u.WORKER_ID,finished:A});else if(y(this._config.chunk)&&!v){if(this._config.chunk(Q,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);Q=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(Q.data),this._completeResults.errors=this._completeResults.errors.concat(Q.errors),this._completeResults.meta=Q.meta),this._completed||!A||!y(this._config.complete)||Q&&Q.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),A||Q&&Q.meta.paused||this._nextChunk(),Q}this._halted=!0},this._sendError=function(s){y(this._config.error)?this._config.error(s):a&&this._config.error&&o.postMessage({workerId:u.WORKER_ID,error:s,finished:!1})}}function d(g){var s;(g=g||{}).chunkSize||(g.chunkSize=u.RemoteChunkSize),c.call(this,g),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(v){this._input=v,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(s=new XMLHttpRequest,this._config.withCredentials&&(s.withCredentials=this._config.withCredentials),n||(s.onload=D(this._chunkLoaded,this),s.onerror=D(this._chunkError,this)),s.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var v=this._config.downloadRequestHeaders;for(var T in v)s.setRequestHeader(T,v[T])}if(this._config.chunkSize){var R=this._start+this._config.chunkSize-1;s.setRequestHeader("Range","bytes="+this._start+"-"+R)}try{s.send(this._config.downloadRequestBody)}catch(Q){this._chunkError(Q.message)}n&&s.status===0&&this._chunkError()}},this._chunkLoaded=function(){s.readyState===4&&(s.status<200||400<=s.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:s.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(v){var T=v.getResponseHeader("Content-Range");return T===null?-1:parseInt(T.substring(T.lastIndexOf("/")+1))}(s),this.parseChunk(s.responseText)))},this._chunkError=function(v){var T=s.statusText||v;this._sendError(new Error(T))}}function f(g){var s,v;(g=g||{}).chunkSize||(g.chunkSize=u.LocalChunkSize),c.call(this,g);var T=typeof FileReader!="undefined";this.stream=function(R){this._input=R,v=R.slice||R.webkitSlice||R.mozSlice,T?((s=new FileReader).onload=D(this._chunkLoaded,this),s.onerror=D(this._chunkError,this)):s=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var R=this._input;if(this._config.chunkSize){var Q=Math.min(this._start+this._config.chunkSize,this._input.size);R=v.call(R,this._start,Q)}var E=s.readAsText(R,this._config.encoding);T||this._chunkLoaded({target:{result:E}})},this._chunkLoaded=function(R){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(R.target.result)},this._chunkError=function(){this._sendError(s.error)}}function i(g){var s;c.call(this,g=g||{}),this.stream=function(v){return s=v,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var v,T=this._config.chunkSize;return T?(v=s.substring(0,T),s=s.substring(T)):(v=s,s=""),this._finished=!s,this.parseChunk(v)}}}function w(g){c.call(this,g=g||{});var s=[],v=!0,T=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(R){this._input=R,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){T&&s.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),s.length?this.parseChunk(s.shift()):v=!0},this._streamData=D(function(R){try{s.push(typeof R=="string"?R:R.toString(this._config.encoding)),v&&(v=!1,this._checkIsFinished(),this.parseChunk(s.shift()))}catch(Q){this._streamError(Q)}},this),this._streamError=D(function(R){this._streamCleanUp(),this._sendError(R)},this),this._streamEnd=D(function(){this._streamCleanUp(),T=!0,this._streamData("")},this),this._streamCleanUp=D(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Y(g){var s,v,T,R=Math.pow(2,53),Q=-R,E=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,A=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,S=this,$=0,I=0,P=!1,k=!1,j=[],O={data:[],errors:[],meta:{}};if(y(g.step)){var L=g.step;g.step=function(ne){if(O=ne,ce())me();else{if(me(),O.data.length===0)return;$+=ne.data.length,g.preview&&$>g.preview?v.abort():(O.data=O.data[0],L(O,S))}}}function oe(ne){return g.skipEmptyLines==="greedy"?ne.join("").trim()==="":ne.length===1&&ne[0].length===0}function me(){if(O&&T&&(be("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),T=!1),g.skipEmptyLines)for(var ne=0;ne<O.data.length;ne++)oe(O.data[ne])&&O.data.splice(ne--,1);return ce()&&function(){if(!O)return;function ie(le,se){y(g.transformHeader)&&(le=g.transformHeader(le,se)),j.push(le)}if(Array.isArray(O.data[0])){for(var he=0;ce()&&he<O.data.length;he++)O.data[he].forEach(ie);O.data.splice(0,1)}else O.data.forEach(ie)}(),function(){if(!O||!g.header&&!g.dynamicTyping&&!g.transform)return O;function ie(le,se){var ae,te=g.header?{}:[];for(ae=0;ae<le.length;ae++){var G=ae,pe=le[ae];g.header&&(G=ae>=j.length?"__parsed_extra":j[ae]),g.transform&&(pe=g.transform(pe,G)),pe=fe(G,pe),G==="__parsed_extra"?(te[G]=te[G]||[],te[G].push(pe)):te[G]=pe}return g.header&&(ae>j.length?be("FieldMismatch","TooManyFields","Too many fields: expected "+j.length+" fields but parsed "+ae,I+se):ae<j.length&&be("FieldMismatch","TooFewFields","Too few fields: expected "+j.length+" fields but parsed "+ae,I+se)),te}var he=1;return!O.data.length||Array.isArray(O.data[0])?(O.data=O.data.map(ie),he=O.data.length):O.data=ie(O.data,0),g.header&&O.meta&&(O.meta.fields=j),I+=he,O}()}function ce(){return g.header&&j.length===0}function fe(ne,ie){return he=ne,g.dynamicTypingFunction&&g.dynamicTyping[he]===void 0&&(g.dynamicTyping[he]=g.dynamicTypingFunction(he)),(g.dynamicTyping[he]||g.dynamicTyping)===!0?ie==="true"||ie==="TRUE"||ie!=="false"&&ie!=="FALSE"&&(function(le){if(E.test(le)){var se=parseFloat(le);if(Q<se&&se<R)return!0}return!1}(ie)?parseFloat(ie):A.test(ie)?new Date(ie):ie===""?null:ie):ie;var he}function be(ne,ie,he,le){var se={type:ne,code:ie,message:he};le!==void 0&&(se.row=le),O.errors.push(se)}this.parse=function(ne,ie,he){var le=g.quoteChar||'"';if(g.newline||(g.newline=function(te,G){te=te.substring(0,1048576);var pe=new RegExp(m(G)+"([^]*?)"+m(G),"gm"),we=(te=te.replace(pe,"")).split("\r"),$e=te.split(`
`),Me=1<$e.length&&$e[0].length<we[0].length;if(we.length===1||Me)return`
`;for(var ke=0,Se=0;Se<we.length;Se++)we[Se][0]===`
`&&ke++;return ke>=we.length/2?`\r
`:"\r"}(ne,le)),T=!1,g.delimiter)y(g.delimiter)&&(g.delimiter=g.delimiter(ne),O.meta.delimiter=g.delimiter);else{var se=function(te,G,pe,we,$e){var Me,ke,Se,Le;$e=$e||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var xe=0;xe<$e.length;xe++){var Je=$e[xe],ut=0,ye=0,He=0;Se=void 0;for(var Be=new b({comments:we,delimiter:Je,newline:G,preview:10}).parse(te),Ue=0;Ue<Be.data.length;Ue++)if(pe&&oe(Be.data[Ue]))He++;else{var Oe=Be.data[Ue].length;ye+=Oe,Se!==void 0?0<Oe&&(ut+=Math.abs(Oe-Se),Se=Oe):Se=Oe}0<Be.data.length&&(ye/=Be.data.length-He),(ke===void 0||ut<=ke)&&(Le===void 0||Le<ye)&&1.99<ye&&(ke=ut,Me=Je,Le=ye)}return{successful:!!(g.delimiter=Me),bestDelimiter:Me}}(ne,g.newline,g.skipEmptyLines,g.comments,g.delimitersToGuess);se.successful?g.delimiter=se.bestDelimiter:(T=!0,g.delimiter=u.DefaultDelimiter),O.meta.delimiter=g.delimiter}var ae=B(g);return g.preview&&g.header&&ae.preview++,s=ne,v=new b(ae),O=v.parse(s,ie,he),me(),P?{meta:{paused:!0}}:O||{meta:{paused:!1}}},this.paused=function(){return P},this.pause=function(){P=!0,v.abort(),s=y(g.chunk)?"":s.substring(v.getCharIndex())},this.resume=function(){S.streamer._halted?(P=!1,S.streamer.parseChunk(s,!0)):setTimeout(S.resume,3)},this.aborted=function(){return k},this.abort=function(){k=!0,v.abort(),O.meta.aborted=!0,y(g.complete)&&g.complete(O),s=""}}function m(g){return g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(g){var s,v=(g=g||{}).delimiter,T=g.newline,R=g.comments,Q=g.step,E=g.preview,A=g.fastMode,S=s=g.quoteChar===void 0?'"':g.quoteChar;if(g.escapeChar!==void 0&&(S=g.escapeChar),(typeof v!="string"||-1<u.BAD_DELIMITERS.indexOf(v))&&(v=","),R===v)throw new Error("Comment character same as delimiter");R===!0?R="#":(typeof R!="string"||-1<u.BAD_DELIMITERS.indexOf(R))&&(R=!1),T!==`
`&&T!=="\r"&&T!==`\r
`&&(T=`
`);var $=0,I=!1;this.parse=function(P,k,j){if(typeof P!="string")throw new Error("Input must be a string");var O=P.length,L=v.length,oe=T.length,me=R.length,ce=y(Q),fe=[],be=[],ne=[],ie=$=0;if(!P)return xe();if(A||A!==!1&&P.indexOf(s)===-1){for(var he=P.split(T),le=0;le<he.length;le++){if(ne=he[le],$+=ne.length,le!==he.length-1)$+=T.length;else if(j)return xe();if(!R||ne.substring(0,me)!==R){if(ce){if(fe=[],Me(ne.split(v)),Je(),I)return xe()}else Me(ne.split(v));if(E&&E<=le)return fe=fe.slice(0,E),xe(!0)}}return xe()}for(var se=P.indexOf(v,$),ae=P.indexOf(T,$),te=new RegExp(m(S)+m(s),"g"),G=P.indexOf(s,$);;)if(P[$]!==s)if(R&&ne.length===0&&P.substring($,$+me)===R){if(ae===-1)return xe();$=ae+oe,ae=P.indexOf(T,$),se=P.indexOf(v,$)}else{if(se!==-1&&(se<ae||ae===-1)){if(!(se<G)){ne.push(P.substring($,se)),$=se+L,se=P.indexOf(v,$);continue}var pe=ut(se,G,ae);if(pe&&pe.nextDelim!==void 0){se=pe.nextDelim,G=pe.quoteSearch,ne.push(P.substring($,se)),$=se+L,se=P.indexOf(v,$);continue}}if(ae===-1)break;if(ne.push(P.substring($,ae)),Le(ae+oe),ce&&(Je(),I))return xe();if(E&&fe.length>=E)return xe(!0)}else for(G=$,$++;;){if((G=P.indexOf(s,G+1))===-1)return j||be.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:fe.length,index:$}),Se();if(G===O-1)return Se(P.substring($,G).replace(te,s));if(s!==S||P[G+1]!==S){if(s===S||G===0||P[G-1]!==S){se!==-1&&se<G+1&&(se=P.indexOf(v,G+1)),ae!==-1&&ae<G+1&&(ae=P.indexOf(T,G+1));var we=ke(ae===-1?se:Math.min(se,ae));if(P[G+1+we]===v){ne.push(P.substring($,G).replace(te,s)),P[$=G+1+we+L]!==s&&(G=P.indexOf(s,$)),se=P.indexOf(v,$),ae=P.indexOf(T,$);break}var $e=ke(ae);if(P.substring(G+1+$e,G+1+$e+oe)===T){if(ne.push(P.substring($,G).replace(te,s)),Le(G+1+$e+oe),se=P.indexOf(v,$),G=P.indexOf(s,$),ce&&(Je(),I))return xe();if(E&&fe.length>=E)return xe(!0);break}be.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:fe.length,index:$}),G++}}else G++}return Se();function Me(ye){fe.push(ye),ie=$}function ke(ye){var He=0;if(ye!==-1){var Be=P.substring(G+1,ye);Be&&Be.trim()===""&&(He=Be.length)}return He}function Se(ye){return j||(ye===void 0&&(ye=P.substring($)),ne.push(ye),$=O,Me(ne),ce&&Je()),xe()}function Le(ye){$=ye,Me(ne),ne=[],ae=P.indexOf(T,$)}function xe(ye){return{data:fe,errors:be,meta:{delimiter:v,linebreak:T,aborted:I,truncated:!!ye,cursor:ie+(k||0)}}}function Je(){Q(xe()),fe=[],be=[]}function ut(ye,He,Be){var Ue={nextDelim:void 0,quoteSearch:void 0},Oe=P.indexOf(s,He+1);if(He<ye&&ye<Oe&&(Oe<Be||Be===-1)){var Dt=P.indexOf(v,Oe);if(Dt===-1)return Ue;Oe<Dt&&(Oe=P.indexOf(s,Oe+1)),Ue=ut(Dt,Oe,Be)}else Ue={nextDelim:ye,quoteSearch:He};return Ue}},this.abort=function(){I=!0},this.getCharIndex=function(){return $}}function h(g){var s=g.data,v=e[s.workerId],T=!1;if(s.error)v.userError(s.error,s.file);else if(s.results&&s.results.data){var R={abort:function(){T=!0,C(s.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:M,resume:M};if(y(v.userStep)){for(var Q=0;Q<s.results.data.length&&(v.userStep({data:s.results.data[Q],errors:s.results.errors,meta:s.results.meta},R),!T);Q++);delete s.results}else y(v.userChunk)&&(v.userChunk(s.results,R,s.file),delete s.results)}s.finished&&!T&&C(s.workerId,s.results)}function C(g,s){var v=e[g];y(v.userComplete)&&v.userComplete(s),v.terminate(),delete e[g]}function M(){throw new Error("Not implemented.")}function B(g){if(typeof g!="object"||g===null)return g;var s=Array.isArray(g)?[]:{};for(var v in g)s[v]=B(g[v]);return s}function D(g,s){return function(){g.apply(s,arguments)}}function y(g){return typeof g=="function"}return a&&(o.onmessage=function(g){var s=g.data;if(u.WORKER_ID===void 0&&s&&(u.WORKER_ID=s.workerId),typeof s.input=="string")o.postMessage({workerId:u.WORKER_ID,results:u.parse(s.input,s.config),finished:!0});else if(o.File&&s.input instanceof File||s.input instanceof Object){var v=u.parse(s.input,s.config);v&&o.postMessage({workerId:u.WORKER_ID,results:v,finished:!0})}}),(d.prototype=Object.create(c.prototype)).constructor=d,(f.prototype=Object.create(c.prototype)).constructor=f,(i.prototype=Object.create(i.prototype)).constructor=i,(w.prototype=Object.create(c.prototype)).constructor=w,u})});var Ze={async XHR(p){let o=window.GM_xmlhttpRequest||(GM?GM.xmlHttpRequest:null);return o?new Promise((n,a)=>{Object.assign(p,{onabort:a,onerror:a,onload:n,ontimeout:a}),o(p)}):Promise.reject()},async getValue(p,o=null){return window.GM_getValue?Promise.resolve(GM_getValue(p)||o):await GM.getValue(p)||o},async setValue(p,o){window.GM_setValue?GM_setValue(p,o):GM.setValue(p,o)}};var Nt="OC-Addons",eo="St\xE9phane TORCHY",x="background-color:green;color:white",to="background-color:black;color:white",Ge="background-color:coral;color:white",no="background-color:cyan;color:white",de="background-color:red;color:white",Re="background-color:blue;color:white",qe="auto-financ\xE9",Ye="financ\xE9 par un tiers",Xe="autre",et="r\xE9alis\xE9e",Ke="annul\xE9e",tt="annul\xE9e tardivement",nt="\xE9tudiant absent",ht="\xE9tudiante absente",ot=6,Ht=30,Ut=35,Gt=40,qt=45,Qt=50,zt=55,z=0,W=1,K=2,oo=[{pathId:158,path:"158-trouvez-lemploi-qui-vous-correspond",value:2}],Z=0,X=1,V=2,ee=3,F=0,N=1,H=2,Wt=0,Kt="completed",Vt="canceled",Jt="late canceled",Zt="marked student as absent",gt="ol";var Xt=function(){return new Promise(p=>{document.readyState=="loading"?document.addEventListener("DOMContentLoaded",p):p()})},bt=async function(p="",o="",n=!1){console.info(`%cfetch() waiting return from : ${p}`,x);let a=await Ze.XHR({method:"GET",url:p,responseType:"text/html",headers:{"User-Agent":"Mozilla/5.0"},onprogress:function(c){}}).catch(c=>{console.error(`%cError ${c}`,de)}),t=new DOMParser().parseFromString(a.responseText.replace(/\n/mg,""),"text/html");if(t.querySelector("meta[id=captcha-bypass]")!==null)throw console.error(`%cError CloudFlare CAPTCHA : ${t.querySelector("title").innerText}`,x),new Error("Must Respond to Cloudflare Captcha or waiting....");var l={};return n===!0?l=t.querySelectorAll(o):l=t.querySelector(o),l};var Ve=function(p,o=-1){try{var n=(p.querySelector("a").href||"/").split("/");return n[n.length+o]}catch(a){console.error(`%cError in getkey${a.stack||a}`,de)}},en=function(p){var o=p.trim().split(" ");try{var n=dayjs_locale_fr.months.findIndex(a=>a===o[1])+1}catch(a){console.error(`%cError in extractDate${a.stack||a}`,de)}return`${o[2]}-${n}-${o[0]}T${o[4]}`};var Pe=function(p){return new Promise(o=>setTimeout(o,p))},tn=function(p){return p.substring(p.lastIndexOf(".")+1,p.length)||p},yt=function(p,o){for(var n=p.split("."),a=o.split("."),e=0;e<3;e++){var t=Number(n[e]),u=Number(a[e]);if(t>u)return 1;if(u>t)return-1;if(!isNaN(t)&&isNaN(u))return 1;if(isNaN(t)&&!isNaN(u))return-1}return 0},nn=function(o,n){return console.info("Reading:",o),fetch(o,{mode:"same-origin"}).then(function(a){return a.blob()}).then(function(a){var e=new FileReader;e.addEventListener("loadend",function(){n(this.result)}),e.readAsText(a)})},on=function(p){let o=p,n=p.reduce(function(f,i){return f*i});var a=new Array(n);let e=function(...f){let i=f.pop();if(f.length!==p.length)throw"Wrong matrix dimensions, need "+p.length+", you provide "+i.length+"!";if(d(f)===0)throw"Wrong type for set need one or more int has dimension, check type of!";let w=c(f);return a[w]=i,i},t=function(...f){if(f.length!==p.length)throw"Wrong matrix dimensions, need "+p.length+", you provide "+f.length+"!";if(d(f)===0)throw"Wrong type for set need one or more int has dimension, check type of!";let i=c(f);return a[i]},u=function(...f){let i=c(f);return a[i]=void 0,a[i]===void 0},l=function(){console.group("dump table"),console.table(a),console.groupEnd("dump table")},c=function(f){return f.reduce(function(i,w,Y,m){let b=o.slice(Y+1),h=b.length>0?b.reduce(function(C,M){return C*M}):1;return i+w*h},0)},d=function(f){return f.reduce((i,w)=>i&typeof w=="number",1)};return Object.freeze({set:e,get:t,del:u,toConsole:l})},rn=function(p,o=0){let n=3735928559^o,a=1103547991^o;for(let e=0,t;e<p.length;e++)t=p.charCodeAt(e),n=Math.imul(n^t,2654435761),a=Math.imul(a^t,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(a^a>>>13,3266489909),a=Math.imul(a^a>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&a)+(n>>>0)},re=function(p,o,n=Error){if(!p)throw new n(o)};var Yt=p=>Array.isArray(p),sn=p=>p.toString().trim().length<="function(){}".length;var _t=function(p){var o;return function(){var n=this,a=arguments;o&&window.cancelAnimationFrame(o),o=window.requestAnimationFrame(function(){p.apply(n,a)})}};var an=function(p){let o=Date.now(),n=null;do n=Date.now();while(n-o<p)};HTMLElement.prototype.appendFirst=function(p){this.firstChild?this.insertBefore(p,this.firstChild):this.appendChild(p)};var ct=async function(p=null,o=null,n=!0){var a="";a+="<style>",a+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",a+="form input {background: #fff;border: 1px solid #9c9c9c;}",a+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",a+="form button:hover {background: gold;}",a+="form label {padding: 0.5em 0.5em 0.5em 0;}",a+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",a+="form input:focus {outline: 3px solid gold;}",a+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}form label {text-align: right;grid-column: 1 / 2;}form input, form button {grid-column: 2 / 3;}}",a+="</style>",a+='<form class="form1" action="">',a+='<label for="dtFrom" class="date">Date de d\xE9but</label>',p?a+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(p).format("YYYY-MM-DD")+'">':a+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31">',a+='<label for="dtTo" class="date">Date de fin</label>',p?a+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(o).format("YYYY-MM-DD")+'">':a+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31">',a+="</form>";let{value:e}=await Swal.fire({title:"<strong>Choix de la p\xE9riode</strong>",icon:"info",html:a,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:"Choisissez la p\xE9riode pour la s\xE9lection des temps factur\xE9s",showLoaderOnConfirm:!0,preConfirm:()=>[document.getElementById("dtFrom").value,document.getElementById("dtTo").value],onRender:t=>{},onOpen:t=>{n===!0&&t.querySelector("#dtFrom").addEventListener("change",_handler=function(){document.getElementById("dtTo").value=dayjs(document.getElementById("dtFrom").value).endOf("month").format("YYYY-MM-DD")})},onClose:t=>{n===!0&&t.querySelector("#dtFrom").removeEventListener("change",_handler)},onAfterClose:t=>{},onDestroy:t=>{}});return p=dayjs(e[0]),o=dayjs(e[1]),await Pe(250),[p,o]},ft=async function(p){await Swal.fire({position:"top-end",icon:"success",title:p,showConfirmButton:!1,timer:1500})};var Qe=class{},rt=Qe;U(rt,"tbl_name","f_archives"),U(rt,"add",async function(o){let n=q.Cfg.dbase,a=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]"),e={id:o[0].to.format("YYYYMM"),data:o,created_at:o[0].now};console.log(`%cWill create archive for id ${o[0].to.format("YYYYMM")} (YYYYMM)`,x),n.get(Qe.tbl_name).push(JSON.parse(JSON.stringify(e))).write()}),U(rt,"exists",function(o){return q.Cfg.dbase.get(Qe.tbl_name).find({id:o}).value()!==void 0}),U(rt,"get",function(o){var a=q.Cfg.dbase.get(Qe.tbl_name).find({id:o}).value();if(a===void 0)throw Error("Erreur qui ne devrait jamais arriver en Archive.get");return console.log(`%cWill use archive for id ${o} (YYYYMM)`,x),a}),U(rt,"delete",function(o=null,n=null){let a=q.Cfg.dbase;if(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),o===null&&n==null){console.log("%cWanna suppress ALL Archives from DB ",x),a.get(Qe.tbl_name).remove().write();return}if(n==null){a.get(Qe.tbl_name).remove(function(e){return dayjs(e.id,"YYYYMM").isBefore(n),"month"}).write();return}if(o==null){a.get(Qe.tbl_name).remove(function(e){return dayjs(e.id,"YYYYMM").isAfter(o,"month")}).write();return}a.get(Qe.tbl_name).remove(function(e){return dayjs(e.id,"YYYYMM").isBetween(o,n,"month","[]")}).write()});var it=rt;var $t=class{},vt=$t;U(vt,"isInOldMode",function(o){var n=null;typeof o=="string"?n=dayjs(o):n=o;try{return n.isBefore($t.getOldModeDate())}catch(a){throw Error("Erreur qui ne devrait jamais arriver en IsInOldMode (probablement un probleme sur la conversion de la date en objet dayjs:"+a.stack||a)}}),U(vt,"getOldModeDate",function(){return dayjs("2020-06-01")}),U(vt,"getAppVersion",function(){return GM.info.script.version});var Ae=vt;var In=function(){let p="students_history",o=1,n=2,a=function(w){if(w.toUpperCase()==="FUNDING")return o;if(w.toUpperCase()==="PATH")return n;throw Error("Erreur qui ne devrait jamais arriver en getype")},e=function(w,Y,m=null){return u(w,o,Y,m)},t=function(w,Y,m=null){return u(w,n,Y,m)},u=function(w,Y,m,b=null){let h=!1;typeof w=="number"&&(w=w.toString(10)),re(typeof w=="string","You must provide a string.",TypeError);let C=q.Cfg.dbase;typeof b=="string"&&(b=dayjs(b)),b===null&&(b=dayjs()),re(b instanceof dayjs,"created date must be a string, a dayjs instance or null.",TypeError);let M={id:w,type:0|Y,value:m,date:b.valueOf(),humanDate:b.format("YYYY-MM-DDTHH:mm:ssZZ")};return h===!0&&console.log(`%cAdd in student history at date ${dayjs(M.date).format("YYYY-MM-DDTHH:mm:ssZZ")} data ${m} with type:${Y} cf const of object`,x),C.get(p).push(JSON.parse(JSON.stringify(M))).write()},l=function(w,Y=null,m=null){let b=q.Cfg.dbase;return w==null&&Y==null&&m==null?(console.log("%cRemove all in student history",x),b.get(p).remove().write()):(typeof m=="string"&&(m=dayjs(m)),m==null?Y==null?(console.log(`%cRemove for student id:${w} history for all type of event`,x),b.get(p).remove({id:w}).write()):(console.log(`%cRemove for student id:${w} history with event type:${Y} cf const of object`,x),b.get(p).remove({id:w,type:Y}).write()):(console.log(`%cRemove for student id:${w} history at date ${m.format("DD/MM/YYYY")} with event type:${Y} cf const of object`,x),b.get(p).remove({id:w,type:Y,date:m.valueOf()}).write()))},c=function(w,Y,m=null){let b=!1,h=q.Cfg.dbase;typeof m=="string"&&(m=dayjs(m)),m===null&&(m=dayjs()),b===!0&&console.log("%cSearching in student history at date %o ",x,m),b===!0&&console.log(`%cSearching in student history at date ${m.format("DD/MM/YYYY")} any data with type:${Y} cf const of object`,x);var C=+m.valueOf(),M=h.get(p).filter(y=>y.id===w&&y.type&Y).map(y=>y.date-C).filter(y=>y>=0).value();if(M.length==0){b===!0&&console.log(`%cThere is no data in student history at date ${m.format("DD/MM/YYYY")} with type:${Y} cf const of object`,x);return}let D=C+(y=>Math.min(...y))(M);return h.get(p).filter(y=>y.id===w&&y.type&Y&&y.date==D).value()[0]},d=function(w){return i(w,o)},f=function(w){return i(w,n)},i=function(w,Y){return w.type&Y};return Object.freeze({addFunding:e,addPath:t,getType:a,remove:l,find:c,isFunding:d,isPath:f,tbl_name:p})},kn=In(),je=kn;var ue=class{static modifyFunding(o,n,a){typeof n=="string"&&(n=dayjs(n)),re(created instanceof dayjs,"modifyFunding date must be a string, a dayjs instance or null.",TypeError);let e=ue.getFunding(o,n);if(a.toLower()===e.toLower()){console.log(`%cFundingMode ${a} is identical as current: ${sCurrent}, nothing to do`,x);return}(a!==qe||a!=Ye||a!==Xe)&&console.log(`%cWarning this state is unknown ${a}`,Ge);let t=q.Cfg.dbase,u=dayjs().format("YYYY-MM-DDTHH:mm:ssZZ");if(n===null&&(n=u),oLastHistory=je.find(o,je.getType("FUNDING"),n),t.get(ue.tbl_name).find({id:o}).assign({funding:a}).write(),je.addFunding(o,e,u),n.isSameOrAfter(Ae.getOldModeDate()))var l=t.get("sessions").filter(function(d){return d.who_id===o&&dayjs(d.when).isSameOrAfter(n,"day")});else var l=t.get("sessions").filter(function(f){f.who_id===o&&dayjs(f.when).isSameOrAfter(Ae.getOldModeDate(),"day")});for(var c=l.value().length;c-=1;)console.log(`There is ${c} elements left to update`,x),l.get(c).assign({funding:a}).write()}},_e=ue;U(_e,"tbl_name","students"),U(_e,"add",function(o,n="noname",a="nopath",e="unknown",t){let u=q.Cfg.dbase;var l=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");let c={id:o,fullname:n,path:a,funding:e,created:l};ue._save(c)}),U(_e,"_checkObject",function(o){!1===!0&&console.log("%cChecking object student:%o ",x,o),re(typeof o.id=="string","Student object id need to be a string.",TypeError),re(typeof o.fullname=="string","Student object fullname need to be a number.",TypeError),re(typeof o.path=="string","Student object path need to be a string.",TypeError),re(typeof o.funding=="string","Student object funding need to be a string.",TypeError),re(typeof o.created=="string","Student object created need to be a string.",TypeError)}),U(_e,"_save",function(o){let n=!1;ue._checkObject(o),n===!0&&console.log("%cSaving student %o to DB",x,o),q.Cfg.dbase.get(ue.tbl_name).push(JSON.parse(JSON.stringify(o))).write()}),U(_e,"exists",function(o,n=null){let a=!1,e=ue.findById(o,n);return a===!0&&console.log(`%cStudent ${o} exists in db ? ${e!==void 0}`,x),e!==void 0}),U(_e,"findById",function(o,n=null){let a=GM_config.get("use_student_cache");return a===!1&&console.log("%cache \xE9tudiant desactiv\xE9 dans les options",x),typeof o=="number"&&(o=o.toString(10)),re(typeof o=="string","You must provide a string.",TypeError),typeof n=="string"&&(n=dayjs(n)),n==null?a===!1?ue._findById(o,n):ue.m_findById(o,"null"):a===!1?ue._findById(o,n.toISOString()):ue.m_findById(o,n.toISOString())}),U(_e,"_findById",function(o,n=null){let a=!1,e=q.Cfg.dbase;typeof n=="string"&&(n=dayjs(n)),a===!0&&console.log(`%c_findById() searching student with id:(${typeof o})${o} in db`,x);var t=e.get(ue.tbl_name).find({id:o}).value();if(a===!0&&console.log("%c_findById() student %o is found",x,t),t!==void 0){if(n!==null){var u={...t},l=je.find(o,je.getType("FUNDING"),n);l!==void 0&&(u.funding=l.value);var c=je.find(o,je.getType("PATH"),n);return c!==void 0&&(u.path=c.value),u}return a===!0&&console.log("%c_findById() student final %o is found",x,t),t}}),U(_e,"m_findById",moize.default(ue._findById,{maxAge:6e5,isSerialized:!0})),U(_e,"getFunding",async function(o,n=null){return typeof n=="string"&&(n=dayjs(n)),await ue.m_getFunding(o,n)}),U(_e,"_getFunding",async function(o,n=null){let a=ue.findById(o,n);return a===void 0?(console.log('%c[Student._getFunding()]Student %s is not in db, fetching data:"funded mode" from webpage',x,o),a=await ue.getFundingFomDashboard(o),console.log("%c[Student._getFunding()]Student %s funding is %o",x,o,a),a.toLowerCase()):a.funding.toLowerCase()}),U(_e,"m_getFunding",moize.default(ue._getFunding,{maxAge:6e5,isSerialized:!0,isPromise:!0})),U(_e,"isAutoFunded",function(o){return console.log("%cFUNCTION DEPRECATED !!!!!!!!!!!!!!!!!!!!!! ",de),ue.getFunded(o).toLowerCase()===qe}),U(_e,"getFundingFomDashboard",async function(o){return(await bt(`https://openclassrooms.com/fr/mentorship/students/${o}/dashboard`,".mentorshipStudent__details > p")).innerText.trim()}),U(_e,"getPath",async function(o,n=null){let a=ue.findById(o,n);if(a==null){console.log(`%cStudent ${o} is not in db, fetching data: 'path' from webpage ....`,x);let e=await bt(`https://openclassrooms.com/fr/mentorship/students/${o}/dashboard`,"a[href*='paths/']");return e.innerText.length==0&&console.error(`%cStudent path is not readable from url : https://openclassrooms.com/fr/mentorship/students/${o}/dashboard`,de),e.innerText.trim()}else return a.path}),U(_e,"delete",function(o=null,n=null){let a=q.Cfg.dbase;if(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),o===null&&n==null){console.log("%cWanna suppress ALL Students from DB",x),a.get(ue.tbl_name).remove().write();return}if(n==null){a.get(ue.tbl_name).remove(function(e){return dayjs(e.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isBefore(n,"day")}).write();return}if(o==null){a.get(ue.tbl_name).remove(function(e){return dayjs(e.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isAfter(o,"day")}).write();return}a.get(ue.tbl_name).remove(function(e){return dayjs(e.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isBetween(o,n,"day","[]")}).write()}),U(_e,"deleteById",function(o,n=null){q.Cfg.dbase.get("students").remove(e=>e.id===o).write(),console.log(`%cAll students with id:${o} are removed from DataBase`,x)}),U(_e,"getAll",async(o,n)=>{let a=!0;var e=!1;let t=q.Cfg.dbase;var u="table.crud-list tbody";bDebug===!0&&console.log("%c[getAll()] Enter function",x);let l=await bt("https://openclassrooms.com/fr/mentorship/dashboard/students",'script[id="mentorshipDashboardConfiguration"]');var c=JSON.parse(l.innerText.trim()),d=c.mentorStudents;bDebug===!0&&console.log("%cgetAll() collect this array of stundent %o",x,d);let f=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");var i=performance.now();await ue.getFundingFomDashboard(d[0].studentId),bDebug===!0&&console.log(`%cEstimated time for updating : ${(performance.now()-i)*d.length} ms`,x),Swal.fire({position:"top-end",icon:"info",toast:!0,title:`mise \xE0 jour de la base de donn\xE9e des \xE9tudiants...
cela peut prendre du temps ~ ${(performance.now()-i)*d.length/1e3} s`,showConfirmButton:!1,timer:1e3}),await Pe(1e3),bDebug===!0&&console.log("%cWill process all students of board",x);for(let b of d){var w=b.studentId.toString(10),Y=b.studentDisplayableName;bDebug===!0&&console.log('%c Working on student "%s"',x,Y),ft(`Collecte les donn\xE9es de l'\xE9tudiant : ${Y}`);var m=b.followedProjectSlug;m.length==0&&(m="non d\xE9fini"),bDebug===!0&&console.log('%cWill collect student "%s" funding',x,Y);let h=await ue.getFundingFomDashboard(w);re(typeof w=="string","sStudentId need to be a string.",TypeError);var c=ue.m_findById(w,null);if(c===void 0){bDebug===!0&&console.log(`%cStudent ${Y} (id:${w}) not present in student database will create it`,x),ue.add(w,Y,m,h,f);continue}h.toLowerCase()!==c.funding.toLowerCase()&&(t.get(ue.tbl_name).find({id:w}).assign({funding:h.toLowerCase()}).write(),je.addFunding(w,c.funding.toLowerCase(),dayjs()),console.log(`%c[Student.getAll]Student ${Y}(id:${w}) was already present in database but change of funding was detected (from ${c.funding.toLowerCase()} to ${h.toLowerCase()})`,x)),m!==c.path&&(t.get(ue.tbl_name).find({id:w}).assign({path:m}).write(),je.addPath(w,c.path,dayjs()),console.log(`%c[Student.getAll]Student ${Y}(id:${w}) was already present in database but change of path was detected (from ${c.path} to ${m})`,x))}}),U(_e,"showList",function(){let n=q.Cfg.dbase.get(ue.tbl_name).value();var a="";a+="<table>",a+="<caption>Liste des \xE9tudiant</caption>",a+="<thead>",a+="<tr>",a+="<th>Nom</th><th>Parcours</th><th>Financement</th><th>Date de cr\xE9ation</th><th>Edition</th>",a+="</tr>",a+="</thead>",a+="<tbody>";for(var e in n)a+="<tr>",a+=`<td>${n[e].fullname}</td><td>${n[e].path}</td><td>${n[e].funding}</td>`,a+=`<td>${dayjs(n[e].created,"YYYY-MM-DDTHH:mm:ssZ[Z]").format("DD/MM/YYYY \xE0 HH:mm")}</td>`,a+=`<td><a href="https://openclassrooms.com/fr/mentorship/students/${n[e].id}/dashboard">${n[e].id}</a></td>`,a+="</tr>";a+="</tbody>",a+="</table>",Swal.fire({title:"<strong>Liste des Etudiants</strong>",icon:"info",html:a,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"fullscreen",onOpen:t=>{var u=t.querySelector("table"),l=new simpleDatatables.DataTable(u)}})}),U(_e,"createManually",async function(o,n,a){let e=["non pr\xE9sent dans la liste","Chef de projet digital","Chef de projet SI","D\xE9veloppeur d'application - Frontend","D\xE9veloppeur Web","Expert en strat\xE9gie marketing et communication ","Production de contenu web avec CMS et Content Marketing ","Tech lead"];var t="";t+="<style>",t+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",t+="form input {background: #fff;border: 1px solid #9c9c9c;}",t+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",t+="form button:hover {background: gold;}",t+="form label {padding: 0.5em 0.5em 0.5em 0;}",t+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",t+="form input:focus {outline: 3px solid gold;}",t+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}label {text-align: right;grid-column: 1 / 2;}input,button {grid-column: 2 / 3;}}",t+="</style>",t+='<form class="form1" action="">',t+='<label for="student_id" class="name">Reference</label>',t+='<input id="student_id" type="text" value="'+o+'">',t+='<label for="student_name" class="name">Name</label>',t+='<input id="student_name" type="text" value="'+n+'">',t+='<label for="funding">Autofinanc\xE9</label>',t+='<input id="funding" type="checkbox" value="autofunded">',t+='<label for="student_path">Parcours</label>',t+='<input id="student_path" name="student_path" type="text" list="student_path-list">',t+='<datalist id="student_path-list">';for(var u in e)t+=`<option>${e[u]}</option>`;t+="/<datalist>",t+='<label for="session_date">Date</label>',t+='<input id="session_date" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(a).format("YYYY-MM-DD")+'">',t+="</form>";let{value:l}=await Swal.fire({title:"<strong>Ajout d'un \xE9tudiant en mode manuel</strong>",icon:"info",html:t,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:`votre \xE9tudiant(e) ${n} n'a pas \xE9t\xE9 trouv\xE9`,preConfirm:()=>({student_id:document.getElementById("student_id").value,student_name:document.getElementById("student_name").value,student_path:document.getElementById("student_path").value,student_funding:document.getElementById("funding").checked,session_date:document.getElementById("session_date").value})});if(l&&l.hasOwnProperty("student_id")){var c="";l.student_funding===!0?c=qe:c=Ye,ue.add(l.student_id,l.student_name,l.student_path,c,l.session_date)}});var ge=_e;var jn=function(){let p="refs",o=0,n=1,a=2,e={DEFAULT:0,SESSIONID_DATEREFID:1},t=function(){q.Cfg.dbase.get("refs").value()===void 0&&(console.log("%cDb dont' contain ref table create it",x),q.Cfg.dbase.assign({refs:[]}).write())},u=function(w,Y,m=e.DEFAULT){let b=q.Cfg.dbase;var h=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");let M=l({key1:w,key2:Y,type:m,created:h,updated:h});an(50),re(Array.isArray(M)&&M.length>0,"Database insertion fail")},l=function(w){return q.Cfg.dbase.get(st.tbl_name).push(JSON.parse(JSON.stringify(w))).write()};return Object.freeze({tbl_name:p,TYPE:e,add:u,updKey1:function(w,Y,m=e.DEFAULT){let b=q.Cfg.dbase,h;h=b.get(st.tbl_name).find(C=>C.key2===w&&C.type===m).assign({key1:Y}).write(),console.log("%cNeedle  %o mValue %o sType %o",x,w,Y,m),console.log("%c_r %o",x,h),re(Array.isArray(h)&&h.length>0,"Database insertion fail")},updKey2:function(w,Y,m=e.DEFAULT){let b=q.Cfg.dbase,h;h=b.get(st.tbl_name).find(C=>C.key1===w&&C.type===m).assign({key2:Y}).write(),console.log("%cNeedle  %o mValue %o sType %o",x,w,Y,m),console.log("%c_r %o",x,h),re(Array.isArray(h)&&h.length>0,"Database insertion fail")},checkSupport:t,exists:function(w,Y,m=e.DEFAULT){let b=st.getByKey(w,Y,m);return console.log(`%cRef ${w} exists in db ? ${b!==void 0}`,x),b!==void 0},getByKey:function(w,Y=1,m=e.DEFAULT){re(typeof Y=="number","You must provide a number as index of key.",TypeError);let b=q.Cfg.dbase,h=null;if(Y==1&&(h=b.get(st.tbl_name).find(C=>C.key1===w&&C.type===m).value()),Y==2&&(h=b.get(st.tbl_name).find(C=>C.key2===w&&C.type===m).value()),h!=null)return h}})},st=jn(),Ee=st;var Ln=function(){let p="meta",o=function(d){return re(typeof d=="string","You must provide a string.",TypeError),q.Cfg.dbase.get(wt.tbl_name).find({key:"dbVersion"}).assign({value:d}).write().value},n=function(){let d=q.Cfg.dbase.get(wt.tbl_name).find({key:"dbVersion"}).value();return typeof d=="undefined"?-1:d.value},a=function(){return q.Cfg.dbase.get("meta").remove(d=>!0).write()},e=function(){return console.log("%c resetDbVersion NE FONCTIONNE PAS",de),q.Cfg.dbase.get("meta").find({key:"dbVersion"}).remove(d=>!0).write()},t=function(d){return re(typeof d=="string","You must provide a string.",TypeError),q.Cfg.dbase.get(wt.tbl_name).find({key:"studentLstUpd"}).assign({value:d}).write().value},u=function(){let d=q.Cfg.dbase.get(wt.tbl_name).find({key:"studentLstUpd"}).value();return typeof d=="undefined"?-1:d.value};return Object.freeze({checkSupport:function(){q.Cfg.dbase.get("meta").value()===void 0&&(console.log("%cDb dont' contain meta table create it",x),q.Cfg.dbase.assign({meta:[]}).write()),n()==-1&&q.Cfg.dbase.get("meta").push({key:"dbVersion",value:"1.0.0"}).write(),u()==-1&&q.Cfg.dbase.get("meta").push({key:"studentLstUpd",value:dayjs("19701006").toISOString()}).write()},getDbVersion:n,setDbVersion:o,delDbVersion:e,setStudentListUpd:t,getStudentListUpd:u,remStudentListUpd:function(){return t(dayjs("19701006").toISOString())},tbl_name:p})},wt=Ln(),Te=wt;var Rn=function(){let p={},o="0",n=!0,a="https://api.openclassrooms.com",e="pending",t="canceled",u="completed",l="late canceled",c="marked student as absent",d=async function(){let E=await i();return E=JSON.parse(E),o=E.id,o},f=async function(){if(p.length==0)throw new Error("_header is empty, no xhr have been trapped so could't do some api request")},i=async function(){let E=a+"/me";return await T(E)},w=function(E,A){return{Range:`items=${E}-${A}`}},Y=async(E=dayjs(),A=0,S=19)=>await h("AFTER",E,[e],A,S),m=async(E=dayjs(),A=0,S=19)=>await h("BEFORE",E,[e],A,S),b=async(E,A=0,S=19)=>await C(E,A,S),h=async function(E="BEFORE",A,S=[t,u,l,c],$=0,I=19){bDebug=!0,typeof A=="string"&&(A=dayjs(A)),re(Yt(S)===!0,"You must provide an array as param aFilter.",TypeError),re(A instanceof dayjs,"date must be a string or a dayjs object.",TypeError);let P=S.join(","),k=encodeURIComponent(A.format("YYYY-MM-DDTHH:MM:ss[Z]"));P=encodeURIComponent(P);let j="";o==0&&await d(),E==="AFTER"?(j=`${a}/users/${o}/sessions?actor=expert&after=${k}&life-cycle-status=${P}`,console.log("URL IS %s",j)):(j=`${a}/users/${o}/sessions?actor=expert&before=${k}&life-cycle-status=${P}`,console.log("URL IS %s",j));let O=w($,I);return bDebug&&console.log("%c_getSessionOnDate url to call is:%s , params are %o",x,j,O),await y(j,w($,I))},C=async function(E=[],A=0,S=19){bDebug=!0,re(Yt(E)===!0,"You must provide an array as param aFilter.",TypeError),E.length==0&&(E=[t,u,l,c]);let $=E.join(",");$=encodeURIComponent($),o==0&&await d();let I=`${a}/users/${o}/sessions?actor=expert&life-cycle-status=${$}`,P=w(A,S);bDebug&&console.log("%cUrl to call is:%o , params are %o",x,I,P);let k=await y(I,P);if(k==null)throw console.error("%cAPI have a problem returned value %o is null|undefined",de,k),new Error(`Request:${a}/users/${o}/sessions?actor=expert&life-cycle-status=${$} have a problem`);return k.errors&&console.log("%cAPI return an error %s",de,k.errors.message),k},M=async function(E){let A=`${a}/users/${E}`;return await y(A)},B=async function(E){await f();let A=`${a}/users/${E}/paths/followed-path`;return await y(A)},D=async function(E){let A=`${a}/users/${E}/paths`;return await y(A)},y=async function(E,A={}){return await f(),await T(E,A)},g=async function(E){return await f(),await R(E,mData)},s=function(E){o=E},v=function(E){return decodeURI(E)!==decodeURIComponent(E)},T=async function(E="",A={},S="json",$="",I=!0){let P=Object.assign({"User-Agent":"Mozilla/5.0"},p,A);if(S.toLowerCase()==="json")return(await Ze.XHR({method:"GET",url:E,responseType:"application/json",headers:P}).catch(O=>{console.error("%c[Api_fetchGer()]Error is %o",de,O)})).responseText;if(S.toLowerCase==="html"){let j=await Ze.XHR({method:"GET",url:E,responseType:"application/json",headers:P}).catch(oe=>{console.error("%c[Api_fetchGer()]Error is %o",de,oe)}),L=new DOMParser().parseFromString(j.responseText.replace(/\n/mg,""),"text/html");var k={};return I===!0?k=L.querySelectorAll($):k=L.querySelector($),k}},R=async function(E="",A={},S={}){};return function(){let E=!1,A="color:DarkSalmon;background-color:AliceBlue;";var S=window.XMLHttpRequest.prototype.open,$=window.XMLHttpRequest.prototype.send,I=window.XMLHttpRequest.prototype.setRequestHeader,P=function(L,oe,me,ce,fe){return E===!0&&console.log("%cmethod %o url:%o, async:%o, user %o, password:%o",A,L,oe,me,ce,fe),this._url=oe,this._requestHeaders={},this._knox=[],S.apply(this,arguments)},k=function(){if(E===!0&&console.log("%cReady state changed to: %o",A,this.readyState),this.readyState===4&&this.status&&this.status>=200&&this.status<300){if(this._url.match(/^https:\/\/api.openclassrooms.com/g)){E===!0&&console.log("%cOPENCLASSROOMS API",A);for(var L in this._knox)p[this._knox[L].key]=this._knox[L].value;E===!0&&console.log("%c _header is %o",A,p),E===!0&&(v(this._url)?console.log("%cDECODED URL:%s",A,decodeURIComponent(this._url)):console.log("%c DECODED URL:%s",A,decodeURI(this._url)))}E===!0&&console.log("%cResponse is :%o",A,this.response)}if(this._onreadystatechange)return this._onreadystatechange.apply(this,arguments)},j=function(L){return E===!0&&console.log("%csendReplacement(%o)",A,L),this.onreadystatechange&&(this._onreadystatechange=this.onreadystatechange),this.onreadystatechange=k,$.apply(this,arguments)},O=function(L,oe){return this._url.match(/^https:\/\/api.openclassrooms.com/g)&&this._knox.push({key:L,value:oe}),this._requestHeaders[L]=oe,I.apply(this,arguments)};window.XMLHttpRequest.prototype.open=P,window.XMLHttpRequest.prototype.send=j,window.XMLHttpRequest.prototype.setRequestHeader=O}(),Object.freeze({forge:s,getPendingSessionAfter:Y,getPendingSessionBefore:m,getHistorySession:b,getUser:M,getUserFollowedPath:B,getUserPath:D,getMe:i,xGet:y,xPost:g})},Pn=Rn(),Ct=Pn;var ze=function(){let o="history_session_cache",n=!1,a=function(){n===!0&&console.log("%cDb dont' contain table history_session_cache table, will create it",x),q.Cfg.dbase.assign({history_session_cache:[]}).write()},e=function(){return q.Cfg.dbase.get(o).value()!==void 0};return{find:function(i){if(e===!1)throw new Error("%c_HistoryDb:DBFindInTable() failed reason : table is not defined",x);return n===!0&&console.log('%c_HistoryDb:DBFindInTable()  Request is App.Cfg.dbase.get("%s").find(%o).value()',x,o,i),q.Cfg.dbase.get(o).find(i).value()},getAll:function(){if(e===!1)throw new Error("%c_HistoryDb:DBGetAll() failed reason : table is not defined",x);return n===!0&&console.log('%c_HistoryDb:DBGetAll()  Request is App.Cfg.dbase.get("%s").value()',x,o),q.Cfg.dbase.get(o).value()},insert:function(i){return e===!1&&a(),n===!0&&console.log("%c_HistoryDb:DBInsertInTable table:%s data:%o)",x,o,i),q.Cfg.dbase.get(o).push(i).write()},remove:function(i={}){if(e===!1)throw new Error("%c_HistoryDb:DBRemove() failed reason : table is not defined",x);return n===!0&&console.log("%c_HistoryDb:DBRemove with filter",x),sn(i)===!0&&console.log("%c_HistoryDb:DBRemove /! filter is empty",x),q.Cfg.dbase.get(o).remove(i).write()},reset:function(){return n===!0&&console.log("%c_History:DBResetTable",x),q.Cfg.dbase.get(o).remove().write()},update:function(i,w){if(e===!1)throw new Error("%c_HistoryDb:DBUpdateInTable() failed reason : table is not defined",x);return q.Cfg.dbase.get(o).find(i).assign(w).write()}}}(),Fn=function(){let p="history_session_cache",o=function(){let d=!0;q.Cfg.dbase.get("history_session_cache").value()===void 0&&(d&&console.log("%cDb dont' contain history_session_cache table create it",x),q.Cfg.dbase.assign({history_session_cache:[]}).write())},n=function(d){let f=!0;typeof d=="string"&&(d=dayjs(d)),re(d instanceof dayjs,"date must be a string or a dayjs object.",TypeError);let i=ze.find({id:+d.format("YYYYMMDD")});return f&&console.log(`%cHistory:_exists ${d.format("YYYYMMDD")} in db ? ${i!==void 0}`,x),i!==void 0},a=function(d){let f=!0;if(typeof d=="string"&&(d=dayjs(d)),re(d instanceof dayjs,"date must be a string or a dayjs object.",TypeError),d.get("day")<d.daysInMonth()&&(d=d.endOf("month")),f===!0&&console.log(`%cSearch in history session cache data for id: ${d.format("DD/MM/YYYY")}`,x),n(d)===!0){if(_r=ze.find({id:+d.format("YYYYMMDD")}),typeof _r.index!==void 0)return _r.index;throw new Error("_getSessionIndex() failed reason : property index is unknown")}return-1},e=function(d){let f=!1;typeof d=="string"&&(d=dayjs(d)),re(d instanceof dayjs,"date must be a string or a dayjs object.",TypeError),f===!0&&console.log(`%cSearch in history session cache NEAREST cached data for id: ${d.format("DD/MM/YYYY")}`,x);let i=+d.format("YYYYMMDD"),w=ze.getAll();if(w.length===0)return f===!0&&console.log("%cHistory session cache is empty",x),-1;w=w.map(b=>+b.id-i).filter(b=>b>0);let Y=b=>Math.min(...b);if(w.length==0)return f===!0&&console.log("%cAll indexes  %o are later than your date:%s",x,ze.getAll(),d.format("DD/MM/YYYY")),-1;let m=Y(w)+i;if(f===!0&&console.log("%cNearest data in history session cache is data with id: %o",x,m),n(m)===!0){if(w=ze.find({id:+m.format("YYYYMMDD")}),typeof w.index!==void 0)return w.index;throw new Error("[History._getNearestSessionIndex()] failed reason : property index is unknown")}return-1};return Object.freeze({tbl_name:p,getSameOrNearestSessionIndex:function(d){let f=a(d);return f===-1&&(f=e(d)),f},remove:function(d=null,f=null){typeof d=="string"&&(d=dayjs(d)),typeof f=="string"&&(f=dayjs(f));let i=function(){};return d!==null&&f!==null&&(i=function(w){return dayjs(w.id.toString(10)).isBetween(d,f,"day","[]")}),d==null&&f!==null&&(i=function(w){return dayjs(w.id.toString(10)).isBefore(f,"day")}),d!=null&&f==null&&(i=function(w){return dayjs(w.id.toString(10)).isAfter(d,"day")}),ze.remove(i)},reset:function(){return ze.reset()},setSessionIndex:function(d,f=0){typeof d=="string"&&(d=dayjs(d)),re(d instanceof dayjs,"date must be a string or a dayjs object.",TypeError),d.get("day")<d.daysInMonth()&&(d=d.endOf("month"));let i=a(d);return i==-1?i=ze.insert({id:+d.format("YYYYMMDD"),index:f}):i=ze.update({id:+d.format("YYYYMMDD")},{index:f}),i}})},Nn=Fn(),at=Nn;var ve=class{static getBetween(o,n){return typeof o=="string"&&(o=dayjs(o)),typeof n=="string"&&(o=dayjs(n)),q.Cfg.dbase.get(ve.tbl_name).filter(t=>dayjs(t.when).isSameOrBefore(n,"day")&&dayjs(t.when).isSameOrAfter(o,"day")).value()}},De=ve;U(De,"tbl_name","sessions"),U(De,"_checkObject",function(o){!1===!0&&console.log("%cChecking object session:%o ",x,o),re(typeof o.id=="string","Session object id need to be a string.",TypeError),re(typeof o.cid=="number","Session object cid need to be a number.",TypeError),re(typeof o.who_id=="string","Session object who_id need to be a string.",TypeError),re(typeof o.who_name=="string","Session object who_name need to be a string.",TypeError),re(typeof o.status=="string","Session object status need to be a string.",TypeError),re(typeof o.type=="string","Session object type need to be a string.",TypeError),re(typeof o.lvl=="string","Session object lvl need to be a string.",TypeError),re(typeof o.when=="string","Session object when need to be a string.",TypeError),re(typeof o.path=="string","Session object path need to be a string.",TypeError),re(typeof o.funding=="string","Session object funding need to be a string.",TypeError)}),U(De,"add",async function(o){let n=30,a=!0;a===!0&&console.log("%cSession.add() so you wanna add a session %o to database",x,o);let e=q.Cfg.dbase;if(GM_config.get("checksessionalreadyexists")===!0)var t=!0;if(a===!0&&console.log("%cSession.add() will search if session %o is already in database",x,o),o.id.length>0){if(t===!0&&ve.exists(o.id)===!0){a===!0&&console.info(`%cSession.add() session id:${o.id} already present in database table sessions, skip it!`,x);return}}else if(t===!0&&ve.exists(o.cid)===!0){a===!0&&console.info(`%cSession.add() session cid:${o.cid} already present in database table sessions, skip it!`,x);return}o.type.toLowerCase()==="presentation"&&(o.type="soutenance"),Ae.isInOldMode(dayjs(o.when))?(o.funding=Ye,o.type.toLowerCase()==="soutenance"?o.path="n/a (defense)":o.path="n/a (old mode)"):o.type.toLowerCase()==="soutenance"?(o.funding=Ye,o.path="n/a (defense)"):(ge.exists(o.who_id)===!1&&(console.warn("%cStudent %s not in Db, will updating student db by fetching students list from dashboard",Ge,o.who_id),a===!0&&console.log("%cLast Update of Student BDD was %i min ago",x,dayjs(Te.getStudentListUpd()).diff(dayjs(),"m")),dayjs(Te.getStudentListUpd()).diff(dayjs(),"m")<-n?(await ge.getAll(),Te.setStudentListUpd(dayjs().toISOString())):(console.log("%c[Session.add()]last Update of database DB was less than %i min ago",x,n),await ge.createManually(o.who_id,o.who_name,o.when),moize.default.isMoized(ge.m_findById)&&ge.m_findById.has([o.who_id,null])&&(ge.m_findById.remove([o.who_id,null]),a===!0&&console.log("%c[Session.add()]student %s removed from the m_findById function cache",x,o.who_id))),console.log("%c[Student.add()] pr\xE9c\xE9demment notre \xE9tudiant %o  n'existait pas existe t'il maintenant ?",x,o.who_id),console.log("%c[Student.add()] la r\xE9ponse est :%o",x,ge.exists(o.who_id,o.when)),ge.exists(o.who_id,o.when)==!1&&(console.warn(`%c[Session.add()] Student ${o.who_id} which exists at ${o.when} still not exit in Db, have to manually create him/her`,Ge),await ge.createManually(o.who_id,o.who_name,o.when),moize.default.isMoized(ge.m_findById)&&ge.m_findById.has([o.who_id,o.when])&&(ge.m_findById.remove([o.who_id,o.when]),a===!0&&console.log("%c[Session.add()]student %s removed from the m_findById function cache",x,o.who_id)))),o.funding=await ge.getFunding(o.who_id,o.when),o.path=await ge.getPath(o.who_id,o.when)),o.cid===void 0&&(a===!0&&console.log("%c[Session.add()] need to calculate a cid]",x),o.cid=ve.getHashId(o.when,o.who_id)),a===!0&&console.log("%cSession.add() calculated id:%s",x,o.cid),_r=Ee.getByKey(o.cid,2,Ee.TYPE.SESSIONID_DATEREFID),_r!==void 0&&(a===!0&&console.log("%cSession.add() I've found a ref %d by using key (%s)%d",x,_r.key1,typeof o.cid,o.cid),o.id=_r.key1.toString()),ve._save(o)}),U(De,"_save",function(o){var n=!1;ve._checkObject(o),o.lvl==""&&(o.lvl="2"),o.lvl.lvl=parseInt(o.lvl.lvl,10),bDebug===!0&&console.log(`%c[Session._save()] saving session id:${o.id} of ${o.who_name}[cid:${o.cid}](${o.who_id}) at ${o.when} to DB`,x),q.Cfg.dbase.get(ve.tbl_name).push(JSON.parse(JSON.stringify(o))).write()}),U(De,"exists",function(o){let n=q.Cfg.dbase;var a=!1;a===!0&&console.log(`%c[Session.exist()] will search existence of session id:(${typeof o})${o} in database`,x);var e=ve.findById(o);return e!==void 0}),U(De,"findById",function(o){let n=q.Cfg.dbase;var a=n.get(ve.tbl_name).find({id:o}).value();return a===void 0&&(a=n.get(ve.tbl_name).find({cid:o}).value()),a}),U(De,"delete",function(o=null,n=null){let a=q.Cfg.dbase;if(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),o===null&&n==null){console.log("%cWanna suppress ALL Sessions from DB",x),a.get(ve.tbl_name).remove().write();return}if(n==null){a.get(ve.tbl_name).remove(function(e){return dayjs(e.when).isBefore(n),"day"}).write();return}if(o==null){a.get(ve.tbl_name).remove(function(e){return dayjs(e.when).isAfter(o,"day")}).write();return}a.get(ve.tbl_name).remove(function(e){return dayjs(e.when).isBetween(o,n,"day","[]")}).write()}),U(De,"deleteById",function(o){q.Cfg.dbase.get("sessions").remove(a=>a.id===o).write(),console.log(`%cSession ${o} suppressed from DB`,x)}),U(De,"parseTable",function(o){var n=o.children[0].children[0].innerText,a=Ve(o.children[0]),e=o.children[1].children[0].innerText.trim(),t=Ve(o.children[1],-2),u=o.children[2].innerText.trim().toLowerCase(),l=o.children[3].children.length?o.children[3].children[0].innerText.trim().toLowerCase():"session",c=-1;o.children[4].children.length>0&&(c=o.children[4].children[0].innerText.trim()),n=en(n);var d={id:a,when:n,who_id:t,who_name:e,status:u,type:l,lvl:c};return d}),U(De,"getHashId",function(o,n){return o instanceof dayjs&&(o=o.toISOString()),typeof n=="number"&&(n=n.toString(10)),re(typeof o=="string"&&typeof n=="string","getId need two string",TypeError),rn(o+n)}),U(De,"parseRow",function(o){!0===!0&&console.log("%cparseRow() Row is %o",x,o);var a=o.children[0].innerText.length>0?o.children[0].innerText.trim().toLowerCase():"session",e=o.children[0].querySelector("svg").getAttribute("aria-label").trim().toLowerCase(),t=o.children[1].querySelector("time").dateTime;t=dayjs(t).toISOString();var u=Ve(o.children[2],-2),l=o.children[2].innerText.trim(),c=ve.getHashId(t,u),d=o.children[3].innerText.trim();d=d.replace(/[^\d]/gmis,"");var f={id:"",cid:c,when:t,who_id:u,who_name:l,status:e,type:a,lvl:d};return f}),U(De,"getSessionsFromAPI",async function(o,n){let a=!1,e=999,t=0,u=!0,l=0,c=20;typeof o=="string"&&(o=dayjs(o)),re(o instanceof dayjs,"dtFrom must be a string or a dayjs object.",TypeError),typeof n=="string"&&(n=dayjs(n)),re(n instanceof dayjs,"dtTo must be a string or a dayjs object.",TypeError);let d=at.getSameOrNearestSessionIndex(n);d!==void 0&&typeof d=="number"&&d>l&&(l=d);var f=n.diff(o,"d")+1;for(NProgress.start();u===!0;){if(t>e){console.error("%c[Session.getSessionsFromAPI()] EMERGENCY EXIT LOOP",de);break}t+=1;var i=l+(c-1),w=await Ct.getHistorySession([],l,i);if(w===null)throw new Error("Api.getHistorySession is null");var Y=JSON.parse(w);if(Y.errors)throw Object.entries(oSession.errors).forEach(h=>console.log("%cApi.getHistorySession send us some errors : %s",Ge,h[1].message)),new Error("Api.getHistorySession send us some errors ");a===!0&&console.log("%cgetSessionsFromAPI() Sessions are %o",x,Y),l=i+1,oSession=ve.parseRowFromApi(Y[Y.length-1]),console.log("%c[Session.getSessionsFromAPI()]La derni\xE8re session r\xE9cuper\xE9e par api date de:%s et nous collectons les sessions entre %s et %s",x,dayjs(oSession.when).format("DD/MM/YYYY"),dayjs(o).format("DD/MM/YYYY"),dayjs(n).format("DD/MM/YYYY")),a===!0&&console.log("%cgetSessionsFromAPI() last session of loaded page is %o",x,oSession),console.log("%c[Session.getSessionsFromAPI()] compare last session date %s avec la date de d\xE9but %s est ce ant\xE9rieur  %o",x,dayjs(oSession.when).format("DD/MM/YYYY"),dayjs(o).format("DD/MM/YYYY"),dayjs(oSession.when).isBefore(o)),dayjs(oSession.when).isBefore(o)===!0&&(u=!1,a===!0&&console.log("%cgetSessionsFromAPI() last session is before start date of parsing %s STOP browsing....",x,dayjs(oSession.dtFrom).format("DD/MM/YYYY")),at.setSessionIndex(oSession.when,l));let b=Y.filter(h=>dayjs(h.sessionDate).isBetween(o,n,"day","[]"));a===!0&&console.log("%cgetSessionsFromAPI() Filtered on date Sessions are %o",x,b);for(let h of b){oSession=ve.parseRowFromApi(h),a===!0&&console.log("%cgetSessionsFromAPI()  will call Session.add() on %o",x,oSession);let C=await ve.add(oSession);var m=dayjs(n).diff(oSession.when,"d")+1;NProgress.set(m/f)}l=i+1}NProgress.done(),await ft(`Collecte des sessions du ${o.format("DD/MM/YYYY")} au ${n.format("DD/MM/YYYY")} termin\xE9e`)}),U(De,"parseRowFromApi",function(o){bDebug=!1,bDebug===!0&&console.log("%cparseRowFromApi() oSession is %o",x,o);let n={};return n.id="",n.who_id=o.recipient.id,typeof n.who_id=="number"&&(n.who_id=n.who_id.toString(10)),n.who_name=o.recipient.displayableName,o.status===Kt&&(n.status=et),o.status===Vt&&(n.status=Ke),o.status===Jt&&(n.status=tt),o.status===Zt&&(n.status=nt),n.status===void 0&&(n.status=o.status),n.type=o.type,n.type.toLowerCase()==="mentoring"&&(n.type="mentorat"),n.lvl=o.projectLevel,n.lvl==null&&(n.lvl=""),n.when=dayjs(o.sessionDate).toISOString(),n.path=null,n.funding=null,n.cid=ve.getHashId(n.when,n.who_id),n});var Ce=De;var At=class{},pt=At;U(pt,"calculateBill",function(o,n){let a=n.format("YYYYMM");return it.exists(a)===!0?(console.log(`%cUse Archived version ${a} of accounting`,x),it.get(a).data):(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),At.m_calculateBill(o,n))}),U(pt,"_calculateBill",function(o,n){typeof o=="string"&&(o=dayjs(o)),typeof n=="string"&&(n=dayjs(n));let a=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");var e=0,t=0,u=performance.now();let d=q.Cfg.dbase.get(Ce.tbl_name).filter(s=>dayjs(s.when).isSameOrBefore(n,"day")&&dayjs(s.when).isSameOrAfter(o,"day")).value(),f=d.length,i={from:o,to:n,created_at:null,maxLevel:ot,number:0,amount:0,errors:{funding:[],level:[],path:[],status:[],type:[]},flatFee:[]},w=0,Y=0,m=[];e=performance.now();let b=At.getPriceList(o);t=performance.now(),console.log("%cGetPriceList took "+(t-e)+" milliseconds.",Re);let h=on([ot+1,ot+1,ot+1,ot+1]);for(var C=0;C<f;C+=1){let s=d[C];var M=0;s.status===et&&(M=Z),s.status===Ke&&(M=X),s.status===tt&&(M=V),(s.status===nt||s.status===ht)&&(M=ee);var B=0;s.type.toLowerCase()==="session"&&(B=F),s.type.toLowerCase()==="mentorat"&&(B=Wt),s.type.toLowerCase()==="soutenance"&&(B=N),s.path!=null&&s.path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&s.type!=="soutenance"&&(B=H);var D=0;let v=Ae.isInOldMode(o);if(v===!0&&(D=s.isFunded===!0?W:z),s.funding===qe&&(D=z),s.funding===Ye&&(D=W),s.funding===Xe&&(D=K),s.lvl==""){i.errors.level.push(s);continue}if(typeof s.lvl=="string"&&(s.lvl=parseInt(s.lvl,10)),s.lvl<0){i.errors.level.push(s);continue}if(v===!1&&s.funding!==qe&&s.funding!==Ye&&s.funding!==Xe){i.errors.funding.push(s);continue}if(s.type.toLowerCase()!=="session"&&s.type.toLowerCase()!=="mentorat"&&B!==N&&B!==H){i.errors.type.push(s);continue}if(s.status!==et&&s.status!==Ke&&s.status!==tt&&s.status!==nt&&s.status!==ht){i.errors.status.push(s);continue}let T=h.get(B,M,D,+s.lvl);T===void 0&&(T={number:0,amount:0,data:[]}),T.number+=1,w+=1,s.lvl<0?(T.amount+=0,Y+=0):(T.amount+=1*b[s.lvl][B][M][D],Y+=1*b[s.lvl][B][M][D]),T.data.push(s),h.set(B,M,D,+s.lvl,T),B===F&&D===z&&s.status!==Ke&&m.push({id:+s.who_id,who_id:s.who_id,who_name:s.who_name})}var y=[];e=performance.now(),y=_.uniqBy(m,"id"),i.flatFee=y,i.number=w,i.amount=Y,i.number+i.errors.funding.length+i.errors.level.length+i.errors.path.length+i.errors.status.length+i.errors.type.length<f&&(console.log(`%cError total number of sessions is ${f} and total number of sessions in bill ${w} + all errors are different`,de),console.log("errors are",i.errors),console.log("sessions are",d)),i.created_at=a,h.set(0,0,0,0,i);var g=performance.now();return console.log("%cFunction took "+(g-u)+" milliseconds.",Re),i.errors.funding.length+i.errors.level.length+i.errors.path.length+i.errors.status.length+i.errors.type.length>0&&console.log("%cWarning some errors found %o",Ge,i.errors),h}),U(pt,"m_calculateBill",moize.default(At._calculateBill,{maxAge:12e4,isSerialized:!0})),U(pt,"getPriceList",function(o){typeof o=="string"&&(o=dayjs(o));var n=[0,Ht,Ut,Gt,qt,Qt,zt];let a=Ae.isInOldMode(o);var e=new Array(7);for(let t=1;t<=ot;t+=1){let u=n[t],l=n[t]/2,c=n[t]/4;a?(e[t]=new Array(3),e[t][F]=new Array(5),e[t][F][Z]=new Array(4),e[t][F][Z][z]=u,e[t][F][Z][W]=u,e[t][F][Z][K]=u,e[t][F][X]=new Array(4),e[t][F][X][z]=0,e[t][F][X][W]=0,e[t][F][X][K]=0,e[t][F][V]=new Array(4),e[t][F][V][z]=l,e[t][F][V][W]=l,e[t][F][V][K]=l,e[t][F][ee]=new Array(4),e[t][F][ee][z]=l,e[t][F][ee][W]=l,e[t][F][ee][K]=l,e[t][N]=new Array(5),e[t][N][Z]=new Array(4),e[t][N][Z][z]=u,e[t][N][Z][W]=u,e[t][N][Z][K]=u,e[t][N][X]=new Array(4),e[t][N][X][z]=0,e[t][N][X][W]=0,e[t][N][X][K]=0,e[t][N][V]=new Array(4),e[t][N][V][z]=l,e[t][N][V][W]=l,e[t][N][V][K]=l,e[t][N][ee]=new Array(4),e[t][N][ee][z]=l,e[t][N][ee][W]=l,e[t][N][ee][K]=l,e[t][H]=new Array(5),e[t][H][Z]=new Array(4),e[t][H][Z][z]=u,e[t][H][Z][W]=u,e[t][H][Z][K]=u,e[t][H][X]=new Array(4),e[t][H][X][z]=0,e[t][H][X][W]=0,e[t][H][X][K]=0,e[t][H][V]=new Array(4),e[t][H][V][z]=l,e[t][H][V][W]=l,e[t][H][V][K]=l,e[t][H][ee]=new Array(4),e[t][H][ee][z]=l,e[t][H][ee][W]=l,e[t][H][ee][K]=l):(e[t]=new Array(3),e[t][F]=new Array(5),e[t][F][Z]=new Array(4),e[t][F][Z][z]=l,e[t][F][Z][W]=u,e[t][F][Z][K]=u,e[t][F][X]=new Array(4),e[t][F][X][z]=0,e[t][F][X][W]=0,e[t][F][X][K]=0,e[t][F][V]=new Array(4),e[t][F][V][z]=0,e[t][F][V][W]=0,e[t][F][V][K]=0,e[t][F][ee]=new Array(4),e[t][F][ee][z]=c,e[t][F][ee][W]=l,e[t][F][ee][K]=l,e[t][N]=new Array(5),e[t][N][Z]=new Array(4),e[t][N][Z][z]=u,e[t][N][Z][W]=u,e[t][N][Z][K]=u,e[t][N][X]=new Array(4),e[t][N][X][z]=0,e[t][N][X][W]=0,e[t][N][X][K]=0,e[t][N][V]=new Array(4),e[t][N][V][z]=0,e[t][N][V][W]=0,e[t][N][V][K]=0,e[t][N][ee]=new Array(4),e[t][N][ee][z]=l,e[t][N][ee][W]=l,e[t][N][ee][K]=l,e[t][H]=new Array(5),e[t][H][Z]=new Array(4),e[t][H][Z][z]=u,e[t][H][Z][W]=u,e[t][H][Z][K]=u,e[t][H][X]=new Array(4),e[t][H][X][z]=0,e[t][H][X][W]=0,e[t][H][X][K]=0,e[t][H][V]=new Array(4),e[t][H][V][z]=0,e[t][H][V][W]=0,e[t][H][V][K]=0,e[t][H][ee]=new Array(4),e[t][H][ee][z]=l,e[t][H][ee][W]=l,e[t][H][ee][K]=l)}return e});var Ne=pt;var Bt=function(p,o){let n=[[0,1,2,3,4,5,5],[5,1,2,3,4,5,5],[4,5,1,2,3,4,4],[3,4,5,1,2,3,3],[2,3,4,5,1,2,2],[1,2,3,4,5,1,1],[0,1,2,3,4,5,0]];return Math.trunc(o.diff(p,"days")/7)*5+n[p.day()][o.day()]};var mt=class{};U(mt,"detail_bill","truc"),U(mt,"getListDetailBill",function(o,n){let e=q.Cfg.dbase.get(Ce.tbl_name).filter(C=>dayjs(C.when).isSameOrBefore(n,"day")&&dayjs(C.when).isSameOrAfter(o,"day")).sortBy(function(C){return dayjs(C.when).valueOf()}).value(),t=Ae.getOldModeDate(),u=Ne.getPriceList(t.subtract(1,"day")),l=Ne.getPriceList(t),c=0;var d=_.cloneDeep(e);for(var f in d){var i=0,w=0,Y=!0,m=0;d[f].status===et&&(m=Z),d[f].status===Ke&&(m=X),d[f].status===tt&&(m=V),(d[f].status===nt||d[f].status===ht)&&(m=ee);var b=0;d[f].type.toLowerCase()==="session"&&(b=F),d[f].type.toLowerCase()==="soutenance"&&(b=N),d[f].path!=null&&d[f].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&d[f].type!=="soutenance"&&(b=H);var h=0;d[f].funding===qe&&(h=z),d[f].funding===Ye&&(h=W),d[f].funding===Xe&&(h=K),Ae.isInOldMode(dayjs(d[f].when))?i=+d[f].lvl>0?u[+d[f].lvl][b][m][h]:0:(Y=!1,i=+d[f].lvl>0?l[+d[f].lvl][b][m][h]:0),c+=i,d[f].iPu=i,d[f].oldMode=Y,d[f].iCumul=c}return d}),U(mt,"getListStatistic",function(o,n){let a=o.clone(),e=a.endOf("month"),t=[],u=[],l=0,c=n.diff(o,"month");for(var d=performance.now();a.isSameOrBefore(n,"day");)t.push(Ne.calculateBill(a,e)),a=a.add(1,"month"),e=a.endOf("month");var f=performance.now();console.log("%cComputed data between the two dates in"+(f-d)+" milliseconds.",Re),a=o.clone(),e=a.endOf("month");let i=0,w=0,Y=0,m=0,b=0,h=0,C=0;for(;l<=c;){let B=t[l].get(0,0,0,0),D=B.maxLevel;u[l]={header:{dtFrom:null,dtTo:null,created_at:null},sessions:{total:0,nb:0,pu:0,nbc:0},defenses:{total:0,nb:0,pu:0,nbc:0},coaches:{total:0,nb:0,pu:0,nbc:0},bonus:0,kpi:{jrs:0,hrs:0,hrsp:0}};let y=1;for(;y<D;){let s=0,v=0,T=0,R=0;i=t[l].get(F,Z,z,y),Y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,Z,W,y),w=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,Z,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,Ae.isInOldMode(a)?(u[l].kpi.hrs+=(i+w+Y)*(45/60),u[l].kpi.hrsp+=(i+w+Y)*(GM_config.get("nbHrsS")/60)):(u[l].kpi.hrs+=Y*(30/60),u[l].kpi.hrsp+=Y*(GM_config.get("nbHrsAfM")/60),u[l].kpi.hrs+=(i+w)*(45/60),u[l].kpi.hrsp+=(i+w)*(GM_config.get("nbHrsfM")/60)),i=t[l].get(F,X,z,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(F,X,W,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(F,X,K,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,Ae.isInOldMode(a)?(i=t[l].get(F,V,z,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,V,W,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,V,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount):(i=t[l].get(F,V,z,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(F,V,W,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(F,V,K,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount),i=t[l].get(F,ee,z,y),Y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,ee,W,y),w=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,ee,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i,u[l].kpi.hrs+=(i+w+Y)*(15/60),u[l].kpi.hrsp+=(i+w+Y)*(15/60),s=u[l].sessions.total,v=u[l].sessions.nb,T=u[l].sessions.pu,R=u[l].sessions.nbc,u[l].sessions={total:b+s,nb:m+v,pu:(b+s)/(m+v),nbc:h+R},s=0,v=0,T=0,R=0,m=0,b=0,h=0,C=0,i=t[l].get(N,Z,z,y),Y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(N,Z,W,y),w=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(N,Z,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,u[l].kpi.hrs+=(i+w+Y)*(45/60),u[l].kpi.hrsp+=(i+w+Y)*(GM_config.get("nbHrsD")/60),i=t[l].get(N,X,z,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(N,X,W,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(N,X,K,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(N,V,z,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(N,V,W,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(N,V,K,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(N,ee,z,y),Y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(N,ee,W,y),w=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(N,ee,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,u[l].kpi.hrs+=(i+w+Y)*(15/60),u[l].kpi.hrsp+=(i+w+Y)*(15/60),s=u[l].defenses.total,v=u[l].defenses.nb,T=u[l].defenses.pu,R=u[l].defenses.nbc,u[l].defenses={total:b+s,nb:m+v,pu:(b+s)/(m+v),nbc:h+R},s=0,s=0,v=0,T=0,R=0,m=0,b=0,h=0,C=0,i=t[l].get(H,Z,z,y),Y=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(H,Z,W,y),w=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(H,Z,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,u[l].kpi.hrs+=(i+w+Y)*(45/60),u[l].kpi.hrsp+=(i+w+Y)*(GM_config.get("nbHrsC")/60),i=t[l].get(H,X,z,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(H,X,W,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(H,X,K,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(H,V,z,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(H,V,W,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(H,V,K,y),h=typeof i=="undefined"?h:h+i.number,C=typeof i=="undefined"?C:C+i.amount,i=t[l].get(H,ee,z,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(H,ee,W,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(H,ee,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,s=u[l].coaches.total,v=u[l].coaches.nb,T=u[l].coaches.pu,R=u[l].coaches.nbc,i=typeof i=="undefined"?0:i.number,u[l].kpi.hrs+=i*(15/60),u[l].kpi.hrsp+=i*(15/60),u[l].coaches={total:b+s,nb:m+v,pu:(b+s)/(m+v),nbc:h+R},y+=1}let g=B.flatFee.length;for(var M=0;M<g;M+=1)u[l].bonus+=30;e.isAfter(n,"day")&&(e=n.clone()),u[l].kpi.jrs=Bt(a,e),u[l].header.dtFrom=a.format("YYYY-MM-DD"),u[l].header.dtTo=e.format("YYYY-MM-DD"),u[l].header.created_at=dayjs().format("YYYY-MM-DD HH:mm:ss"),a=a.add(1,"month"),e=a.endOf("month"),l+=1}return u}),U(mt,"getListStatisticOld",function(o,n){let a=o.clone(),e=a.endOf("month"),t=[],u=[],l=n.get("month")-o.get("month");for(var c=performance.now();a.isSameOrBefore(n,"day");)t.push(Ne.calculateBill(a,e)),a=a.add(1,"month"),e=a.endOf("month");var d=performance.now();console.log("%cComputed data between the two dates in"+(d-c)+" milliseconds.",Re);let f=0;for(a=o.clone(),e=a.endOf("month"),console.log(t);f<=l;){let i=t[f][0].max_level;u[f]={header:{dtFrom:null,dtTo:null,created_at:null},sessions:{total:0,nb:0,pu:0,nbc:0},defenses:{total:0,nb:0,pu:0,nbc:0},coaches:{total:0,nb:0,pu:0,nbc:0},bonus:0,kpi:{jrs:0,hrs:0,hrsp:0}};let w=1;for(;w<i;){let Y=[...Array(8).keys()];for(let m=0;m<Y.length;m+=1)u[f].sessions.total+=t[f][w].sessions.number[m]*t[f][w].sessions.pu[m],u[f].sessions.nb+=t[f][w].sessions.number[m],u[f].defenses.total+=t[f][w].defenses.number[m]*t[f][w].defenses.pu[m],u[f].defenses.nb+=t[f][w].defenses.number[m],Ae.isInOldMode(a)?[1,5].includes(m)&&(u[f].sessions.nbc+=t[f][w].sessions.number[m],u[f].defenses.nbc+=t[f][w].defenses.number[m]):[1,2,5,6].includes(m)&&(u[f].sessions.nbc+=t[f][w].sessions.number[m],u[f].defenses.nbc+=t[f][w].defenses.number[m]),Ae.isInOldMode(a)?(u[f].kpi.hrs+=(t[f][w].sessions.number[m]-t[f][w].defenses.number[m])*(45/60),u[f].kpi.hrsp+=(t[f][w].sessions.number[m]-t[f][w].defenses.number[m])*(GM_config.get("nbHrsfM")/60)):([4,5,6,7].includes(m)&&(u[f].kpi.hrs+=(t[f][w].sessions.number[m]-t[f][w].defenses.number[m])*(30/60),u[f].kpi.hrsp+=(t[f][w].sessions.number[m]-t[f][w].defenses.number[m])*(GM_config.get("nbHrsAfM")/60)),[0,1,2,3].includes(m)&&(u[f].kpi.hrs+=(t[f][w].sessions.number[m]-t[f][w].defenses.number[m])*(45/60),u[f].kpi.hrsp+=(t[f][w].sessions.number[m]-t[f][w].defenses.number[m])*(GM_config.get("nbHrsfM")/60))),u[f].kpi.hrs+=t[f][w].defenses.number[m]*(45/60),u[f].kpi.hrsp+=t[f][w].defenses.number[m]*(GM_config.get("nbHrsD")/60);w+=1}u[f].sessions.pu=u[f].sessions.total/(u[f].sessions.nb-u[f].sessions.nbc),u[f].defenses.pu=u[f].defenses.total/(u[f].defenses.nb-u[f].defenses.nbc),u[f].coaches.total=u[f].sessions.total-u[f].defenses.total,u[f].coaches.nb=u[f].sessions.nb-u[f].defenses.nb,u[f].coaches.nbc=u[f].sessions.nbc-u[f].defenses.nbc,u[f].coaches.pu=u[f].coaches.total/(u[f].coaches.nb-u[f].coaches.nbc);for(let Y=0;Y<t[f][0].bonus.length;Y+=1)u[f].bonus+=t[f][0].bonus[Y].sessions>0?30:0;e.isAfter(n,"day")&&(e=n.clone()),u[f].kpi.jrs=Bt(a,e),u[f].header.dtFrom=a.format("YYYY-MM-DD"),u[f].header.dtTo=e.format("YYYY-MM-DD"),u[f].header.created_at=dayjs().format("YYYY-MM-DD HH:mm:ss"),a=a.add(1,"month"),e=a.endOf("month"),f+=1}return u});var xt=mt;var Ot=class{static changePgIfNeeded(o,n,a,e){var t=e.getPageCount(),u=e.getPages()[t-1],l=u.fontSize,c=u.getFont(),d=u.lineHeight;return o<n&&(a=1,u=e.addPage(),u.font=c,u.setFontSize(l),u.lineHeight=d),[a,u]}};U(Ot,"addFooter",async function(o,n,a={}){let{degrees:e,PDFDocument:t,rgb:u,StandardFonts:l}=PDFLib,c=o.getPageCount(),d="8".repeat(c),f=await o.embedFont(l.TimesRoman),i=12,w=f.widthOfTextAtSize(`page ${d} / ${d}`,i),Y=10,m=10,b=1,h=u(0/255,0/255,0/255),C=u(253/255,246/255,227/255),M=5,B=5,D=3,y=3,g=!0;o.getPages().forEach((s,v)=>{if(!(g===!0&&v==0)){let{width:T,height:R}=s.getSize(),Q=i+2*b+D+y;s.moveTo(Y+M,i+y),s.setFont(f),s.setFontSize(i),s.setFontColor(u(1,0,0)),n!==void 0&&s.drawText(`${n}`),s.drawText(`page ${v+1} / ${c}`,{x:T-w-B}),s.drawRectangle({x:Y,y:10,width:T-(Y+m),height:Q,color:C,opacity:.6,borderColor:h,borderWidth:b})}})});var We=Ot;var dn=async function(){let p=q.Cfg.dbase;return await Swal.mixin({confirmButtonText:"Suivant &rarr;",showCancelButton:!0,progressSteps:["0","1","2","3","4","5"],onOpen:function(i){console.log("...onOpen")},onRender:function(i){console.log("....onUpdate")},onClose:function(i){console.log(".....onClose")},onAfterClose:function(i){console.log("......onAfterClose")},onDestroy:function(i){console.log(".......onDestroy")}}).queue([{title:"Migration de la base",html:"<p>Cette migration va corriger la base et ajouter les nouveaux champs n\xE9cessaires, l`interrpuption du traitement est sans danger (mais ce n' est pas une raison !)</p>"},{title:"Correction de la table \xE9tudiant",html:"<p>Correction de la liste des \xE9tudiants (who_id)",onOpen:async function(i){console.log("%cMigration table des \xE9tudiants correction du who_id",x),Swal.showLoading();var w=dayjs("2020-06-01"),Y=p.get("students"),m=Y.value(),b=p.get("sessions").filter(D=>dayjs(D.when).isSameOrAfter(w,"day")),h=Y.size().value(),C=Swal.getContent().textContent;for(c=0;c<h;c+=1){var M=b.find(y=>y.who_name===m[c].fullname).value();M!==void 0&&Y.get(c).assign({who_id:M.who_id}).write();let D=Swal.getContent();D!=null&&(D.innerHTML=`${C}<br /><p>Traitement en cours : ${c}/${m.length}</p>`),await Pe(1)}Swal.hideLoading();let B=Swal.getContent();B!=null&&(B.textContent=`Traitement termin\xE9 : ${m.length}/${m.length}`)}},{title:"Correction de la table \xE9tudiant",html:"<p>Correction de la liste des \xE9tudiants funded devient funding</p>",onOpen:async function(i){console.log("%cMigration : table des \xE9tudiants suppression de l'ancien champs et ajout du champs funding",x),Swal.showLoading();for(var w=p.get("students"),Y=w.size().value(),m=Swal.getContent().textContent,b=0;b<Y;b+=1){var h=w.get(b).value().fundedby;if(h===void 0){console.log("%cStudent ${oListStudents.get(i).who_name} already converted, skip it",x);continue}w.get(b).unset(["fundedby"]).assign({funding:h}).write(),console.log("%cStudent ${oListStudents.get(i).who_name} create field funding and remove fundedby",x);let M=Swal.getContent();M!=null&&(M.innerHTML=`${m}<br /><p>Traitement en cours : ${b}/${Y}</p>`),await Pe(1)}Swal.hideLoading();let C=Swal.getContent();C!=null&&(C.textContent=`Traitement termin\xE9 : ${Y}/${Y}`)}},{title:"Correction table Etudiants",html:"<p>Correction de la liste des sessions, ajout du path dans la session</p>",onOpen:async function(i){console.log("%cMigration table des sessions correction de id_who",x),Swal.showLoading();var w=dayjs("2020-06-01"),Y=p.get("students"),m=Y.value(),b=p.get("sessions").filter(y=>dayjs(y.when).isSameOrAfter(w,"day")),h=b.filter(y=>y.type!="soutenance").value(),C=Swal.getContent().textContent;for(c=0;c<h.length;c+=1){var M=Y.find({who_id:h[c].who_id}).value();console.log("found",M);var B=M!==void 0&&M.path.length>0?M.path:"0-unknown";p.get("sessions").find({id:h[c].id}).assign({path:B}).write();let y=Swal.getContent();y!=null&&(y.innerHTML=`${C}<br /><p>Traitement en cours : ${c}/${h.length}</p>`),await Pe(1)}Swal.hideLoading();let D=Swal.getContent();D!=null&&(D.textContent=`Traitement termin\xE9 : ${c}/${h.length}`)}},{title:"Migration de la table des Sessions",html:'<p>Correction de la liste des sessions, suppression du champs "isFunded"</p>',onOpen:async function(i){console.log("%cMigration : table des sessions suppression de isFunded",x),Swal.showLoading();for(var w=dayjs("2020-06-01"),Y=p.get("students").value(),m=p.get("sessions").filter(B=>dayjs(B.when).isSameOrAfter(w,"day")),b=Swal.getContent().textContent,h=m.value().length;h-=1;){var C=m.get(h);C.value().isFunded===void 0||C.value().isFunded===void 0?console.log(`%cSkip ${C.value()} already converted`,x):C.unset(["isFunded"]).write();let B=Swal.getContent();B!=null&&(B.innerHTML=`${b}<br /><p>Traitement en cours : il reste ${h} \xE9lements \xE0 convertir</p>`),await Pe(1)}Swal.hideLoading();let M=Swal.getContent();M!=null&&(M.textContent=`Traitement en termin\xE9 : ${m.value().length}/${m.value().length}`)}},{title:"Migration de la table des Sessions",html:"<p>Correction de la liste des sessions, ajout de funding</p>",onOpen:async function(i){console.log("%cMigration : table des sessions ajout de fundedBy",x),Swal.showLoading();for(var w=dayjs("2020-06-01"),Y=p.get("students").value(),m=p.get("sessions").filter(y=>dayjs(y.when).isSameOrAfter(w,"day")),b=m.filter(y=>y.type!="soutenance"),h=Swal.getContent().textContent,C=b.value().length;C-=1;){var M=b.get(C);M.value().funding!==void 0?console.log(`%cSkip ${M.value()} already converted`,x):M.assign({funding:ge.getFunding(M.value().who_id)}).write();let y=Swal.getContent();y.innerHTML=`${h}<br /><p>Traitement en cours : il rest ${C}\xE9lements \xE0 convertir</p>`,await Pe(1)}for(var B=C,b=m.filter(y=>y.type=="soutenance"),C=0;C<b.value().length;C+=1){b.get(C).assign({funding:Ye}).write();let g=Swal.getContent();g!=null&&(g.innerHTML=`${h}<br /><p>Traitement en cours : ${B+C}/${m.value().length}</p>`),await Pe(1)}Swal.hideLoading();let D=Swal.getContent();D!=null&&(D.textContent=`Traitement termin\xE9 :  ${m.value().length}/${m.value().length}`)}}]).then(i=>{if(i.value){let w=JSON.stringify(i.value);Swal.fire({title:"Traitement termin\xE9!",html:`
			Your answers:
			<pre><code>${w}</code></pre>
		  `,confirmButtonText:"Lovely!"})}else return console.log("%c resultat en erreur",x,i,i.dismiss===Swal.DismissReason.cancel),-1});var n,a,e;for(c=0;c<a.length;c+=1){var t;t!==void 0&&p.get("students").find({fullname:t.who_name}).assign({who_id:t.who_id}).write()}var u;for(c=0;c<u.length;c+=1){var t,l;p.get("sessions").find({id:u[c].id}).assign({path:l}).write()}for(var c;c<e.value().length;c+=1)e.get(c).unset(["isFunded"]).write();for(var d,c;c<d.value().length;c+=1){var f=d.get(c);f.assign({fundedBy:ge.getFunded(f.value().who_id)}).write()}for(var d,c;c<d.value().length;c+=1)d.get(c).assign({fundedBy:Ye}).write()};var un=On(ln()),jt=class{},Fe=jt;U(Fe,"save",function(){return console.log("%cWanna save DBASE",x),JSON.stringify(q.Cfg.dbase.getState())}),U(Fe,"load",function(o){return console.log(`%cWanna load ${o} in DBASE`,x),console.log("%c !!!!!! TYPE NOT CHECKED BE CARREFULL",x),q.Cfg.dbase.setState(JSON.parse(o)).write()}),U(Fe,"update",async function(o){console.log(`%cIs there any update to DB to go to version ${o}`,x);let n=[{version:"1.00.0006",action:dn}];for(let e=0,t=n.length;e<t;e++)if(yt(o,n[e].version)==0)if(console.log(`%cFound an update to DB version '${n[e].version}' proceed conversion...`,x),await n[e].action()==-1)console.log(`%cError something was wrong during update of database from version: ${Te.getVersion()} to version:${n[e].version}.... you have canceled it`,de),Swal.fire({icon:"error",title:"Oops...",text:`Quelque chose s'est mal pass\xE9 ou vous avez annul\xE9 l'update 

Utiliser l'application dans ces conditions n'est pas garanti  !`,footer:'<a href="https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon/issues">G\xE9n\xE9rer un bug?</a>'});else{let l=Te.setDbVersion(o);console.log(`%cChanged DB to version ${l}`,x)}let a=Te.setDbVersion(o);console.log(`%cChanged DB to version ${a}`,x)}),U(Fe,"erase",function(o){return console.log(`%cErase all data of table: ${o}`,x),q.Cfg.dbase.get(o).remove().write()}),U(Fe,"loadTable",function(o,n){if(table_exist(o))return q.Cfg.dbase.set(o,n).write();throw"Table :"+o+", not exists in DB !"}),U(Fe,"table_exist",o=>q.Cfg.dbase.has(o).value),U(Fe,"table_export",function(o){if(table_exist(o))return JSON.stringify(q.Cfg.dbase.get(o).value());throw"Table :"+o+", not exists id DB !"}),U(Fe,"exportTblToCSV",function(o="",n,a){let e=jt.exportTblToJSON(o,n,a),t={quotes:!1,quoteChar:'"',escapeChar:'"',delimiter:",",header:!0,newline:`\r
`,skipEmptyLines:!1,columns:null};return un.default.unparse(e,t)}),U(Fe,"exportTblToJSON",function(o="",n,a){if(o=="")return console.log("%cIrrecoverable Error: You forget to define a data table name",de),-1;if(n!==null&&n!==""&&(dtFrom=dayjs(n)),a!==null&&a!==""&&(dtTo=dayjs(a)),q.Cfg.dbase.has(o).value==!1)return console.log(`%cIrrecoverable Error: table ${o} don't exist`,de),-1;if(o===Ce.tbl_name){if(typeof dtFrom=="object"&&dtTo==="object")return q.Cfg.dbase.get(o).filter(e=>dayjs(e.when).isSameOrBefore(dtTo,"day")&&dayjs(e.when).isSameOrAfter(dtFrom,"day")).value();if(typeof dtFrom=="object")return q.Cfg.dbase.get(o).filter(e=>dayjs(e.when).isSameOrAfter(dtFrom,"day")).value();if(typeof dtTo=="object")return q.Cfg.dbase.get(o).filter(e=>dayjs(e.when).isSameOrBefore(dtTo,"day")).value()}return q.Cfg.dbase.get(o).value()});var dt=Fe;var Mt=async function(){var p="";p+="<style>div.about_content {background-color: #fed9ff;/*width: 600px;*/height: var(--heigth, 80%);overflow-x: hidden;overflow-y: auto;text-align: left;padding: 20px;}</style>",p+='<div class="about_content" style="--heigth: 600px;">',p+='<div class="about_content__wrapper">';var n=(await Ze.XHR({method:"GET",url:"https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/README.md",responseType:"text/html",headers:{"User-Agent":"Mozilla/5.0"}})).responseText,a=new showdown.Converter,e=a.makeHtml(n);p+=e,p+="</div>",p+="</div>",Swal.fire({title:`<strong>A propos de ${Nt}</strong>`,icon:"info",html:p,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})};var Tt=function(){var p=gt,o=document.querySelector(p),n=!1;if(o===null)throw console.log(`%cERROR:Could'nt find the table which display sessions : ${o}`,de),new Error("!!!! IRRECOVERABLE ERROR NO TABLE OF SESSIONS FOUNDED");if(o.querySelector(".Facturier__cbox input[type=checkbox]")===null){var o=document.querySelector(`${p}`);for(let D of o.children){if(D.firstChild.nodeName!=="A")continue;let y=D.firstChild;var a=y.children[0].querySelector("svg").getAttribute("aria-label"),e=y.children[0].querySelector("p").innerText,t=y.children[1].querySelector("time").getAttribute("datetime").trim(),u=y.children[2].querySelector("a").innerText,l=Ve(y.children[2],-2),c=document.createElement("input");c.type="checkbox",c.name="name";var d=dayjs(t).toISOString(),f=Ce.getHashId(d,l);c.value=f,c.onclick=function(v){v.stopPropagation()},n=Ce.exists(f),n===!0&&(c.checked=!0);let g=y.children[1].classList,s=y.lastChild.classList;y.lastChild.classList=g;var i=document.createElement("div");i.appendChild(c),i.classList.add(...s),i.classList.add("Facturier__cbox"),y.appendChild(i)}if(document.querySelector(`${p} .Facturier__cbox_all`)===null){let D=(s,v)=>v.insertAdjacentElement("beforebegin",s);var w=document.querySelector(`${p} li`);let y=w.firstChild.classList;var c=document.createElement("input");c.type="checkbox",c.name="name",c.value="value",c.id="id",c.onclick=function(){document.querySelectorAll(".Facturier__cbox input[type=checkbox]").forEach(s=>s.checked=!s.checked)},c.style="visibility: hidden;";var Y=document.createElement("label");Y.innerText="in DB",Y.style="display:block;text-align:right;",Y.onMouseOver="this.style.cursor=pointer;",Y.onMouseOut="this.style.cursor=auto;",Y.appendChild(c);var m=document.createElement("div");m.classList=y,m.classList.add("Facturier__cbox_all"),m.appendChild(Y),D(m,document.querySelector(`${p} li`))}}else{for(var b=o.querySelectorAll(".Facturier__cbox input[type=checkbox]"),h=b.length,C=new Array(h);h--;C[h]=b[h]);for(var M in C){let B=parseInt(C[M].value,10);n=Ce.exists(B),n===!0?C[M].checked=!0:C[M].checked=!1}}},cn=async function(){var[p,o]=await ct(dayjs().startOf("month"),dayjs().endOf("month"));let n=xt.getListDetailBill(p,o),a="";a+="<table>",a+="<thead>",a+="<tr><th>Quand</th><th>Qui</th><th>Financ\xE9 ?</th><th>Type</th><th>Niveau</th><th>Ancien Mode ?</th><th>Statut</th><th>PU HT</th><th>Cumul</th></tr>",a+="<thead>",a+="<tbody>";for(let e=0;e<n.length;e+=1)a+="<tr>",a+=`<td>${dayjs(n[e].when).format("DD/MM/YYYY \xE0 HH:mm:ss")}</td>`,a+=`<td>${n[e].who_name}</td><td>${n[e].funding}</td>`,sType=n[e].type,n[e].path!=null&&n[e].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&n[e].type!=="soutenance"&&(sType="Coaching"),a+=`<td>${sType}</td><td>${n[e].lvl}</td>`,a+=`<td>${n[e].oldMode===!0?"Oui":"Non"}</td>`,a+=`<td>${n[e].status}</td>`,a+=`<td>${n[e].iPu}</td><td>${n[e].iCumul}\u20AC</td>`,a+="</tr>";a+="</tbody>",a+="</table>",Swal.fire({title:`<strong>Liste d\xE9taill\xE9es des sessions du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,icon:"info",html:a,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen",onOpen:e=>{var t=e.querySelector("table"),u=new simpleDatatables.DataTable(t)}})},fn=async function(){var p=!0,[o,n]=await ct(dayjs().startOf("month"),dayjs().endOf("month"));p==!0&&console.log("%ccollectAuto() Wanna collect from %s to %s",x,o.format("DD/MM/YYYY"),n.format("DD/MM/YYYY"));var a=await Ce.getSessionsFromAPI(o,n);p==!0&&console.log("%ccollectAuto() Sessions are is %o",x,a)};var pn=async function(){var p=gt,o=document.querySelectorAll(p);GM_addStyle(".ldBar path.mainline{stroke-width:10;stroke:#09f;stroke-linecap:round}"),GM_addStyle(".ldBar path.baseline{stroke-width:14;stroke:#f1f2f3;stroke-linecap:round;filter:url(#custom-shadow)}");let n='<div id="pbar" class="ldBar label-center" data-value="0" data-path="M0 0 L200 0 L200 1"></div>';Swal.fire({title:"Traitement en cours!",html:n,confirmButtonText:"Lovely!",onBeforeOpen:function(a){var e=new ldBar("#pbar")},onRender:function(a){},onOpen:async function(a){for(var e=document.getElementById("pbar").ldBar,t=0;t<o.length;t+=1){var u=o[t].parentElement.parentElement,l=Ce.parseRow(u);await Ce.add(l),e.set(t/o.length*100,!1)}e.set(100,!1),Swal.getTitle()&&(Swal.getTitle().innerText="Traitement termin\xE9 !")},onClose:function(a){},onAfterClose:function(a){},onDestroy:function(a){}})},mn=function(){let p=unsafeWindow.Facturier.cfg.dbase,o=unsafeWindow.Facturier.libs.find(c=>c.id=="dayjs").ptr,n=unsafeWindow.Facturier.libs.find(c=>c.id=="fetchInject").ptr,a=unsafeWindow.Facturier.klass.find(c=>c.id=="Session").ptr,e=unsafeWindow.Facturier.klass.find(c=>c.id=="Student").ptr,t=unsafeWindow.Facturier.klass.find(c=>c.id=="History").ptr,u=unsafeWindow.Facturier.klass.find(c=>c.id=="Archive").ptr,l=unsafeWindow.Facturier.klass.find(c=>c.id=="StudentHistory").ptr;console.log("%cd_dbase, d_dayjs, d_Session, d_Student, d_History, d_Archive, d_StudentHistory are exported",x),console.log("%cfor examples write all code after $>",x),console.group("%cd_dbase",x),console.log("example : get last session in db $>d_dbase.get(d_Session.tbl_name).last().value();"),console.log("          get first student in db $>d_dbase.get(d_Student.tbl_name).first().value()"),console.log("          or d_dbase.get(d_Student.tbl_name).get(0).value()"),console.log("          get all sessions grouped by month/yyyy in db $>d_dbase.get(d_Session.tbl_name).groupBy( v => d_dayjs(v.when).format('MM/YYYY')).value()"),console.log("          get all table $> d_dbase.value()"),console.groupEnd(),console.group("%cd_fetchInject",x),console.log("same as fetchInject libs : https://habd.as/code/fetch-inject/"),console.groupEnd(),console.group("%cd_dayjs",x),console.log("same as dayjs libs"),console.groupEnd(),console.group("%cd_Student",x),console.log("find a student by id \xA4 d_Student.findById(STUDENT_ID, (DATE) ); // date is optionnal"),console.groupEnd(),console.group("%cd_Session",x),console.log("get a list of session \xA4 d_Session.getBetween('2020-08-01','2020-08-31')"),console.log("delete a session by id \xA4 d_Session.deleteById(SESSION_ID);"),console.groupEnd(),console.group("%cSome combinated example",x),console.log("Delete last saved session :  d_Session.deleteById( d_dbase.get(d_Session.tbl_name).last().value().id ); "),console.log("Find all session between 01/08/2020 and 31/08/2020 :  d_dbase.get(d_Session.tbl_name).filter( v => d_dayjs(v.when).isSameOrBefore('20200831', 'day') && d_dayjs(v.when).isSameOrAfter('20200801', 'day')).value(); "),console.groupEnd();debugger};var hn=function(){let{degrees:p,PDFDocument:o,rgb:n,StandardFonts:a}=PDFLib;async function e(){let c=await fetch("https://pdf-lib.js.org/assets/with_update_sections.pdf").then(h=>h.arrayBuffer()),d=await o.load(c),f=await d.embedFont(a.Helvetica),w=d.getPages()[0],{width:Y,height:m}=w.getSize();w.drawText("This text was added with JavaScript!",{x:5,y:m/2+300,size:50,font:f,color:n(.95,.1,.1),rotate:p(-45)});let b=await d.save();download(b,"pdf-lib_modification_example.pdf","application/pdf")}async function t(){let l=await o.create(),c=await l.embedFont(a.TimesRoman),d=l.addPage(),{width:f,height:i}=d.getSize(),w=30;d.drawText("Creating PDFs in JavaScript is awesome!",{x:50,y:i-4*w,size:w,font:c,color:n(0,.53,.71)});let Y=await l.save();download(Y,"pdf-lib_modification_example.pdf","application/pdf")}async function u(){var[l,c]=await ct(dayjs().startOf("month"),dayjs().endOf("month"));let d=xt.getListDetailBill(l,c),f=await o.create(),i=await f.embedFont(a.TimesRoman),w=f.addPage(),{width:Y,height:m}=w.getSize(),b=30;w.drawText(`Prestations en d\xE9tail 

 du ${l.format("DD/MM/YYYY")} au ${c.format("DD/MM/YYYY")}`,{x:50,y:m/2-b,size:b,font:i,color:n(116/255,81/255,235/255)});let h=12,C=1.25,M=f.addPage();M.setFontSize(h),M.line_space=C,M.font=i;let B=1,D=20,y=C*h+D,g=m/2,s=function(te){let G="LOrEm ipsum DOLor sit aMet, conSEc/tetUr 25 porttitor. ";return te*1.0925*(i.widthOfTextAtSize(G,h)/G.length)},v=[0,18,36,10,13,8,5,7],T=[v[0],s(v[1]),s(v[2]),s(v[3]),s(v[4]),s(v[5]),s(v[6]),s(v[7])],R=w.lineHeight,Q=25;for(let te=1;te<d.length;te+=1){if(g=m-C*h*B,g<y&&(B=1,M=f.addPage(),M.font=i,M.setFontSize(h),M.line_space=C,g=m-C*h*B),B===1){let ke=["","Quand","Qui","Financ\xE9","Type-Niv.","Statut","Pu","Cumul"],Se=Q;M.moveTo(Se,g);for(let Le=1;Le<ke.length;Le+=1)M.drawText(ke[Le],{x:Se}),Se+=T[Le];B+=1,g=m-C*h*B}let G=Q;M.drawText(dayjs(d[te].when).format("DD/MM/YYYY \xE0 HH:mm"),{font:i,size:h,y:g,x:G,lineHeight:R}),G+=T[1],M.drawText(d[te].who_name.trim().slice(0,v[2]),{font:i,size:h,y:g,x:G,lineHeight:R}),G+=T[2];let pe=d[te].funding.trim().slice(0,v[3]);d[te].funding==="auto-financ\xE9"&&(pe="Au. Fin."),d[te].funding==="financ\xE9 par un tiers"&&(pe="Fin."),M.drawText(pe,{font:i,size:h,y:g,x:G,lineHeight:R}),G+=T[3];let we=d[te].type;d[te].path!=null&&d[te].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&d[te].type!=="soutenance"&&(we="Coaching");let $e=`${we.trim().slice(0,v[4]-2)}-${d[te].lvl.toString()}`;M.drawText($e,{font:i,size:h,y:g,x:G,lineHeight:R}),G+=T[4];let Me=d[te].status;d[te].status==="\xE9tudiant absent"&&(Me="absent"),d[te].status==="\xE9tudiante absente"&&(Me="absente"),d[te].status==="annul\xE9e tardivement"&&(Me="an. tard."),M.drawText(Me,{font:i,size:h,y:g,x:G,lineHeight:R}),G+=T[5],M.drawText(d[te].iPu.toString(),{font:i,size:h,y:g,x:G,lineHeight:R}),G+=T[6],M.drawText(d[te].iCumul.toString(),{font:i,size:h,y:g,x:G,lineHeight:R}),B+=1}var E=await Ne.calculateBill(l,c);let S=E.get(0,0,0,0).maxLevel,$=Ae.getOldModeDate(),I=Ne.getPriceList($.subtract(1,"day")),P=Ne.getPriceList($);var k=1;let j=!1;var O=[F,N,H],L=["Sessions","Soutenance","Coaching"],oe=[0,1,2,3],me=["R\xE9alis\xE9e","Annul\xE9e","Annul\xE9e tardivement","Etudiant(e) absent(e)"],ce=[z,W,K],fe=["Autofinanc\xE9s","Financ\xE9s","Autres"];B=1,M=f.addPage();let be=["","Quand","Qui","Nb","Pu","Cumul"],ne=[0,18,50,3,5,7],ie=[v[0],s(v[1]),s(v[2]),s(v[3]),s(v[4]),s(v[5])],he="";for(_iSessionType=0,_iSessionTypeLength=O.length;_iSessionType<_iSessionTypeLength;_iSessionType+=1){for(;k<=S;){for([B,M]=We.changePgIfNeeded(g,y,B,f),g=m-C*h*B,_iSessionQuality=0,_iSessionQualityLength=oe.length;_iSessionQuality<_iSessionQualityLength;_iSessionQuality+=1)for(_iFunding=0,_iFundingLength=ce.length;_iFunding<_iFundingLength;_iFunding+=1){if(_i0=E.get(O[_iSessionType],oe[_iSessionQuality],ce[_iFunding],k),typeof _i0=="undefined"&&j===!1)continue;_i0.data=_i0.data.reverse();let te=Q;if(he=`${L[_iSessionType]} de Niveau ${k} Etudiants ${fe[_iFunding]}`,M.moveTo(te,g),M.drawText(he,{font:i,size:h+4,y:g,x:te,lineHeight:R}),te+=15,B+=1,[B,M]=We.changePgIfNeeded(g,y,B,f),g=m-C*h*B,M.moveTo(te,g),M.drawText(me[_iSessionQuality],{font:i,size:h+2,y:g,x:te,lineHeight:R}),te+=15,B+=1,[B,M]=We.changePgIfNeeded(g,y,B,f),g=m-C*h*B,typeof _i0=="undefined"){M.drawText(`d\xE9sol\xE9 pas de r\xE9sultat pour cette section au niveau de facturation (${k})`,{font:i,size:h,y:g,x:te,lineHeight:R}),B+=1,[B,M]=We.changePgIfNeeded(g,y,B,f),g=m-C*h*B;continue}let G=te,pe=0;M.moveTo(te,g);for(let we=1;we<be.length;we+=1)M.drawText(be[we],{font:i,size:h+2,y:g,x:G,lineHeight:R}),G+=ie[we];B+=1,[B,M]=We.changePgIfNeeded(g,y,B,f),g=m-C*h*B,G=te;for(var le=0,se=_i0.data.length;le<se;le+=1)G=te,M.drawText(dayjs(_i0.data[le].when).format("DD/MM/YYYY \xE0 HH:mm"),{font:i,size:h,y:g,x:G,lineHeight:R}),G+=ie[1],M.drawText(_i0.data[le].who_name.trim().slice(0,ne[1]),{font:i,size:h,y:g,x:G,lineHeight:R}),G+=ie[2],M.drawText((le+1).toString(),{font:i,size:h,y:g,x:G,lineHeight:R}),G+=ie[3],Ae.isInOldMode(dayjs(_i0.data[le].when))?iPu=+_i0.data[le].lvl>0?I[k][O[_iSessionType]][oe[_iSessionQuality]][ce[_iFunding]]:0:iPu=+_i0.data[le].lvl>0?P[k][O[_iSessionType]][oe[_iSessionQuality]][ce[_iFunding]]:0,M.drawText(iPu.toString(),{font:i,size:h,y:g,x:G,lineHeight:R}),G+=ie[4],pe+=iPu,M.drawText(pe.toString(),{font:i,size:h,y:g,x:G,lineHeight:R}),B+=1,[B,M]=We.changePgIfNeeded(g,y,B,f),g=m-C*h*B}k+=1,B+=1,[B,M]=We.changePgIfNeeded(g,y,B,f),g=m-C*h*B}k=1}We.addFooter(f,`G\xE9n\xE9r\xE9 avec Facturier version ${Ae.getAppVersion()}`);let ae=await f.save();download(ae,`prestations_facturees_detail_${l.format("YYYYMMDD")}-${c.format("YYYYMMDD")}.pdf`,"application/pdf")}u()},gn=async function(){GM_addStyle('.formgrid{font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;}'),GM_addStyle(`
.swal2-styled[type=button]{background-color:#3085d6;border-radius:.75em;color:#fff;font-size:1.0625em;border-left-color:#3085d6;border-right-color:#3085d6;display:inline-block}
.formgrid{display:grid;grid-template-columns:1fr 1em 1fr;grid-gap:.3em .6em;grid-auto-flow:dense;align-items:center}
.formgrid input,.formgrid output,.formgrid textarea,.formgrid select,.formgrid button{grid-column:2 / 4;width:auto;margin:0}
.formgrid legend{font-size:1.2em;width:100%;border-bottom:1px dotted #99c}
.formgrid fieldset{max-width:40em;padding:4px;margin:2em auto;border:0 none}
`);let p="";p+="<legend>Que voulez vous faire ?</legend>",p+="<fieldset>",p+='<div class="formgrid">',p+='Epurer<button id="answer1" data-action="raz" class="swal2-styled" type="button">RAZ</button>',p+='Sauvegarder toute la base<button id="answer2" data-action="export" class="swal2-styled" type="button">Sauvegarder</button>',p+='Charger toute la base<button id="answer3" data-action="import" class="swal2-styled" type="button">Charger</button>',p+=`Exporter les tables
    <button class="swal2-styled" type="button"
    	hx-get="/views/test-swal-sauvegarde"
		hx-select="body"
        hx-target="#sttPlaceHolder"
        hx-include="[name='email']"
        hx-swap="innerHTML"> Exporter
    </button>
		`,p+="</fieldset>",p+="</div>";let{value:o}=await Swal.fire({title:"Gestion de la base de donn\xE9e",html:p,focusConfirm:!1,preConfirm:()=>[document.getElementById("answer1").value,document.getElementById("answer2").value],didOpen:n=>{console.log("%conOpen popup","color:coral"),htmx.process(document.querySelector(".swal2-container")),console.log("%cHtmx Process done","color:coral"),n.querySelector(".formgrid").addEventListener("click",_handler=function(a){let e=function(l){l.target.matches('button[data-action="raz"]')&&(Swal.close(),Gn())},t=function(l){l.target.matches('button[data-action="export"]')&&(Swal.close(),Hn())},u=function(l){l.target.matches('button[data-action="import"]')&&(Swal.close(),Un())};e(a),t(a),u(a)})},onClose:n=>{n.querySelector(".formgrid").removeEventListener("click",_handler),console.log("%conClose popup","color:coral")}});o&&Swal.fire(JSON.stringify(o))},Hn=async function(){let p=dt.save();console.log(`%cWanna save : ${p}`,x);let o=dayjs(),n="";n+=`<a id="download" href="data:text/plain;charset=utf-8,${encodeURIComponent(p)}" download="save_${o.format("YYYYMMDD")}.json">save_${o.format("YYYYMMDD")}.json</a>`,Swal.fire({title:"Sauvegarde de la base de donn\xE9e",html:n,focusConfirm:!1,onOpen:a=>{a.querySelector("#download").click()},onClose:a=>{}})};var Un=async function(){console.log("%cWanna load DATABASE",x);let{value:p}=await Swal.fire({title:"Selection de la sauvegarde (json)",input:"file",inputAttributes:{accept:".json","aria-label":"Upload your database"}});if(p){let o=new FileReader;o.onload=n=>{dt.load(n.target.result),Tt(),ft("Chargement de la base termin\xE9")},o.readAsText(p)}},Gn=async function(){GM_addStyle(".form_addon {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}"),GM_addStyle(".form_addon input {background: #fff;border: 1px solid #9c9c9c;}"),GM_addStyle(".form_addon button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}"),GM_addStyle(".form_addon button:hover {background: gold;}"),GM_addStyle(".form_addon label {padding: 0.5em 0.5em 0.5em 0;}"),GM_addStyle(".form_addon input {padding: 0.7em;margin-bottom: 0.5rem;}"),GM_addStyle(".form_addon input:focus {outline: 3px solid gold;}"),GM_addStyle("@media (min-width: 400px) {.form_addon {grid-template-columns: 200px 1fr;grid-gap: 16px;} .form_addon label {text-align: right;grid-column: 1 / 2;} .form_addon input, .form_addon button {grid-column: 2 / 3;}}");var p="";p+='<form id="RAZ" class="form_addon" action="">',p+='<label for="students" class="cbox">Etudiants</label>',p+='<input id="students" type="checkbox" value="del_students_true" checked>',p+='<label for="sessions" class="cbox">Sessions</label>',p+='<input id="sessions" type="checkbox" value="del_sessions_true" checked>',p+='<label for="archives" class="cbox">Archives : factures</label>',p+='<input id="archives" type="checkbox" value="del_archives_true" checked>',p+='<label for="history_cache" class="cbox">Signet historique</label>',p+='<input id="history_cache" type="checkbox" value="del_history_cache_true" checked>',p+='<label for="radio1">filtrer la date</label>',p+='<input type="radio" id="radio1" name="date_filter" value="false" checked>',p+='<label for="radio2">ne pas filtrer</label>',p+='<input type="radio" id="radio2" name="date_filter" value="true">',p+='<label for="dtFrom" class="date">Date de d\xE9but</label>',p+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31">',p+='<label for="dtTo" class="date">Date de fin</label>',p+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31">',p+="<!-- Switch -->",p+='<input type="checkbox" class="switch" name="s1" id="s1">',p+='<label for="s1">Switch</label>',p+="</form>";let{value:o}=await Swal.fire({title:"<strong>RAZ des donn\xE9es</strong>",icon:"info",html:p,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:"Choisissez ce que vous allez supprimer de la base de donn\xE9e",preConfirm:()=>{let c=document.getElementsByName("date_filter"),d="notfound";for(var f in c)c[f].checked===!0&&(d=c[f].value);return console.log(document.getElementById("s1")),[document.getElementById("students").checked,document.getElementById("sessions").checked,document.getElementById("archives").checked,document.getElementById("history_cache").checked,document.getElementById("dtFrom").disabled===!0?null:document.getElementById("dtFrom").value,document.getElementById("dtTo").disabled===!0?null:document.getElementById("dtTo").value,d]},onOpen:c=>{c.querySelector("#radio1").addEventListener("change",function(){console.log(document.getElementById("radio1").checked);let d=document.getElementById("radio1").checked;document.getElementById("dtFrom").disabled=!d,document.getElementById("dtTo").disabled=!d}),c.querySelector("#radio2").addEventListener("change",function(){let d=document.getElementById("radio1").checked;document.getElementById("dtFrom").disabled=!d,document.getElementById("dtTo").disabled=!d}),c.querySelector("#dtFrom").addEventListener("change",function(){document.getElementById("dtTo").value=dayjs(document.getElementById("dtFrom").value).endOf("month").format("YYYY-MM-DD")})},onClose:c=>{c.querySelector("#radio1").removeEventListener("change"),c.querySelector("#radio2").removeEventListener("change"),c.querySelector("#dtFrom").removeEventListener("change")}}),n=o[0],a=o[1],e=o[2],t=o[3];console.log(`%cWanna raz students ? ${n}, wanna raz sessions ? ${a}, wanna raz archives ? ${e}`,x);let u=o[4]?dayjs(o[4]):null,l=o[5]?dayjs(o[5]):null;n===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des \xE9tudiants",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),ge.delete(u,l),Te.remStudentListUpd()),a===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des sessions",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),Ce.delete(u,l),Tt()),e===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des archives (financi\xE8res)",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),it.delete(u,l)),t===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base du cache des historique de session",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),at.remove(u,l))};var bn=async function(){var p="";p+="<style>",p+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",p+="form input {background: #fff;border: 1px solid #9c9c9c;}",p+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",p+="form button:hover {background: gold;}",p+="form label {padding: 0.5em 0.5em 0.5em 0;}",p+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",p+="form input:focus {outline: 3px solid gold;}",p+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}label {text-align: right;grid-column: 1 / 2;}input,button {grid-column: 2 / 3;}}",p+="</style>",p+='<form class="form1" action="">',p+='<label for="dd" class="date">Date de d\xE9but</label>',p+='<input id="dd" type="date" max="2030-12-31" min="2010-12-31">',p+='<label for="df" class="date">Date de fin</label>',p+='<input id="df" type="date" max="2030-12-31" min="2010-12-31">',p+="</form>";var[o,n]=await ct(dayjs().startOf("month"),dayjs().endOf("month")),a=await Ne.calculateBill(o,n);Ae.isInOldMode(o)?qn(o,n,a):Qn(o,n,a)};var qn=function(p,o,n){let a=n.get(0,0,0,0),e=4;var t="",u=null,l=0,c=0,d=0,f=[[4,"Groupe"],[1,"Niveau 1"],[2,"Niveau 2"],[3,"Niveau 3"]],i=0,w=0,Y=!1,m=0,b=0,h=0,C=0,M=0,B=0,D=0,y=0,g=0,s=0,v=0,T=0,R=0,Q=0,E=0,A=0,S=0,$=0,I=1;n.toConsole(),t+="<style>.wrapper{  display: grid;grid-gap: 10px;grid-template-column: 1fr 1fr;}</style>",t+='<div class="wrapper">',t+="<table>",t+="<thead>",t+="<tr>",t+='<th>Type</th><th><abbr title="nombre">nb</abbr></th><th>PU(<abbr title="hors taxes">HT</abbr>)</th><th>Total(<abbr title="hors taxes">HT</abbr>)</th>',t+="</tr>",t+="</thead>",t+="<tbody>",t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Mentorat</th>',t+="</tr>";for(var i=performance.now();I<=e;)_i0=n.get(F,Z,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : r\xE9alis\xE9es</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),_i0=n.get(F,X,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),_i0=n.get(F,V,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es tard.</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),_i0=n.get(F,ee,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : \xE9tudiant abs.</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),I+=1;var w=performance.now();console.log("%cCalculate first array"+(w-i)+" milliseconds.",Re),t+="<tr>",t+="<td>Total</td>",t+=`<td>${l}</td><td></td><td>${c}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",d+=c,l=0,c=0,t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Soutenance</th>',t+="</tr>",I=1;for(var i=performance.now();I<=e;)_i0=n.get(N,Z,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : r\xE9alis\xE9es</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),_i0=n.get(N,X,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),_i0=n.get(N,V,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es tard.</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),_i0=n.get(N,ee,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : \xE9tudiant abs.</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),I+=1;var w=performance.now();console.log("%cCalculate second array"+(w-i)+" milliseconds.",Re),t+="<tr>",t+="<td>Total</td>",t+=`<td>${l}</td><td></td><td>${c}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",d+=c,l=0,c=0,t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Coaching</th>',t+="</tr>",I=1;for(var i=performance.now();I<=e;)_i0=n.get(H,Z,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : r\xE9alis\xE9es</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),_i0=n.get(H,X,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),_i0=n.get(H,V,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es tard.</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),_i0=n.get(H,ee,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,W,I),v=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,K,I),T=_i0===void 0?0:_i0.number,$=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=v>0?S/v:S,E=T>0?$/T:$,(Y===!0||s+v+T>0)&&(l+=s,l+=v,l+=T,c+=A,c+=S,c+=$,t+="<tr>",t+=`<td>Niveau ${I} : \xE9tudiant abs.</td>`,t+=`<td>${s+v+T}</td><td>${Q}</td><td>${A+S+$}\u20AC</td>`,t+="</tr>"),I+=1;var w=performance.now();console.log("%cCalculate third array"+(w-i)+" milliseconds.",Re),t+="<tr>",t+="<td>Total</td>",t+=`<td>${l}</td><td></td><td>${c}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",d+=c,t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Total G\xE9n\xE9ral</th>',t+="</tr>",t+=`<td colspan="3"></td><td>${d}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",t+="</tbody>",t+="<tfoot>",t+="</tfoot>",t+="</table>",t+=`<p>Soit un total g\xE9n\xE9ral \xE0 facturer de ${d}\u20AC`,Swal.fire({title:`<strong>Liste des formations tarif\xE9es du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,html:t,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})},Qn=function(p,o,n){console.log("%cEnter computation bill",x);let a=!1;var e="",t=0,u=0,l=0,c=0,d=0,f=0,i=0,w=0,Y=0,m=0,b=0,h=0;let C=n.get(0,0,0,0),M=C.maxLevel;var B=0,D=0,y=0,g=0,s=0,v=0,T=0,R=0,Q=0,E=0,A=0,S=0,$=0,I=0,P=0,k=0,j=0,O=0,L=1;e+="<style>.wrapper{  display: grid;grid-gap: 10px;grid-template-column: 1fr 1fr;}</style>",e+='<div class="wrapper">',e+="<table>",e+="<thead>",e+="<tr>",e+='<th rowspan="2">Type</th><th colspan="3" scope="colgroup">Auto Financ\xE9s</th><th colspan="3" scope="colgroup">Financ\xE9s</th><th colspan="3" scope="colgroup">Autres</th><th colspan="2" scope="colgroup">Total</th>',e+="</tr>",e+="<tr>",e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+="</tr>",e+="</thead>",e+="<tbody>",e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de mentorat</th>',e+="</tr>";for(var oe=performance.now();L<=M;)_i0=n.get(F,Z,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : r\xE9alis\xE9es</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),_i0=n.get(F,X,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),_i0=n.get(F,V,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es tard.</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),_i0=n.get(F,ee,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : \xE9tud. absent</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),L+=1;var me=performance.now();for(console.log("%cCalculate first array"+(me-oe)+" milliseconds.",Re),e+="<tr>",e+="<td>Total</td>",e+=`<td>${t}</td><td></td><td>${c}\u20AC</td>`,e+=`<td>${u}</td><td></td><td>${d}\u20AC</td>`,e+=`<td>${l}</td><td></td><td>${f}\u20AC</td>`,e+=`<td>${t+u+l}</td><td>${c+d+f}\u20AC</td>`,e+="</tr>",e+="<tr>",e+="</tr>",i+=t,w+=u,Y+=l,m+=c,b+=d,h+=f,t=0,u=0,l=0,c=0,d=0,f=0,e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de Soutenance</th>',e+="</tr>",L=1;L<=M;)_i0=n.get(N,Z,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : r\xE9alis\xE9es</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),_i0=n.get(N,X,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),_i0=n.get(N,V,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es tard.</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),_i0=n.get(N,ee,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : \xE9tud. absent</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),L+=1;e+="<tr>",e+="<td>Total</td>",e+=`<td>${t}</td><td></td><td>${c}\u20AC</td>`,e+=`<td>${u}</td><td></td><td>${d}\u20AC</td>`,e+=`<td>${l}</td><td></td><td>${f}\u20AC</td>`,e+=`<td>${t+u+l}</td><td>${c+d+f}\u20AC</td>`,e+="</tr>",e+="<tr>",e+="</tr>",i+=t,w+=u,Y+=l,m+=c,b+=d,h+=f,t=0,u=0,l=0,c=0,d=0,f=0,e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de Coaching</th>',e+="</tr>";for(var L=1;L<=M;)_i0=n.get(H,Z,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : r\xE9alis\xE9es</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),_i0=n.get(H,X,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),_i0=n.get(H,V,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es tard.</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),_i0=n.get(H,ee,z,L),E=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,K,L),S=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,$=E>0?k/E:k,I=A>0?j/A:j,P=S>0?O/S:O,(a===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,c+=k,d+=j,f+=O,e+="<tr>",e+=`<td>Niveau ${L} : \xE9tud. absent</td>`,e+=`<td>${E}</td><td>${$}</td><td>${k}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${O}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${k+j+O}\u20AC</td>`,e+="</tr>"),L+=1;i+=t,w+=u,Y+=l,m+=c,b+=d,h+=f,e+="<tr>",e+="<td>Total</td>",e+=`<td>${t}</td><td></td><td>${c}\u20AC</td>`,e+=`<td>${u}</td><td></td><td>${d}\u20AC</td>`,e+=`<td>${l}</td><td></td><td>${f}\u20AC</td>`,e+=`<td>${t+u+l}</td><td>${c+d+f}\u20AC</td>`,e+="</tr>",e+="<tr>",e+="</tr>",e+="</tbody>",e+="<tfoot>",e+="</tfoot>",e+="</table>";var ce=0,fe="";let be=C.flatFee.length;for(var ne=0;ne<be;ne+=1)ce+=30,fe+=C.flatFee[ne].who_name+", ";be>1?e+=`<p class="flat_fee">Calcul du forfait "autofinanc\xE9". Ce mois ci ${be} \xE9tudiants ont eu au moins une session il s'agit de : ${fe.slice(0,-1)}`:e+=`<p class="flat_fee">Calcul du forfait "autofinanc\xE9". Ce mois ci ${be} \xE9tudiant a eu au moins une session il s'agit de : ${fe.slice(0,-1)}`,e+=`. Le forfait est donc de ${ce}\u20AC</p>`,e+=`<p>Soit un total g\xE9n\xE9ral \xE0 facturer de ${m+b+h+ce}\u20AC</p>`,Swal.fire({title:`<strong>Liste des formations tarif\xE9es du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,html:e,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})},yn=async function(){var[p,o]=await ct(dayjs().startOf("month"),dayjs().endOf("month"),!1);if(p===null||o===null)throw console.log("%cError need date from, date to",de),new Error;let n=xt.getListStatistic(p,o),a="",e=new Array(22),t=Array.apply(null,Array(22)).map(Number.prototype.valueOf,0),u=p.clone(),l=u.endOf("month"),c="";e[0]="<thead><tr><th>Sessions</th>",e[1]="<tbody><tr><td>Sessions</td>",e[2]='<tr class="header"><td>Montant</td>',e[3]="<tr><td>Nb.",e[4]="<tr><td>Pu",e[5]='<tr class="header"><td>Soutenances</td>',e[6]="<tr><td>Montant</td>",e[7]="<tr><td>Nb.",e[8]="<tr><td>Pu",e[9]='<tr class="header"><td>Coaching</td>',e[10]="<tr><td>Montant</td>",e[11]="<tr><td>Nb.",e[12]="<tr><td>Pu",e[13]='<tr class="header"><td>Bonus</td>',e[14]="<tr><td>Bonus AF</td>",e[15]="<tr><td>Total G\xE9n\xE9ral</td>",e[16]='<tr class="header"><td>KPI</td>',e[17]="<tr><td>NbJrs</td>",e[18]="<tr><td>TJM</td>",e[19]="<tr><td>Nb hrs</td>",e[20]="<tr><td>THM</td>",e[21]="<tr><td>Nb hrs (p.)</td>",e[22]="<tr><td>THM (p)</td>";for(var d=0;d<n.length;d+=1){t[2]+=n[d].sessions.total,t[3]+=n[d].sessions.nb-n[d].sessions.nbc,t[4]+=n[d].sessions.pu,t[6]+=n[d].defenses.total,t[7]+=n[d].defenses.nb-n[d].defenses.nbc,t[8]+=n[d].defenses.pu,t[10]+=n[d].coaches.total,t[11]+=n[d].coaches.nb-n[d].coaches.nbc,t[12]+=n[d].coaches.pu,t[14]+=n[d].bonus;let f=n[d].sessions.total+n[d].defenses.total+n[d].coaches.total+n[d].bonus;t[15]+=f,t[16]+=n[d].kpi.jrs,t[18]+=n[d].kpi.hrs,t[20]+=n[d].kpi.hrsp,n.length==1&&(c="</tr>"),d===n.length-1&&n.length>1?l.isAfter(o,"day")?(t[2]-=n[d].sessions.total,t[3]-=n[d].sessions.nb-n[d].sessions.nbc,t[4]-=n[d].sessions.pu,t[6]-=n[d].defenses.total,t[7]-=n[d].defenses.nb-n[d].defenses.nbc,t[8]-=n[d].defenses.pu,t[10]-=n[d].coaches.total,t[11]-=n[d].coaches.nb-n[d].coaches.nbc,t[12]-=n[d].coaches.pu,t[14]-=n[d].bonus,t[15]-=f,t[16]-=n[d].kpi.jrs,t[18]-=n[d].kpi.hrs,t[20]-=n[d].kpi.hrsp,e[0]+=`<td>Total(moy)</td><td>${dayjs(n[d].header.dtTo).format("MMMM")}</td></thead></tr>`,e[1]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[2]+=`<td>${t[2]} (${(t[2]/(n.length-1)).toFixed(2)})</td><td>${n[d].sessions.total}</td></tr>`,e[3]+=`<td>${t[3]} (${(t[3]/(n.length-1)).toFixed(2)})</td><td>${n[d].sessions.nb} (${n[d].sessions.nbc})</td></tr>`,e[4]+=`<td> n/a (${(t[4]/(n.length-1)).toFixed(2)})</td><td>${n[d].sessions.pu.toFixed(2)}</td></tr>`,e[5]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[6]+=`<td>${t[6]} (${(t[6]/(n.length-1)).toFixed(2)})</td><td>${n[d].defenses.total}</td></tr>`,e[7]+=`<td>${t[7]} (${(t[7]/(n.length-1)).toFixed(2)})</td><td>${n[d].defenses.nb} (${n[d].defenses.nbc})</td></tr>`,e[8]+=`<td> n/a (${(t[8]/(n.length-1)).toFixed(2)})</td><td>${n[d].defenses.pu.toFixed(2)}</td></tr>`,e[9]+=`<td>&nbsp;</td>${c}`,e[10]+=`<td>${t[10]} (${(t[10]/(n.length-1)).toFixed(2)})</td><td>${n[d].coaches.total}</td></tr>`,e[11]+=`<td>${t[11]} (${(t[11]/(n.length-1)).toFixed(2)})</td><td>${n[d].coaches.nb} (${n[d].coaches.nbc})</td></tr>`,e[12]+=`<td> n/a (${(t[12]/(n.length-1)).toFixed(2)})</td><td>${n[d].coaches.pu.toFixed(2)}</td></tr>`,e[13]+="<td>&nbsp;</td></tr>",e[14]+=`<td>${t[14]} (${(t[14]/(n.length-1)).toFixed(2)})</td><td>${n[d].bonus}</td></tr>`,e[15]+=`<td>${t[15]} (${(t[15]/(n.length-1)).toFixed(2)})</td><td>${f}</td></tr>`,e[16]+="<td>&nbsp;</td></tr>",e[17]+=`<td>${t[16]} (${(t[16]/(n.length-1)).toFixed(2)})</td><td>${n[d].kpi.jrs}</td></tr>`,e[18]+=`<td> n/a (${(t[15]/t[16]).toFixed(2)})</td><td>${(f/n[d].kpi.jrs).toFixed(2)}</td></tr>`,e[19]+=`<td>${t[18]} (${(t[18]/(n.length-1)).toFixed(2)})</td><td>${n[d].kpi.hrs.toFixed(2)}</td></tr>`,e[20]+=`<td> n/a  (${(t[15]/t[18]).toFixed(2)})</td><td>${(f/n[d].kpi.hrs).toFixed(2)}</td></tr>`,e[21]+=`<td>${t[20].toFixed(2)} (${(t[20]/(n.length-1)).toFixed(2)})</td><td>${n[d].kpi.hrsp.toFixed(2)}</td></tr>`,e[22]+=`<td> n/a  (${(t[15]/t[20]).toFixed(2)})</td><td>${(f/n[d].kpi.hrsp).toFixed(2)}</td></tr>`):(e[0]+=`<td>${dayjs(n[d].header.dtTo).format("MMMM")}</td><td>Tot.</td></thead></tr>`,e[1]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[2]+=`<td>${n[d].sessions.total}</td><td>${t[2]} (${(t[2]/n.length).toFixed(2)})</td></tr>`,e[3]+=`<td>${n[d].sessions.nb} (${n[d].sessions.nbc})</td><td>${t[3]} (${(t[3]/n.length).toFixed(2)})</td></tr>`,e[4]+=`<td>${n[d].sessions.pu.toFixed(2)}</td><td> n/a (${(t[4]/n.length).toFixed(2)})</td></tr>`,e[5]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[6]+=`<td>${n[d].defenses.total}</td><td>${t[6]} (${(t[6]/n.length).toFixed(2)})</td></tr>`,e[7]+=`<td>${n[d].defenses.nb} (${n[d].defenses.nbc})</td><td>${t[7]} (${(t[7]/n.length).toFixed(2)})</td></tr>`,e[8]+=`<td>${n[d].defenses.pu.toFixed(2)}</td><td> n/a (${(t[8]/n.length).toFixed(2)})</td></tr>`,e[9]+=`<td>&nbsp;</td>${c}`,e[10]+=`<td>${n[d].coaches.total}</td><td>${t[10]} (${(t[10]/n.length).toFixed(2)})</td></tr>`,e[11]+=`<td>${n[d].coaches.nb} (${n[d].coaches.nbc})</td><td>${t[11]} (${(t[11]/n.length).toFixed(2)})</td></tr>`,e[12]+=`<td>${n[d].coaches.pu.toFixed(2)}</td><td> n/a (${(t[12]/n.length).toFixed(2)})</td></tr>`,e[13]+="<td>&nbsp;</td></tr>",e[14]+=`<td>${n[d].bonus}</td><td>${t[14]} (${(t[14]/n.length).toFixed(2)})</td></tr>`,e[15]+=`<td>${f}</td><td>${t[15]} (${(t[15]/n.length).toFixed(2)})</td></tr>`,e[16]+="<td>&nbsp;</td></tr>",e[17]+=`<td>${n[d].kpi.jrs}</td><td>${t[16]} (${(t[16]/n.length).toFixed(2)})</td></tr>`,e[18]+=`<td>${(f/n[d].kpi.jrs).toFixed(2)}</td><td> n/a (${(t[15]/t[16]).toFixed(2)})</td></tr>`,e[19]+=`<td>${n[d].kpi.hrs.toFixed(2)}</td><td>${t[18]} (${(t[18]/n.length).toFixed(2)})</td></tr>`,e[20]+=`<td>${(f/n[d].kpi.hrs).toFixed(2)}</td><td> n/a  (${(t[15]/t[18]).toFixed(2)})</td></tr>`,e[21]+=`<td>${n[d].kpi.hrsp.toFixed(2)}</td><td>${t[20].toFixed(2)} (${(t[20]/n.length).toFixed(2)})</td></tr>`,e[22]+=`<td>${(f/n[d].kpi.hrsp).toFixed(2)}</td><td> n/a  (${(t[15]/t[20]).toFixed(2)})</td></tr>`):(e[0]+=`<td>${dayjs(n[d].header.dtTo).format("MMMM")}</td>${c}`,e[1]+=`<td>&nbsp;</td>${c}`,e[2]+=`<td>${n[d].sessions.total}</td>${c}`,e[3]+=`<td>${n[d].sessions.nb} (${n[d].sessions.nbc})</td>${c}`,e[4]+=`<td>${n[d].sessions.pu.toFixed(2)}</td>${c}`,e[5]+=`<td>&nbsp;</td>${c}`,e[6]+=`<td>${n[d].defenses.total}</td>${c}`,e[7]+=`<td>${n[d].defenses.nb} (${n[d].defenses.nbc})</td>${c}`,e[8]+=`<td>${n[d].defenses.pu.toFixed(2)}</td>${c}`,e[9]+=`<td>&nbsp;</td>${c}`,e[10]+=`<td>${n[d].coaches.total}</td>${c}`,e[11]+=`<td>${n[d].coaches.nb} (${n[d].coaches.nbc})</td>${c}`,e[12]+=`<td>${n[d].coaches.pu.toFixed(2)}</td>${c}`,e[13]+=`<td>&nbsp;</td>${c}`,e[14]+=`<td>${n[d].bonus}</td>${c}`,e[15]+=`<td>${f}</td>${c}`,e[16]+=`<td>&nbsp;</td>${c}`,e[17]+=`<td>${n[d].kpi.jrs}</td>${c}`,e[18]+=`<td>${(f/n[d].kpi.jrs).toFixed(2)}</td>${c}`,e[19]+=`<td>${n[d].kpi.hrs.toFixed(2)}</td>${c}`,e[20]+=`<td>${(f/n[d].kpi.hrs).toFixed(2)}</td>${c}`,e[21]+=`<td>${n[d].kpi.hrsp.toFixed(2)}</td>${c}`,e[22]+=`<td>${(f/n[d].kpi.hrsp).toFixed(2)}</td>${c}`),u=u.add(1,"month"),l=u.endOf("month")}a="<table>"+e.join(" ")+`</tbody><tfoot><tr><td colspan=${n.length+1}>la valeur entre parenth\xE8se fait reference aux annul\xE9s</td></tr></tfoot></table>`,Swal.fire({title:`<strong>Statistiques du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,icon:"info",html:a,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen",onOpen:f=>{}})};var Ie=class{},St=Ie;U(St,"init",function(){console.log("%cin initUI",x),Ie.build();var o=new Draggabilly(".draggable",{handle:".handle"})}),U(St,"build",function(){console.log("%c in buildUI","background-color:green;color:white"),GM_addStyle(`
.flow > * + * {
  margin-top: var(--flow-space, 1em);
}
		`),GM_addStyle(".panel {/* because of stacking context : https://stackoverflow.com/questions/5218927/z-index-not-working-with-fixed-positioning */position: relative;z-index: 666; /*seems that 4 is good*/}"),GM_addStyle(".menuBar {padding:7px;/*for handler*/font-size: 1rem; pointer-events: inherit;}"),GM_addStyle(".draggable {background: transparent;border-radius: 10px;padding: 20px;}"),GM_addStyle(".draggable.is-pointer-down {background: #09F;}"),GM_addStyle(".draggable.is-dragging { opacity: 0.7; }"),GM_addStyle(".handle {background: #555;background: hsla(0, 0%, 0%, 0.4);width: 20px;height: 20px; border-radius: 10px; position: relative; top:10px; left:-10px;}"),GM_addStyle(`
.menuBar{
/*Smol Responsive CSS Grid*/
--min: 15ch;
--gap: 1rem;
display: grid;
grid-gap: var(--gap);
/* min() with 100% prevents overflow
in extra narrow spaces */
grid-template-columns: repeat(auto-fit, minmax(min(100%, var(--min)), 1fr)); /* 20 px is size of handle*/ 
}
		`);var o=document.createElement("div"),n=document.createElement("div");n.classList.add("handle"),o.appendChild(n),o.classList.add("panel","draggable"),document.body.insertAdjacentElement("beforeend",o),o.setAttribute("style",`top:-${document.body.offsetHeight-o.offsetHeight}px`);var a=document.createElement("div");a.classList.add("menuBar"),o.appendChild(a),Ie.addButton("collectChecked",pn,{},a),Ie.addButton("CollectAuto",fn,{},a),Ie.addButton("showBill",bn,{},a),Ie.addButton("billInDetails",cn,{},a),Ie.addButton("PDF",hn,{},a),Ie.addButton("SList",ge.showList,{},a),Ie.addButton("DbgMode",mn,{},a),Ie.addButton("statistics",yn,{},a),Ie.addButton("Database",gn,{},a),Ie.addButton("about",Mt,{},a);let e=document.createElement("div"),t=e.style;e.id="sttPlaceHolder";let u={position:"absolute",bottom:"7%",left:"4%","z-index":999,display:"hidden"};document.body.insertAdjacentElement("beforeend",e),Object.keys(u).forEach(l=>t[l]=u[l])}),U(St,"addButton",function(o,n,a,e){e=e||document.body,a=a||{position:"absolute",bottom:"7%",left:"4%","z-index":3};let t=document.createElement("button"),u=t.style;return t.classList.add("button--primary","button"),e.appendChild(t),t.innerHTML=o,t.onclick=n,Object.keys(a).forEach(l=>u[l]=a[l]),t});var Lt=class{};U(Lt,"start",function(o){let n=document.getElementById(o),a=c=>n.style.transform=`translateX(${c}px)`,e=0,t=7,u=c=>{a(e),e+=t,e>100?requestAnimationFrame(l):requestAnimationFrame(u)},l=c=>{a(e),e-=t,e<-100?requestAnimationFrame(u):requestAnimationFrame(l)};return requestAnimationFrame(u)}),U(Lt,"stop",function(o){window.cancelAnimationFrame(o)});var _n=St;var zn="#OCAddonsCfg {background-color: lightblue;} #OCAddonsCfg .reset_holder {float: left; position: relative; bottom: -1em;} #OCAddonsCfg .saveclose_buttons {margin: .7em;}",Wn="height: 16.7em; width: 30em; border: 1px solid; border-radius: 3px; position: fixed; z-index: 999;";var vn={id:"OCAddonsCfg",title:"Configuration du module",fields:{nbHrsAfM:{section:["Statistiques","param\xE8tres"],label:"Nombre de minutes pour une session d'\xE9tudiant auto financ\xE9",title:"Dur\xE9e moyenne d'une session AF (calcul du THM)",labelPos:"left",type:"input",default:30},nbHrsfM:{label:"Nombre de minutes pour une session d'\xE9tudiant financ\xE9",title:"Dur\xE9e moyenne d'une session Financ\xE9e (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsS:{label:"Nombre de minutes pour une session (avant 01/07/2020)",title:"Dur\xE9e moyenne d'une session avant la s\xE9paration auto financ\xE9 | financ\xE9 (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsD:{label:"Nombre de minutes pour une session de soutenance",title:"Dur\xE9e moyenne d'une sessionde soutenance AF (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsC:{label:"Nombre de minutes pour une session de coaching",title:"Dur\xE9e moyenne d'une session de coachine (calcul du THM)",labelPos:"left",type:"input",default:45},maxfetchpg:{section:["Application","optimisation"],label:"Maximum de page recherch\xE9es dans l'historique",labelPos:"left",type:"input",default:1e3},datacachelifetime:{label:"Temps de conservation des donn\xE9es dans le cache (en ms)",labelPos:"left",type:"input",default:12e4},checksessionalreadyexists:{section:["Application","Base de donn\xE9e"],label:"sessions: v\xE9rifier existence avant insertion",labelPos:"left",type:"checkbox",default:!0},sizeofcontentlist:{section:["Interface","th\xE8me"],label:"taille de la police des listes",labelPos:"left",type:"input",default:"1em;"},use_custom_css:{label:"utiliser des styles personnalis\xE9s",labelPos:"left",type:"checkbox",default:!1},custom_css_url:{label:"url de la feuille de style (si plusieurs les s\xE9parer par des virgules)",labelPos:"left",type:"input",default:""},custom_css_data:{label:"code css \xE0 injecter ?",title:"saisir ici le code css \xE0 injecter directement dans la page web g\xE9n\xE9r\xE9e",labelPos:"left",type:"input",default:""},alwaysaddcbox:{section:["Interface","Gadget"],label:"Toujours ajouter les checkbox sur l'interface",labelPos:"left",type:"checkbox",default:!0},hackheaderzindex:{section:["","Hack"],label:"Changer le zindex du bandeau haut",title:"le bandeau haut \xE0 un z-index  (1000) qui le place au dessus de tout ce qui est pr\xE9sent \xE0 l'\xE9cran, ce qui g\xEAne la barre de menu ; activer cette option r\xE9duit ce chiffre \xE0 0",labelPos:"left",type:"checkbox",default:!0},use_student_cache:{section:["Avanc\xE9es",""],label:"Utiliser le cache \xE9tudiant",title:"Lorsque l' application recherche si un \xE9tudiant est pr\xE9sent on utilise un cache pour \xE9viter de passer trop de temps dans les requ\xEAtes, d\xE9sactiver le cache permettra de toujours faire une requete en base ",labelPos:"left",type:"checkbox",default:!0},support:{section:["","Support"],label:"StephaneTy-Pro.github.io",title:"more info on https://github.com/StephaneTy-Pro",type:"button",click:()=>{GM_openInTab("https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon",{active:!0,insert:!0,setParent:!0})}}},css:zn,events:{save:function(){GM_config.close()}}},Rt=function(){GM_config.open(),OCAddonsCfg.style=Wn};var Pt=class{};U(Pt,"longTaskTiming",function(){if(window.self===window.top){console.log("LongTasks: Initializing");var o=new window.PerformanceObserver(function(n){for(var a=n.getEntries(),e=0;e<a.length;e++)console.log("LongTasks: ",a[e].name,a[e].duration,a[e].attribution.length,a[e].attribution.length>0?a[e].attribution[0].containerType:null,a[e].attribution.length>0?a[e].attribution[0].containerName:null,a[e].attribution.length>0?a[e].attribution[0].containerSrc:null,a[e].attribution.length>0?a[e].attribution[0].containerId:null,a[e])});typeof window.PerformanceLongTaskTiming!="undefined"?console.log("LongTasks: Appears to be supported"):console.log("LongTasks: Not supported");try{o.observe({entryTypes:["longtask"]})}catch(n){console.log("LongTasks: Not supported")}}}),U(Pt,"paintTiming",function(){if(window.self===window.top){console.log("PaintTiming: Initializing");var o=new window.PerformanceObserver(function(n){for(var a=n.getEntries(),e=0;e<a.length;e++)console.log("PaintTiming: ",a[e].name,a[e].startTime)});if(typeof window.PerformancePaintTiming!="undefined")console.log("PaintTiming: Appears to be supported");else{console.log("PaintTiming: Not supported");return}try{o.observe({entryTypes:["paint"],buffered:!0})}catch(n){console.log("PaintTiming: Not supported")}}});var Ft=function(p,o,n,a,e,t,u){t=o.createElement(n),u=o.getElementsByTagName(n)[0],t.appendChild(o.createTextNode(a.text)),t.onload=e(a),u?u.parentNode.insertBefore(t,u):o.head.appendChild(t)};var Kn=function(p,o){if(!arguments.length)return Promise.reject(new ReferenceError("Failed to execute 'fetchInject': 1 argument required but only 0 present."));if(arguments[0]&&arguments[0].constructor!==Array)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 1 must be of type 'Array'."));if(arguments[1]&&arguments[1].constructor!==Promise)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 2 must be of type 'Promise'."));let n=[],a=o?[].concat(o):[],e=[];return p.forEach(t=>a.push(window.fetch(t).then(u=>[u.clone().text(),u.blob()]).then(u=>Promise.all(u).then(l=>{n.push({text:l[0],blob:l[1]})})))),Promise.all(a).then(()=>(n.forEach(t=>{e.push({then:u=>{t.blob.type.includes("text/css")?Ft(window,document,"style",t,u):Ft(window,document,"script",t,u)}})}),Promise.all(e)))},lt=Kn;var zi=function(p,o,n){"use strict";if(!p.MutationObserver||typeof HTMLElement=="undefined")return;var a=0,e=function(){var m=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(b,h){return b instanceof HTMLElement&&m.call(b,h)},addMethod:function(b,h,C){var M=b[h];b[h]=function(){if(C.length==arguments.length)return C.apply(this,arguments);if(typeof M=="function")return M.apply(this,arguments)}},callCallbacks:function(b,h){h&&h.options.onceOnly&&h.firedElems.length==1&&(b=[b[0]]);for(var C=0,M;M=b[C];C++)M&&M.callback&&M.callback.call(M.elem,M.elem);h&&h.options.onceOnly&&h.firedElems.length==1&&h.me.unbindEventWithSelectorAndCallback.call(h.target,h.selector,h.callback)},checkChildNodesRecursively:function(b,h,C,M){for(var B=0,D;D=b[B];B++)C(D,h,M)&&M.push({callback:h.callback,elem:D}),D.childNodes.length>0&&e.checkChildNodesRecursively(D.childNodes,h,C,M)},mergeArrays:function(b,h){var C={},M;for(M in b)b.hasOwnProperty(M)&&(C[M]=b[M]);for(M in h)h.hasOwnProperty(M)&&(C[M]=h[M]);return C},toElementsArray:function(b){return typeof b!="undefined"&&(typeof b.length!="number"||b===p)&&(b=[b]),b}}}(),t=function(){var m=function(){this._eventsBucket=[],this._beforeAdding=null,this._beforeRemoving=null};return m.prototype.addEvent=function(b,h,C,M){var B={target:b,selector:h,options:C,callback:M,firedElems:[]};return this._beforeAdding&&this._beforeAdding(B),this._eventsBucket.push(B),B},m.prototype.removeEvent=function(b){for(var h=this._eventsBucket.length-1,C;C=this._eventsBucket[h];h--)if(b(C)){this._beforeRemoving&&this._beforeRemoving(C);var M=this._eventsBucket.splice(h,1);M&&M.length&&(M[0].callback=null)}},m.prototype.beforeAdding=function(b){this._beforeAdding=b},m.prototype.beforeRemoving=function(b){this._beforeRemoving=b},m}(),u=function(m,b){var h=new t,C=this,M={fireOnAttributesModification:!1};return h.beforeAdding(function(B){var D=B.target,y;(D===p.document||D===p)&&(D=document.getElementsByTagName("html")[0]),y=new MutationObserver(function(s){b.call(this,s,B)});var g=m(B.options);y.observe(D,g),B.observer=y,B.me=C}),h.beforeRemoving(function(B){B.observer.disconnect()}),this.bindEvent=function(B,D,y){D=e.mergeArrays(M,D);for(var g=e.toElementsArray(this),s=0;s<g.length;s++)h.addEvent(g[s],B,D,y)},this.unbindEvent=function(){var B=e.toElementsArray(this);h.removeEvent(function(D){for(var y=0;y<B.length;y++)if(this===n||D.target===B[y])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function(B){var D=e.toElementsArray(this),y=B,g;typeof B=="function"?g=function(s){for(var v=0;v<D.length;v++)if((this===n||s.target===D[v])&&s.callback===y)return!0;return!1}:g=function(s){for(var v=0;v<D.length;v++)if((this===n||s.target===D[v])&&s.selector===B)return!0;return!1},h.removeEvent(g)},this.unbindEventWithSelectorAndCallback=function(B,D){var y=e.toElementsArray(this);h.removeEvent(function(g){for(var s=0;s<y.length;s++)if((this===n||g.target===y[s])&&g.selector===B&&g.callback===D)return!0;return!1})},this},l=function(){var m={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function b(B){var D={attributes:!1,childList:!0,subtree:!0};return B.fireOnAttributesModification&&(D.attributes=!0),D}function h(B,D){B.forEach(function(y){var g=y.addedNodes,s=y.target,v=[],T;g!==null&&g.length>0?e.checkChildNodesRecursively(g,D,C,v):y.type==="attributes"&&C(s,D,v)&&v.push({callback:D.callback,elem:s}),e.callCallbacks(v,D)})}function C(B,D,y){return e.matchesSelector(B,D.selector)&&(B._id===n&&(B._id=a++),D.firedElems.indexOf(B._id)==-1)?(D.firedElems.push(B._id),!0):!1}d=new u(b,h);var M=d.bindEvent;return d.bindEvent=function(B,D,y){typeof y=="undefined"?(y=D,D=m):D=e.mergeArrays(m,D);var g=e.toElementsArray(this);if(D.existing){for(var s=[],v=0;v<g.length;v++)for(var T=g[v].querySelectorAll(B),R=0;R<T.length;R++)s.push({callback:y,elem:T[R]});if(D.onceOnly&&s.length)return y.call(s[0].elem,s[0].elem);setTimeout(e.callCallbacks,1,s)}M.call(this,B,D,y)},d},c=function(){var m={};function b(){var B={childList:!0,subtree:!0};return B}function h(B,D){B.forEach(function(y){var g=y.removedNodes,s=[];g!==null&&g.length>0&&e.checkChildNodesRecursively(g,D,C,s),e.callCallbacks(s,D)})}function C(B,D){return e.matchesSelector(B,D.selector)}f=new u(b,h);var M=f.bindEvent;return f.bindEvent=function(B,D,y){typeof y=="undefined"?(y=D,D=m):D=e.mergeArrays(m,D),M.call(this,B,D,y)},f},d=new l,f=new c;function i(m,b,h){e.addMethod(b,h,m.unbindEvent),e.addMethod(b,h,m.unbindEventWithSelectorOrCallback),e.addMethod(b,h,m.unbindEventWithSelectorAndCallback)}function w(m){m.arrive=d.bindEvent,i(d,m,"unbindArrive"),m.leave=f.bindEvent,i(f,m,"unbindLeave")}o&&w(o.fn),w(HTMLElement.prototype),w(NodeList.prototype),w(HTMLCollection.prototype),w(HTMLDocument.prototype),w(Window.prototype);var Y={};return i(d,Y,"unbindAllArrive"),i(f,Y,"unbindAllLeave"),Y}(window,typeof jQuery=="undefined"?null:jQuery,void 0);var wn={data:"DwCwLgtgNgfAUKApgQwCb2BRZkAIDGIyATgM7YC8ARAK5gBmAtABxUYCEjjuADgPY1iARxp8AlrjEA7fFEGJcURKUViARitSIaAD1z1xKgPy5GMXgOIWaAN3FWlKgFYDEVxFNwQ+W3KRxSqMhQfFIKXBik+MRiPGB+xPjU4GA8pABcAPSZ+KhSAHROpFpQYjbE+WFgmVI8EJmkAO6I2MFuYABMAAIAjAAMbMAN0bFgkSNxCUlUKWlZmTS1ANYA5vn4fPVBAJ5FvfnM+R09mTtF+RDShaRUuFr0brgwQ1ExcRxcuNZWAJIAoj0eqYzAhXqMpskwKkMtlcgUiiUyhUqpkViBMsEeNJEEUMVAsWEujYOvkdKTTmJ-HiCYhGGJEIDrrd7m5nsM3mMEJxuPxBIplLhkHRiAKpMgbGIVsgwNoyMDxhyITMoXNYXlrojypVsKj0Zjsbj9YTiaTyahKdUjYgmWywe84KCwNslPA1D5trgAN5wL4GKRgRj0ZCXKDbdK4KgAeR4HlwAGVkFIbgAaUzIHg8JSMUjbfyICCpgBCpSkSwAssh8HHczKIAAxUJgVNUOOIFZ8BQAVR+VFTACU+G6wHxU5GdNsVh5GAmk6nO2pFmAaKmAMKJnAiqBQZsACUQUBs2DE+DwADltIhe7g9wejyfUwBBGLBVOkROkbNuMT0ADcuDgAC+CANE6LrASAKDoA6wBuqg2zwAg5o2AQUDIKQpDULWmbSpeGAUjYCGghMnJwI00ioHwjT5CyxAADJ8Gg0grA++LYrgFD6Is+BgGIoS4AAFCeW5qJWSwAJRenAACQUkbEmfBKPkIQrPxVA0YoDHmlIKxUGJP4+l8hlfGRgSUfkaCoH8h7+rRFoeG4-EAORNMEjmpvQXE8Xx-GIBJ3pGUZsmhKQCnWspqmINZ8TOY0rm4CK+CIGUiCoKmFEEMEUAifgSy6fpAWGUF8mKeFvn5QVAVCVlon8XpBkFQBdUVQQwWhUpfAqY5kUePE5BgI5TWGQB+lySFJUdapNH0Yx2ksTSfjYDKqB5XAHkyF5niTmAnbEFAABqJCkLVklGTYJC4GdcocZ6w31Rd508CQYAqBxJkUVRIQnht+QgCK9D5CK2GJfxmQANpGAAZAAugA1PxoMAHoUNDMNiRQ8MI9DABUYmomI7mebxUj8QWSyINsyZnXIvknRVl2kKDZPbFD7H3dT5VfI1HPxdggiePT+lAathN8VtO1QAACiQwb8Y9xDBtgbhpYgQY0FAYBUzQvn+YZl24II+LS1gMpWBx9xCurmuINz378W9ZmfdKRM-X9+TkYgOiRvQstG4rxASeYjA9GJOsFQbcsKybrNi7tB1kLVoMR8bbhQ9zRlAUZIpLsQnjh77JuCw6esURAfaQR6HFrdxRMCX50lZ3zuBhI0uAS8QmyUog-EimNh7seY3oyd+AkUfgNBYP6APl3GOAyuxHFUCEM06XXMlSaP489eZqCWVFtl5mExCqQAIpGZYro2PXTVoy2pj3CmHmJ0lSQBuD7uQklr-ft61fpMlAS-J+t04D8TQtsGQx0KAD2kqNNq4UqAAFJ8D5HyP4J6V4qAbBCMQdIGx5ZQBWlJZAsUxDxBLmXNA2xf4wNauNFSiDch8HwJIFQIpKEYKwXwHBeDgiEP4DwGgPBqFFTGmFCaDCUH5A8LfCMnDuFcN4XVKSgExLULgJkLGPosb6x4qUJ0nF1o1xoOQVAkhTFnBUJSRy-p9YmK0f+XA2ivgNxzgQQQIobFBBlKmR6O8Uq4DImAEAuA+iSHoE3FoN8tGZDgHrLaAAVCCx8cLsSrhtY6g80k118fxUgfkebZ08Lk3AwBcD9AkiYRyfRHK4Bhn4XA4ZSB-gAcXVmzdcDJJlLVeuvNXGg1QPkLadY1ZQAAJooCPhJHxaB+IDK2mWRsIBaow2DtM1AszBnYE6V3MSYkoaFHEMTRyjABqASLg9PgAieCszATIAx1dQi1UHsPfiToYx8HCXGWKUBcDsAoBxRyWTQgDUHiItqbh25HwYT8YgCU+CHnlmoJQb9YVcIwdlVY7dFioEYHI9IIpUp4qRaJQhUkXFSD-i-aS2RgR3AAJf0GkKQmuWgVD7nzD1FQGwIAQEWKQalORgq9RlGkVmoNHI9DcrgRyHQpWOQAMyOShtJJQwrECio4uKyVyYZVKpoUmXq3yACKWstYz3VazL5wQLhiB0NIfioKAD6WE44ZCbiM5MBkZJyUZcQCAhY6DDikPEj2YBwyOTjDQMo65cAQ3lrCn8bkvWyUTIlKAAaoShBDToMN0q250vwHSrQNiIaoQTUmr4MkeDtxWD3Ug5q5h+BFaQT1layXdTIIgDNQa3VgGIFrVtuAZJUzEF4omZZlBvknOGlcChCDBlFcoeIIoRBWM9TJc0qBoweHDECop3gghQFXmvWBdDVKSKtVAdIm7t1SFJTJe2VFzSkEemAQgVker8WfmvdpK5jHDggB+-0TkXJQCld+mSnpcALjUEi5Q4Y+0DruK0MQV6vS4BlDm8MUYADS+RbivwAWvKST9iNKJfqmZ+ZEty3t3SLYm2tv2nrEfQi93z0jUagLe0lAF13r1HWXQIbg6OGO8ge4IIcIPMfaqxtjwRr0CekW4e9UlH3UUpK+99UV+K-v-ZsIDYAQPfKlVBmDcHe39sQMrHAqHwxQcw7myB5gHMkBQPkK2uBCO7OfrxqjqGoArhCOQETDzibiaPaC71tCWPnskfkS9HH-OBb4OQHjfHN3JeC-c9J4XJPEek-AuLKCEsZaC5ecjvmN2juPku9uYZstExJj4CTkWwVnqoEV4r7HN01f8HVtLz9pJc2kvq-wbMtYvVwKDVOKrsBuNhT1Btf9RvxEemEKAjrGggFCpGYgrYlDcVZqCniYBkVSXDSahQdg1aIAAF4XQECoN8tg2wkC0MQJNMlwDQCMuGAABs-YAShJyBBgCubblJKTkHu2BulMpAhayGMD6R8AZLAEZfuVAfVUdSWAEhFCaEMJUAMH62to62CA+kAI+Io7qCEHEIlW4YosB04h4zjD2wYzJFHcW24VtqBSBGYMbkRBAjIoXJmzwshjxLAIGz8IIIZLxIEPED2-BiAmxgoGvitOqDvmaMQHozJpTIEYJWDa1A1dcLAI6zKtxZCE+oKBjo2ZQIpVuG8xA1AJdBrYJGHDQwfehBx3GOlUAC0bUPvyFQOBzNa8l2Y6g+u3AdGNzgM3oXLc6HVzb0Il4CfoSd98l3-hnTu451zqgQe70wH94H7XUgcdDAx1ALH2Am+ohiFBGSf2+PVsQBfKQvqIAhfScgVMahkz4GTKlGmn8ovFRi+Pyf0-Z-kakqq3Azr8w8Fdd+vtHpWvb4gLvw6rMABScZIynnyHLcgsymGb0niINw2x9uIG4lwpyoNmde8wfLqgKGAadzYILWdfKSWEaLGTVSENE-dIK8Y-U-MgdfV+L6QgHyY9GSSAxfaAv7JBP4HQRKOIGuAAEk9EQAAl72lTxR4SgB-AxVrQEECFxQUi4XxRSgGkpRkkvVQW20aAOlKDHVCAnXQmQEnH4j+wnUSAkF8Hp0hysEWAUFZWQ10FwEuQ2lID+3APJX0GCHIC4KIzaxi0v2v1v0Oi7g3gnjAHyBf2IDf3ZU-yPkch-wVlZwZ0vCALEhAOpl2S4OyFtk9w+S3xdTP3+QBWxRVmxFQBqQAB8Yjgid9XV54OJBctw8sh5vYEiT8kiwj3U0jWseDSA+CBDR0nZhDJ0xCu5JC3B8AZC50IdSAxAFCwhkNNBtA9B1CiZNDtDelPAgwoB9Dv1X5v1sDRFcCkFYCkCWFcAyDEDXVKDkxMFWD5F8F70dDPQ8weB0gehUwrZ0g5jDohZ-4+MNFn4nArtkBKRkM7AmjeAnpbjSA+RFDkMZRQs7hHI6VrIOUbE5smhSFCBHhHiHBHJFg1CaBFBHIhQ+0lCBR2UrC2jFA8AX8tY34+jQhQsziFAYxVCtBXio5UIWoDU7j1tNttslBdt39uJUxzivAupPByANc7h0TvheB25HpJwHAFBiA6VHj1ZpRcBJFcAABzvAFov0ULFox6FQZ+LGGJB9fzWjBrbyfcTAgrcROTK9Tjbjdfb9fcGwrWOwyk4cJw-IEnCAMnaIrwiyAzfeeHByRyaXHKKVR1UXVAJQU2JUhjSTKTKA8KPA-AAzXAeJEgLacMMg60DcLaBYpY7BXBBRAhcAn0okq3DXFiDbc3GuSuejHyGwMAdIteW2SKawyM7AC4aUAEo6RyavfpE3DPC3KgFMm3O3Tw-Mk9X0iaf0ggnPXAB8WiWiOXdw3vGMtg2glTLAzINbfcUknbPbBw6wg4q6aVRs23LcRyP8GlDYNWPIRyeIYxBQUhCDGSIs9YdxHqYM4gLafU1-I0r-Zw3-Nw48Dw4AjzDiEwm-PrJib8KhT0PYhs7Pa3FcghRqQ8iA04RABcFYDkrgmSIdHgx0pYQfYfYRYjIdQwmSclaC26fLIVN+f8jXSMMIW3N4rM0TBjXM1sqSQs3M-IEs6ww8iAcsiCSs6srxU3DM0ILPHPR1PPQAgaCi0CycjbLbGco0-IBcybLqPC3PMINc3ADcgQVvKQHc2xfcsAEC48seBbf0c8y82w+wg7Y07-e8--dw3irwl83AN81BPtT8+gb8385cni4C4jKSIdNUlSf0n4JMdoQUJtC1fk-gRojaBpGYz0HgraS7M1EVZZHoaMmg+Msc2C75N2byjXSKxABtH2EkrbaUZXBMQ8ZMcK7AdKzKsSFZUjFyzY0gVBTMR8-iIqsAEq6KsqnYkJVMCVNQTgkCng6QBkxq01DK6KwSx1M06UQq5KiKga0qmGDoCq4jKqmq0oYGBqpq9VZZDoVMPodqnofALqlyoybITfR1NQMATwDiBqxCpo-1BvZCteIdbIY6069YJapYW6mCqSOCl6y6v1N6l+f8YjDCiDLCteDRQUN40hRxOUteRstMoi9JMqCDRsgixAOGxrBGteYbf+IbB0ERVbRMKcnKsAPK8UBQa6Z+E7M7C7FE67JQe7a7J7IUQ8KUYgd7T7KSb7KAc7XAAHNePHMoZNKSHQRgVi6gUOIdGSWPRwOzO6NtKSHoOzMxcMfoVMMAJFdIZyJcYtZ6KVBzcNP4TWsQdcUgGpXzAqNeDoBW0dcMDoLajDNW5ySdLonW0NcNVsdCJ2zzQdQKGSeVS21AcMeVW21Wq9DWmgLW0gF0i0LhbYZ2rDaVHcKOmIF-FQOHMOw2-0Y2z2mW8WqSAAFj9vDFzqDvtpAETu2EdXIHdtCEdRPABNjtzUcgrGEBRPZIUErsaOChNq9sKhkgAFYC7cBe7i6Q7jZkB67w1j5QgpA6UWgVB0xaqvpkpM7Tae6qVZaAIqBv0cdcc1Z4BZbgBuQeYxsgisJUI54Ig7pebT6cJs614haSdqBQZR1djQDEAWZpBcBIw1BzjuIpF-QYhlBXlkBzMxJN6zaZJ0gmZqBydL6ZI96ApebSh4Hva0cqc6AK8-8ASco3QdBbh0hdcrY3ZloGljLCHg6+dX7qAKdwG0dUI1B9wGkH6qBCHydcAhaHNqAyHQ1BhMg6H9xkHV6kcxABHebMhr6ZRt7ccFhYBv0hgkIcde9n5+9vqR9a5+559QLBQY8IIRRpi8AsGlgcGAlSFgkpA+AzFJAvB-19BUMo4ddTFhw+AmMcLuLLUJrsAJZLlBFaorzDS5yuE0zv9PcKADGcGoYn7UBPCuDN8JAOJuKlIPAVgglUxbdYU2lEAW4nx5YqExA9J-qZISd+I-wxAuA-xUniAn6WZrorbuLKmiHUxf99i+A6nf8p8IIcoUomm6mDGUpMb0Lej0NNj0gNrxtEBwxymiMAEsLRo8aSSvFSb58KbEAuaqBLstwBR5mUxn4OauaebcdS8wIsDtEhJpEAGrA0B0wwA6VkNcBZgYRBVsFSg1B1hNhMhsB8BMgRQVgzSHmuEnnGAvmzTGAOhe7MhbmVR7m5EnmXmthKIpAl5UBMgegABOVFsF2U5+DRPhqAaiHCdIdIZAegKOT0OSeHXNKgAAHUQGYHlQADYqAfxArmVQhwxNwnZDwfwlAiXC6+geAdAfxhwtjB6+WfwAIMWCmuEIAvRn1sJ6sLTGWLImIlb8x6DRJGDsVwwABiegZFnVnV+grhd7JWvlvwBSUdXATV-AHa61n8Bii86Qa2kUKVqE8x0JF1215AIWsiVAIJcMWlvoXl-l3xLSFYZViAUV5+M0yQWodBz0BgrFQILV+gZNg1lm4TMpE1sac1zV5F-AXN3NiNiVv1aDBvL0eNpg-21QNEMAWtcmBVneJVkJfIAAdhVe9d9bKQDYQVTaNZCULakijer3SG2wRTLbVYTcrfbFb37ajexa9GDcbb6HyF7vzCbZXalaXfXb7aIyjbQfiE9AXe0nDCXdbfDbtZWGkEYCHAA2PeXadZnclejep3SAMDHhUE9BVxLDGdwHlUzbNdMSndQH7a6CwHNDwBJkvfbZAB5cDb8lNMldtx3j4k9AtMYHEdpCwXHiTGtoDZNZ6HoGIB-FQ6lCFZ6FpZFdfng79UQ4ok8Dnc9AczN1KBWCkFZclHACI67xYLkAgFY7KTktwA6FFYFLNJo51xjabBE4Q4sj4mry9FQ8w94+toE-lVFaIxeDdyb13dQGoD7AfAAC17dUJC9idpOkO70wb6yKdUGJOMHWcP9DG+BcHE8q8jS082LM8qA+oK65yjB7d2myZu9cc52mH8A1AjTdtTw+AwA2BQ8DKiYo9nieA6UYgfAFAjAkdgH+HAcQuuFqAfW6x24IAjPHc1IcI2BtkbnUA6UJdMv6GZGbPqcXOCuiuPdOc-95nbgGKdBqAbbA6g4Xd5UjcvBpBeu+h+gBvGAhv3O6yiYndsBHV5mRrWu7hazUJtIaBKiKBAUPsm9cviB8uia+ASuTPOuYBKvfBGUpA6vsvGv0HdcfXlc2vK9OuvBPWxv+uehBvhvLgpAxuJuvupvhvWLZuOKvOFulvhwZv1uVhNvJxtuCPHIO8zSm8X1EwYAouZRwxkVGV1ZdGgTETVu54WjShLg54X9o8Foq6kwClLBp7lAXg1sFG+8RQVHwwnMNHv01BzwUpKuzZH8rDNkwA-glArDCxtgfh1kqyjTgCemgPv0WvNhWZLCt4toRfviwBxfJenJFeIBnzX6uDHvzH+ex5Be1fReeotepfdf9f2Zv1v1bZufIk+f-kMNLNY0IYBI7gwBCulfciqBbg4jvfldkiIxdJcBWzCjijghSiNoRCp0qipDaibnSAw8P9I9Hhnj5mwT6UNgASYd9G0IYS-A0-QstDoKdD+jBiMb8nlEv4BnWshn5VKNiM9jQZDyVfJ5zeNerenJwu5zZeAuUo+M15O-rDu+xeJfrefeivgDn1gGlBTFcjEN0u8iflwwx+hf1fJ-tfHIbfzLX6R+N0BfVfsBt-Lep+deju5-KQF--Fl-3eTBUj1+mTTfT-heLf-Re+9-r+D-qYINlUGNSlJVn4xboYwfHHyEenUZi1AoepPSjeRNKicZOSlK0jvBtJ2RD4TkedNpEQDOlXS7pVmHugwIwCKouNBaGAG2S+8IAqNPiCRVCw5k8yrWSit7GPK0Uyyb6Jit-hB7sU-u4PG3EtwI6bAzKFFTfBYlZh1hzcggekBUCebVUru6yY3uYD4BEN540qCxHtWIy2wxBuRCIldxSj8V3KqkJBD8D7B9g-gK4SMHtD+B6dCwtEP4LgGsF9hIwfYXAKeD+B-Bj4PZFcCuD+Bxg4wQZSMPGDPj2CHwEsCWLRB+ArgHw8SH4NflwB7QHwfYOML2BApVlx2FbbjmwQJR-giUqEHKImhArgF+mhSaClShcraDVuuwaqnEGIAd8T+XfM-p-016X8f+yuW3iiQ4ggULED+N-g0I-498Wh+-bwmARAp-0t03sRyN4H9AgBgCo1QzFQFGSLDRkjAMsGWEYDHxj4Y5KSOQCgD-RxKYqT0IINUab8J+F-XfkMKtgq0+A16eoeP0aEDDzhv-YYRQUAEoU0K7aEoUDWgpJkxsfUB8HBjypzk+enpBgRRSorFkQypZBihwMAbOFuBnnbzjsPT5+cWyTAoyEdTUDK9bhW-Jod-374GVB+DnFKKUPXjYjThX-QYTP02A383wcGJfr8i3xqAuhZI+4Tv2n5tCvC8-OkazHYCMjDyaFYGkc0s41wIa4rNeH1EoFFcaBXpaCn8IBF8AjS2yDAmnAqjDZmoB1QVDgXgRIJQgt6CwFcg4TLE4yqxQaKqO7pGRSsKWb9pAIkhQJaY6ogKHAINL6V0+t5KjtQOQHAEnW8KRAOgIPgOR-8iYScAgVFyt43ApogKJViGx-wZmxJKcnMKOzk1SElNaVGs30CStpQbNHZv9kBxIQBaQtEWlQDFprxJa8Ge0avXlroYranbdyBmLDSOQigwKFWi7WlSNilKWdGhhbSrGVsbatYv1NKHVr4BSANgcetQWHFd1b6MkWBmvRzob0t6sjXegLQPqfAe48QE+jvjPoK4RGaOdDpOMFqBg8uVACJi-Wpjv1PAX9H+tYR6gAMjopYvJGAwQYQMoGVAGBigwEb70kGe43HHuzs7-4HOODPBgQ1fpEM8GpDYCXMIobUwqG74nOsFyy7r8mGLDYhuw1DScNgJDmHhtixgmiNPxKDIYOh0kZDBFxojeRoNh7ws8B8oQYfOz1tHQIQaYLNCBhh0b7k56cuf8U52MZBIm45jc1hIF5RjZcedjTwOa0cY-D4grjc6u4zACeMrkPjeAf42ICBNnCwTUJk53CajoomEGGJqzHiZKBtIyTLfCQA9LtIsmyAHJnkwgyFNimpTQybCkqZHYamzTMQPsmfpNwFYXTZyZUAVhtMiR-tWpp5Ll59NihjcKDEM1zonitY4zIyYYSmbLZthxqKaiKivJax4YSjfGkJTJKIAKSc5PvOlMW44R10UMLwkEg8D8QBIPcNWHmWgHPxRBjqY+CJA-gcQJB3EKQW4HyBLBjOcg8iPxEUFqEVBrvRyPVKL4aCtBdUhqaTVd66Coi+ZQwdClMHmDLB1gh8LYPsGODnBrg9wZ4IfDeDfB-g+JIEKvxlgQhYQiIVEJiFxCEhSQlIWvDSE5R1WzBPFNkJaixliUOUY2t+nXyA0saG6MaUX2V6-TyAt+PtM-BeQVT1YzwzAjSj7TvgzSjwMDIOHOKq5PA5oCUpcRFDfojqKM1mGDOsKEMCUNAYGKAmTA6BaJAkT0JInHxTYyQmxKGOGDJBWxGoqYG6BJChnywkwUbBGenwwzmMUZQaMUHYQEhMx0gmxCKWMythzVN8pAHcJACgDUApSNzbkryVngMsMZc2XXm0g9TB9jea-LgiMTBaNF+QcuBdJoBSRLpUSa-VMASWz5KUzZ8s6tJ3HNnco4giAB3uEn4iLdjwoMeVOEz6BVNXeK-TAuvCpFSspIcTFGV7PCY9AZsxGI3kOjDmezvZoMDoNHLbJaiOySCHng43MZ7kieCgMgrr1fjcB85R3BYrIiNGjkUC9vAspkQ9n4BQYUcj3l8Frn1z9kL5V3n+S4p24Q4clMFg2jKQQYaUOc0uioATH0MTwOciGrFG0YKA88KlUxB-StACQScb8MBC1B4DbA5qZAu8YmJcqVioM1Y5WnbRDr+Aw6nKUcY5H1pp0jaE4lyl2P3k9jh66tduk7WbFx0I0jtTulnRcq+1uxAdR+aHXDqR1-A0dc+QnWAVJ0JsuAVOmBwzo3ziM+dX+bgCLoq0S6ZdHztTxrqVgII58puhT1bpU8O6SYOBWvH7qIKh6KCkeq0HPmT0pA9PAUPPSWrstlAxCmcbLSOr3YOIF49Pn-RsqAM7xLMsFoU14nnjv63C68fSFvF388kIcQwXeIiZFTX4HiG4goGeIQpZQ7xd2HoD-DIpe6b8MbPLL7QCAbAdKLSb8S7LW4qGf4SyV-j1hiAKAjqW7Ak30kgAg4xTGABQD6DWTGAIg34sGTgyngFYOk27JUxbk0UkUpQ2aZxlwo54rwpAPxUoACVYAihpAcxYyRhivkr875GytpC-IOpSxws+JYgESVWZWK16AGdaEbLxIkUyuN8rkkKXFK0owcxpcrjEhBSyh4o6WdAEsUQYpZMs9JX9mAB4AHucLBFrcF+gqx8uJudIA5gnKoRpAP4edJ2jAAUA6ATAZgMmHDIyA0unYPsJEM2D8AwgwGFJVJVaXMgRlmkTigBTIIJIkkOEWqABGuChA2Ay5a5dgESSIAlRrSx5ddwxAwA-s0FbIL0ugD9LgAPAGAFc3DyLLJwVhG5i8s9BmMqIcwpyEsNGSrCNhA0B5W2MdmWBqqkiIYGCv+Vrwhib8AYgoCgw0pmgASRMGKGiXW5fKSIt4ifTv4DzeGFobGcoEqnPCyyQiPQHaIdSJgxADFNDDoEajgEaUnwUsdzNpUa5TF4k27BQGmzQVJZIqR1I2R0nhzk5Vi7CmnJUi1zN5EGNQA2H7FgA3y6qz2bnX2TyCypvU5Qb-lUENiQoKA9YEP1QAGqjV0IlcHGD2hfB45dci1aaW6lqF1GtqwJQNKHEjivCcvCDI73dXShPVe0CioUyOp2LbajqCABQE2KqqpKTipJiAB-COoxAwANNWUzEAwxUYTAowtAUzWNlQYBaoqSSNtjVqpKtagKS6v4pSQHFt+YxEslr4uVPQNTfGCBQ3RTKPAGwLQDsr2Un488wGVAOUqkRSUqlUAZXPGtyQqqa1daryVgEaVUDmlfAXZEf2IyNMm1OeFtfslaZDqpILYh0uOIvXvCZIRQ9pRjSBrRrvYhqusW+UTVf5k1HilJumuPXW4c1QSfNYWuLVb5S15akCoYP-Ua5T1D6xtWuubUbq5e7aztQIiKJlSL1-avyYOpcqj8R1Wy8dbsovhTrDlhmKyh+RyV2VZkc6ypdUr4C1LoNYAU9Zuqsze8d1Ws3ZGJAPU-p3JjG5jeetw1Hk35bYxyLeqHUPr3hAoiDD0s6WyyqAwAXeirOIxJq5sBan9VvilZxNHFek3NSWqLXhswNZanxb1DrCoYiloa7mnCocX8aFYAER1K8qJq3KukXy2YsEo3WhpKCh5IFVAH6WHkgcwjECoMua7nK0AYyv6JMpwDTLQ0syy4hSkWV9QVlDAFgBss9DWaN1rFOcYJvejwsLlVAMgqQFM0JLbNbAVzTZqwAAR+IpW9zTmmcq4bAtvyvzayr+XPr5qsm9JfJukYwAlNWNb2jwV9RdwSBEtZMd+0cimbCA0glQCsDpTT1FZ7ACtI+I5o5jmodfNHPI3y2yaAIcjMoNhKkiKNwGPqK6t2izRXr6Ih4UMHNtgZ9MpmdUV+IZGAh2hOQged0HhA5rwAgAA",method:"decompressFromEncodedURIComponent"};var An=function(){var p=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",a={};function e(u,l){if(!a[u]){a[u]={};for(var c=0;c<u.length;c++)a[u][u.charAt(c)]=c}return a[u][l]}var t={compressToBase64:function(u){if(u==null)return"";var l=t._compress(u,6,function(c){return o.charAt(c)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(u){return u==null?"":u==""?null:t._decompress(u.length,32,function(l){return e(o,u.charAt(l))})},compressToUTF16:function(u){return u==null?"":t._compress(u,15,function(l){return p(l+32)})+" "},decompressFromUTF16:function(u){return u==null?"":u==""?null:t._decompress(u.length,16384,function(l){return u.charCodeAt(l)-32})},compressToUint8Array:function(u){for(var l=t.compress(u),c=new Uint8Array(l.length*2),d=0,f=l.length;d<f;d++){var i=l.charCodeAt(d);c[d*2]=i>>>8,c[d*2+1]=i%256}return c},decompressFromUint8Array:function(u){if(u==null)return t.decompress(u);for(var l=new Array(u.length/2),c=0,d=l.length;c<d;c++)l[c]=u[c*2]*256+u[c*2+1];var f=[];return l.forEach(function(i){f.push(p(i))}),t.decompress(f.join(""))},compressToEncodedURIComponent:function(u){return u==null?"":t._compress(u,6,function(l){return n.charAt(l)})},decompressFromEncodedURIComponent:function(u){return u==null?"":u==""?null:(u=u.replace(/ /g,"+"),t._decompress(u.length,32,function(l){return e(n,u.charAt(l))}))},compress:function(u){return t._compress(u,16,function(l){return p(l)})},_compress:function(u,l,c){if(u==null)return"";var d,f,i={},w={},Y="",m="",b="",h=2,C=3,M=2,B=[],D=0,y=0,g;for(g=0;g<u.length;g+=1)if(Y=u.charAt(g),Object.prototype.hasOwnProperty.call(i,Y)||(i[Y]=C++,w[Y]=!0),m=b+Y,Object.prototype.hasOwnProperty.call(i,m))b=m;else{if(Object.prototype.hasOwnProperty.call(w,b)){if(b.charCodeAt(0)<256){for(d=0;d<M;d++)D=D<<1,y==l-1?(y=0,B.push(c(D)),D=0):y++;for(f=b.charCodeAt(0),d=0;d<8;d++)D=D<<1|f&1,y==l-1?(y=0,B.push(c(D)),D=0):y++,f=f>>1}else{for(f=1,d=0;d<M;d++)D=D<<1|f,y==l-1?(y=0,B.push(c(D)),D=0):y++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)D=D<<1|f&1,y==l-1?(y=0,B.push(c(D)),D=0):y++,f=f>>1}h--,h==0&&(h=Math.pow(2,M),M++),delete w[b]}else for(f=i[b],d=0;d<M;d++)D=D<<1|f&1,y==l-1?(y=0,B.push(c(D)),D=0):y++,f=f>>1;h--,h==0&&(h=Math.pow(2,M),M++),i[m]=C++,b=String(Y)}if(b!==""){if(Object.prototype.hasOwnProperty.call(w,b)){if(b.charCodeAt(0)<256){for(d=0;d<M;d++)D=D<<1,y==l-1?(y=0,B.push(c(D)),D=0):y++;for(f=b.charCodeAt(0),d=0;d<8;d++)D=D<<1|f&1,y==l-1?(y=0,B.push(c(D)),D=0):y++,f=f>>1}else{for(f=1,d=0;d<M;d++)D=D<<1|f,y==l-1?(y=0,B.push(c(D)),D=0):y++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)D=D<<1|f&1,y==l-1?(y=0,B.push(c(D)),D=0):y++,f=f>>1}h--,h==0&&(h=Math.pow(2,M),M++),delete w[b]}else for(f=i[b],d=0;d<M;d++)D=D<<1|f&1,y==l-1?(y=0,B.push(c(D)),D=0):y++,f=f>>1;h--,h==0&&(h=Math.pow(2,M),M++)}for(f=2,d=0;d<M;d++)D=D<<1|f&1,y==l-1?(y=0,B.push(c(D)),D=0):y++,f=f>>1;for(;;)if(D=D<<1,y==l-1){B.push(c(D));break}else y++;return B.join("")},decompress:function(u){return u==null?"":u==""?null:t._decompress(u.length,32768,function(l){return u.charCodeAt(l)})},_decompress:function(u,l,c){var d=[],f,i=4,w=4,Y=3,m="",b=[],h,C,M,B,D,y,g,s={val:c(0),position:l,index:1};for(h=0;h<3;h+=1)d[h]=h;for(M=0,D=Math.pow(2,2),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=c(s.index++)),M|=(B>0?1:0)*y,y<<=1;switch(f=M){case 0:for(M=0,D=Math.pow(2,8),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=c(s.index++)),M|=(B>0?1:0)*y,y<<=1;g=p(M);break;case 1:for(M=0,D=Math.pow(2,16),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=c(s.index++)),M|=(B>0?1:0)*y,y<<=1;g=p(M);break;case 2:return""}for(d[3]=g,C=g,b.push(g);;){if(s.index>u)return"";for(M=0,D=Math.pow(2,Y),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=c(s.index++)),M|=(B>0?1:0)*y,y<<=1;switch(g=M){case 0:for(M=0,D=Math.pow(2,8),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=c(s.index++)),M|=(B>0?1:0)*y,y<<=1;d[w++]=p(M),g=w-1,i--;break;case 1:for(M=0,D=Math.pow(2,16),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=c(s.index++)),M|=(B>0?1:0)*y,y<<=1;d[w++]=p(M),g=w-1,i--;break;case 2:return b.join("")}if(i==0&&(i=Math.pow(2,Y),Y++),d[g])m=d[g];else if(g===w)m=C+C.charAt(0);else return null;b.push(m),d[w++]=C+m.charAt(0),i--,C=m,i==0&&(i=Math.pow(2,Y),Y++)}}};return t}();var Vn=function(){var p=[{id:"/views/test-swal-sauvegarde",path:"views",file:"test-swal-sauvegarde",ptr:wn}],o=function(n){oCurView=p.find(t=>t.id==n),oCurView===void 0&&console.log(`%cError view ${n} could't be found`,de),oCurView=oCurView.ptr;let a=oCurView.data;return An[oCurView.method](a)};return Object.freeze({load:o})},Jn=Vn(),Sn=Jn;var J={Cfg:{dbase:null},raf:null,cssMainDataSelector:gt,ID_MENU_FORCE_LOADING:null,ID_MENU_FORCE_ADDTOLEFTMENU:null,start:async function(){await Xt();let p=J.checkSupport();console.log(`%cAre all functions supported ? : ${p}`,x);var o="header [class*=MuiAvatar-img]";document.querySelector(o)===null?(console.log(`%c All condition not met, waiting element '${o}' `,x),document.arrive(o,J._warmup),J.ID_MENU_FORCE_LOADING=GM_registerMenuCommand("force - loading",J._warmup),J.ID_MENU_FORCE_ADDTOLEFTMENU=GM_registerMenuCommand("force - populate menuleft",J._addLinkToMenu)):(console.log("%c All condition already met go",x),J._warmup())},checkSupport:function(){return!0},_warmup:function(){console.log("%c in _warmup",x),document.unbindArrive(J._warmup),GM_unregisterMenuCommand(J.ID_MENU_FORCE_LOADING),GM===void 0?(console.log("%cI am not in a tamper env",x),J._userscriptless()):console.log(`%cTamper environment detected the version is ${GM.info.version}`,x),GM_addStyle(GM_getResourceText("jspanelcss")),GM_addStyle(GM_getResourceText("toastifycss")),GM_addStyle(GM_getResourceText("simpledatatablecss")),GM_addStyle(GM_getResourceText("loading_barcss")),GM_addStyle(GM_getResourceText("nprogress_css")),GM_config.init(vn),GM_registerMenuCommand("collectauto",Rt,"a"),GM_registerMenuCommand("configure",Rt,"a"),GM_config.get("hackheaderzindex")===!0&&(document.getElementById("header").style.zIndex=0),GM_addStyle(".swal2-title{font-size:1.275em)");var p=J.cssMainDataSelector;document.querySelector(p)===null?(console.log(`%c All condition not met, waiting element '${p}' `,x),document.arrive(p,J._main)):(console.log("%c All condition already met go",x),J._main())},_forceCbox:function(){J._applyInjectionForSessionsHistory()},pathname:document.location.pathname,_getOCMainClass:function(){try{let o=document.querySelector(J.cssMainDataSelector).classList.value.match(/dom-services-(\d)/);if(o.length==2)return`dom-services-${o[1]}`;throw new Error("_aOCMainSrvId.length must be 2")}catch(p){return console.error("%cError in _getOCMainClass():%s",de,p),""}},_sOCMainSrvClassName:"",_eventMonitor:function(){var p=document.querySelector("body"),o=new MutationObserver(function(a){a.forEach(function(e){e.target.classList.contains(`${J._sOCMainSrvClassName}-MuiTouchRipple-root`),e.target.nodeName==="TBODY"&&e.target.parentElement.nodeName==="TABLE"&&(console.log("%cTable data changed (TBODy,TABLE)",x),console.log("%c=============> Changed data : %o",x,e),_t(J._applyInjectionOnPathNameMutation())),e.target.nodeName==="OL"&&(console.log("%cTable data changed (OL)",x),console.log("%c=============> Changed data : %o",x,e),_t(J._applyInjectionOnPathNameMutation())),e.target.nodeName==="BUTTON"&&e.target.parentElement.parentElement.parentElement.firstElementChild.nodeName==="TABLE"&&(console.log("%cTable data changed (BUTTON, TABLE)",x),console.log("%c=============> Changed data : %o",x,e),_t(J._applyInjectionOnPathNameMutation())),e.target.ariaLabel==="Page pr\xE9c\xE9dente",J.pathname!=document.location.pathname&&(J.pathname=document.location.pathname,_t(J._applyInjectionOnPathNameMutation()))})}),n={childList:!0,subtree:!0};o.observe(p,n)},_applyInjectionOnPathNameMutation:function(){let p=!1;p===!1&&document.location.pathname.match(/\/sessions$/)&&(p=!0,J._applyInjectionForSessionsToComplete()),p===!1&&document.location.pathname.match(/\/booked-mentorship-sessions$/)&&(p=!0,J._applyInjectionForSessionsBooked()),p===!1&&document.location.pathname.match(/\/mentorship-sessions-history$/)&&(p=!0,J._applyInjectionForSessionsHistory()),p===!1&&console.log("%cUnknow Route so could't guess what to do",de)},_lastMutation:0,_applyInjectionForSessionsToComplete:function(){document.querySelector(`${J.cssMainDataSelector} .Facturier__cbox_all`)!==null&&(document.querySelector(`${J.cssMainDataSelector} .Facturier__cbox_all`).style.display="none"),console.log("%cWill Patch All Buttons corresponding to this CSS PATH %s",x,`${J.cssMainDataSelector} a a[href*=sessions]`);var p=Array.from(document.querySelectorAll(`${J.cssMainDataSelector} a a[href*=sessions]`)),o;p.forEach(function(n){console.log("%cWill Patch Button %o",x,n),n.innerText=".:"+n.innerText+":.",n.addEventListener("click",o=function(a){a.stopPropagation(),a.preventDefault();var e=n.parentElement.parentElement.parentElement,t=e.children[1].querySelector("time").getAttribute("datetime").trim(),u=Ve(e.children[2],-2),l=e.children[3].querySelector("a").getAttribute("href-sav"),c=(l||"/").split("/"),d=c[c.length-1],f=dayjs(t).toISOString(),i=Ce.getHashId(f,u);let w=parseInt(d,10),Y=Ee.exists(w,1,Ee.TYPE.SESSIONID_DATEREFID),m=Ee.exists(i,2,Ee.TYPE.SESSIONID_DATEREFID);Y&&(m||(console.log(`[SESSIONID_DATEREFID] iSessionId ${w} est connu mais pas iHash${i}`),Ee.updKey2(w,i,Ee.TYPE.SESSIONID_DATEREFID))),m&&(Y||(console.log(`[SESSIONID_DATEREFID] iHash${i} est connu mais pas iSessionId ${w}`),Ee.updKey1(w,i,Ee.TYPE.SESSIONID_DATEREFID))),!Y&&!m&&(console.log(`[SESSIONID_DATEREFID] iHash${i} et iSessionId ${w} sont INconnus`),Ee.add(w,i,Ee.TYPE.SESSIONID_DATEREFID)),window.open(l,"blank").focus()}),n.setAttribute("href-sav",n.getAttribute("href")),n.removeAttribute("href")})},_applyInjectionForSessionsBooked:function(){document.querySelector(`${J.cssMainDataSelector} .Facturier__cbox_all`)!==null&&(document.querySelector(`${J.cssMainDataSelector} .Facturier__cbox_all`).style.display="none")},_applyInjectionForSessionsHistory:function(p=100){document.querySelector(`${J.cssMainDataSelector} .Facturier__cbox_all`)!==null&&(document.querySelector(`${J.cssMainDataSelector} .Facturier__cbox_all`).style.display="block"),!(dayjs().valueOf()-J._lastMutation<p)&&(Tt(),J._lastMutation=dayjs().valueOf())},_addHeader:function(){J._sOCMainSrvClassName.length===0&&(J._sOCMainSrvClassName=J._getOCMainClass()),J._sOCMainSrvClassName.length===0&&(console.error("%c[index._addHeader()] _sOCMainSrvClassName is still unknow",de),console.log("[index._addHeader()]check this %o",document.querySelector(J.cssMainDataSelector)));let p=`
<a href="" class="${J._sOCMainSrvClassName}-MuiButtonBase-root
 ${J._sOCMainSrvClassName}-MuiTab-root
 ${J._sOCMainSrvClassName}-dom-services73
 ${J._sOCMainSrvClassName}-MuiTab-textColorInherit"
 style="margin-left: auto;">
 <span class="${J._sOCMainSrvClassName}-MuiTab-wrapper">En base de donn\xE9e (21/24)</span>
 <span class="${J._sOCMainSrvClassName}-MuiTouchRipple-root"></span></a>
`,o=document.querySelector("#mainContent > :not(div:empty)").children,n=0;for(n=o.length-1;n>=0&&(console.log(n,o[n].nodeName),o[n].nodeName!=="SECTION");n--);if(n===0){console.error("IRRECOVERABLE ERROR element <section> not found");return}n=n-1;let a=o[n].querySelector("a").parentElement,e=o[n].querySelector("a[aria-selected=false]"),t=document.createElement("span");t.innerText="Facturier v."+GM.info.script.version,t.classList.add(...e.children[0].classList),t.classList.add("Facturier__header");let u=document.createElement("span");u.classList.add(...e.children[1].classList),u.classList.add("Facturier__header");let l=document.createElement("a");l.onclick=Mt,l.classList.add(...e.classList),l.classList.add("Facturier__header"),l.appendChild(t),l.appendChild(u),l.style="margin-left: auto",a.appendChild(l)},_userscriptless(){console.log("%cIm'not in a Tamper environment so i need to load js scripts",x)},_main:function(){console.log("\u200B\u200B\u200B%c[index._main()]MainLoaded\u200B\u200B\u200B",x),document.unbindArrive(J._main),J._eventMonitor();let p=new LocalStorage("db");var o=low(p);o.defaults({students:[],sessions:[],f_archives:[],history_session_cache:[],meta:[],refs:[],students_history:[]}).write(),J.Cfg.dbase=o,dayjs.extend(dayjs_plugin_isSameOrAfter),dayjs.extend(dayjs_plugin_isSameOrBefore),dayjs.extend(dayjs_plugin_isBetween),dayjs.extend(dayjs_plugin_localeData),dayjs.extend(dayjs_plugin_localeData),dayjs.extend(dayjs_plugin_customParseFormat),dayjs.locale("fr"),Ee.checkSupport(),Te.checkSupport(),document.querySelector(".panel.menuBar.flex.draggable")===null&&_n.init(),J._addHeader(),J._applyInjectionOnPathNameMutation(),console.log("%cWait for side menu to add element to it",x),sCSSObserved="nav:not([role])",document.arrive(sCSSObserved,J._addLinkToMenu);let n=Te.getDbVersion();if(yt(GM.info.script.version,n)==1&&(console.log(`%cDB is in version: ${Te.getDbVersion()} need to go to version ${GM.info.script.version}`,x),dt.update(GM.info.script.version)),lt(["https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"]).then(async function(a){console.log("%cALPINE js fetched",x)}),lt(["https://unpkg.com/htmx.org@1.1.0","https://unpkg.com/htmx.org@1.1.0/dist/ext/debug.js"]).then(async function(a){htmx.on("htmx:configRequest",function(e){}),htmx.on("htmx:beforeRequest",function(e){if(e.detail.pathInfo.finalPath&&tn(e.detail.pathInfo.finalPath)!=="html"){e.detail.xhr.addEventListener("abort",function(){}),e.detail.xhr.onloadstart=function(d){this.abort()};let l=Sn.load(e.detail.pathInfo.finalPath),c=e.detail.target;var t=e.detail.elt.getAttribute("hx-select");if(t){let d=new DOMParser().parseFromString(l,"text/html");oNode=d.querySelector(t),oNode?l=oNode.outerHTML:console.log(`%cWanna select target ${t} in data received from calling ${e.detail.pathInfo.finalPath} but this node could'nt be found so return the whole string`,de)}var u=function(d,f){var i=document.createRange(),w=i.createContextualFragment(d);console.log(w);for(var Y=w.childNodes.length-1;Y>=0;Y--){var m=w.childNodes[Y];f.appendChild(m),htmx.process(m)}return f.lastChild};u(l,e.detail.target)}}),htmx.on("htmx:xhr:loadstart",function(e){})}),lt(["https://cdn.jsdelivr.net/npm/sweetalert2@10"]).then(async function(a){console.log("%cSweetAlert fetched",x)}),GM_config.get("use_custom_css")===!0){let e=GM_config.get("custom_css_url").split(",");if(e.length!==0)console.log(`%cWanna inject Custom CSS from URL:${e}`,x),lt(e).then(()=>{console.log(`%cCustom CSS from URL:${e} loaded`,x)}).catch(t=>console.log(`%cError detected when loading dependencies ${t}`,de));else{let t=GM_config.get("custom_css_data");if(t.length()>0){console.log(`%cNeed to inject a custom css in application content is ${t}`,x);let u=document.createElement("style");u.innerHTML=t,document.head.insertAdjacentElement("beforeend",u)}}}unsafeWindow.Facturier={libs:[],cfg:{dbase:null},klass:[]},unsafeWindow.Facturier.cfg.dbase=J.Cfg.dbase,unsafeWindow.Facturier.libs.push({id:"fetchInject",ptr:lt}),unsafeWindow.Facturier.libs.push({id:"dayjs",ptr:dayjs}),unsafeWindow.Facturier.klass.push({id:"Student",ptr:ge}),unsafeWindow.Facturier.klass.push({id:"Session",ptr:Ce}),unsafeWindow.Facturier.klass.push({id:"Archive",ptr:it}),unsafeWindow.Facturier.klass.push({id:"History",ptr:at}),unsafeWindow.Facturier.klass.push({id:"StudentHistory",ptr:je}),unsafeWindow.Facturier.klass.push({id:"Ref",ptr:Ee}),unsafeWindow.Facturier.klass.push({id:"Dbase",ptr:dt}),unsafeWindow.Facturier.klass.push({id:"Meta",ptr:Te}),unsafeWindow.Facturier.klass.push({id:"Ref",ptr:Ee}),unsafeWindow.Facturier.klass.push({id:"Api",ptr:Ct}),unsafeWindow.Facturier.libs.push({id:"NProgress",ptr:NProgress}),unsafeWindow.Facturier.libs.push({id:"Moise",ptr:moize}),GM.info.script.downloadURL==="http://localhost:8000/dist/app-facturier.iife.js"?(console.log("%cALERTE .... version locale !!!!!! ","background-color:coral;color:white"),console.log("%c test readfile",x),nn("file:////media/pwyll/USB120Go/DevStt/UserScripts/SttAddon/src/update_data_base.js",function(a){console.log(a)}),J.loadDependencies()):console.log(`%c GM.info.script.downloadURL url : ${GM.info.script.downloadURL}`,x)},_addLinkToMenu:function(){console.log("%cSide menu was added",x),document.unbindArrive(J._addLinkToMenu);try{let p=document.querySelectorAll("nav:not([role])")[0],o=p.children[0].lastChild.cloneNode(!0);o.firstChild.innerText="Facturier",elMenu=document.querySelector(".panel.draggable"),o.firstChild.href="javascript:function(){elMenu = document.querySelector('.panel.draggable');elMenu.style.display = (elMenu.style.display != 'block') ? 'block' : 'none';}";let n=p.children[0].lastChild.firstChild;o.firstChild.appendChild(n.children[0].cloneNode(!0)),o.firstChild.appendChild(n.children[1].cloneNode(!1)),o.firstChild.appendChild(n.children[2].cloneNode(!1));let a=p.children[0].cloneNode(!1);a.appendChild(o),p.appendChild(a)}catch(p){console.log("%cInjecting menu encounter an error: %o",de,p)}},loadDependencies:function(){let p=[];p.push("http://localhost:8000/src/branch01/sandbox.js"),p.push("http://localhost:8000/src/branch01/sandbox.css"),lt(p).then(()=>{console.log(`dependencies ${p} loaded`)})},dbUpdate:function(){console.log("%c Need to update DB",x),yt(GM.info.script.version,"1.00.0006")==0&&(console.log("%c Need to update DB to version '1.00.0006'",x),dt.update("1.00.0006"))}};window.Facturier!==void 0?window.Facturier.start():J.start();var q=J;})();
/* @license
Papa Parse
v5.3.0
https://github.com/mholt/PapaParse
License: MIT
*/
/**
 * Fetch Inject module.
 *
 * @module fetchInject
 * @license Zlib
 * @param {(USVString[]|Request[])} inputs Resources you wish to fetch.
 * @param {Promise} [promise] A promise to await before attempting injection.
 * @throws {Promise<ReferenceError>} Rejects with error when given no arguments.
 * @throws {Promise<TypeError>} Rejects with error on invalid arguments.
 * @throws {Promise<Error>} Whatever `fetch` decides to throw.
 * @throws {SyntaxError} Via DOM upon attempting to parse unexpected tokens.
 * @returns {Promise<Object[]>} A promise which resolves to an `Array` of
 *     Objects containing `Response` `Body` properties used by the module.
 */
//# sourceMappingURL=app.min.js.map
