// ==UserScript==
// @name         Facturier
// @namespace    http://tampermonkey.net/
// @version      1.10.0007
// @description  Un addon pour vous aider dans votre facturation
// @author       Stéphane TORCHY
// @updateURL    https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/dist/app.min.js
// @downloadURL  https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/dist/app.min.js
// @icon         https://mirrors.creativecommons.org/presskit/icons/heart.red.png
// multiple usage
// @match        https://openclassrooms.com/fr/mentorship/dashboard/mentorship-sessions-history*
// @match        https://openclassrooms.com/fr/mentorship/dashboard/sessions
// @match        https://openclassrooms.com/fr/mentorship/dashboard/booked-mentorship-sessions

// Start at document start https://www.tampermonkey.net/documentation.php#_run_at
// @run-at document-start   

// @grant        unsafeWindow
// @grant        GM_addStyle
// @grant        GM_getResourceText
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        GM.xmlHttpRequest
// @grant        GM_notification

// @require      https://cdn.jsdelivr.net/npm/lodash@4.17.19/lodash.min.js
// @require      https://unpkg.com/lowdb@0.17/dist/low.min.js
// @require      https://unpkg.com/lowdb@0.17/dist/LocalStorage.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/dayjs.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/locale/fr.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isBetween.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isSameOrBefore.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/isSameOrAfter.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/customParseFormat.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.29/plugin/localeData.min.js


//// GM_Compat : Portable monkey-patching for userscripts  
// SRC 				https://github.com/chocolateboy/gm-compat
// permet notamment d'utiliser GMCompat.unsafeWindow.notify('loaded', { value: 42 }) sous chrome
// @require       	https://unpkg.com/gm-compat@1.1.0 

//// GM_Config
// SRC 			https://github.com/sizzlemctwizzle/GM_config/wiki
// require      https://openuserjs.org/src/libs/sizzle/GM_config.js (cassé ce jour 28/08/2020);
// @require      https://raw.githubusercontent.com/sizzlemctwizzle/GM_config/master/gm_config.js

//// sweetalert 2
// require      https://cdn.jsdelivr.net/npm/sweetalert2@9/dist/sweetalert2.all.min.js
// @require      https://cdn.jsdelivr.net/npm/sweetalert2@10

//// draggabilly
// @require      https://cdnjs.cloudflare.com/ajax/libs/draggabilly/2.2.0/draggabilly.pkgd.min.js

//// toastify 
// @require     https://cdn.jsdelivr.net/npm/toastify-js@1.8.0/src/toastify.min.js
// @resource    toastifycss https://raw.githubusercontent.com/apvarun/toastify-js/master/src/toastify.css

// https://github.com/uzairfarooq/arrive --> included manually
// require     https://raw.githubusercontent.com/uzairfarooq/arrive/master/minified/arrive.min.js

////simple-datatables
//// https://github.com/fiduswriter/Simple-DataTables
// @require     https://cdn.jsdelivr.net/npm/simple-datatables@latest
// @resource    simpledatatablecss https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css


//// MEMOIZATION
//// TODO : check best function
// require https://raw.githubusercontent.com/anywhichway/nano-memoize/master/dist/nano-memoize.min.js
// https://github.com/planttheidea/moize#usage
// @require https://cdn.jsdelivr.net/npm/moize@5.4.7/dist/moize.min.js
// require https://cdn.jsdelivr.net/npm/moize@6.0.2/dist/moize.min.js -> probleme 20210701
// require https://cdn.jsdelivr.net/npm/moize@6.0.3/dist/moize.min.js -> probleme 20210701
// USAGE OF https://caolan.github.io/async/v3/docs.html
// FONCTIONNE PAS require https://cdn.jsdelivr.net/npm/async@3.2.0/memoize.min.js probleme export
// @require https://cdn.jsdelivr.net/npm/async@3.2.0/dist/async.min.js
// TOTEST https://github.com/sindresorhus/p-memoize
// Ne fonctionne pasrequire https://cdn.skypack.dev/p-memoize

//// FETCH INJECT --> included manually
// require https://cdn.jsdelivr.net/npm/fetch-inject

//// PARSER MKDOWN
// @require 	 https://cdn.jsdelivr.net/npm/showdown@1.9.1/dist/showdown.min.js

//// PDF https://pdf-lib.js.org/docs/api/
// @require      https://unpkg.com/pdf-lib@1.9.0/dist/pdf-lib.min.js
// @require      https://unpkg.com/downloadjs@1.4.7/download.js

//// HTMX https://htmx.org --> included dynamically
// require https://unpkg.com/htmx.org@1.1.0/dist/htmx.min.js

//// ALPINE JS --> included dynamically
// require https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.js


// ProgressBar 
// https://loading.io/progress/
// require https://raw.githubusercontent.com/loadingio/loading-bar/master/dist/loading-bar.js
// resource loading_barcss https://raw.githubusercontent.com/loadingio/loading-bar/master/dist/loading-bar.css
// @require https://loadingio.github.io/loading-bar/dist/loading-bar.js
// @resource loading_barcss https://loadingio.github.io/loading-bar/dist/loading-bar.min.css

// https://www.cssscript.com/demo/text-progress-bar-ascii-loader/
// https://github.com/kimmobrunfeldt/progressbar.js - fonctionne mais probleme avec le easing dans mon popup progress bar
// require https://raw.githubusercontent.com/kimmobrunfeldt/progressbar.js/master/dist/progressbar.min.js
// require https://raw.githubusercontent.com/kimmobrunfeldt/progressbar.js/master/dist/progressbar.js
// https://pvdlg.github.io/uprogress/js-api/#UProgress+start
// https://ricostacruz.com/nprogress


// @require https://unpkg.com/nprogress@0.2.0/nprogress.js
// @resource nprogress_css https://unpkg.com/nprogress@0.2.0/nprogress.css


// semble cassé
// https://github.com/webosorg/Process
// https://unpkg.com/@webos/process@0.2.0/dist/process.js
// https://cdn.jsdelivr.net/npm/@webos/process@0.2.0/dist/process.min.js
// bof ... je ne parviens pas à faire fonctionner l'exemple
// https://cdn.jsdelivr.net/npm/worker-function@2.0.1/WorkerFunction.min.js
// Threading 
// require  https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/Thread.js
// require   https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/ThreadPool.js
// require   https://raw.githubusercontent.com/gkjohnson/threading-js/master/umd/ThreadQueue.js
// semble cassé
// https://cdn.jsdelivr.net/npm/threads@1.6.3/dist/index.min.js
// https://unpkg.com/paralleljs@1.0/lib/parallel.js
// https://cdn.jsdelivr.net/npm/threads@1.6.3/dist/index.min.js
// Freelancer
// https://github.com/Wildhoney/Freelancer
// fonctionne require https://raw.githubusercontent.com/arqex/worker-function/master/WorkerFunction.js
// ne fonctonne pas https://raw.githubusercontent.com/duart38/Thread/master/Thread.bundle.js
// require      https://cdn.jsdelivr.net/npm/paralleljs@1.0.1/lib/parallel.min.js


/*
 * History
 * cf https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon/blob/master/CHANGELOG.md
 */
// ==/UserScript==
(()=>{var Cn=Object.create,St=Object.defineProperty;var Mn=Object.getOwnPropertyDescriptor;var Tn=Object.getOwnPropertyNames;var Dn=Object.getPrototypeOf,Yn=Object.prototype.hasOwnProperty;var $n=(p,o,n)=>o in p?St(p,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):p[o]=n;var Bn=p=>St(p,"__esModule",{value:!0});var kn=(p,o)=>()=>(o||p((o={exports:{}}).exports,o),o.exports);var In=(p,o,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let d of Tn(o))!Yn.call(p,d)&&d!=="default"&&St(p,d,{get:()=>o[d],enumerable:!(n=Mn(o,d))||n.enumerable});return p},On=p=>In(Bn(St(p!=null?Cn(Dn(p)):{},"default",p&&p.__esModule&&"default"in p?{get:()=>p.default,enumerable:!0}:{value:p,enumerable:!0})),p);var U=(p,o,n)=>($n(p,typeof o!="symbol"?o+"":o,n),n);var un=kn((It,Ot)=>{(function(p,o){typeof define=="function"&&define.amd?define([],o):typeof Ot=="object"&&typeof It!="undefined"?Ot.exports=o():p.Papa=o()})(It,function p(){"use strict";var o=typeof self!="undefined"?self:typeof window!="undefined"?window:o!==void 0?o:{},n=!o.document&&!!o.postMessage,d=n&&/blob:/i.test((o.location||{}).protocol),e={},t=0,u={parse:function(h,s){var w=(s=s||{}).dynamicTyping||!1;if(y(w)&&(s.dynamicTypingFunction=w,w={}),s.dynamicTyping=w,s.transform=!!y(s.transform)&&s.transform,s.worker&&u.WORKERS_SUPPORTED){var C=function(){if(!u.WORKERS_SUPPORTED)return!1;var Q=(A=o.URL||o.webkitURL||null,S=p.toString(),u.BLOB_URL||(u.BLOB_URL=A.createObjectURL(new Blob(["(",S,")();"],{type:"text/javascript"})))),E=new o.Worker(Q),A,S;return E.onmessage=g,E.id=t++,e[E.id]=E}();return C.userStep=s.step,C.userChunk=s.chunk,C.userComplete=s.complete,C.userError=s.error,s.step=y(s.step),s.chunk=y(s.chunk),s.complete=y(s.complete),s.error=y(s.error),delete s.worker,void C.postMessage({input:h,config:s,workerId:C.id})}var R=null;return u.NODE_STREAM_INPUT,typeof h=="string"?R=s.download?new a(s):new i(s):h.readable===!0&&y(h.read)&&y(h.on)?R=new v(s):(o.File&&h instanceof File||h instanceof Object)&&(R=new c(s)),R.stream(h)},unparse:function(h,s){var w=!1,C=!0,R=",",Q=`\r
`,E='"',A=E+E,S=!1,Y=null,I=!1;(function(){if(typeof s=="object"){if(typeof s.delimiter!="string"||u.BAD_DELIMITERS.filter(function(L){return s.delimiter.indexOf(L)!==-1}).length||(R=s.delimiter),(typeof s.quotes=="boolean"||typeof s.quotes=="function"||Array.isArray(s.quotes))&&(w=s.quotes),typeof s.skipEmptyLines!="boolean"&&typeof s.skipEmptyLines!="string"||(S=s.skipEmptyLines),typeof s.newline=="string"&&(Q=s.newline),typeof s.quoteChar=="string"&&(E=s.quoteChar),typeof s.header=="boolean"&&(C=s.header),Array.isArray(s.columns)){if(s.columns.length===0)throw new Error("Option columns is empty");Y=s.columns}s.escapeChar!==void 0&&(A=s.escapeChar+E),typeof s.escapeFormulae=="boolean"&&(I=s.escapeFormulae)}})();var P=new RegExp(m(E),"g");if(typeof h=="string"&&(h=JSON.parse(h)),Array.isArray(h)){if(!h.length||Array.isArray(h[0]))return j(null,h,S);if(typeof h[0]=="object")return j(Y||O(h[0]),h,S)}else if(typeof h=="object")return typeof h.data=="string"&&(h.data=JSON.parse(h.data)),Array.isArray(h.data)&&(h.fields||(h.fields=h.meta&&h.meta.fields),h.fields||(h.fields=Array.isArray(h.data[0])?h.fields:O(h.data[0])),Array.isArray(h.data[0])||typeof h.data[0]=="object"||(h.data=[h.data])),j(h.fields||[],h.data||[],S);throw new Error("Unable to serialize unrecognized input");function O(L){if(typeof L!="object")return[];var oe=[];for(var me in L)oe.push(me);return oe}function j(L,oe,me){var ce="";typeof L=="string"&&(L=JSON.parse(L)),typeof oe=="string"&&(oe=JSON.parse(oe));var fe=Array.isArray(L)&&0<L.length,be=!Array.isArray(oe[0]);if(fe&&C){for(var ne=0;ne<L.length;ne++)0<ne&&(ce+=R),ce+=k(L[ne],ne);0<oe.length&&(ce+=Q)}for(var ie=0;ie<oe.length;ie++){var he=fe?L.length:oe[ie].length,de=!1,se=fe?Object.keys(oe[ie]).length===0:oe[ie].length===0;if(me&&!fe&&(de=me==="greedy"?oe[ie].join("").trim()==="":oe[ie].length===1&&oe[ie][0].length===0),me==="greedy"&&fe){for(var ae=[],te=0;te<he;te++){var G=be?L[te]:te;ae.push(oe[ie][G])}de=ae.join("").trim()===""}if(!de){for(var pe=0;pe<he;pe++){0<pe&&!se&&(ce+=R);var we=fe&&be?L[pe]:pe;ce+=k(oe[ie][we],pe)}ie<oe.length-1&&(!me||0<he&&!se)&&(ce+=Q)}}return ce}function k(L,oe){if(L==null)return"";if(L.constructor===Date)return JSON.stringify(L).slice(1,25);I===!0&&typeof L=="string"&&L.match(/^[=+\-@].*$/)!==null&&(L="'"+L);var me=L.toString().replace(P,A),ce=typeof w=="boolean"&&w||typeof w=="function"&&w(L,oe)||Array.isArray(w)&&w[oe]||function(fe,be){for(var ne=0;ne<be.length;ne++)if(-1<fe.indexOf(be[ne]))return!0;return!1}(me,u.BAD_DELIMITERS)||-1<me.indexOf(R)||me.charAt(0)===" "||me.charAt(me.length-1)===" ";return ce?E+me+E:me}}};if(u.RECORD_SEP=String.fromCharCode(30),u.UNIT_SEP=String.fromCharCode(31),u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!n&&!!o.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=b,u.ParserHandle=$,u.NetworkStreamer=a,u.FileStreamer=c,u.StringStreamer=i,u.ReadableStreamStreamer=v,o.jQuery){var l=o.jQuery;l.fn.parse=function(h){var s=h.config||{},w=[];return this.each(function(Q){if(!(l(this).prop("tagName").toUpperCase()==="INPUT"&&l(this).attr("type").toLowerCase()==="file"&&o.FileReader)||!this.files||this.files.length===0)return!0;for(var E=0;E<this.files.length;E++)w.push({file:this.files[E],inputElem:this,instanceConfig:l.extend({},s)})}),C(),this;function C(){if(w.length!==0){var Q,E,A,S,Y=w[0];if(y(h.before)){var I=h.before(Y.file,Y.inputElem);if(typeof I=="object"){if(I.action==="abort")return Q="AbortError",E=Y.file,A=Y.inputElem,S=I.reason,void(y(h.error)&&h.error({name:Q},E,A,S));if(I.action==="skip")return void R();typeof I.config=="object"&&(Y.instanceConfig=l.extend(Y.instanceConfig,I.config))}else if(I==="skip")return void R()}var P=Y.instanceConfig.complete;Y.instanceConfig.complete=function(O){y(P)&&P(O,Y.file,Y.inputElem),R()},u.parse(Y.file,Y.instanceConfig)}else y(h.complete)&&h.complete()}function R(){w.splice(0,1),C()}}}function f(h){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(s){var w=B(s);w.chunkSize=parseInt(w.chunkSize),s.step||s.chunk||(w.chunkSize=null),this._handle=new $(w),(this._handle.streamer=this)._config=w}.call(this,h),this.parseChunk=function(s,w){if(this.isFirstChunk&&y(this._config.beforeFirstChunk)){var C=this._config.beforeFirstChunk(s);C!==void 0&&(s=C)}this.isFirstChunk=!1,this._halted=!1;var R=this._partialLine+s;this._partialLine="";var Q=this._handle.parse(R,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var E=Q.meta.cursor;this._finished||(this._partialLine=R.substring(E-this._baseIndex),this._baseIndex=E),Q&&Q.data&&(this._rowCount+=Q.data.length);var A=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(d)o.postMessage({results:Q,workerId:u.WORKER_ID,finished:A});else if(y(this._config.chunk)&&!w){if(this._config.chunk(Q,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);Q=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(Q.data),this._completeResults.errors=this._completeResults.errors.concat(Q.errors),this._completeResults.meta=Q.meta),this._completed||!A||!y(this._config.complete)||Q&&Q.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),A||Q&&Q.meta.paused||this._nextChunk(),Q}this._halted=!0},this._sendError=function(s){y(this._config.error)?this._config.error(s):d&&this._config.error&&o.postMessage({workerId:u.WORKER_ID,error:s,finished:!1})}}function a(h){var s;(h=h||{}).chunkSize||(h.chunkSize=u.RemoteChunkSize),f.call(this,h),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(w){this._input=w,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(s=new XMLHttpRequest,this._config.withCredentials&&(s.withCredentials=this._config.withCredentials),n||(s.onload=D(this._chunkLoaded,this),s.onerror=D(this._chunkError,this)),s.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var w=this._config.downloadRequestHeaders;for(var C in w)s.setRequestHeader(C,w[C])}if(this._config.chunkSize){var R=this._start+this._config.chunkSize-1;s.setRequestHeader("Range","bytes="+this._start+"-"+R)}try{s.send(this._config.downloadRequestBody)}catch(Q){this._chunkError(Q.message)}n&&s.status===0&&this._chunkError()}},this._chunkLoaded=function(){s.readyState===4&&(s.status<200||400<=s.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:s.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(w){var C=w.getResponseHeader("Content-Range");return C===null?-1:parseInt(C.substring(C.lastIndexOf("/")+1))}(s),this.parseChunk(s.responseText)))},this._chunkError=function(w){var C=s.statusText||w;this._sendError(new Error(C))}}function c(h){var s,w;(h=h||{}).chunkSize||(h.chunkSize=u.LocalChunkSize),f.call(this,h);var C=typeof FileReader!="undefined";this.stream=function(R){this._input=R,w=R.slice||R.webkitSlice||R.mozSlice,C?((s=new FileReader).onload=D(this._chunkLoaded,this),s.onerror=D(this._chunkError,this)):s=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var R=this._input;if(this._config.chunkSize){var Q=Math.min(this._start+this._config.chunkSize,this._input.size);R=w.call(R,this._start,Q)}var E=s.readAsText(R,this._config.encoding);C||this._chunkLoaded({target:{result:E}})},this._chunkLoaded=function(R){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(R.target.result)},this._chunkError=function(){this._sendError(s.error)}}function i(h){var s;f.call(this,h=h||{}),this.stream=function(w){return s=w,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var w,C=this._config.chunkSize;return C?(w=s.substring(0,C),s=s.substring(C)):(w=s,s=""),this._finished=!s,this.parseChunk(w)}}}function v(h){f.call(this,h=h||{});var s=[],w=!0,C=!1;this.pause=function(){f.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){f.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(R){this._input=R,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){C&&s.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),s.length?this.parseChunk(s.shift()):w=!0},this._streamData=D(function(R){try{s.push(typeof R=="string"?R:R.toString(this._config.encoding)),w&&(w=!1,this._checkIsFinished(),this.parseChunk(s.shift()))}catch(Q){this._streamError(Q)}},this),this._streamError=D(function(R){this._streamCleanUp(),this._sendError(R)},this),this._streamEnd=D(function(){this._streamCleanUp(),C=!0,this._streamData("")},this),this._streamCleanUp=D(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function $(h){var s,w,C,R=Math.pow(2,53),Q=-R,E=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,A=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,S=this,Y=0,I=0,P=!1,O=!1,j=[],k={data:[],errors:[],meta:{}};if(y(h.step)){var L=h.step;h.step=function(ne){if(k=ne,ce())me();else{if(me(),k.data.length===0)return;Y+=ne.data.length,h.preview&&Y>h.preview?w.abort():(k.data=k.data[0],L(k,S))}}}function oe(ne){return h.skipEmptyLines==="greedy"?ne.join("").trim()==="":ne.length===1&&ne[0].length===0}function me(){if(k&&C&&(be("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),C=!1),h.skipEmptyLines)for(var ne=0;ne<k.data.length;ne++)oe(k.data[ne])&&k.data.splice(ne--,1);return ce()&&function(){if(!k)return;function ie(de,se){y(h.transformHeader)&&(de=h.transformHeader(de,se)),j.push(de)}if(Array.isArray(k.data[0])){for(var he=0;ce()&&he<k.data.length;he++)k.data[he].forEach(ie);k.data.splice(0,1)}else k.data.forEach(ie)}(),function(){if(!k||!h.header&&!h.dynamicTyping&&!h.transform)return k;function ie(de,se){var ae,te=h.header?{}:[];for(ae=0;ae<de.length;ae++){var G=ae,pe=de[ae];h.header&&(G=ae>=j.length?"__parsed_extra":j[ae]),h.transform&&(pe=h.transform(pe,G)),pe=fe(G,pe),G==="__parsed_extra"?(te[G]=te[G]||[],te[G].push(pe)):te[G]=pe}return h.header&&(ae>j.length?be("FieldMismatch","TooManyFields","Too many fields: expected "+j.length+" fields but parsed "+ae,I+se):ae<j.length&&be("FieldMismatch","TooFewFields","Too few fields: expected "+j.length+" fields but parsed "+ae,I+se)),te}var he=1;return!k.data.length||Array.isArray(k.data[0])?(k.data=k.data.map(ie),he=k.data.length):k.data=ie(k.data,0),h.header&&k.meta&&(k.meta.fields=j),I+=he,k}()}function ce(){return h.header&&j.length===0}function fe(ne,ie){return he=ne,h.dynamicTypingFunction&&h.dynamicTyping[he]===void 0&&(h.dynamicTyping[he]=h.dynamicTypingFunction(he)),(h.dynamicTyping[he]||h.dynamicTyping)===!0?ie==="true"||ie==="TRUE"||ie!=="false"&&ie!=="FALSE"&&(function(de){if(E.test(de)){var se=parseFloat(de);if(Q<se&&se<R)return!0}return!1}(ie)?parseFloat(ie):A.test(ie)?new Date(ie):ie===""?null:ie):ie;var he}function be(ne,ie,he,de){var se={type:ne,code:ie,message:he};de!==void 0&&(se.row=de),k.errors.push(se)}this.parse=function(ne,ie,he){var de=h.quoteChar||'"';if(h.newline||(h.newline=function(te,G){te=te.substring(0,1048576);var pe=new RegExp(m(G)+"([^]*?)"+m(G),"gm"),we=(te=te.replace(pe,"")).split("\r"),$e=te.split(`
`),Me=1<$e.length&&$e[0].length<we[0].length;if(we.length===1||Me)return`
`;for(var Oe=0,Se=0;Se<we.length;Se++)we[Se][0]===`
`&&Oe++;return Oe>=we.length/2?`\r
`:"\r"}(ne,de)),C=!1,h.delimiter)y(h.delimiter)&&(h.delimiter=h.delimiter(ne),k.meta.delimiter=h.delimiter);else{var se=function(te,G,pe,we,$e){var Me,Oe,Se,Le;$e=$e||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var Ce=0;Ce<$e.length;Ce++){var Ve=$e[Ce],ut=0,ye=0,Ne=0;Se=void 0;for(var Be=new b({comments:we,delimiter:Ve,newline:G,preview:10}).parse(te),Ue=0;Ue<Be.data.length;Ue++)if(pe&&oe(Be.data[Ue]))Ne++;else{var ke=Be.data[Ue].length;ye+=ke,Se!==void 0?0<ke&&(ut+=Math.abs(ke-Se),Se=ke):Se=ke}0<Be.data.length&&(ye/=Be.data.length-Ne),(Oe===void 0||ut<=Oe)&&(Le===void 0||Le<ye)&&1.99<ye&&(Oe=ut,Me=Ve,Le=ye)}return{successful:!!(h.delimiter=Me),bestDelimiter:Me}}(ne,h.newline,h.skipEmptyLines,h.comments,h.delimitersToGuess);se.successful?h.delimiter=se.bestDelimiter:(C=!0,h.delimiter=u.DefaultDelimiter),k.meta.delimiter=h.delimiter}var ae=B(h);return h.preview&&h.header&&ae.preview++,s=ne,w=new b(ae),k=w.parse(s,ie,he),me(),P?{meta:{paused:!0}}:k||{meta:{paused:!1}}},this.paused=function(){return P},this.pause=function(){P=!0,w.abort(),s=y(h.chunk)?"":s.substring(w.getCharIndex())},this.resume=function(){S.streamer._halted?(P=!1,S.streamer.parseChunk(s,!0)):setTimeout(S.resume,3)},this.aborted=function(){return O},this.abort=function(){O=!0,w.abort(),k.meta.aborted=!0,y(h.complete)&&h.complete(k),s=""}}function m(h){return h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(h){var s,w=(h=h||{}).delimiter,C=h.newline,R=h.comments,Q=h.step,E=h.preview,A=h.fastMode,S=s=h.quoteChar===void 0?'"':h.quoteChar;if(h.escapeChar!==void 0&&(S=h.escapeChar),(typeof w!="string"||-1<u.BAD_DELIMITERS.indexOf(w))&&(w=","),R===w)throw new Error("Comment character same as delimiter");R===!0?R="#":(typeof R!="string"||-1<u.BAD_DELIMITERS.indexOf(R))&&(R=!1),C!==`
`&&C!=="\r"&&C!==`\r
`&&(C=`
`);var Y=0,I=!1;this.parse=function(P,O,j){if(typeof P!="string")throw new Error("Input must be a string");var k=P.length,L=w.length,oe=C.length,me=R.length,ce=y(Q),fe=[],be=[],ne=[],ie=Y=0;if(!P)return Ce();if(A||A!==!1&&P.indexOf(s)===-1){for(var he=P.split(C),de=0;de<he.length;de++){if(ne=he[de],Y+=ne.length,de!==he.length-1)Y+=C.length;else if(j)return Ce();if(!R||ne.substring(0,me)!==R){if(ce){if(fe=[],Me(ne.split(w)),Ve(),I)return Ce()}else Me(ne.split(w));if(E&&E<=de)return fe=fe.slice(0,E),Ce(!0)}}return Ce()}for(var se=P.indexOf(w,Y),ae=P.indexOf(C,Y),te=new RegExp(m(S)+m(s),"g"),G=P.indexOf(s,Y);;)if(P[Y]!==s)if(R&&ne.length===0&&P.substring(Y,Y+me)===R){if(ae===-1)return Ce();Y=ae+oe,ae=P.indexOf(C,Y),se=P.indexOf(w,Y)}else{if(se!==-1&&(se<ae||ae===-1)){if(!(se<G)){ne.push(P.substring(Y,se)),Y=se+L,se=P.indexOf(w,Y);continue}var pe=ut(se,G,ae);if(pe&&pe.nextDelim!==void 0){se=pe.nextDelim,G=pe.quoteSearch,ne.push(P.substring(Y,se)),Y=se+L,se=P.indexOf(w,Y);continue}}if(ae===-1)break;if(ne.push(P.substring(Y,ae)),Le(ae+oe),ce&&(Ve(),I))return Ce();if(E&&fe.length>=E)return Ce(!0)}else for(G=Y,Y++;;){if((G=P.indexOf(s,G+1))===-1)return j||be.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:fe.length,index:Y}),Se();if(G===k-1)return Se(P.substring(Y,G).replace(te,s));if(s!==S||P[G+1]!==S){if(s===S||G===0||P[G-1]!==S){se!==-1&&se<G+1&&(se=P.indexOf(w,G+1)),ae!==-1&&ae<G+1&&(ae=P.indexOf(C,G+1));var we=Oe(ae===-1?se:Math.min(se,ae));if(P[G+1+we]===w){ne.push(P.substring(Y,G).replace(te,s)),P[Y=G+1+we+L]!==s&&(G=P.indexOf(s,Y)),se=P.indexOf(w,Y),ae=P.indexOf(C,Y);break}var $e=Oe(ae);if(P.substring(G+1+$e,G+1+$e+oe)===C){if(ne.push(P.substring(Y,G).replace(te,s)),Le(G+1+$e+oe),se=P.indexOf(w,Y),G=P.indexOf(s,Y),ce&&(Ve(),I))return Ce();if(E&&fe.length>=E)return Ce(!0);break}be.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:fe.length,index:Y}),G++}}else G++}return Se();function Me(ye){fe.push(ye),ie=Y}function Oe(ye){var Ne=0;if(ye!==-1){var Be=P.substring(G+1,ye);Be&&Be.trim()===""&&(Ne=Be.length)}return Ne}function Se(ye){return j||(ye===void 0&&(ye=P.substring(Y)),ne.push(ye),Y=k,Me(ne),ce&&Ve()),Ce()}function Le(ye){Y=ye,Me(ne),ne=[],ae=P.indexOf(C,Y)}function Ce(ye){return{data:fe,errors:be,meta:{delimiter:w,linebreak:C,aborted:I,truncated:!!ye,cursor:ie+(O||0)}}}function Ve(){Q(Ce()),fe=[],be=[]}function ut(ye,Ne,Be){var Ue={nextDelim:void 0,quoteSearch:void 0},ke=P.indexOf(s,Ne+1);if(Ne<ye&&ye<ke&&(ke<Be||Be===-1)){var Dt=P.indexOf(w,ke);if(Dt===-1)return Ue;ke<Dt&&(ke=P.indexOf(s,ke+1)),Ue=ut(Dt,ke,Be)}else Ue={nextDelim:ye,quoteSearch:Ne};return Ue}},this.abort=function(){I=!0},this.getCharIndex=function(){return Y}}function g(h){var s=h.data,w=e[s.workerId],C=!1;if(s.error)w.userError(s.error,s.file);else if(s.results&&s.results.data){var R={abort:function(){C=!0,x(s.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:T,resume:T};if(y(w.userStep)){for(var Q=0;Q<s.results.data.length&&(w.userStep({data:s.results.data[Q],errors:s.results.errors,meta:s.results.meta},R),!C);Q++);delete s.results}else y(w.userChunk)&&(w.userChunk(s.results,R,s.file),delete s.results)}s.finished&&!C&&x(s.workerId,s.results)}function x(h,s){var w=e[h];y(w.userComplete)&&w.userComplete(s),w.terminate(),delete e[h]}function T(){throw new Error("Not implemented.")}function B(h){if(typeof h!="object"||h===null)return h;var s=Array.isArray(h)?[]:{};for(var w in h)s[w]=B(h[w]);return s}function D(h,s){return function(){h.apply(s,arguments)}}function y(h){return typeof h=="function"}return d&&(o.onmessage=function(h){var s=h.data;if(u.WORKER_ID===void 0&&s&&(u.WORKER_ID=s.workerId),typeof s.input=="string")o.postMessage({workerId:u.WORKER_ID,results:u.parse(s.input,s.config),finished:!0});else if(o.File&&s.input instanceof File||s.input instanceof Object){var w=u.parse(s.input,s.config);w&&o.postMessage({workerId:u.WORKER_ID,results:w,finished:!0})}}),(a.prototype=Object.create(f.prototype)).constructor=a,(c.prototype=Object.create(f.prototype)).constructor=c,(i.prototype=Object.create(i.prototype)).constructor=i,(v.prototype=Object.create(f.prototype)).constructor=v,u})});var Je={async XHR(p){let o=window.GM_xmlhttpRequest||(GM?GM.xmlHttpRequest:null);return o?new Promise((n,d)=>{Object.assign(p,{onabort:d,onerror:d,onload:n,ontimeout:d}),o(p)}):Promise.reject()},async getValue(p,o=null){return window.GM_getValue?Promise.resolve(GM_getValue(p)||o):await GM.getValue(p)||o},async setValue(p,o){window.GM_setValue?GM_setValue(p,o):GM.setValue(p,o)}};var Ht="OC-Addons",oo="St\xE9phane TORCHY",M="background-color:green;color:white",ro="background-color:black;color:white",Ge="background-color:coral;color:white",io="background-color:cyan;color:white",le="background-color:red;color:white",Re="background-color:blue;color:white",qe="auto-financ\xE9",Ye="financ\xE9 par un tiers",Ze="autre",Xe="r\xE9alis\xE9e",et="annul\xE9e",tt="annul\xE9e tardivement",nt="\xE9tudiant absent",ht="\xE9tudiante absente",ot=6,Nt=30,Ut=35,Gt=40,qt=45,Qt=50,zt=55,z=0,W=1,K=2,so=[{pathId:158,path:"158-trouvez-lemploi-qui-vous-correspond",value:2}],Z=0,X=1,V=2,ee=3,F=0,H=1,N=2,Wt=0,Kt="completed",Vt="canceled",Jt="late canceled",Zt="marked student as absent",gt="table";var Xt=function(){return new Promise(p=>{document.readyState=="loading"?document.addEventListener("DOMContentLoaded",p):p()})},bt=async function(p="",o="",n=!1){console.info(`%cfetch() waiting return from : ${p}`,M);let d=await Je.XHR({method:"GET",url:p,responseType:"text/html",headers:{"User-Agent":"Mozilla/5.0"},onprogress:function(f){}}).catch(f=>{console.error(`%cError ${f}`,le)}),t=new DOMParser().parseFromString(d.responseText.replace(/\n/mg,""),"text/html");if(t.querySelector("meta[id=captcha-bypass]")!==null)throw console.error(`%cError CloudFlare CAPTCHA : ${t.querySelector("title").innerText}`,M),new Error("Must Respond to Cloudflare Captcha or waiting....");var l={};return n===!0?l=t.querySelectorAll(o):l=t.querySelector(o),l};var Ke=function(p,o=-1){try{var n=(p.querySelector("a").href||"/").split("/");return n[n.length+o]}catch(d){console.error(`%cError in getkey${d.stack||d}`,le)}},en=function(p){var o=p.trim().split(" ");try{var n=dayjs_locale_fr.months.findIndex(d=>d===o[1])+1}catch(d){console.error(`%cError in extractDate${d.stack||d}`,le)}return`${o[2]}-${n}-${o[0]}T${o[4]}`};var Pe=function(p){return new Promise(o=>setTimeout(o,p))},tn=function(p){return p.substring(p.lastIndexOf(".")+1,p.length)||p},yt=function(p,o){for(var n=p.split("."),d=o.split("."),e=0;e<3;e++){var t=Number(n[e]),u=Number(d[e]);if(t>u)return 1;if(u>t)return-1;if(!isNaN(t)&&isNaN(u))return 1;if(isNaN(t)&&!isNaN(u))return-1}return 0},nn=function(o,n){return console.info("Reading:",o),fetch(o,{mode:"same-origin"}).then(function(d){return d.blob()}).then(function(d){var e=new FileReader;e.addEventListener("loadend",function(){n(this.result)}),e.readAsText(d)})},on=function(p){let o=p,n=p.reduce(function(c,i){return c*i});var d=new Array(n);let e=function(...c){let i=c.pop();if(c.length!==p.length)throw"Wrong matrix dimensions, need "+p.length+", you provide "+i.length+"!";if(a(c)===0)throw"Wrong type for set need one or more int has dimension, check type of!";let v=f(c);return d[v]=i,i},t=function(...c){if(c.length!==p.length)throw"Wrong matrix dimensions, need "+p.length+", you provide "+c.length+"!";if(a(c)===0)throw"Wrong type for set need one or more int has dimension, check type of!";let i=f(c);return d[i]},u=function(...c){let i=f(c);return d[i]=void 0,d[i]===void 0},l=function(){console.group("dump table"),console.table(d),console.groupEnd("dump table")},f=function(c){return c.reduce(function(i,v,$,m){let b=o.slice($+1),g=b.length>0?b.reduce(function(x,T){return x*T}):1;return i+v*g},0)},a=function(c){return c.reduce((i,v)=>i&typeof v=="number",1)};return Object.freeze({set:e,get:t,del:u,toConsole:l})},rn=function(p,o=0){let n=3735928559^o,d=1103547991^o;for(let e=0,t;e<p.length;e++)t=p.charCodeAt(e),n=Math.imul(n^t,2654435761),d=Math.imul(d^t,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(d^d>>>13,3266489909),d=Math.imul(d^d>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&d)+(n>>>0)},re=function(p,o,n=Error){if(!p)throw new n(o)};var Yt=p=>Array.isArray(p),sn=p=>p.toString().trim().length<="function(){}".length;var an=async function(p){console.log(`%cwait() will wait ${p}ms`,"color:darksalmon"),jn(p)};var Et=function(p){var o;return function(){var n=this,d=arguments;o&&window.cancelAnimationFrame(o),o=window.requestAnimationFrame(function(){p.apply(n,d)})}};var jn=async function(p){return console.log("%csleep() will sleep %i ms ","color:darksalmon",p),new Promise(o=>setTimeout(o,p))},dn=function(p){let o=Date.now(),n=null;do n=Date.now();while(n-o<p)};HTMLElement.prototype.appendFirst=function(p){this.firstChild?this.insertBefore(p,this.firstChild):this.appendChild(p)};var ct=async function(p=null,o=null,n=!0){var d="";d+="<style>",d+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",d+="form input {background: #fff;border: 1px solid #9c9c9c;}",d+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",d+="form button:hover {background: gold;}",d+="form label {padding: 0.5em 0.5em 0.5em 0;}",d+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",d+="form input:focus {outline: 3px solid gold;}",d+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}form label {text-align: right;grid-column: 1 / 2;}form input, form button {grid-column: 2 / 3;}}",d+="</style>",d+='<form class="form1" action="">',d+='<label for="dtFrom" class="date">Date de d\xE9but</label>',p?d+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(p).format("YYYY-MM-DD")+'">':d+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31">',d+='<label for="dtTo" class="date">Date de fin</label>',p?d+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(o).format("YYYY-MM-DD")+'">':d+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31">',d+="</form>";let{value:e}=await Swal.fire({title:"<strong>Choix de la p\xE9riode</strong>",icon:"info",html:d,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:"Choisissez la p\xE9riode pour la s\xE9lection des temps factur\xE9s",showLoaderOnConfirm:!0,preConfirm:()=>[document.getElementById("dtFrom").value,document.getElementById("dtTo").value],onRender:t=>{},onOpen:t=>{n===!0&&t.querySelector("#dtFrom").addEventListener("change",_handler=function(){document.getElementById("dtTo").value=dayjs(document.getElementById("dtFrom").value).endOf("month").format("YYYY-MM-DD")})},onClose:t=>{n===!0&&t.querySelector("#dtFrom").removeEventListener("change",_handler)},onAfterClose:t=>{},onDestroy:t=>{}});return p=dayjs(e[0]),o=dayjs(e[1]),await Pe(250),[p,o]},ft=async function(p){await Swal.fire({position:"top-end",icon:"success",title:p,showConfirmButton:!1,timer:1500})};var Qe=class{},rt=Qe;U(rt,"tbl_name","f_archives"),U(rt,"add",async function(o){let n=q.Cfg.dbase,d=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]"),e={id:o[0].to.format("YYYYMM"),data:o,created_at:o[0].now};console.log(`%cWill create archive for id ${o[0].to.format("YYYYMM")} (YYYYMM)`,M),n.get(Qe.tbl_name).push(JSON.parse(JSON.stringify(e))).write()}),U(rt,"exists",function(o){return q.Cfg.dbase.get(Qe.tbl_name).find({id:o}).value()!==void 0}),U(rt,"get",function(o){var d=q.Cfg.dbase.get(Qe.tbl_name).find({id:o}).value();if(d===void 0)throw Error("Erreur qui ne devrait jamais arriver en Archive.get");return console.log(`%cWill use archive for id ${o} (YYYYMM)`,M),d}),U(rt,"delete",function(o=null,n=null){let d=q.Cfg.dbase;if(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),o===null&&n==null){console.log("%cWanna suppress ALL Archives from DB ",M),d.get(Qe.tbl_name).remove().write();return}if(n==null){d.get(Qe.tbl_name).remove(function(e){return dayjs(e.id,"YYYYMM").isBefore(n),"month"}).write();return}if(o==null){d.get(Qe.tbl_name).remove(function(e){return dayjs(e.id,"YYYYMM").isAfter(o,"month")}).write();return}d.get(Qe.tbl_name).remove(function(e){return dayjs(e.id,"YYYYMM").isBetween(o,n,"month","[]")}).write()});var it=rt;var $t=class{},_t=$t;U(_t,"isInOldMode",function(o){var n=null;typeof o=="string"?n=dayjs(o):n=o;try{return n.isBefore($t.getOldModeDate())}catch(d){throw Error("Erreur qui ne devrait jamais arriver en IsInOldMode (probablement un probleme sur la conversion de la date en objet dayjs:"+d.stack||d)}}),U(_t,"getOldModeDate",function(){return dayjs("2020-06-01")}),U(_t,"getAppVersion",function(){return GM.info.script.version});var Ae=_t;var Ln=function(){let p="students_history",o=1,n=2,d=function(v){if(v.toUpperCase()==="FUNDING")return o;if(v.toUpperCase()==="PATH")return n;throw Error("Erreur qui ne devrait jamais arriver en getype")},e=function(v,$,m=null){return u(v,o,$,m)},t=function(v,$,m=null){return u(v,n,$,m)},u=function(v,$,m,b=null){let g=!1;typeof v=="number"&&(v=v.toString(10)),re(typeof v=="string","You must provide a string.",TypeError);let x=q.Cfg.dbase;typeof b=="string"&&(b=dayjs(b)),b===null&&(b=dayjs()),re(b instanceof dayjs,"created date must be a string, a dayjs instance or null.",TypeError);let T={id:v,type:0|$,value:m,date:b.valueOf(),humanDate:b.format("YYYY-MM-DDTHH:mm:ssZZ")};return g===!0&&console.log(`%cAdd in student history at date ${dayjs(T.date).format("YYYY-MM-DDTHH:mm:ssZZ")} data ${m} with type:${$} cf const of object`,M),x.get(p).push(JSON.parse(JSON.stringify(T))).write()},l=function(v,$=null,m=null){let b=q.Cfg.dbase;return v==null&&$==null&&m==null?(console.log("%cRemove all in student history",M),b.get(p).remove().write()):(typeof m=="string"&&(m=dayjs(m)),m==null?$==null?(console.log(`%cRemove for student id:${v} history for all type of event`,M),b.get(p).remove({id:v}).write()):(console.log(`%cRemove for student id:${v} history with event type:${$} cf const of object`,M),b.get(p).remove({id:v,type:$}).write()):(console.log(`%cRemove for student id:${v} history at date ${m.format("DD/MM/YYYY")} with event type:${$} cf const of object`,M),b.get(p).remove({id:v,type:$,date:m.valueOf()}).write()))},f=function(v,$,m=null){let b=!1,g=q.Cfg.dbase;typeof m=="string"&&(m=dayjs(m)),m===null&&(m=dayjs()),b===!0&&console.log("%cSearching in student history at date %o ",M,m),b===!0&&console.log(`%cSearching in student history at date ${m.format("DD/MM/YYYY")} any data with type:${$} cf const of object`,M);var x=+m.valueOf(),T=g.get(p).filter(y=>y.id===v&&y.type&$).map(y=>y.date-x).filter(y=>y>=0).value();if(T.length==0){b===!0&&console.log(`%cThere is no data in student history at date ${m.format("DD/MM/YYYY")} with type:${$} cf const of object`,M);return}let D=x+(y=>Math.min(...y))(T);return g.get(p).filter(y=>y.id===v&&y.type&$&&y.date==D).value()[0]},a=function(v){return i(v,o)},c=function(v){return i(v,n)},i=function(v,$){return v.type&$};return Object.freeze({addFunding:e,addPath:t,getType:d,remove:l,find:f,isFunding:a,isPath:c,tbl_name:p})},Rn=Ln(),je=Rn;var ue=class{static modifyFunding(o,n,d){typeof n=="string"&&(n=dayjs(n)),re(created instanceof dayjs,"modifyFunding date must be a string, a dayjs instance or null.",TypeError);let e=ue.getFunding(o,n);if(d.toLower()===e.toLower()){console.log(`%cFundingMode ${d} is identical as current: ${sCurrent}, nothing to do`,M);return}(d!==qe||d!=Ye||d!==Ze)&&console.log(`%cWarning this state is unknown ${d}`,Ge);let t=q.Cfg.dbase,u=dayjs().format("YYYY-MM-DDTHH:mm:ssZZ");if(n===null&&(n=u),oLastHistory=je.find(o,je.getType("FUNDING"),n),t.get(ue.tbl_name).find({id:o}).assign({funding:d}).write(),je.addFunding(o,e,u),n.isSameOrAfter(Ae.getOldModeDate()))var l=t.get("sessions").filter(function(a){return a.who_id===o&&dayjs(a.when).isSameOrAfter(n,"day")});else var l=t.get("sessions").filter(function(c){c.who_id===o&&dayjs(c.when).isSameOrAfter(Ae.getOldModeDate(),"day")});for(var f=l.value().length;f-=1;)console.log(`There is ${f} elements left to update`,M),l.get(f).assign({funding:d}).write()}},_e=ue;U(_e,"tbl_name","students"),U(_e,"add",function(o,n="noname",d="nopath",e="unknown",t){let u=q.Cfg.dbase;var l=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");let f={id:o,fullname:n,path:d,funding:e,created:l};ue._save(f)}),U(_e,"_checkObject",function(o){!1===!0&&console.log("%cChecking object student:%o ",M,o),re(typeof o.id=="string","Student object id need to be a string.",TypeError),re(typeof o.fullname=="string","Student object fullname need to be a number.",TypeError),re(typeof o.path=="string","Student object path need to be a string.",TypeError),re(typeof o.funding=="string","Student object funding need to be a string.",TypeError),re(typeof o.created=="string","Student object created need to be a string.",TypeError)}),U(_e,"_save",function(o){let n=!1;ue._checkObject(o),n===!0&&console.log("%cSaving student %o to DB",M,o),q.Cfg.dbase.get(ue.tbl_name).push(JSON.parse(JSON.stringify(o))).write()}),U(_e,"exists",function(o,n=null){let d=!1,e=ue.findById(o,n);return d===!0&&console.log(`%cStudent ${o} exists in db ? ${e!==void 0}`,M),e!==void 0}),U(_e,"findById",function(o,n=null){let d=!0;return typeof o=="number"&&(o=o.toString(10)),re(typeof o=="string","You must provide a string.",TypeError),typeof n=="string"&&(n=dayjs(n)),n==null?d===!1?ue._findById(o,n):ue.m_findById(o,"null"):d===!1?ue._findById(o,n.toISOString()):ue.m_findById(o,n.toISOString())}),U(_e,"_findById",function(o,n=null){let d=!1,e=q.Cfg.dbase;typeof n=="string"&&(n=dayjs(n)),d===!0&&console.log(`%c_findById() searching student with id:(${typeof o})${o} in db`,M);var t=e.get(ue.tbl_name).find({id:o}).value();if(d===!0&&console.log("%c_findById() student %o is found",M,t),t!==void 0){if(n!==null){var u={...t},l=je.find(o,je.getType("FUNDING"),n);l!==void 0&&(u.funding=l.value);var f=je.find(o,je.getType("PATH"),n);return f!==void 0&&(u.path=f.value),u}return d===!0&&console.log("%c_findById() student final %o is found",M,t),t}}),U(_e,"m_findById",moize.default(ue._findById,{maxAge:6e5,isSerialized:!0})),U(_e,"getFunding",async function(o,n=null){return typeof n=="string"&&(n=dayjs(n)),await ue.m_getFunding(o,n)}),U(_e,"_getFunding",async function(o,n=null){let d=ue.findById(o,n);return d===void 0?(console.log('%c[Student._getFunding()]Student %s is not in db, fetching data:"funded mode" from webpage',M,o),d=await ue.getFundingFomDashboard(o),console.log("%c[Student._getFunding()]Student %s funding is %o",M,o,d),d.toLowerCase()):d.funding.toLowerCase()}),U(_e,"m_getFunding",moize.default(ue._getFunding,{maxAge:6e5,isSerialized:!0,isPromise:!0})),U(_e,"isAutoFunded",function(o){return console.log("%cFUNCTION DEPRECATED !!!!!!!!!!!!!!!!!!!!!! ",le),ue.getFunded(o).toLowerCase()===qe}),U(_e,"getFundingFomDashboard",async function(o){return(await bt(`https://openclassrooms.com/fr/mentorship/students/${o}/dashboard`,".mentorshipStudent__details > p")).innerText.trim()}),U(_e,"getPath",async function(o,n=null){let d=ue.findById(o,n);if(d==null){console.log(`%cStudent ${o} is not in db, fetching data: 'path' from webpage ....`,M);let e=await bt(`https://openclassrooms.com/fr/mentorship/students/${o}/dashboard`,"a[href*='paths/']");return e.innerText.length==0&&console.error(`%cStudent path is not readable from url : https://openclassrooms.com/fr/mentorship/students/${o}/dashboard`,le),e.innerText.trim()}else return d.path}),U(_e,"delete",function(o=null,n=null){let d=q.Cfg.dbase;if(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),o===null&&n==null){console.log("%cWanna suppress ALL Students from DB",M),d.get(ue.tbl_name).remove().write();return}if(n==null){d.get(ue.tbl_name).remove(function(e){return dayjs(e.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isBefore(n,"day")}).write();return}if(o==null){d.get(ue.tbl_name).remove(function(e){return dayjs(e.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isAfter(o,"day")}).write();return}d.get(ue.tbl_name).remove(function(e){return dayjs(e.created,"YYYY-MM-DDTHH:mm:ssZ[Z]").isBetween(o,n,"day","[]")}).write()}),U(_e,"deleteById",function(o,n=null){q.Cfg.dbase.get("students").remove(e=>e.id===o).write(),console.log(`%cAll students with id:${o} are removed from DataBase`,M)}),U(_e,"getAll",async(o,n)=>{let d=!0;var e=!1;let t=q.Cfg.dbase;var u="table.crud-list tbody";bDebug===!0&&console.log("%c[getAll()] Enter function",M);let l=await bt("https://openclassrooms.com/fr/mentorship/dashboard/students",'script[id="mentorshipDashboardConfiguration"]');var f=JSON.parse(l.innerText.trim()),a=f.mentorStudents;bDebug===!0&&console.log("%cgetAll() collect this array of stundent %o",M,a);let c=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");var i=performance.now();await ue.getFundingFomDashboard(a[0].studentId),bDebug===!0&&console.log(`%cEstimated time for updating : ${(performance.now()-i)*a.length} ms`,M),Swal.fire({position:"top-end",icon:"info",toast:!0,title:`mise \xE0 jour de la base de donn\xE9e des \xE9tudiants...
cela peut prendre du temps ~ ${(performance.now()-i)*a.length/1e3} s`,showConfirmButton:!1,timer:1e3}),await Pe(1e3),bDebug===!0&&console.log("%cWill process all students of board",M);for(let b of a){var v=b.studentId.toString(10),$=b.studentDisplayableName;bDebug===!0&&console.log('%c Working on student "%s"',M,$),ft(`Collecte les donn\xE9es de l'\xE9tudiant : ${$}`);var m=b.followedProjectSlug;m.length==0&&(m="non d\xE9fini"),bDebug===!0&&console.log('%cWill collect student "%s" funding',M,$);let g=await ue.getFundingFomDashboard(v);re(typeof v=="string","sStudentId need to be a string.",TypeError);var f=ue.m_findById(v,null);if(f===void 0){bDebug===!0&&console.log(`%cStudent ${$} (id:${v}) not present in student database will create it`,M),ue.add(v,$,m,g,c);continue}g.toLowerCase()!==f.funding.toLowerCase()&&(t.get(ue.tbl_name).find({id:v}).assign({funding:g.toLowerCase()}).write(),je.addFunding(v,f.funding.toLowerCase(),dayjs()),console.log(`%c[Student.getAll]Student ${$}(id:${v}) was already present in database but change of funding was detected (from ${f.funding.toLowerCase()} to ${g.toLowerCase()})`,M)),m!==f.path&&(t.get(ue.tbl_name).find({id:v}).assign({path:m}).write(),je.addPath(v,f.path,dayjs()),console.log(`%c[Student.getAll]Student ${$}(id:${v}) was already present in database but change of path was detected (from ${f.path} to ${m})`,M))}}),U(_e,"showList",function(){let n=q.Cfg.dbase.get(ue.tbl_name).value();var d="";d+="<table>",d+="<caption>Liste des \xE9tudiant</caption>",d+="<thead>",d+="<tr>",d+="<th>Nom</th><th>Parcours</th><th>Financement</th><th>Date de cr\xE9ation</th><th>Edition</th>",d+="</tr>",d+="</thead>",d+="<tbody>";for(var e in n)d+="<tr>",d+=`<td>${n[e].fullname}</td><td>${n[e].path}</td><td>${n[e].funding}</td>`,d+=`<td>${dayjs(n[e].created,"YYYY-MM-DDTHH:mm:ssZ[Z]").format("DD/MM/YYYY \xE0 HH:mm")}</td>`,d+=`<td><a href="https://openclassrooms.com/fr/mentorship/students/${n[e].id}/dashboard">${n[e].id}</a></td>`,d+="</tr>";d+="</tbody>",d+="</table>",Swal.fire({title:"<strong>Liste des Etudiants</strong>",icon:"info",html:d,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"fullscreen",onOpen:t=>{var u=t.querySelector("table"),l=new simpleDatatables.DataTable(u)}})}),U(_e,"createManually",async function(o,n,d){let e=["non pr\xE9sent dans la liste","Chef de projet digital","Chef de projet SI","D\xE9veloppeur d'application - Frontend","D\xE9veloppeur Web","Expert en strat\xE9gie marketing et communication ","Production de contenu web avec CMS et Content Marketing ","Tech lead"];var t="";t+="<style>",t+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",t+="form input {background: #fff;border: 1px solid #9c9c9c;}",t+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",t+="form button:hover {background: gold;}",t+="form label {padding: 0.5em 0.5em 0.5em 0;}",t+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",t+="form input:focus {outline: 3px solid gold;}",t+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}label {text-align: right;grid-column: 1 / 2;}input,button {grid-column: 2 / 3;}}",t+="</style>",t+='<form class="form1" action="">',t+='<label for="student_id" class="name">Reference</label>',t+='<input id="student_id" type="text" value="'+o+'">',t+='<label for="student_name" class="name">Name</label>',t+='<input id="student_name" type="text" value="'+n+'">',t+='<label for="funding">Autofinanc\xE9</label>',t+='<input id="funding" type="checkbox" value="autofunded">',t+='<label for="student_path">Parcours</label>',t+='<input id="student_path" name="student_path" type="text" list="student_path-list">',t+='<datalist id="student_path-list">';for(var u in e)t+=`<option>${e[u]}</option>`;t+="/<datalist>",t+='<label for="session_date">Date</label>',t+='<input id="session_date" type="date" max="2030-12-31" min="2010-12-31" value="'+dayjs(d).format("YYYY-MM-DD")+'">',t+="</form>";let{value:l}=await Swal.fire({title:"<strong>Ajout d'un \xE9tudiant en mode manuel</strong>",icon:"info",html:t,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:`votre \xE9tudiant(e) ${n} n'a pas \xE9t\xE9 trouv\xE9`,preConfirm:()=>({student_id:document.getElementById("student_id").value,student_name:document.getElementById("student_name").value,student_path:document.getElementById("student_path").value,student_funding:document.getElementById("funding").checked,session_date:document.getElementById("session_date").value})});if(l&&l.hasOwnProperty("student_id")){var f="";l.student_funding===!0?f=qe:f=Ye,ue.add(l.student_id,l.student_name,l.student_path,f,l.session_date)}});var ge=_e;var Pn=function(){let p="refs",o=0,n=1,d=2,e={DEFAULT:0,SESSIONID_DATEREFID:1},t=function(){q.Cfg.dbase.get("refs").value()===void 0&&(console.log("%cDb dont' contain ref table create it",M),q.Cfg.dbase.assign({refs:[]}).write())},u=function(v,$,m=e.DEFAULT){let b=q.Cfg.dbase;var g=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");let T=l({key1:v,key2:$,type:m,created:g,updated:g});dn(50),re(Array.isArray(T)&&T.length>0,"Database insertion fail")},l=function(v){return q.Cfg.dbase.get(st.tbl_name).push(JSON.parse(JSON.stringify(v))).write()};return Object.freeze({tbl_name:p,TYPE:e,add:u,updKey1:function(v,$,m=e.DEFAULT){let b=q.Cfg.dbase,g;g=b.get(st.tbl_name).find(x=>x.key2===v&&x.type===m).assign({key1:$}).write(),console.log("%cNeedle  %o mValue %o sType %o",M,v,$,m),console.log("%c_r %o",M,g),re(Array.isArray(g)&&g.length>0,"Database insertion fail")},updKey2:function(v,$,m=e.DEFAULT){let b=q.Cfg.dbase,g;g=b.get(st.tbl_name).find(x=>x.key1===v&&x.type===m).assign({key2:$}).write(),console.log("%cNeedle  %o mValue %o sType %o",M,v,$,m),console.log("%c_r %o",M,g),re(Array.isArray(g)&&g.length>0,"Database insertion fail")},checkSupport:t,exists:function(v,$,m=e.DEFAULT){let b=st.getByKey(v,$,m);return console.log(`%cRef ${v} exists in db ? ${b!==void 0}`,M),b!==void 0},getByKey:function(v,$=1,m=e.DEFAULT){re(typeof $=="number","You must provide a number as index of key.",TypeError);let b=q.Cfg.dbase,g=null;if($==1&&(g=b.get(st.tbl_name).find(x=>x.key1===v&&x.type===m).value()),$==2&&(g=b.get(st.tbl_name).find(x=>x.key2===v&&x.type===m).value()),g!=null)return g}})},st=Pn(),Ee=st;var Fn=function(){let p="meta",o=function(a){return re(typeof a=="string","You must provide a string.",TypeError),q.Cfg.dbase.get(vt.tbl_name).find({key:"dbVersion"}).assign({value:a}).write().value},n=function(){let a=q.Cfg.dbase.get(vt.tbl_name).find({key:"dbVersion"}).value();return typeof a=="undefined"?-1:a.value},d=function(){return q.Cfg.dbase.get("meta").remove(a=>!0).write()},e=function(){return console.log("%c resetDbVersion NE FONCTIONNE PAS",le),q.Cfg.dbase.get("meta").find({key:"dbVersion"}).remove(a=>!0).write()},t=function(a){return re(typeof a=="string","You must provide a string.",TypeError),q.Cfg.dbase.get(vt.tbl_name).find({key:"studentLstUpd"}).assign({value:a}).write().value},u=function(){let a=q.Cfg.dbase.get(vt.tbl_name).find({key:"studentLstUpd"}).value();return typeof a=="undefined"?-1:a.value};return Object.freeze({checkSupport:function(){q.Cfg.dbase.get("meta").value()===void 0&&(console.log("%cDb dont' contain meta table create it",M),q.Cfg.dbase.assign({meta:[]}).write()),n()==-1&&q.Cfg.dbase.get("meta").push({key:"dbVersion",value:"1.0.0"}).write(),u()==-1&&q.Cfg.dbase.get("meta").push({key:"studentLstUpd",value:dayjs("19701006").toISOString()}).write()},getDbVersion:n,setDbVersion:o,delDbVersion:e,setStudentListUpd:t,getStudentListUpd:u,remStudentListUpd:function(){return t(dayjs("19701006").toISOString())},tbl_name:p})},vt=Fn(),Te=vt;var Hn=function(){let p={},o="0",n=!0,d="https://api.openclassrooms.com",e="pending",t="canceled",u="completed",l="late canceled",f="marked student as absent",a=async function(){let E=await i();return E=JSON.parse(E),o=E.id,o},c=async function(){if(p.length==0)throw new Error("_header is empty, no xhr have been trapped so could't do some api request")},i=async function(){let E=d+"/me";return await C(E)},v=function(E,A){return{Range:`items=${E}-${A}`}},$=async(E=dayjs(),A=0,S=19)=>await g("AFTER",E,[e],A,S),m=async(E=dayjs(),A=0,S=19)=>await g("BEFORE",E,[e],A,S),b=async(E,A=0,S=19)=>await x(E,A,S),g=async function(E="BEFORE",A,S=[t,u,l,f],Y=0,I=19){bDebug=!0,typeof A=="string"&&(A=dayjs(A)),re(Yt(S)===!0,"You must provide an array as param aFilter.",TypeError),re(A instanceof dayjs,"date must be a string or a dayjs object.",TypeError);let P=S.join(","),O=encodeURIComponent(A.format("YYYY-MM-DDTHH:MM:ss[Z]"));P=encodeURIComponent(P);let j="";o==0&&await a(),E==="AFTER"?(j=`${d}/users/${o}/sessions?actor=expert&after=${O}&life-cycle-status=${P}`,console.log("URL IS %s",j)):(j=`${d}/users/${o}/sessions?actor=expert&before=${O}&life-cycle-status=${P}`,console.log("URL IS %s",j));let k=v(Y,I);return bDebug&&console.log("%c_getSessionOnDate url to call is:%s , params are %o",M,j,k),await y(j,v(Y,I))},x=async function(E=[],A=0,S=19){bDebug=!0,re(Yt(E)===!0,"You must provide an array as param aFilter.",TypeError),E.length==0&&(E=[t,u,l,f]);let Y=E.join(",");Y=encodeURIComponent(Y),o==0&&await a();let I=`${d}/users/${o}/sessions?actor=expert&life-cycle-status=${Y}`,P=v(A,S);bDebug&&console.log("%cUrl to call is:%o , params are %o",M,I,P);let O=await y(I,P);if(O==null)throw console.error("%cAPI have a problem returned value %o is null|undefined",le,O),new Error(`Request:${d}/users/${o}/sessions?actor=expert&life-cycle-status=${Y} have a problem`);return O.errors&&console.log("%cAPI return an error %s",le,O.errors.message),O},T=async function(E){let A=`${d}/users/${E}`;return await y(A)},B=async function(E){await c();let A=`${d}/users/${E}/paths/followed-path`;return await y(A)},D=async function(E){let A=`${d}/users/${E}/paths`;return await y(A)},y=async function(E,A={}){return await c(),await C(E,A)},h=async function(E){return await c(),await R(E,mData)},s=function(E){o=E},w=function(E){return decodeURI(E)!==decodeURIComponent(E)},C=async function(E="",A={},S="json",Y="",I=!0){let P=Object.assign({"User-Agent":"Mozilla/5.0"},p,A);if(S.toLowerCase()==="json")return(await Je.XHR({method:"GET",url:E,responseType:"application/json",headers:P}).catch(k=>{console.error("%c[Api_fetchGer()]Error is %o",le,k)})).responseText;if(S.toLowerCase==="html"){let j=await Je.XHR({method:"GET",url:E,responseType:"application/json",headers:P}).catch(oe=>{console.error("%c[Api_fetchGer()]Error is %o",le,oe)}),L=new DOMParser().parseFromString(j.responseText.replace(/\n/mg,""),"text/html");var O={};return I===!0?O=L.querySelectorAll(Y):O=L.querySelector(Y),O}},R=async function(E="",A={},S={}){};return function(){let E=!1,A="color:DarkSalmon;background-color:AliceBlue;";var S=window.XMLHttpRequest.prototype.open,Y=window.XMLHttpRequest.prototype.send,I=window.XMLHttpRequest.prototype.setRequestHeader,P=function(L,oe,me,ce,fe){return E===!0&&console.log("%cmethod %o url:%o, async:%o, user %o, password:%o",A,L,oe,me,ce,fe),this._url=oe,this._requestHeaders={},this._knox=[],S.apply(this,arguments)},O=function(){if(E===!0&&console.log("%cReady state changed to: %o",A,this.readyState),this.readyState===4&&this.status&&this.status>=200&&this.status<300){if(this._url.match(/^https:\/\/api.openclassrooms.com/g)){E===!0&&console.log("%cOPENCLASSROOMS API",A);for(var L in this._knox)p[this._knox[L].key]=this._knox[L].value;E===!0&&console.log("%c _header is %o",A,p),E===!0&&(w(this._url)?console.log("%cDECODED URL:%s",A,decodeURIComponent(this._url)):console.log("%c DECODED URL:%s",A,decodeURI(this._url)))}E===!0&&console.log("%cResponse is :%o",A,this.response)}if(this._onreadystatechange)return this._onreadystatechange.apply(this,arguments)},j=function(L){return E===!0&&console.log("%csendReplacement(%o)",A,L),this.onreadystatechange&&(this._onreadystatechange=this.onreadystatechange),this.onreadystatechange=O,Y.apply(this,arguments)},k=function(L,oe){return this._url.match(/^https:\/\/api.openclassrooms.com/g)&&this._knox.push({key:L,value:oe}),this._requestHeaders[L]=oe,I.apply(this,arguments)};window.XMLHttpRequest.prototype.open=P,window.XMLHttpRequest.prototype.send=j,window.XMLHttpRequest.prototype.setRequestHeader=k}(),Object.freeze({forge:s,getPendingSessionAfter:$,getPendingSessionBefore:m,getHistorySession:b,getUser:T,getUserFollowedPath:B,getUserPath:D,getMe:i,xGet:y,xPost:h})},Nn=Hn(),xt=Nn;var ze=function(){let o="history_session_cache",n=!1,d=function(){n===!0&&console.log("%cDb dont' contain table history_session_cache table, will create it",M),q.Cfg.dbase.assign({history_session_cache:[]}).write()},e=function(){return q.Cfg.dbase.get(o).value()!==void 0};return{find:function(i){if(e===!1)throw new Error("%c_HistoryDb:DBFindInTable() failed reason : table is not defined",M);return n===!0&&console.log('%c_HistoryDb:DBFindInTable()  Request is App.Cfg.dbase.get("%s").find(%o).value()',M,o,i),q.Cfg.dbase.get(o).find(i).value()},getAll:function(){if(e===!1)throw new Error("%c_HistoryDb:DBGetAll() failed reason : table is not defined",M);return n===!0&&console.log('%c_HistoryDb:DBGetAll()  Request is App.Cfg.dbase.get("%s").value()',M,o),q.Cfg.dbase.get(o).value()},insert:function(i){return e===!1&&d(),n===!0&&console.log("%c_HistoryDb:DBInsertInTable table:%s data:%o)",M,o,i),q.Cfg.dbase.get(o).push(i).write()},remove:function(i={}){if(e===!1)throw new Error("%c_HistoryDb:DBRemove() failed reason : table is not defined",M);return n===!0&&console.log("%c_HistoryDb:DBRemove with filter",M),sn(i)===!0&&console.log("%c_HistoryDb:DBRemove /! filter is empty",M),q.Cfg.dbase.get(o).remove(i).write()},reset:function(){return n===!0&&console.log("%c_History:DBResetTable",M),q.Cfg.dbase.get(o).remove().write()},update:function(i,v){if(e===!1)throw new Error("%c_HistoryDb:DBUpdateInTable() failed reason : table is not defined",M);return q.Cfg.dbase.get(o).find(i).assign(v).write()}}}(),Un=function(){let p="history_session_cache",o=function(){let a=!0;q.Cfg.dbase.get("history_session_cache").value()===void 0&&(a&&console.log("%cDb dont' contain history_session_cache table create it",M),q.Cfg.dbase.assign({history_session_cache:[]}).write())},n=function(a){let c=!0;typeof a=="string"&&(a=dayjs(a)),re(a instanceof dayjs,"date must be a string or a dayjs object.",TypeError);let i=ze.find({id:+a.format("YYYYMMDD")});return c&&console.log(`%cHistory:_exists ${a.format("YYYYMMDD")} in db ? ${i!==void 0}`,M),i!==void 0},d=function(a){let c=!0;if(typeof a=="string"&&(a=dayjs(a)),re(a instanceof dayjs,"date must be a string or a dayjs object.",TypeError),a.get("day")<a.daysInMonth()&&(a=a.endOf("month")),c===!0&&console.log(`%cSearch in history session cache data for id: ${a.format("DD/MM/YYYY")}`,M),n(a)===!0){if(_r=ze.find({id:+a.format("YYYYMMDD")}),typeof _r.index!==void 0)return _r.index;throw new Error("_getSessionIndex() failed reason : property index is unknown")}return-1},e=function(a){let c=!1;typeof a=="string"&&(a=dayjs(a)),re(a instanceof dayjs,"date must be a string or a dayjs object.",TypeError),c===!0&&console.log(`%cSearch in history session cache NEAREST cached data for id: ${a.format("DD/MM/YYYY")}`,M);let i=+a.format("YYYYMMDD"),v=ze.getAll();if(v.length===0)return c===!0&&console.log("%cHistory session cache is empty",M),-1;v=v.map(b=>+b.id-i).filter(b=>b>0);let $=b=>Math.min(...b);if(v.length==0)return c===!0&&console.log("%cAll indexes  %o are later than your date:%s",M,ze.getAll(),a.format("DD/MM/YYYY")),-1;let m=$(v)+i;if(c===!0&&console.log("%cNearest data in history session cache is data with id: %o",M,m),n(m)===!0){if(v=ze.find({id:+m.format("YYYYMMDD")}),typeof v.index!==void 0)return v.index;throw new Error("[History._getNearestSessionIndex()] failed reason : property index is unknown")}return-1};return Object.freeze({tbl_name:p,getSameOrNearestSessionIndex:function(a){let c=d(a);return c===-1&&(c=e(a)),c},remove:function(a=null,c=null){typeof a=="string"&&(a=dayjs(a)),typeof c=="string"&&(c=dayjs(c));let i=function(){};return a!==null&&c!==null&&(i=function(v){return dayjs(v.id.toString(10)).isBetween(a,c,"day","[]")}),a==null&&c!==null&&(i=function(v){return dayjs(v.id.toString(10)).isBefore(c,"day")}),a!=null&&c==null&&(i=function(v){return dayjs(v.id.toString(10)).isAfter(a,"day")}),ze.remove(i)},reset:function(){return ze.reset()},setSessionIndex:function(a,c=0){typeof a=="string"&&(a=dayjs(a)),re(a instanceof dayjs,"date must be a string or a dayjs object.",TypeError),a.get("day")<a.daysInMonth()&&(a=a.endOf("month"));let i=d(a);return i==-1?i=ze.insert({id:+a.format("YYYYMMDD"),index:c}):i=ze.update({id:+a.format("YYYYMMDD")},{index:c}),i}})},Gn=Un(),at=Gn;var ve=class{static getBetween(o,n){return typeof o=="string"&&(o=dayjs(o)),typeof n=="string"&&(o=dayjs(n)),q.Cfg.dbase.get(ve.tbl_name).filter(t=>dayjs(t.when).isSameOrBefore(n,"day")&&dayjs(t.when).isSameOrAfter(o,"day")).value()}},De=ve;U(De,"tbl_name","sessions"),U(De,"_checkObject",function(o){!1===!0&&console.log("%cChecking object session:%o ",M,o),re(typeof o.id=="string","Session object id need to be a string.",TypeError),re(typeof o.cid=="number","Session object cid need to be a number.",TypeError),re(typeof o.who_id=="string","Session object who_id need to be a string.",TypeError),re(typeof o.who_name=="string","Session object who_name need to be a string.",TypeError),re(typeof o.status=="string","Session object status need to be a string.",TypeError),re(typeof o.type=="string","Session object type need to be a string.",TypeError),re(typeof o.lvl=="string","Session object lvl need to be a string.",TypeError),re(typeof o.when=="string","Session object when need to be a string.",TypeError),re(typeof o.path=="string","Session object path need to be a string.",TypeError),re(typeof o.funding=="string","Session object funding need to be a string.",TypeError)}),U(De,"add",async function(o){let n=30,d=!0;d===!0&&console.log("%cSession.add() so you wanna add a session %o to database",M,o);let e=q.Cfg.dbase;if(GM_config.get("checksessionalreadyexists")===!0)var t=!0;if(d===!0&&console.log("%cSession.add() will search if session %o is already in database",M,o),o.id.length>0){if(t===!0&&ve.exists(o.id)===!0){d===!0&&console.info(`%cSession.add() session id:${o.id} already present in database table sessions, skip it!`,M);return}}else if(t===!0&&ve.exists(o.cid)===!0){d===!0&&console.info(`%cSession.add() session cid:${o.cid} already present in database table sessions, skip it!`,M);return}o.type.toLowerCase()==="presentation"&&(o.type="soutenance"),Ae.isInOldMode(dayjs(o.when))?(o.funding=Ye,o.type.toLowerCase()==="soutenance"?o.path="n/a (defense)":o.path="n/a (old mode)"):o.type.toLowerCase()==="soutenance"?(o.funding=Ye,o.path="n/a (defense)"):(ge.exists(o.who_id)===!1&&(console.warn("%cStudent %s not in Db, will updating student db by fetching students list from dashboard",Ge,o.who_id),d===!0&&console.log("%cLast Update of Student BDD was %i min ago",M,dayjs(Te.getStudentListUpd()).diff(dayjs(),"m")),dayjs(Te.getStudentListUpd()).diff(dayjs(),"m")<-n?(await ge.getAll(),Te.setStudentListUpd(dayjs().toISOString())):(console.log("%c[Session.add()]last Update of database DB was less than %i min ago",M,n),await ge.createManually(o.who_id,o.who_name,o.when),moize.default.isMoized(ge.m_findById)&&ge.m_findById.has([o.who_id,null])&&(ge.m_findById.remove([o.who_id,null]),d===!0&&console.log("%c[Session.add()]student %s removed from the m_findById function cache",M,o.who_id))),console.log("%c[Student.add()] pr\xE9c\xE9demment notre \xE9tudiant %o  n'existait pas existe t'il maintenant ?",M,o.who_id),console.log("%c[Student.add()] la r\xE9ponse est :%o",M,ge.exists(o.who_id,o.when)),ge.exists(o.who_id,o.when)==!1&&(console.warn(`%c[Session.add()] Student ${o.who_id} which exists at ${o.when} still not exit in Db, have to manually create him/her`,Ge),await ge.createManually(o.who_id,o.who_name,o.when),moize.default.isMoized(ge.m_findById)&&ge.m_findById.has([o.who_id,o.when])&&(ge.m_findById.remove([o.who_id,o.when]),d===!0&&console.log("%c[Session.add()]student %s removed from the m_findById function cache",M,o.who_id)))),o.funding=await ge.getFunding(o.who_id,o.when),o.path=await ge.getPath(o.who_id,o.when)),o.cid===void 0&&(d===!0&&console.log("%c[Session.add()] need to calculate a cid]",M),o.cid=ve.getHashId(o.when,o.who_id)),d===!0&&console.log("%cSession.add() calculated id:%s",M,o.cid),_r=Ee.getByKey(o.cid,2,Ee.TYPE.SESSIONID_DATEREFID),_r!==void 0&&(d===!0&&console.log("%cSession.add() I've found a ref %d by using key (%s)%d",M,_r.key1,typeof o.cid,o.cid),o.id=_r.key1.toString()),ve._save(o),await an(50)}),U(De,"_save",function(o){var n=!1;ve._checkObject(o),o.lvl==""&&(o.lvl="2"),o.lvl.lvl=parseInt(o.lvl.lvl,10),bDebug===!0&&console.log(`%c[Session._save()] saving session id:${o.id} of ${o.who_name}[cid:${o.cid}](${o.who_id}) at ${o.when} to DB`,M),q.Cfg.dbase.get(ve.tbl_name).push(JSON.parse(JSON.stringify(o))).write()}),U(De,"exists",function(o){let n=q.Cfg.dbase;var d=!1;d===!0&&console.log(`%c[Session.exist()] will search existence of session id:(${typeof o})${o} in database`,M);var e=ve.findById(o);return e!==void 0}),U(De,"findById",function(o){let n=q.Cfg.dbase;var d=n.get(ve.tbl_name).find({id:o}).value();return d===void 0&&(d=n.get(ve.tbl_name).find({cid:o}).value()),d}),U(De,"delete",function(o=null,n=null){let d=q.Cfg.dbase;if(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),o===null&&n==null){console.log("%cWanna suppress ALL Sessions from DB",M),d.get(ve.tbl_name).remove().write();return}if(n==null){d.get(ve.tbl_name).remove(function(e){return dayjs(e.when).isBefore(n),"day"}).write();return}if(o==null){d.get(ve.tbl_name).remove(function(e){return dayjs(e.when).isAfter(o,"day")}).write();return}d.get(ve.tbl_name).remove(function(e){return dayjs(e.when).isBetween(o,n,"day","[]")}).write()}),U(De,"deleteById",function(o){q.Cfg.dbase.get("sessions").remove(d=>d.id===o).write(),console.log(`%cSession ${o} suppressed from DB`,M)}),U(De,"parseTable",function(o){var n=o.children[0].children[0].innerText,d=Ke(o.children[0]),e=o.children[1].children[0].innerText.trim(),t=Ke(o.children[1],-2),u=o.children[2].innerText.trim().toLowerCase(),l=o.children[3].children.length?o.children[3].children[0].innerText.trim().toLowerCase():"session",f=-1;o.children[4].children.length>0&&(f=o.children[4].children[0].innerText.trim()),n=en(n);var a={id:d,when:n,who_id:t,who_name:e,status:u,type:l,lvl:f};return a}),U(De,"getHashId",function(o,n){return o instanceof dayjs&&(o=o.toISOString()),typeof n=="number"&&(n=n.toString(10)),re(typeof o=="string"&&typeof n=="string","getId need two string",TypeError),rn(o+n)}),U(De,"parseRow",function(o){var n=o.children[0].innerText.length>0?o.children[0].innerText.trim().toLowerCase():"session",d=o.children[0].querySelector("svg").getAttribute("aria-label").trim().toLowerCase(),e=o.children[1].querySelector("time").dateTime;e=dayjs(e).toISOString();var t=Ke(o.children[2],-2),u=o.children[2].innerText.trim(),l=ve.getHashId(e,t),f=o.children[3].innerText.trim();f=f.replace(/[^\d]/gmis,"");var a={id:"",cid:l,when:e,who_id:t,who_name:u,status:d,type:n,lvl:f};return a}),U(De,"getSessionsFromAPI",async function(o,n){let d=!1,e=999,t=0,u=!0,l=0,f=20;typeof o=="string"&&(o=dayjs(o)),re(o instanceof dayjs,"dtFrom must be a string or a dayjs object.",TypeError),typeof n=="string"&&(n=dayjs(n)),re(n instanceof dayjs,"dtTo must be a string or a dayjs object.",TypeError);let a=at.getSameOrNearestSessionIndex(n);a!==void 0&&typeof a=="number"&&a>l&&(l=a);var c=n.diff(o,"d")+1;for(NProgress.start();u===!0;){if(t>e){console.error("%c[Session.getSessionsFromAPI()] EMERGENCY EXIT LOOP",le);break}t+=1;var i=l+(f-1),v=await xt.getHistorySession([],l,i);if(v===null)throw new Error("Api.getHistorySession is null");var $=JSON.parse(v);if($.errors)throw Object.entries(oSession.errors).forEach(g=>console.log("%cApi.getHistorySession send us some errors : %s",Ge,g[1].message)),new Error("Api.getHistorySession send us some errors ");d===!0&&console.log("%cgetSessionsFromAPI() Sessions are %o",M,$),l=i+1,oSession=ve.parseRowFromApi($[$.length-1]),console.log("%c[Session.getSessionsFromAPI()]La derni\xE8re session r\xE9cuper\xE9e par api date de:%s et nous collectons les sessions entre %s et %s",M,dayjs(oSession.when).format("DD/MM/YYYY"),dayjs(o).format("DD/MM/YYYY"),dayjs(n).format("DD/MM/YYYY")),d===!0&&console.log("%cgetSessionsFromAPI() last session of loaded page is %o",M,oSession),console.log("%c[Session.getSessionsFromAPI()] compare last session date %s avec la date de d\xE9but %s est ce ant\xE9rieur  %o",M,dayjs(oSession.when).format("DD/MM/YYYY"),dayjs(o).format("DD/MM/YYYY"),dayjs(oSession.when).isBefore(o)),dayjs(oSession.when).isBefore(o)===!0&&(u=!1,d===!0&&console.log("%cgetSessionsFromAPI() last session is before start date of parsing %s STOP browsing....",M,dayjs(oSession.dtFrom).format("DD/MM/YYYY")),at.setSessionIndex(oSession.when,l));let b=$.filter(g=>dayjs(g.sessionDate).isBetween(o,n,"day","[]"));d===!0&&console.log("%cgetSessionsFromAPI() Filtered on date Sessions are %o",M,b);for(let g of b){oSession=ve.parseRowFromApi(g),d===!0&&console.log("%cgetSessionsFromAPI()  will call Session.add() on %o",M,oSession);let x=await ve.add(oSession);var m=dayjs(n).diff(oSession.when,"d")+1;NProgress.set(m/c)}l=i+1}NProgress.done(),await ft(`Collecte des sessions du ${o.format("DD/MM/YYYY")} au ${n.format("DD/MM/YYYY")} termin\xE9e`)}),U(De,"parseRowFromApi",function(o){bDebug=!1,bDebug===!0&&console.log("%cparseRowFromApi() oSession is %o",M,o);let n={};return n.id="",n.who_id=o.recipient.id,typeof n.who_id=="number"&&(n.who_id=n.who_id.toString(10)),n.who_name=o.recipient.displayableName,o.status===Kt&&(n.status=Xe),o.status===Vt&&(n.status=et),o.status===Jt&&(n.status=tt),o.status===Zt&&(n.status=nt),n.status===void 0&&(n.status=o.status),n.type=o.type,n.type.toLowerCase()==="mentoring"&&(n.type="mentorat"),n.lvl=o.projectLevel,n.lvl==null&&(n.lvl=""),n.when=dayjs(o.sessionDate).toISOString(),n.path=null,n.funding=null,n.cid=ve.getHashId(n.when,n.who_id),n});var xe=De;var wt=class{},pt=wt;U(pt,"calculateBill",function(o,n){let d=n.format("YYYYMM");return it.exists(d)===!0?(console.log(`%cUse Archived version ${d} of accounting`,M),it.get(d).data):(typeof o=="string"&&(o=o.format("YYYY-MM-DD")),typeof n=="string"&&(n=n.format("YYYY-MM-DD")),wt.m_calculateBill(o,n))}),U(pt,"_calculateBill",function(o,n){typeof o=="string"&&(o=dayjs(o)),typeof n=="string"&&(n=dayjs(n));let d=dayjs().format("YYYY-MM-DDTHH:mm:ssZ[Z]");var e=0,t=0,u=performance.now();let a=q.Cfg.dbase.get(xe.tbl_name).filter(s=>dayjs(s.when).isSameOrBefore(n,"day")&&dayjs(s.when).isSameOrAfter(o,"day")).value(),c=a.length,i={from:o,to:n,created_at:null,maxLevel:ot,number:0,amount:0,errors:{funding:[],level:[],path:[],status:[],type:[]},flatFee:[]},v=0,$=0,m=[];e=performance.now();let b=wt.getPriceList(o);t=performance.now(),console.log("%cGetPriceList took "+(t-e)+" milliseconds.",Re);let g=on([ot+1,ot+1,ot+1,ot+1]);for(var x=0;x<c;x+=1){let s=a[x];var T=0;s.status===Xe&&(T=Z),s.status===et&&(T=X),s.status===tt&&(T=V),(s.status===nt||s.status===ht)&&(T=ee);var B=0;s.type.toLowerCase()==="session"&&(B=F),s.type.toLowerCase()==="mentorat"&&(B=Wt),s.type.toLowerCase()==="soutenance"&&(B=H),s.path!=null&&s.path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&s.type!=="soutenance"&&(B=N);var D=0;let w=Ae.isInOldMode(o);if(w===!0&&(D=s.isFunded===!0?W:z),s.funding===qe&&(D=z),s.funding===Ye&&(D=W),s.funding===Ze&&(D=K),s.lvl==""){i.errors.level.push(s);continue}if(typeof s.lvl=="string"&&(s.lvl=parseInt(s.lvl,10)),s.lvl<0){i.errors.level.push(s);continue}if(w===!1&&s.funding!==qe&&s.funding!==Ye&&s.funding!==Ze){i.errors.funding.push(s);continue}if(s.type.toLowerCase()!=="session"&&s.type.toLowerCase()!=="mentorat"&&B!==H&&B!==N){i.errors.type.push(s);continue}if(s.status!==Xe&&s.status!==et&&s.status!==tt&&s.status!==nt&&s.status!==ht){i.errors.status.push(s);continue}let C=g.get(B,T,D,+s.lvl);C===void 0&&(C={number:0,amount:0,data:[]}),C.number+=1,v+=1,s.lvl<0?(C.amount+=0,$+=0):(C.amount+=1*b[s.lvl][B][T][D],$+=1*b[s.lvl][B][T][D]),C.data.push(s),g.set(B,T,D,+s.lvl,C),B===F&&D===z&&m.push({id:+s.who_id,who_id:s.who_id,who_name:s.who_name})}var y=[];e=performance.now(),y=_.uniqBy(m,"id"),i.flatFee=y,i.number=v,i.amount=$,i.number+i.errors.funding.length+i.errors.level.length+i.errors.path.length+i.errors.status.length+i.errors.type.length<c&&(console.log(`%cError total number of sessions is ${c} and total number of sessions in bill ${v} + all errors are different`,le),console.log("errors are",i.errors),console.log("sessions are",a)),i.created_at=d,g.set(0,0,0,0,i);var h=performance.now();return console.log("%cFunction took "+(h-u)+" milliseconds.",Re),i.errors.funding.length+i.errors.level.length+i.errors.path.length+i.errors.status.length+i.errors.type.length>0&&console.log("%cWarning some errors found %o",Ge,i.errors),g}),U(pt,"m_calculateBill",moize.default(wt._calculateBill,{maxAge:12e4,isSerialized:!0})),U(pt,"getPriceList",function(o){typeof o=="string"&&(o=dayjs(o));var n=[0,Nt,Ut,Gt,qt,Qt,zt];let d=Ae.isInOldMode(o);var e=new Array(7);for(let t=1;t<=ot;t+=1){let u=n[t],l=n[t]/2,f=n[t]/4;d?(e[t]=new Array(3),e[t][F]=new Array(5),e[t][F][Z]=new Array(4),e[t][F][Z][z]=u,e[t][F][Z][W]=u,e[t][F][Z][K]=u,e[t][F][X]=new Array(4),e[t][F][X][z]=0,e[t][F][X][W]=0,e[t][F][X][K]=0,e[t][F][V]=new Array(4),e[t][F][V][z]=l,e[t][F][V][W]=l,e[t][F][V][K]=l,e[t][F][ee]=new Array(4),e[t][F][ee][z]=l,e[t][F][ee][W]=l,e[t][F][ee][K]=l,e[t][H]=new Array(5),e[t][H][Z]=new Array(4),e[t][H][Z][z]=u,e[t][H][Z][W]=u,e[t][H][Z][K]=u,e[t][H][X]=new Array(4),e[t][H][X][z]=0,e[t][H][X][W]=0,e[t][H][X][K]=0,e[t][H][V]=new Array(4),e[t][H][V][z]=l,e[t][H][V][W]=l,e[t][H][V][K]=l,e[t][H][ee]=new Array(4),e[t][H][ee][z]=l,e[t][H][ee][W]=l,e[t][H][ee][K]=l,e[t][N]=new Array(5),e[t][N][Z]=new Array(4),e[t][N][Z][z]=u,e[t][N][Z][W]=u,e[t][N][Z][K]=u,e[t][N][X]=new Array(4),e[t][N][X][z]=0,e[t][N][X][W]=0,e[t][N][X][K]=0,e[t][N][V]=new Array(4),e[t][N][V][z]=l,e[t][N][V][W]=l,e[t][N][V][K]=l,e[t][N][ee]=new Array(4),e[t][N][ee][z]=l,e[t][N][ee][W]=l,e[t][N][ee][K]=l):(e[t]=new Array(3),e[t][F]=new Array(5),e[t][F][Z]=new Array(4),e[t][F][Z][z]=l,e[t][F][Z][W]=u,e[t][F][Z][K]=u,e[t][F][X]=new Array(4),e[t][F][X][z]=0,e[t][F][X][W]=0,e[t][F][X][K]=0,e[t][F][V]=new Array(4),e[t][F][V][z]=0,e[t][F][V][W]=0,e[t][F][V][K]=0,e[t][F][ee]=new Array(4),e[t][F][ee][z]=f,e[t][F][ee][W]=l,e[t][F][ee][K]=l,e[t][H]=new Array(5),e[t][H][Z]=new Array(4),e[t][H][Z][z]=u,e[t][H][Z][W]=u,e[t][H][Z][K]=u,e[t][H][X]=new Array(4),e[t][H][X][z]=0,e[t][H][X][W]=0,e[t][H][X][K]=0,e[t][H][V]=new Array(4),e[t][H][V][z]=0,e[t][H][V][W]=0,e[t][H][V][K]=0,e[t][H][ee]=new Array(4),e[t][H][ee][z]=l,e[t][H][ee][W]=l,e[t][H][ee][K]=l,e[t][N]=new Array(5),e[t][N][Z]=new Array(4),e[t][N][Z][z]=u,e[t][N][Z][W]=u,e[t][N][Z][K]=u,e[t][N][X]=new Array(4),e[t][N][X][z]=0,e[t][N][X][W]=0,e[t][N][X][K]=0,e[t][N][V]=new Array(4),e[t][N][V][z]=0,e[t][N][V][W]=0,e[t][N][V][K]=0,e[t][N][ee]=new Array(4),e[t][N][ee][z]=l,e[t][N][ee][W]=l,e[t][N][ee][K]=l)}return e});var He=pt;var Bt=function(p,o){let n=[[0,1,2,3,4,5,5],[5,1,2,3,4,5,5],[4,5,1,2,3,4,4],[3,4,5,1,2,3,3],[2,3,4,5,1,2,2],[1,2,3,4,5,1,1],[0,1,2,3,4,5,0]];return Math.trunc(o.diff(p,"days")/7)*5+n[p.day()][o.day()]};var mt=class{};U(mt,"detail_bill","truc"),U(mt,"getListDetailBill",function(o,n){let e=q.Cfg.dbase.get(xe.tbl_name).filter(x=>dayjs(x.when).isSameOrBefore(n,"day")&&dayjs(x.when).isSameOrAfter(o,"day")).sortBy(function(x){return dayjs(x.when).valueOf()}).value(),t=Ae.getOldModeDate(),u=He.getPriceList(t.subtract(1,"day")),l=He.getPriceList(t),f=0;var a=_.cloneDeep(e);for(var c in a){var i=0,v=0,$=!0,m=0;a[c].status===Xe&&(m=Z),a[c].status===et&&(m=X),a[c].status===tt&&(m=V),(a[c].status===nt||a[c].status===ht)&&(m=ee);var b=0;a[c].type.toLowerCase()==="session"&&(b=F),a[c].type.toLowerCase()==="soutenance"&&(b=H),a[c].path!=null&&a[c].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&a[c].type!=="soutenance"&&(b=N);var g=0;a[c].funding===qe&&(g=z),a[c].funding===Ye&&(g=W),a[c].funding===Ze&&(g=K),Ae.isInOldMode(dayjs(a[c].when))?i=+a[c].lvl>0?u[+a[c].lvl][b][m][g]:0:($=!1,i=+a[c].lvl>0?l[+a[c].lvl][b][m][g]:0),f+=i,a[c].iPu=i,a[c].oldMode=$,a[c].iCumul=f}return a}),U(mt,"getListStatistic",function(o,n){let d=o.clone(),e=d.endOf("month"),t=[],u=[],l=0,f=n.diff(o,"month");for(var a=performance.now();d.isSameOrBefore(n,"day");)t.push(He.calculateBill(d,e)),d=d.add(1,"month"),e=d.endOf("month");var c=performance.now();console.log("%cComputed data between the two dates in"+(c-a)+" milliseconds.",Re),d=o.clone(),e=d.endOf("month");let i=0,v=0,$=0,m=0,b=0,g=0,x=0;for(;l<=f;){let B=t[l].get(0,0,0,0),D=B.maxLevel;u[l]={header:{dtFrom:null,dtTo:null,created_at:null},sessions:{total:0,nb:0,pu:0,nbc:0},defenses:{total:0,nb:0,pu:0,nbc:0},coaches:{total:0,nb:0,pu:0,nbc:0},bonus:0,kpi:{jrs:0,hrs:0,hrsp:0}};let y=1;for(;y<D;){let s=0,w=0,C=0,R=0;i=t[l].get(F,Z,z,y),$=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,Z,W,y),v=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,Z,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,Ae.isInOldMode(d)?(u[l].kpi.hrs+=(i+v+$)*(45/60),u[l].kpi.hrsp+=(i+v+$)*(GM_config.get("nbHrsS")/60)):(u[l].kpi.hrs+=$*(30/60),u[l].kpi.hrsp+=$*(GM_config.get("nbHrsAfM")/60),u[l].kpi.hrs+=(i+v)*(45/60),u[l].kpi.hrsp+=(i+v)*(GM_config.get("nbHrsfM")/60)),i=t[l].get(F,X,z,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(F,X,W,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(F,X,K,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,Ae.isInOldMode(d)?(i=t[l].get(F,V,z,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,V,W,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,V,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount):(i=t[l].get(F,V,z,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(F,V,W,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(F,V,K,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount),i=t[l].get(F,ee,z,y),$=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,ee,W,y),v=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(F,ee,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i,u[l].kpi.hrs+=(i+v+$)*(15/60),u[l].kpi.hrsp+=(i+v+$)*(15/60),s=u[l].sessions.total,w=u[l].sessions.nb,C=u[l].sessions.pu,R=u[l].sessions.nbc,u[l].sessions={total:b+s,nb:m+w,pu:(b+s)/(m+w),nbc:g+R},s=0,w=0,C=0,R=0,m=0,b=0,g=0,x=0,i=t[l].get(H,Z,z,y),$=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(H,Z,W,y),v=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(H,Z,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,u[l].kpi.hrs+=(i+v+$)*(45/60),u[l].kpi.hrsp+=(i+v+$)*(GM_config.get("nbHrsD")/60),i=t[l].get(H,X,z,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(H,X,W,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(H,X,K,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(H,V,z,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(H,V,W,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(H,V,K,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(H,ee,z,y),$=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(H,ee,W,y),v=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(H,ee,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,u[l].kpi.hrs+=(i+v+$)*(15/60),u[l].kpi.hrsp+=(i+v+$)*(15/60),s=u[l].defenses.total,w=u[l].defenses.nb,C=u[l].defenses.pu,R=u[l].defenses.nbc,u[l].defenses={total:b+s,nb:m+w,pu:(b+s)/(m+w),nbc:g+R},s=0,s=0,w=0,C=0,R=0,m=0,b=0,g=0,x=0,i=t[l].get(N,Z,z,y),$=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(N,Z,W,y),v=typeof i=="undefined"?0:i.number,m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(N,Z,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=typeof i=="undefined"?0:i.number,u[l].kpi.hrs+=(i+v+$)*(45/60),u[l].kpi.hrsp+=(i+v+$)*(GM_config.get("nbHrsC")/60),i=t[l].get(N,X,z,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(N,X,W,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(N,X,K,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(N,V,z,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(N,V,W,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(N,V,K,y),g=typeof i=="undefined"?g:g+i.number,x=typeof i=="undefined"?x:x+i.amount,i=t[l].get(N,ee,z,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(N,ee,W,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,i=t[l].get(N,ee,K,y),m=typeof i=="undefined"?m:m+i.number,b=typeof i=="undefined"?b:b+i.amount,s=u[l].coaches.total,w=u[l].coaches.nb,C=u[l].coaches.pu,R=u[l].coaches.nbc,i=typeof i=="undefined"?0:i.number,u[l].kpi.hrs+=i*(15/60),u[l].kpi.hrsp+=i*(15/60),u[l].coaches={total:b+s,nb:m+w,pu:(b+s)/(m+w),nbc:g+R},y+=1}let h=B.flatFee.length;for(var T=0;T<h;T+=1)u[l].bonus+=30;e.isAfter(n,"day")&&(e=n.clone()),u[l].kpi.jrs=Bt(d,e),u[l].header.dtFrom=d.format("YYYY-MM-DD"),u[l].header.dtTo=e.format("YYYY-MM-DD"),u[l].header.created_at=dayjs().format("YYYY-MM-DD HH:mm:ss"),d=d.add(1,"month"),e=d.endOf("month"),l+=1}return u}),U(mt,"getListStatisticOld",function(o,n){let d=o.clone(),e=d.endOf("month"),t=[],u=[],l=n.get("month")-o.get("month");for(var f=performance.now();d.isSameOrBefore(n,"day");)t.push(He.calculateBill(d,e)),d=d.add(1,"month"),e=d.endOf("month");var a=performance.now();console.log("%cComputed data between the two dates in"+(a-f)+" milliseconds.",Re);let c=0;for(d=o.clone(),e=d.endOf("month"),console.log(t);c<=l;){let i=t[c][0].max_level;u[c]={header:{dtFrom:null,dtTo:null,created_at:null},sessions:{total:0,nb:0,pu:0,nbc:0},defenses:{total:0,nb:0,pu:0,nbc:0},coaches:{total:0,nb:0,pu:0,nbc:0},bonus:0,kpi:{jrs:0,hrs:0,hrsp:0}};let v=1;for(;v<i;){let $=[...Array(8).keys()];for(let m=0;m<$.length;m+=1)u[c].sessions.total+=t[c][v].sessions.number[m]*t[c][v].sessions.pu[m],u[c].sessions.nb+=t[c][v].sessions.number[m],u[c].defenses.total+=t[c][v].defenses.number[m]*t[c][v].defenses.pu[m],u[c].defenses.nb+=t[c][v].defenses.number[m],Ae.isInOldMode(d)?[1,5].includes(m)&&(u[c].sessions.nbc+=t[c][v].sessions.number[m],u[c].defenses.nbc+=t[c][v].defenses.number[m]):[1,2,5,6].includes(m)&&(u[c].sessions.nbc+=t[c][v].sessions.number[m],u[c].defenses.nbc+=t[c][v].defenses.number[m]),Ae.isInOldMode(d)?(u[c].kpi.hrs+=(t[c][v].sessions.number[m]-t[c][v].defenses.number[m])*(45/60),u[c].kpi.hrsp+=(t[c][v].sessions.number[m]-t[c][v].defenses.number[m])*(GM_config.get("nbHrsfM")/60)):([4,5,6,7].includes(m)&&(u[c].kpi.hrs+=(t[c][v].sessions.number[m]-t[c][v].defenses.number[m])*(30/60),u[c].kpi.hrsp+=(t[c][v].sessions.number[m]-t[c][v].defenses.number[m])*(GM_config.get("nbHrsAfM")/60)),[0,1,2,3].includes(m)&&(u[c].kpi.hrs+=(t[c][v].sessions.number[m]-t[c][v].defenses.number[m])*(45/60),u[c].kpi.hrsp+=(t[c][v].sessions.number[m]-t[c][v].defenses.number[m])*(GM_config.get("nbHrsfM")/60))),u[c].kpi.hrs+=t[c][v].defenses.number[m]*(45/60),u[c].kpi.hrsp+=t[c][v].defenses.number[m]*(GM_config.get("nbHrsD")/60);v+=1}u[c].sessions.pu=u[c].sessions.total/(u[c].sessions.nb-u[c].sessions.nbc),u[c].defenses.pu=u[c].defenses.total/(u[c].defenses.nb-u[c].defenses.nbc),u[c].coaches.total=u[c].sessions.total-u[c].defenses.total,u[c].coaches.nb=u[c].sessions.nb-u[c].defenses.nb,u[c].coaches.nbc=u[c].sessions.nbc-u[c].defenses.nbc,u[c].coaches.pu=u[c].coaches.total/(u[c].coaches.nb-u[c].coaches.nbc);for(let $=0;$<t[c][0].bonus.length;$+=1)u[c].bonus+=t[c][0].bonus[$].sessions>0?30:0;e.isAfter(n,"day")&&(e=n.clone()),u[c].kpi.jrs=Bt(d,e),u[c].header.dtFrom=d.format("YYYY-MM-DD"),u[c].header.dtTo=e.format("YYYY-MM-DD"),u[c].header.created_at=dayjs().format("YYYY-MM-DD HH:mm:ss"),d=d.add(1,"month"),e=d.endOf("month"),c+=1}return u});var Ct=mt;var kt=class{static changePgIfNeeded(o,n,d,e){var t=e.getPageCount(),u=e.getPages()[t-1],l=u.fontSize,f=u.getFont(),a=u.lineHeight;return o<n&&(d=1,u=e.addPage(),u.font=f,u.setFontSize(l),u.lineHeight=a),[d,u]}};U(kt,"addFooter",async function(o,n,d={}){let{degrees:e,PDFDocument:t,rgb:u,StandardFonts:l}=PDFLib,f=o.getPageCount(),a="8".repeat(f),c=await o.embedFont(l.TimesRoman),i=12,v=c.widthOfTextAtSize(`page ${a} / ${a}`,i),$=10,m=10,b=1,g=u(0/255,0/255,0/255),x=u(253/255,246/255,227/255),T=5,B=5,D=3,y=3,h=!0;o.getPages().forEach((s,w)=>{if(!(h===!0&&w==0)){let{width:C,height:R}=s.getSize(),Q=i+2*b+D+y;s.moveTo($+T,i+y),s.setFont(c),s.setFontSize(i),s.setFontColor(u(1,0,0)),n!==void 0&&s.drawText(`${n}`),s.drawText(`page ${w+1} / ${f}`,{x:C-v-B}),s.drawRectangle({x:$,y:10,width:C-($+m),height:Q,color:x,opacity:.6,borderColor:g,borderWidth:b})}})});var We=kt;var ln=async function(){let p=q.Cfg.dbase;return await Swal.mixin({confirmButtonText:"Suivant &rarr;",showCancelButton:!0,progressSteps:["0","1","2","3","4","5"],onOpen:function(i){console.log("...onOpen")},onRender:function(i){console.log("....onUpdate")},onClose:function(i){console.log(".....onClose")},onAfterClose:function(i){console.log("......onAfterClose")},onDestroy:function(i){console.log(".......onDestroy")}}).queue([{title:"Migration de la base",html:"<p>Cette migration va corriger la base et ajouter les nouveaux champs n\xE9cessaires, l`interrpuption du traitement est sans danger (mais ce n' est pas une raison !)</p>"},{title:"Correction de la table \xE9tudiant",html:"<p>Correction de la liste des \xE9tudiants (who_id)",onOpen:async function(i){console.log("%cMigration table des \xE9tudiants correction du who_id",M),Swal.showLoading();var v=dayjs("2020-06-01"),$=p.get("students"),m=$.value(),b=p.get("sessions").filter(D=>dayjs(D.when).isSameOrAfter(v,"day")),g=$.size().value(),x=Swal.getContent().textContent;for(f=0;f<g;f+=1){var T=b.find(y=>y.who_name===m[f].fullname).value();T!==void 0&&$.get(f).assign({who_id:T.who_id}).write();let D=Swal.getContent();D!=null&&(D.innerHTML=`${x}<br /><p>Traitement en cours : ${f}/${m.length}</p>`),await Pe(1)}Swal.hideLoading();let B=Swal.getContent();B!=null&&(B.textContent=`Traitement termin\xE9 : ${m.length}/${m.length}`)}},{title:"Correction de la table \xE9tudiant",html:"<p>Correction de la liste des \xE9tudiants funded devient funding</p>",onOpen:async function(i){console.log("%cMigration : table des \xE9tudiants suppression de l'ancien champs et ajout du champs funding",M),Swal.showLoading();for(var v=p.get("students"),$=v.size().value(),m=Swal.getContent().textContent,b=0;b<$;b+=1){var g=v.get(b).value().fundedby;if(g===void 0){console.log("%cStudent ${oListStudents.get(i).who_name} already converted, skip it",M);continue}v.get(b).unset(["fundedby"]).assign({funding:g}).write(),console.log("%cStudent ${oListStudents.get(i).who_name} create field funding and remove fundedby",M);let T=Swal.getContent();T!=null&&(T.innerHTML=`${m}<br /><p>Traitement en cours : ${b}/${$}</p>`),await Pe(1)}Swal.hideLoading();let x=Swal.getContent();x!=null&&(x.textContent=`Traitement termin\xE9 : ${$}/${$}`)}},{title:"Correction table Etudiants",html:"<p>Correction de la liste des sessions, ajout du path dans la session</p>",onOpen:async function(i){console.log("%cMigration table des sessions correction de id_who",M),Swal.showLoading();var v=dayjs("2020-06-01"),$=p.get("students"),m=$.value(),b=p.get("sessions").filter(y=>dayjs(y.when).isSameOrAfter(v,"day")),g=b.filter(y=>y.type!="soutenance").value(),x=Swal.getContent().textContent;for(f=0;f<g.length;f+=1){var T=$.find({who_id:g[f].who_id}).value();console.log("found",T);var B=T!==void 0&&T.path.length>0?T.path:"0-unknown";p.get("sessions").find({id:g[f].id}).assign({path:B}).write();let y=Swal.getContent();y!=null&&(y.innerHTML=`${x}<br /><p>Traitement en cours : ${f}/${g.length}</p>`),await Pe(1)}Swal.hideLoading();let D=Swal.getContent();D!=null&&(D.textContent=`Traitement termin\xE9 : ${f}/${g.length}`)}},{title:"Migration de la table des Sessions",html:'<p>Correction de la liste des sessions, suppression du champs "isFunded"</p>',onOpen:async function(i){console.log("%cMigration : table des sessions suppression de isFunded",M),Swal.showLoading();for(var v=dayjs("2020-06-01"),$=p.get("students").value(),m=p.get("sessions").filter(B=>dayjs(B.when).isSameOrAfter(v,"day")),b=Swal.getContent().textContent,g=m.value().length;g-=1;){var x=m.get(g);x.value().isFunded===void 0||x.value().isFunded===void 0?console.log(`%cSkip ${x.value()} already converted`,M):x.unset(["isFunded"]).write();let B=Swal.getContent();B!=null&&(B.innerHTML=`${b}<br /><p>Traitement en cours : il reste ${g} \xE9lements \xE0 convertir</p>`),await Pe(1)}Swal.hideLoading();let T=Swal.getContent();T!=null&&(T.textContent=`Traitement en termin\xE9 : ${m.value().length}/${m.value().length}`)}},{title:"Migration de la table des Sessions",html:"<p>Correction de la liste des sessions, ajout de funding</p>",onOpen:async function(i){console.log("%cMigration : table des sessions ajout de fundedBy",M),Swal.showLoading();for(var v=dayjs("2020-06-01"),$=p.get("students").value(),m=p.get("sessions").filter(y=>dayjs(y.when).isSameOrAfter(v,"day")),b=m.filter(y=>y.type!="soutenance"),g=Swal.getContent().textContent,x=b.value().length;x-=1;){var T=b.get(x);T.value().funding!==void 0?console.log(`%cSkip ${T.value()} already converted`,M):T.assign({funding:ge.getFunding(T.value().who_id)}).write();let y=Swal.getContent();y.innerHTML=`${g}<br /><p>Traitement en cours : il rest ${x}\xE9lements \xE0 convertir</p>`,await Pe(1)}for(var B=x,b=m.filter(y=>y.type=="soutenance"),x=0;x<b.value().length;x+=1){b.get(x).assign({funding:Ye}).write();let h=Swal.getContent();h!=null&&(h.innerHTML=`${g}<br /><p>Traitement en cours : ${B+x}/${m.value().length}</p>`),await Pe(1)}Swal.hideLoading();let D=Swal.getContent();D!=null&&(D.textContent=`Traitement termin\xE9 :  ${m.value().length}/${m.value().length}`)}}]).then(i=>{if(i.value){let v=JSON.stringify(i.value);Swal.fire({title:"Traitement termin\xE9!",html:`
			Your answers:
			<pre><code>${v}</code></pre>
		  `,confirmButtonText:"Lovely!"})}else return console.log("%c resultat en erreur",M,i,i.dismiss===Swal.DismissReason.cancel),-1});var n,d,e;for(f=0;f<d.length;f+=1){var t;t!==void 0&&p.get("students").find({fullname:t.who_name}).assign({who_id:t.who_id}).write()}var u;for(f=0;f<u.length;f+=1){var t,l;p.get("sessions").find({id:u[f].id}).assign({path:l}).write()}for(var f;f<e.value().length;f+=1)e.get(f).unset(["isFunded"]).write();for(var a,f;f<a.value().length;f+=1){var c=a.get(f);c.assign({fundedBy:ge.getFunded(c.value().who_id)}).write()}for(var a,f;f<a.value().length;f+=1)a.get(f).assign({fundedBy:Ye}).write()};var cn=On(un()),jt=class{},Fe=jt;U(Fe,"save",function(){return console.log("%cWanna save DBASE",M),JSON.stringify(q.Cfg.dbase.getState())}),U(Fe,"load",function(o){return console.log(`%cWanna load ${o} in DBASE`,M),console.log("%c !!!!!! TYPE NOT CHECKED BE CARREFULL",M),q.Cfg.dbase.setState(JSON.parse(o)).write()}),U(Fe,"update",async function(o){console.log(`%cIs there any update to DB to go to version ${o}`,M);let n=[{version:"1.00.0006",action:ln}];for(let e=0,t=n.length;e<t;e++)if(yt(o,n[e].version)==0)if(console.log(`%cFound an update to DB version '${n[e].version}' proceed conversion...`,M),await n[e].action()==-1)console.log(`%cError something was wrong during update of database from version: ${Te.getVersion()} to version:${n[e].version}.... you have canceled it`,le),Swal.fire({icon:"error",title:"Oops...",text:`Quelque chose s'est mal pass\xE9 ou vous avez annul\xE9 l'update 

Utiliser l'application dans ces conditions n'est pas garanti  !`,footer:'<a href="https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon/issues">G\xE9n\xE9rer un bug?</a>'});else{let l=Te.setDbVersion(o);console.log(`%cChanged DB to version ${l}`,M)}let d=Te.setDbVersion(o);console.log(`%cChanged DB to version ${d}`,M)}),U(Fe,"erase",function(o){return console.log(`%cErase all data of table: ${o}`,M),q.Cfg.dbase.get(o).remove().write()}),U(Fe,"loadTable",function(o,n){if(table_exist(o))return q.Cfg.dbase.set(o,n).write();throw"Table :"+o+", not exists in DB !"}),U(Fe,"table_exist",o=>q.Cfg.dbase.has(o).value),U(Fe,"table_export",function(o){if(table_exist(o))return JSON.stringify(q.Cfg.dbase.get(o).value());throw"Table :"+o+", not exists id DB !"}),U(Fe,"exportTblToCSV",function(o="",n,d){let e=jt.exportTblToJSON(o,n,d),t={quotes:!1,quoteChar:'"',escapeChar:'"',delimiter:",",header:!0,newline:`\r
`,skipEmptyLines:!1,columns:null};return cn.default.unparse(e,t)}),U(Fe,"exportTblToJSON",function(o="",n,d){if(o=="")return console.log("%cIrrecoverable Error: You forget to define a data table name",le),-1;if(n!==null&&n!==""&&(dtFrom=dayjs(n)),d!==null&&d!==""&&(dtTo=dayjs(d)),q.Cfg.dbase.has(o).value==!1)return console.log(`%cIrrecoverable Error: table ${o} don't exist`,le),-1;if(o===xe.tbl_name){if(typeof dtFrom=="object"&&dtTo==="object")return q.Cfg.dbase.get(o).filter(e=>dayjs(e.when).isSameOrBefore(dtTo,"day")&&dayjs(e.when).isSameOrAfter(dtFrom,"day")).value();if(typeof dtFrom=="object")return q.Cfg.dbase.get(o).filter(e=>dayjs(e.when).isSameOrAfter(dtFrom,"day")).value();if(typeof dtTo=="object")return q.Cfg.dbase.get(o).filter(e=>dayjs(e.when).isSameOrBefore(dtTo,"day")).value()}return q.Cfg.dbase.get(o).value()});var dt=Fe;var fn=async function(){var p="";p+="<style>div.about_content {background-color: #fed9ff;/*width: 600px;*/height: var(--heigth, 80%);overflow-x: hidden;overflow-y: auto;text-align: left;padding: 20px;}</style>",p+='<div class="about_content" style="--heigth: 600px;">',p+='<div class="about_content__wrapper">';var n=(await Je.XHR({method:"GET",url:"https://raw.githubusercontent.com/StephaneTy-Pro/OC-Mentors-AccountAddon/master/README.md",responseType:"text/html",headers:{"User-Agent":"Mozilla/5.0"}})).responseText,d=new showdown.Converter,e=d.makeHtml(n);p+=e,p+="</div>",p+="</div>",Swal.fire({title:`<strong>A propos de ${Ht}</strong>`,icon:"info",html:p,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})};var Mt=function(){var p=gt,o=document.querySelector(p),n=!1;if(o===null)throw console.log(`%cERROR:Could'nt find the table which display sessions : ${o}`,le),new Error("!!!! IRRECOVERABLE ERROR NO TABLE OF SESSIONS FOUNDED");if(o.querySelector("[type=checkbox]")===null){var o=document.querySelector(`${p} tbody`);for(let B of o.children)if(B.querySelector("a")!==null){var d=Ke(B.children[2],-2),e=document.createElement("input");e.type="checkbox",e.name="name";var t=B.children[1].querySelector("time").dateTime.trim();t=dayjs(t).toISOString();var u=xe.getHashId(t,d);e.value=u,e.onclick=function(D){D.stopPropagation()},n=xe.exists(u),n===!0&&(e.checked=!0);var l=document.createElement("td");l.style="text-align: center",l.appendChild(e),B.appendChild(l)}if(document.querySelector(`${p} thead`)===null){let B=(y,h)=>h.insertAdjacentElement("beforebegin",y);p=`${p} tbody`;var f=document.querySelector(p),e=document.createElement("input");e.type="checkbox",e.name="name",e.value="value",e.id="id",e.onclick=function(){document.querySelectorAll("tbody input[type=checkbox]").forEach(y=>y.checked=!y.checked)},e.style="visibility: hidden;";var a=document.createElement("label");a.innerText="in DB",a.style="display:block;",a.onMouseOver="this.style.cursor=pointer;",a.onMouseOut="this.style.cursor=auto;",a.appendChild(e);var c=document.createElement("td");c.style=`
    font-size: 1rem;
    max-width: 280px;
    font-family: Montserrat;
    font-weight: 400;
    line-height: 1.625rem;
    text-transform: inherit;
`,c.innerText=" ";var i=document.createElement("td");i.style=`
    font-size: 1rem;
    max-width: 280px;
    font-family: Montserrat;
    font-weight: 400;
    line-height: 1.625rem;
    text-transform: inherit;
    margin-left: auto;
`,i.innerText="Fact.(o/n)",i.addEventListener("click",_handler=function(y){document.querySelectorAll("tbody input[type=checkbox]").forEach(h=>h.checked=!h.checked)});var v=document.createElement("tr");v.style=`
    display: flex;
    align-items: center;
    border-bottom: 1px solid #e0e0e0;
    flex-direction: row;
    background-color: #fff;
`,v.appendChild(c),v.appendChild(i);var $=document.createElement("thead");$.style="display: block;",$.appendChild(v),B($,document.querySelector(p))}}else{for(var m=o.querySelectorAll("[type=checkbox]"),b=m.length,g=new Array(b);b--;g[b]=m[b]);for(var x in g){let T=parseInt(g[x].value,10);n=xe.exists(T),n===!0?g[x].checked=!0:g[x].checked=!1}}},pn=async function(){var[p,o]=await ct(dayjs().startOf("month"),dayjs().endOf("month"));let n=Ct.getListDetailBill(p,o),d="";d+="<table>",d+="<thead>",d+="<tr><th>Quand</th><th>Qui</th><th>Financ\xE9 ?</th><th>Type</th><th>Niveau</th><th>Ancien Mode ?</th><th>Statut</th><th>PU HT</th><th>Cumul</th></tr>",d+="<thead>",d+="<tbody>";for(let e=0;e<n.length;e+=1)d+="<tr>",d+=`<td>${dayjs(n[e].when).format("DD/MM/YYYY \xE0 HH:mm:ss")}</td>`,d+=`<td>${n[e].who_name}</td><td>${n[e].funding}</td>`,sType=n[e].type,n[e].path!=null&&n[e].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&n[e].type!=="soutenance"&&(sType="Coaching"),d+=`<td>${sType}</td><td>${n[e].lvl}</td>`,d+=`<td>${n[e].oldMode===!0?"Oui":"Non"}</td>`,d+=`<td>${n[e].status}</td>`,d+=`<td>${n[e].iPu}</td><td>${n[e].iCumul}\u20AC</td>`,d+="</tr>";d+="</tbody>",d+="</table>",Swal.fire({title:`<strong>Liste d\xE9taill\xE9es des sessions du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,icon:"info",html:d,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen",onOpen:e=>{var t=e.querySelector("table"),u=new simpleDatatables.DataTable(t)}})},mn=async function(){var p=!0,[o,n]=await ct(dayjs().startOf("month"),dayjs().endOf("month"));p==!0&&console.log("%ccollectAuto() Wanna collect from %s to %s",M,o.format("DD/MM/YYYY"),n.format("DD/MM/YYYY"));var d=await xe.getSessionsFromAPI(o,n);p==!0&&console.log("%ccollectAuto() Sessions are is %o",M,d)};var hn=async function(){var p=gt,o=document.querySelectorAll(p);GM_addStyle(".ldBar path.mainline{stroke-width:10;stroke:#09f;stroke-linecap:round}"),GM_addStyle(".ldBar path.baseline{stroke-width:14;stroke:#f1f2f3;stroke-linecap:round;filter:url(#custom-shadow)}");let n='<div id="pbar" class="ldBar label-center" data-value="0" data-path="M0 0 L200 0 L200 1"></div>';Swal.fire({title:"Traitement en cours!",html:n,confirmButtonText:"Lovely!",onBeforeOpen:function(d){var e=new ldBar("#pbar")},onRender:function(d){},onOpen:async function(d){for(var e=document.getElementById("pbar").ldBar,t=0;t<o.length;t+=1){var u=o[t].parentElement.parentElement,l=xe.parseRow(u);await xe.add(l),e.set(t/o.length*100,!1)}e.set(100,!1),Swal.getTitle()&&(Swal.getTitle().innerText="Traitement termin\xE9 !")},onClose:function(d){},onAfterClose:function(d){},onDestroy:function(d){}})},gn=function(){let p=unsafeWindow.Facturier.cfg.dbase,o=unsafeWindow.Facturier.libs.find(f=>f.id=="dayjs").ptr,n=unsafeWindow.Facturier.libs.find(f=>f.id=="fetchInject").ptr,d=unsafeWindow.Facturier.klass.find(f=>f.id=="Session").ptr,e=unsafeWindow.Facturier.klass.find(f=>f.id=="Student").ptr,t=unsafeWindow.Facturier.klass.find(f=>f.id=="History").ptr,u=unsafeWindow.Facturier.klass.find(f=>f.id=="Archive").ptr,l=unsafeWindow.Facturier.klass.find(f=>f.id=="StudentHistory").ptr;console.log("%cd_dbase, d_dayjs, d_Session, d_Student, d_History, d_Archive, d_StudentHistory are exported",M),console.log("%cfor examples write all code after $>",M),console.group("%cd_dbase",M),console.log("example : get last session in db $>d_dbase.get(d_Session.tbl_name).last().value();"),console.log("          get first student in db $>d_dbase.get(d_Student.tbl_name).first().value()"),console.log("          or d_dbase.get(d_Student.tbl_name).get(0).value()"),console.log("          get all sessions grouped by month/yyyy in db $>d_dbase.get(d_Session.tbl_name).groupBy( v => d_dayjs(v.when).format('MM/YYYY')).value()"),console.log("          get all table $> d_dbase.value()"),console.groupEnd(),console.group("%cd_fetchInject",M),console.log("same as fetchInject libs : https://habd.as/code/fetch-inject/"),console.groupEnd(),console.group("%cd_dayjs",M),console.log("same as dayjs libs"),console.groupEnd(),console.group("%cd_Student",M),console.log("find a student by id \xA4 d_Student.findById(STUDENT_ID, (DATE) ); // date is optionnal"),console.groupEnd(),console.group("%cd_Session",M),console.log("get a list of session \xA4 d_Session.getBetween('2020-08-01','2020-08-31')"),console.log("delete a session by id \xA4 d_Session.deleteById(SESSION_ID);"),console.groupEnd(),console.group("%cSome combinated example",M),console.log("Delete last saved session :  d_Session.deleteById( d_dbase.get(d_Session.tbl_name).last().value().id ); "),console.log("Find all session between 01/08/2020 and 31/08/2020 :  d_dbase.get(d_Session.tbl_name).filter( v => d_dayjs(v.when).isSameOrBefore('20200831', 'day') && d_dayjs(v.when).isSameOrAfter('20200801', 'day')).value(); "),console.groupEnd();debugger};var bn=function(){let{degrees:p,PDFDocument:o,rgb:n,StandardFonts:d}=PDFLib;async function e(){let f=await fetch("https://pdf-lib.js.org/assets/with_update_sections.pdf").then(g=>g.arrayBuffer()),a=await o.load(f),c=await a.embedFont(d.Helvetica),v=a.getPages()[0],{width:$,height:m}=v.getSize();v.drawText("This text was added with JavaScript!",{x:5,y:m/2+300,size:50,font:c,color:n(.95,.1,.1),rotate:p(-45)});let b=await a.save();download(b,"pdf-lib_modification_example.pdf","application/pdf")}async function t(){let l=await o.create(),f=await l.embedFont(d.TimesRoman),a=l.addPage(),{width:c,height:i}=a.getSize(),v=30;a.drawText("Creating PDFs in JavaScript is awesome!",{x:50,y:i-4*v,size:v,font:f,color:n(0,.53,.71)});let $=await l.save();download($,"pdf-lib_modification_example.pdf","application/pdf")}async function u(){var[l,f]=await ct(dayjs().startOf("month"),dayjs().endOf("month"));let a=Ct.getListDetailBill(l,f),c=await o.create(),i=await c.embedFont(d.TimesRoman),v=c.addPage(),{width:$,height:m}=v.getSize(),b=30;v.drawText(`Prestations en d\xE9tail 

 du ${l.format("DD/MM/YYYY")} au ${f.format("DD/MM/YYYY")}`,{x:50,y:m/2-b,size:b,font:i,color:n(116/255,81/255,235/255)});let g=12,x=1.25,T=c.addPage();T.setFontSize(g),T.line_space=x,T.font=i;let B=1,D=20,y=x*g+D,h=m/2,s=function(te){let G="LOrEm ipsum DOLor sit aMet, conSEc/tetUr 25 porttitor. ";return te*1.0925*(i.widthOfTextAtSize(G,g)/G.length)},w=[0,18,36,10,13,8,5,7],C=[w[0],s(w[1]),s(w[2]),s(w[3]),s(w[4]),s(w[5]),s(w[6]),s(w[7])],R=v.lineHeight,Q=25;for(let te=1;te<a.length;te+=1){if(h=m-x*g*B,h<y&&(B=1,T=c.addPage(),T.font=i,T.setFontSize(g),T.line_space=x,h=m-x*g*B),B===1){let Oe=["","Quand","Qui","Financ\xE9","Type-Niv.","Statut","Pu","Cumul"],Se=Q;T.moveTo(Se,h);for(let Le=1;Le<Oe.length;Le+=1)T.drawText(Oe[Le],{x:Se}),Se+=C[Le];B+=1,h=m-x*g*B}let G=Q;T.drawText(dayjs(a[te].when).format("DD/MM/YYYY \xE0 HH:mm"),{font:i,size:g,y:h,x:G,lineHeight:R}),G+=C[1],T.drawText(a[te].who_name.trim().slice(0,w[2]),{font:i,size:g,y:h,x:G,lineHeight:R}),G+=C[2];let pe=a[te].funding.trim().slice(0,w[3]);a[te].funding==="auto-financ\xE9"&&(pe="Au. Fin."),a[te].funding==="financ\xE9 par un tiers"&&(pe="Fin."),T.drawText(pe,{font:i,size:g,y:h,x:G,lineHeight:R}),G+=C[3];let we=a[te].type;a[te].path!=null&&a[te].path.toLowerCase()==="158-trouvez-lemploi-qui-vous-correspond"&&a[te].type!=="soutenance"&&(we="Coaching");let $e=`${we.trim().slice(0,w[4]-2)}-${a[te].lvl.toString()}`;T.drawText($e,{font:i,size:g,y:h,x:G,lineHeight:R}),G+=C[4];let Me=a[te].status;a[te].status==="\xE9tudiant absent"&&(Me="absent"),a[te].status==="\xE9tudiante absente"&&(Me="absente"),a[te].status==="annul\xE9e tardivement"&&(Me="an. tard."),T.drawText(Me,{font:i,size:g,y:h,x:G,lineHeight:R}),G+=C[5],T.drawText(a[te].iPu.toString(),{font:i,size:g,y:h,x:G,lineHeight:R}),G+=C[6],T.drawText(a[te].iCumul.toString(),{font:i,size:g,y:h,x:G,lineHeight:R}),B+=1}var E=await He.calculateBill(l,f);let S=E.get(0,0,0,0).maxLevel,Y=Ae.getOldModeDate(),I=He.getPriceList(Y.subtract(1,"day")),P=He.getPriceList(Y);var O=1;let j=!1;var k=[F,H,N],L=["Sessions","Soutenance","Coaching"],oe=[0,1,2,3],me=["R\xE9alis\xE9e","Annul\xE9e","Annul\xE9e tardivement","Etudiant(e) absent(e)"],ce=[z,W,K],fe=["Autofinanc\xE9s","Financ\xE9s","Autres"];B=1,T=c.addPage();let be=["","Quand","Qui","Nb","Pu","Cumul"],ne=[0,18,50,3,5,7],ie=[w[0],s(w[1]),s(w[2]),s(w[3]),s(w[4]),s(w[5])],he="";for(_iSessionType=0,_iSessionTypeLength=k.length;_iSessionType<_iSessionTypeLength;_iSessionType+=1){for(;O<=S;){for([B,T]=We.changePgIfNeeded(h,y,B,c),h=m-x*g*B,_iSessionQuality=0,_iSessionQualityLength=oe.length;_iSessionQuality<_iSessionQualityLength;_iSessionQuality+=1)for(_iFunding=0,_iFundingLength=ce.length;_iFunding<_iFundingLength;_iFunding+=1){if(_i0=E.get(k[_iSessionType],oe[_iSessionQuality],ce[_iFunding],O),typeof _i0=="undefined"&&j===!1)continue;_i0.data=_i0.data.reverse();let te=Q;if(he=`${L[_iSessionType]} de Niveau ${O} Etudiants ${fe[_iFunding]}`,T.moveTo(te,h),T.drawText(he,{font:i,size:g+4,y:h,x:te,lineHeight:R}),te+=15,B+=1,[B,T]=We.changePgIfNeeded(h,y,B,c),h=m-x*g*B,T.moveTo(te,h),T.drawText(me[_iSessionQuality],{font:i,size:g+2,y:h,x:te,lineHeight:R}),te+=15,B+=1,[B,T]=We.changePgIfNeeded(h,y,B,c),h=m-x*g*B,typeof _i0=="undefined"){T.drawText(`d\xE9sol\xE9 pas de r\xE9sultat pour cette section au niveau de facturation (${O})`,{font:i,size:g,y:h,x:te,lineHeight:R}),B+=1,[B,T]=We.changePgIfNeeded(h,y,B,c),h=m-x*g*B;continue}let G=te,pe=0;T.moveTo(te,h);for(let we=1;we<be.length;we+=1)T.drawText(be[we],{font:i,size:g+2,y:h,x:G,lineHeight:R}),G+=ie[we];B+=1,[B,T]=We.changePgIfNeeded(h,y,B,c),h=m-x*g*B,G=te;for(var de=0,se=_i0.data.length;de<se;de+=1)G=te,T.drawText(dayjs(_i0.data[de].when).format("DD/MM/YYYY \xE0 HH:mm"),{font:i,size:g,y:h,x:G,lineHeight:R}),G+=ie[1],T.drawText(_i0.data[de].who_name.trim().slice(0,ne[1]),{font:i,size:g,y:h,x:G,lineHeight:R}),G+=ie[2],T.drawText((de+1).toString(),{font:i,size:g,y:h,x:G,lineHeight:R}),G+=ie[3],Ae.isInOldMode(dayjs(_i0.data[de].when))?iPu=+_i0.data[de].lvl>0?I[O][k[_iSessionType]][oe[_iSessionQuality]][ce[_iFunding]]:0:iPu=+_i0.data[de].lvl>0?P[O][k[_iSessionType]][oe[_iSessionQuality]][ce[_iFunding]]:0,T.drawText(iPu.toString(),{font:i,size:g,y:h,x:G,lineHeight:R}),G+=ie[4],pe+=iPu,T.drawText(pe.toString(),{font:i,size:g,y:h,x:G,lineHeight:R}),B+=1,[B,T]=We.changePgIfNeeded(h,y,B,c),h=m-x*g*B}O+=1,B+=1,[B,T]=We.changePgIfNeeded(h,y,B,c),h=m-x*g*B}O=1}We.addFooter(c,`G\xE9n\xE9r\xE9 avec Facturier version ${Ae.getAppVersion()}`);let ae=await c.save();download(ae,`prestations_facturees_detail_${l.format("YYYYMMDD")}-${f.format("YYYYMMDD")}.pdf`,"application/pdf")}u()},yn=async function(){GM_addStyle('.formgrid{font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;}'),GM_addStyle(`
.swal2-styled[type=button]{background-color:#3085d6;border-radius:.75em;color:#fff;font-size:1.0625em;border-left-color:#3085d6;border-right-color:#3085d6;display:inline-block}
.formgrid{display:grid;grid-template-columns:1fr 1em 1fr;grid-gap:.3em .6em;grid-auto-flow:dense;align-items:center}
.formgrid input,.formgrid output,.formgrid textarea,.formgrid select,.formgrid button{grid-column:2 / 4;width:auto;margin:0}
.formgrid legend{font-size:1.2em;width:100%;border-bottom:1px dotted #99c}
.formgrid fieldset{max-width:40em;padding:4px;margin:2em auto;border:0 none}
`);let p="";p+="<legend>Que voulez vous faire ?</legend>",p+="<fieldset>",p+='<div class="formgrid">',p+='Epurer<button id="answer1" data-action="raz" class="swal2-styled" type="button">RAZ</button>',p+='Sauvegarder toute la base<button id="answer2" data-action="export" class="swal2-styled" type="button">Sauvegarder</button>',p+='Charger toute la base<button id="answer3" data-action="import" class="swal2-styled" type="button">Charger</button>',p+=`Exporter les tables
    <button class="swal2-styled" type="button"
    	hx-get="/views/test-swal-sauvegarde"
		hx-select="body"
        hx-target="#sttPlaceHolder"
        hx-include="[name='email']"
        hx-swap="innerHTML"> Exporter
    </button>
		`,p+="</fieldset>",p+="</div>";let{value:o}=await Swal.fire({title:"Gestion de la base de donn\xE9e",html:p,focusConfirm:!1,preConfirm:()=>[document.getElementById("answer1").value,document.getElementById("answer2").value],didOpen:n=>{console.log("%conOpen popup","color:coral"),htmx.process(document.querySelector(".swal2-container")),console.log("%cHtmx Process done","color:coral"),n.querySelector(".formgrid").addEventListener("click",_handler=function(d){let e=function(l){l.target.matches('button[data-action="raz"]')&&(Swal.close(),zn())},t=function(l){l.target.matches('button[data-action="export"]')&&(Swal.close(),qn())},u=function(l){l.target.matches('button[data-action="import"]')&&(Swal.close(),Qn())};e(d),t(d),u(d)})},onClose:n=>{n.querySelector(".formgrid").removeEventListener("click",_handler),console.log("%conClose popup","color:coral")}});o&&Swal.fire(JSON.stringify(o))},qn=async function(){let p=dt.save();console.log(`%cWanna save : ${p}`,M);let o=dayjs(),n="";n+=`<a id="download" href="data:text/plain;charset=utf-8,${encodeURIComponent(p)}" download="save_${o.format("YYYYMMDD")}.json">save_${o.format("YYYYMMDD")}.json</a>`,Swal.fire({title:"Sauvegarde de la base de donn\xE9e",html:n,focusConfirm:!1,onOpen:d=>{d.querySelector("#download").click()},onClose:d=>{}})};var Qn=async function(){console.log("%cWanna load DATABASE",M);let{value:p}=await Swal.fire({title:"Selection de la sauvegarde (json)",input:"file",inputAttributes:{accept:".json","aria-label":"Upload your database"}});if(p){let o=new FileReader;o.onload=n=>{dt.import(n.target.result),Mt(),ft("Chargement de la base termin\xE9")},o.readAsText(p)}},zn=async function(){GM_addStyle(".form_addon {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}"),GM_addStyle(".form_addon input {background: #fff;border: 1px solid #9c9c9c;}"),GM_addStyle(".form_addon button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}"),GM_addStyle(".form_addon button:hover {background: gold;}"),GM_addStyle(".form_addon label {padding: 0.5em 0.5em 0.5em 0;}"),GM_addStyle(".form_addon input {padding: 0.7em;margin-bottom: 0.5rem;}"),GM_addStyle(".form_addon input:focus {outline: 3px solid gold;}"),GM_addStyle("@media (min-width: 400px) {.form_addon {grid-template-columns: 200px 1fr;grid-gap: 16px;} .form_addon label {text-align: right;grid-column: 1 / 2;} .form_addon input, .form_addon button {grid-column: 2 / 3;}}");var p="";p+='<form id="RAZ" class="form_addon" action="">',p+='<label for="students" class="cbox">Etudiants</label>',p+='<input id="students" type="checkbox" value="del_students_true" checked>',p+='<label for="sessions" class="cbox">Sessions</label>',p+='<input id="sessions" type="checkbox" value="del_sessions_true" checked>',p+='<label for="archives" class="cbox">Archives : factures</label>',p+='<input id="archives" type="checkbox" value="del_archives_true" checked>',p+='<label for="history_cache" class="cbox">Signet historique</label>',p+='<input id="history_cache" type="checkbox" value="del_history_cache_true" checked>',p+='<label for="radio1">filtrer la date</label>',p+='<input type="radio" id="radio1" name="date_filter" value="false" checked>',p+='<label for="radio2">ne pas filtrer</label>',p+='<input type="radio" id="radio2" name="date_filter" value="true">',p+='<label for="dtFrom" class="date">Date de d\xE9but</label>',p+='<input id="dtFrom" type="date" max="2030-12-31" min="2010-12-31">',p+='<label for="dtTo" class="date">Date de fin</label>',p+='<input id="dtTo" type="date" max="2030-12-31" min="2010-12-31">',p+="<!-- Switch -->",p+='<input type="checkbox" class="switch" name="s1" id="s1">',p+='<label for="s1">Switch</label>',p+="</form>";let{value:o}=await Swal.fire({title:"<strong>RAZ des donn\xE9es</strong>",icon:"info",html:p,showCloseButton:!0,focusConfirm:!1,position:"top-start",grow:"row",footer:"Choisissez ce que vous allez supprimer de la base de donn\xE9e",preConfirm:()=>{let f=document.getElementsByName("date_filter"),a="notfound";for(var c in f)f[c].checked===!0&&(a=f[c].value);return console.log(document.getElementById("s1")),[document.getElementById("students").checked,document.getElementById("sessions").checked,document.getElementById("archives").checked,document.getElementById("history_cache").checked,document.getElementById("dtFrom").disabled===!0?null:document.getElementById("dtFrom").value,document.getElementById("dtTo").disabled===!0?null:document.getElementById("dtTo").value,a]},onOpen:f=>{f.querySelector("#radio1").addEventListener("change",function(){console.log(document.getElementById("radio1").checked);let a=document.getElementById("radio1").checked;document.getElementById("dtFrom").disabled=!a,document.getElementById("dtTo").disabled=!a}),f.querySelector("#radio2").addEventListener("change",function(){let a=document.getElementById("radio1").checked;document.getElementById("dtFrom").disabled=!a,document.getElementById("dtTo").disabled=!a}),f.querySelector("#dtFrom").addEventListener("change",function(){document.getElementById("dtTo").value=dayjs(document.getElementById("dtFrom").value).endOf("month").format("YYYY-MM-DD")})},onClose:f=>{f.querySelector("#radio1").removeEventListener("change"),f.querySelector("#radio2").removeEventListener("change"),f.querySelector("#dtFrom").removeEventListener("change")}}),n=o[0],d=o[1],e=o[2],t=o[3];console.log(`%cWanna raz students ? ${n}, wanna raz sessions ? ${d}, wanna raz archives ? ${e}`,M);let u=o[4]?dayjs(o[4]):null,l=o[5]?dayjs(o[5]):null;n===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des \xE9tudiants",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),ge.delete(u,l),Te.remStudentListUpd()),d===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des sessions",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),xe.delete(u,l),Mt()),e===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base des archives (financi\xE8res)",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),it.delete(u,l)),t===!0&&(setTimeout(function(){Toastify({text:"Suppression de la base du cache des historique de session",gravity:"top",position:"right",close:!0,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}).showToast()},500),at.remove(u,l))};var _n=async function(){var p="";p+="<style>",p+="form {display: grid;padding: 1em;background: #f9f9f9;border: 1px solid #c1c1c1;margin: 2rem auto 0 auto;max-width: 600px;padding: 1em;}",p+="form input {background: #fff;border: 1px solid #9c9c9c;}",p+="form button {background: lightgrey;padding: 0.7em;width: 100%;border: 0;}",p+="form button:hover {background: gold;}",p+="form label {padding: 0.5em 0.5em 0.5em 0;}",p+="form input {padding: 0.7em;margin-bottom: 0.5rem;}",p+="form input:focus {outline: 3px solid gold;}",p+="@media (min-width: 400px) {form {grid-template-columns: 200px 1fr;grid-gap: 16px;}label {text-align: right;grid-column: 1 / 2;}input,button {grid-column: 2 / 3;}}",p+="</style>",p+='<form class="form1" action="">',p+='<label for="dd" class="date">Date de d\xE9but</label>',p+='<input id="dd" type="date" max="2030-12-31" min="2010-12-31">',p+='<label for="df" class="date">Date de fin</label>',p+='<input id="df" type="date" max="2030-12-31" min="2010-12-31">',p+="</form>";var[o,n]=await ct(dayjs().startOf("month"),dayjs().endOf("month")),d=await He.calculateBill(o,n);Ae.isInOldMode(o)?Wn(o,n,d):Kn(o,n,d)};var Wn=function(p,o,n){let d=n.get(0,0,0,0),e=4;var t="",u=null,l=0,f=0,a=0,c=[[4,"Groupe"],[1,"Niveau 1"],[2,"Niveau 2"],[3,"Niveau 3"]],i=0,v=0,$=!1,m=0,b=0,g=0,x=0,T=0,B=0,D=0,y=0,h=0,s=0,w=0,C=0,R=0,Q=0,E=0,A=0,S=0,Y=0,I=1;n.toConsole(),t+="<style>.wrapper{  display: grid;grid-gap: 10px;grid-template-column: 1fr 1fr;}</style>",t+='<div class="wrapper">',t+="<table>",t+="<thead>",t+="<tr>",t+='<th>Type</th><th><abbr title="nombre">nb</abbr></th><th>PU(<abbr title="hors taxes">HT</abbr>)</th><th>Total(<abbr title="hors taxes">HT</abbr>)</th>',t+="</tr>",t+="</thead>",t+="<tbody>",t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Mentorat</th>',t+="</tr>";for(var i=performance.now();I<=e;)_i0=n.get(F,Z,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : r\xE9alis\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(F,X,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(F,V,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es tard.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(F,ee,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : \xE9tudiant abs.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),I+=1;var v=performance.now();console.log("%cCalculate first array"+(v-i)+" milliseconds.",Re),t+="<tr>",t+="<td>Total</td>",t+=`<td>${l}</td><td></td><td>${f}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",a+=f,l=0,f=0,t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Soutenance</th>',t+="</tr>",I=1;for(var i=performance.now();I<=e;)_i0=n.get(H,Z,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : r\xE9alis\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(H,X,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(H,V,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es tard.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(H,ee,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : \xE9tudiant abs.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),I+=1;var v=performance.now();console.log("%cCalculate second array"+(v-i)+" milliseconds.",Re),t+="<tr>",t+="<td>Total</td>",t+=`<td>${l}</td><td></td><td>${f}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",a+=f,l=0,f=0,t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Sessions de Coaching</th>',t+="</tr>",I=1;for(var i=performance.now();I<=e;)_i0=n.get(N,Z,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : r\xE9alis\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(N,X,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(N,V,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : annul\xE9es tard.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),_i0=n.get(N,ee,z,I),s=_i0===void 0?0:_i0.number,A=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,W,I),w=_i0===void 0?0:_i0.number,S=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,K,I),C=_i0===void 0?0:_i0.number,Y=_i0===void 0?0:_i0.amount,R=s>0?A/s:A,Q=w>0?S/w:S,E=C>0?Y/C:Y,($===!0||s+w+C>0)&&(l+=s,l+=w,l+=C,f+=A,f+=S,f+=Y,t+="<tr>",t+=`<td>Niveau ${I} : \xE9tudiant abs.</td>`,t+=`<td>${s+w+C}</td><td>${Q}</td><td>${A+S+Y}\u20AC</td>`,t+="</tr>"),I+=1;var v=performance.now();console.log("%cCalculate third array"+(v-i)+" milliseconds.",Re),t+="<tr>",t+="<td>Total</td>",t+=`<td>${l}</td><td></td><td>${f}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",a+=f,t+="<tr>",t+='<th colspan="4" class="pseudoheader" scope="colgroup">Total G\xE9n\xE9ral</th>',t+="</tr>",t+=`<td colspan="3"></td><td>${a}\u20AC</td>`,t+="</tr>",t+="<tr>",t+="</tr>",t+="</tbody>",t+="<tfoot>",t+="</tfoot>",t+="</table>",t+=`<p>Soit un total g\xE9n\xE9ral \xE0 facturer de ${a}\u20AC`,Swal.fire({title:`<strong>Liste des formations tarif\xE9es du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,html:t,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})},Kn=function(p,o,n){console.log("%cEnter computation bill",M);let d=!1;var e="",t=0,u=0,l=0,f=0,a=0,c=0,i=0,v=0,$=0,m=0,b=0,g=0;let x=n.get(0,0,0,0),T=x.maxLevel;var B=0,D=0,y=0,h=0,s=0,w=0,C=0,R=0,Q=0,E=0,A=0,S=0,Y=0,I=0,P=0,O=0,j=0,k=0,L=1;e+="<style>.wrapper{  display: grid;grid-gap: 10px;grid-template-column: 1fr 1fr;}</style>",e+='<div class="wrapper">',e+="<table>",e+="<thead>",e+="<tr>",e+='<th rowspan="2">Type</th><th colspan="3" scope="colgroup">Auto Financ\xE9s</th><th colspan="3" scope="colgroup">Financ\xE9s</th><th colspan="3" scope="colgroup">Autres</th><th colspan="2" scope="colgroup">Total</th>',e+="</tr>",e+="<tr>",e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="prix unitaire">Pu.</abbt>(<abbr title="hors taxes">HT</abbr>)</th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+='<th><abbr title="nombre">Nb.</abbr></th><th><abbr title="montant">Mt.</abbt>(<abbr title="hors taxes">HT</abbr>)</th>',e+="</tr>",e+="</thead>",e+="<tbody>",e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de mentorat</th>',e+="</tr>";for(var oe=performance.now();L<=T;)_i0=n.get(F,Z,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,Z,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : r\xE9alis\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(F,X,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,X,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(F,V,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,V,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es tard.</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(F,ee,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(F,ee,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : \xE9tud. absent</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),L+=1;var me=performance.now();for(console.log("%cCalculate first array"+(me-oe)+" milliseconds.",Re),e+="<tr>",e+="<td>Total</td>",e+=`<td>${t}</td><td></td><td>${f}\u20AC</td>`,e+=`<td>${u}</td><td></td><td>${a}\u20AC</td>`,e+=`<td>${l}</td><td></td><td>${c}\u20AC</td>`,e+=`<td>${t+u+l}</td><td>${f+a+c}\u20AC</td>`,e+="</tr>",e+="<tr>",e+="</tr>",i+=t,v+=u,$+=l,m+=f,b+=a,g+=c,t=0,u=0,l=0,f=0,a=0,c=0,e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de Soutenance</th>',e+="</tr>",L=1;L<=T;)_i0=n.get(H,Z,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,Z,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : r\xE9alis\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(H,X,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,X,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(H,V,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,V,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es tard.</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(H,ee,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(H,ee,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : \xE9tud. absent</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),L+=1;e+="<tr>",e+="<td>Total</td>",e+=`<td>${t}</td><td></td><td>${f}\u20AC</td>`,e+=`<td>${u}</td><td></td><td>${a}\u20AC</td>`,e+=`<td>${l}</td><td></td><td>${c}\u20AC</td>`,e+=`<td>${t+u+l}</td><td>${f+a+c}\u20AC</td>`,e+="</tr>",e+="<tr>",e+="</tr>",i+=t,v+=u,$+=l,m+=f,b+=a,g+=c,t=0,u=0,l=0,f=0,a=0,c=0,e+="<tr>",e+='<th colspan="12" class="pseudoheader" scope="colgroup">Sessions de Coaching</th>',e+="</tr>";for(var L=1;L<=T;)_i0=n.get(N,Z,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,Z,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : r\xE9alis\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(N,X,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,X,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(N,V,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,V,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : annul\xE9es tard.</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),_i0=n.get(N,ee,z,L),E=_i0===void 0?0:_i0.number,O=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,W,L),A=_i0===void 0?0:_i0.number,j=_i0===void 0?0:_i0.amount,_i0=n.get(N,ee,K,L),S=_i0===void 0?0:_i0.number,k=_i0===void 0?0:_i0.amount,Y=E>0?O/E:O,I=A>0?j/A:j,P=S>0?k/S:k,(d===!0||E+A+S>0)&&(t+=E,u+=A,l+=S,f+=O,a+=j,c+=k,e+="<tr>",e+=`<td>Niveau ${L} : \xE9tud. absent</td>`,e+=`<td>${E}</td><td>${Y}</td><td>${O}\u20AC</td>`,e+=`<td>${A}</td><td>${I}</td><td>${j}\u20AC</td>`,e+=`<td>${S}</td><td>${P}</td><td>${k}\u20AC</td>`,e+=`<td>${E+A+S}</td><td>${O+j+k}\u20AC</td>`,e+="</tr>"),L+=1;i+=t,v+=u,$+=l,m+=f,b+=a,g+=c,e+="<tr>",e+="<td>Total</td>",e+=`<td>${t}</td><td></td><td>${f}\u20AC</td>`,e+=`<td>${u}</td><td></td><td>${a}\u20AC</td>`,e+=`<td>${l}</td><td></td><td>${c}\u20AC</td>`,e+=`<td>${t+u+l}</td><td>${f+a+c}\u20AC</td>`,e+="</tr>",e+="<tr>",e+="</tr>",e+="</tbody>",e+="<tfoot>",e+="</tfoot>",e+="</table>";var ce=0,fe="";let be=x.flatFee.length;for(var ne=0;ne<be;ne+=1)ce+=30,fe+=x.flatFee[ne].who_name+", ";be>1?e+=`<p class="flat_fee">Calcul du forfait "autofinanc\xE9". Ce mois ci ${be} \xE9tudiants ont eu au moins une session il s'agit de : ${fe.slice(0,-1)}`:e+=`<p class="flat_fee">Calcul du forfait "autofinanc\xE9". Ce mois ci ${be} \xE9tudiant a eu au moins une session il s'agit de : ${fe.slice(0,-1)}`,e+=`. Le forfait est donc de ${ce}\u20AC</p>`,e+=`<p>Soit un total g\xE9n\xE9ral \xE0 facturer de ${m+b+g+ce}\u20AC</p>`,Swal.fire({title:`<strong>Liste des formations tarif\xE9es du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,html:e,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen"})},vn=async function(){var[p,o]=await ct(dayjs().startOf("month"),dayjs().endOf("month"),!1);if(p===null||o===null)throw console.log("%cError need date from, date to",le),new Error;let n=Ct.getListStatistic(p,o),d="",e=new Array(22),t=Array.apply(null,Array(22)).map(Number.prototype.valueOf,0),u=p.clone(),l=u.endOf("month"),f="";e[0]="<thead><tr><th>Sessions</th>",e[1]="<tbody><tr><td>Sessions</td>",e[2]='<tr class="header"><td>Montant</td>',e[3]="<tr><td>Nb.",e[4]="<tr><td>Pu",e[5]='<tr class="header"><td>Soutenances</td>',e[6]="<tr><td>Montant</td>",e[7]="<tr><td>Nb.",e[8]="<tr><td>Pu",e[9]='<tr class="header"><td>Coaching</td>',e[10]="<tr><td>Montant</td>",e[11]="<tr><td>Nb.",e[12]="<tr><td>Pu",e[13]='<tr class="header"><td>Bonus</td>',e[14]="<tr><td>Bonus AF</td>",e[15]="<tr><td>Total G\xE9n\xE9ral</td>",e[16]='<tr class="header"><td>KPI</td>',e[17]="<tr><td>NbJrs</td>",e[18]="<tr><td>TJM</td>",e[19]="<tr><td>Nb hrs</td>",e[20]="<tr><td>THM</td>",e[21]="<tr><td>Nb hrs (p.)</td>",e[22]="<tr><td>THM (p)</td>";for(var a=0;a<n.length;a+=1){t[2]+=n[a].sessions.total,t[3]+=n[a].sessions.nb-n[a].sessions.nbc,t[4]+=n[a].sessions.pu,t[6]+=n[a].defenses.total,t[7]+=n[a].defenses.nb-n[a].defenses.nbc,t[8]+=n[a].defenses.pu,t[10]+=n[a].coaches.total,t[11]+=n[a].coaches.nb-n[a].coaches.nbc,t[12]+=n[a].coaches.pu,t[14]+=n[a].bonus;let c=n[a].sessions.total+n[a].defenses.total+n[a].coaches.total+n[a].bonus;t[15]+=c,t[16]+=n[a].kpi.jrs,t[18]+=n[a].kpi.hrs,t[20]+=n[a].kpi.hrsp,n.length==1&&(f="</tr>"),a===n.length-1&&n.length>1?l.isAfter(o,"day")?(t[2]-=n[a].sessions.total,t[3]-=n[a].sessions.nb-n[a].sessions.nbc,t[4]-=n[a].sessions.pu,t[6]-=n[a].defenses.total,t[7]-=n[a].defenses.nb-n[a].defenses.nbc,t[8]-=n[a].defenses.pu,t[10]-=n[a].coaches.total,t[11]-=n[a].coaches.nb-n[a].coaches.nbc,t[12]-=n[a].coaches.pu,t[14]-=n[a].bonus,t[15]-=c,t[16]-=n[a].kpi.jrs,t[18]-=n[a].kpi.hrs,t[20]-=n[a].kpi.hrsp,e[0]+=`<td>Total(moy)</td><td>${dayjs(n[a].header.dtTo).format("MMMM")}</td></thead></tr>`,e[1]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[2]+=`<td>${t[2]} (${(t[2]/(n.length-1)).toFixed(2)})</td><td>${n[a].sessions.total}</td></tr>`,e[3]+=`<td>${t[3]} (${(t[3]/(n.length-1)).toFixed(2)})</td><td>${n[a].sessions.nb} (${n[a].sessions.nbc})</td></tr>`,e[4]+=`<td> n/a (${(t[4]/(n.length-1)).toFixed(2)})</td><td>${n[a].sessions.pu.toFixed(2)}</td></tr>`,e[5]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[6]+=`<td>${t[6]} (${(t[6]/(n.length-1)).toFixed(2)})</td><td>${n[a].defenses.total}</td></tr>`,e[7]+=`<td>${t[7]} (${(t[7]/(n.length-1)).toFixed(2)})</td><td>${n[a].defenses.nb} (${n[a].defenses.nbc})</td></tr>`,e[8]+=`<td> n/a (${(t[8]/(n.length-1)).toFixed(2)})</td><td>${n[a].defenses.pu.toFixed(2)}</td></tr>`,e[9]+=`<td>&nbsp;</td>${f}`,e[10]+=`<td>${t[10]} (${(t[10]/(n.length-1)).toFixed(2)})</td><td>${n[a].coaches.total}</td></tr>`,e[11]+=`<td>${t[11]} (${(t[11]/(n.length-1)).toFixed(2)})</td><td>${n[a].coaches.nb} (${n[a].coaches.nbc})</td></tr>`,e[12]+=`<td> n/a (${(t[12]/(n.length-1)).toFixed(2)})</td><td>${n[a].coaches.pu.toFixed(2)}</td></tr>`,e[13]+="<td>&nbsp;</td></tr>",e[14]+=`<td>${t[14]} (${(t[14]/(n.length-1)).toFixed(2)})</td><td>${n[a].bonus}</td></tr>`,e[15]+=`<td>${t[15]} (${(t[15]/(n.length-1)).toFixed(2)})</td><td>${c}</td></tr>`,e[16]+="<td>&nbsp;</td></tr>",e[17]+=`<td>${t[16]} (${(t[16]/(n.length-1)).toFixed(2)})</td><td>${n[a].kpi.jrs}</td></tr>`,e[18]+=`<td> n/a (${(t[15]/t[16]).toFixed(2)})</td><td>${(c/n[a].kpi.jrs).toFixed(2)}</td></tr>`,e[19]+=`<td>${t[18]} (${(t[18]/(n.length-1)).toFixed(2)})</td><td>${n[a].kpi.hrs.toFixed(2)}</td></tr>`,e[20]+=`<td> n/a  (${(t[15]/t[18]).toFixed(2)})</td><td>${(c/n[a].kpi.hrs).toFixed(2)}</td></tr>`,e[21]+=`<td>${t[20].toFixed(2)} (${(t[20]/(n.length-1)).toFixed(2)})</td><td>${n[a].kpi.hrsp.toFixed(2)}</td></tr>`,e[22]+=`<td> n/a  (${(t[15]/t[20]).toFixed(2)})</td><td>${(c/n[a].kpi.hrsp).toFixed(2)}</td></tr>`):(e[0]+=`<td>${dayjs(n[a].header.dtTo).format("MMMM")}</td><td>Tot.</td></thead></tr>`,e[1]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[2]+=`<td>${n[a].sessions.total}</td><td>${t[2]} (${(t[2]/n.length).toFixed(2)})</td></tr>`,e[3]+=`<td>${n[a].sessions.nb} (${n[a].sessions.nbc})</td><td>${t[3]} (${(t[3]/n.length).toFixed(2)})</td></tr>`,e[4]+=`<td>${n[a].sessions.pu.toFixed(2)}</td><td> n/a (${(t[4]/n.length).toFixed(2)})</td></tr>`,e[5]+="<td>&nbsp;</td><td>&nbsp;</td></tr>",e[6]+=`<td>${n[a].defenses.total}</td><td>${t[6]} (${(t[6]/n.length).toFixed(2)})</td></tr>`,e[7]+=`<td>${n[a].defenses.nb} (${n[a].defenses.nbc})</td><td>${t[7]} (${(t[7]/n.length).toFixed(2)})</td></tr>`,e[8]+=`<td>${n[a].defenses.pu.toFixed(2)}</td><td> n/a (${(t[8]/n.length).toFixed(2)})</td></tr>`,e[9]+=`<td>&nbsp;</td>${f}`,e[10]+=`<td>${n[a].coaches.total}</td><td>${t[10]} (${(t[10]/n.length).toFixed(2)})</td></tr>`,e[11]+=`<td>${n[a].coaches.nb} (${n[a].coaches.nbc})</td><td>${t[11]} (${(t[11]/n.length).toFixed(2)})</td></tr>`,e[12]+=`<td>${n[a].coaches.pu.toFixed(2)}</td><td> n/a (${(t[12]/n.length).toFixed(2)})</td></tr>`,e[13]+="<td>&nbsp;</td></tr>",e[14]+=`<td>${n[a].bonus}</td><td>${t[14]} (${(t[14]/n.length).toFixed(2)})</td></tr>`,e[15]+=`<td>${c}</td><td>${t[15]} (${(t[15]/n.length).toFixed(2)})</td></tr>`,e[16]+="<td>&nbsp;</td></tr>",e[17]+=`<td>${n[a].kpi.jrs}</td><td>${t[16]} (${(t[16]/n.length).toFixed(2)})</td></tr>`,e[18]+=`<td>${(c/n[a].kpi.jrs).toFixed(2)}</td><td> n/a (${(t[15]/t[16]).toFixed(2)})</td></tr>`,e[19]+=`<td>${n[a].kpi.hrs.toFixed(2)}</td><td>${t[18]} (${(t[18]/n.length).toFixed(2)})</td></tr>`,e[20]+=`<td>${(c/n[a].kpi.hrs).toFixed(2)}</td><td> n/a  (${(t[15]/t[18]).toFixed(2)})</td></tr>`,e[21]+=`<td>${n[a].kpi.hrsp.toFixed(2)}</td><td>${t[20].toFixed(2)} (${(t[20]/n.length).toFixed(2)})</td></tr>`,e[22]+=`<td>${(c/n[a].kpi.hrsp).toFixed(2)}</td><td> n/a  (${(t[15]/t[20]).toFixed(2)})</td></tr>`):(e[0]+=`<td>${dayjs(n[a].header.dtTo).format("MMMM")}</td>${f}`,e[1]+=`<td>&nbsp;</td>${f}`,e[2]+=`<td>${n[a].sessions.total}</td>${f}`,e[3]+=`<td>${n[a].sessions.nb} (${n[a].sessions.nbc})</td>${f}`,e[4]+=`<td>${n[a].sessions.pu.toFixed(2)}</td>${f}`,e[5]+=`<td>&nbsp;</td>${f}`,e[6]+=`<td>${n[a].defenses.total}</td>${f}`,e[7]+=`<td>${n[a].defenses.nb} (${n[a].defenses.nbc})</td>${f}`,e[8]+=`<td>${n[a].defenses.pu.toFixed(2)}</td>${f}`,e[9]+=`<td>&nbsp;</td>${f}`,e[10]+=`<td>${n[a].coaches.total}</td>${f}`,e[11]+=`<td>${n[a].coaches.nb} (${n[a].coaches.nbc})</td>${f}`,e[12]+=`<td>${n[a].coaches.pu.toFixed(2)}</td>${f}`,e[13]+=`<td>&nbsp;</td>${f}`,e[14]+=`<td>${n[a].bonus}</td>${f}`,e[15]+=`<td>${c}</td>${f}`,e[16]+=`<td>&nbsp;</td>${f}`,e[17]+=`<td>${n[a].kpi.jrs}</td>${f}`,e[18]+=`<td>${(c/n[a].kpi.jrs).toFixed(2)}</td>${f}`,e[19]+=`<td>${n[a].kpi.hrs.toFixed(2)}</td>${f}`,e[20]+=`<td>${(c/n[a].kpi.hrs).toFixed(2)}</td>${f}`,e[21]+=`<td>${n[a].kpi.hrsp.toFixed(2)}</td>${f}`,e[22]+=`<td>${(c/n[a].kpi.hrsp).toFixed(2)}</td>${f}`),u=u.add(1,"month"),l=u.endOf("month")}d="<table>"+e.join(" ")+`</tbody><tfoot><tr><td colspan=${n.length+1}>la valeur entre parenth\xE8se fait reference aux annul\xE9s</td></tr></tfoot></table>`,Swal.fire({title:`<strong>Statistiques du ${p.format("DD/MM/YYYY")} au ${o.format("DD/MM/YYYY")}</strong>`,icon:"info",html:d,showCloseButton:!0,focusConfirm:!1,position:"center-start",grow:"fullscreen",onOpen:c=>{}})};var Ie=class{},At=Ie;U(At,"init",function(){console.log("%cin initUI",M),Ie.build();var o=new Draggabilly(".draggable",{handle:".handle"})}),U(At,"build",function(){console.log("%c in buildUI","background-color:green;color:white"),GM_addStyle(`
.flow > * + * {
  margin-top: var(--flow-space, 1em);
}
		`),GM_addStyle(".panel {/* because of stacking context : https://stackoverflow.com/questions/5218927/z-index-not-working-with-fixed-positioning */position: relative;z-index: 666; /*seems that 4 is good*/}"),GM_addStyle(".menuBar {padding:7px;/*for handler*/font-size: 1rem; pointer-events: inherit;}"),GM_addStyle(".draggable {background: transparent;border-radius: 10px;padding: 20px;}"),GM_addStyle(".draggable.is-pointer-down {background: #09F;}"),GM_addStyle(".draggable.is-dragging { opacity: 0.7; }"),GM_addStyle(".handle {background: #555;background: hsla(0, 0%, 0%, 0.4);width: 20px;height: 20px; border-radius: 10px; position: relative; top:10px; left:-10px;}"),GM_addStyle(`
.menuBar{
/*Smol Responsive CSS Grid*/
--min: 15ch;
--gap: 1rem;
display: grid;
grid-gap: var(--gap);
/* min() with 100% prevents overflow
in extra narrow spaces */
grid-template-columns: repeat(auto-fit, minmax(min(100%, var(--min)), 1fr)); /* 20 px is size of handle*/ 
}
		`);var o=document.createElement("div"),n=document.createElement("div");n.classList.add("handle"),o.appendChild(n),o.classList.add("panel","draggable"),document.body.insertAdjacentElement("beforeend",o),o.setAttribute("style",`top:-${document.body.offsetHeight-o.offsetHeight}px`);var d=document.createElement("div");d.classList.add("menuBar"),o.appendChild(d),Ie.addButton("collectChecked",hn,{},d),Ie.addButton("CollectAuto",mn,{},d),Ie.addButton("showBill",_n,{},d),Ie.addButton("billInDetails",pn,{},d),Ie.addButton("PDF",bn,{},d),Ie.addButton("SList",ge.showList,{},d),Ie.addButton("DbgMode",gn,{},d),Ie.addButton("statistics",vn,{},d),Ie.addButton("Database",yn,{},d),Ie.addButton("about",fn,{},d);let e=document.createElement("div"),t=e.style;e.id="sttPlaceHolder";let u={position:"absolute",bottom:"7%",left:"4%","z-index":999,display:"hidden"};document.body.insertAdjacentElement("beforeend",e),Object.keys(u).forEach(l=>t[l]=u[l])}),U(At,"addButton",function(o,n,d,e){e=e||document.body,d=d||{position:"absolute",bottom:"7%",left:"4%","z-index":3};let t=document.createElement("button"),u=t.style;return t.classList.add("button--primary","button"),e.appendChild(t),t.innerHTML=o,t.onclick=n,Object.keys(d).forEach(l=>u[l]=d[l]),t});var Lt=class{};U(Lt,"start",function(o){let n=document.getElementById(o),d=f=>n.style.transform=`translateX(${f}px)`,e=0,t=7,u=f=>{d(e),e+=t,e>100?requestAnimationFrame(l):requestAnimationFrame(u)},l=f=>{d(e),e-=t,e<-100?requestAnimationFrame(u):requestAnimationFrame(l)};return requestAnimationFrame(u)}),U(Lt,"stop",function(o){window.cancelAnimationFrame(o)});var wn=At;var Vn="#OCAddonsCfg {background-color: lightblue;} #OCAddonsCfg .reset_holder {float: left; position: relative; bottom: -1em;} #OCAddonsCfg .saveclose_buttons {margin: .7em;}",Jn="height: 16.7em; width: 30em; border: 1px solid; border-radius: 3px; position: fixed; z-index: 999;";var An={id:"OCAddonsCfg",title:"Configuration du module",fields:{nbHrsAfM:{section:["Statistiques","param\xE8tres"],label:"Nombre de minutes pour une session d'\xE9tudiant auto financ\xE9",title:"Dur\xE9e moyenne d'une session AF (calcul du THM)",labelPos:"left",type:"input",default:30},nbHrsfM:{label:"Nombre de minutes pour une session d'\xE9tudiant financ\xE9",title:"Dur\xE9e moyenne d'une session Financ\xE9e (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsS:{label:"Nombre de minutes pour une session (avant 01/07/2020)",title:"Dur\xE9e moyenne d'une session avant la s\xE9paration auto financ\xE9 | financ\xE9 (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsD:{label:"Nombre de minutes pour une session de soutenance",title:"Dur\xE9e moyenne d'une sessionde soutenance AF (calcul du THM)",labelPos:"left",type:"input",default:45},nbHrsC:{label:"Nombre de minutes pour une session de coaching",title:"Dur\xE9e moyenne d'une session de coachine (calcul du THM)",labelPos:"left",type:"input",default:45},maxfetchpg:{section:["Application","optimisation"],label:"Maximum de page recherch\xE9es dans l'historique",labelPos:"left",type:"input",default:1e3},datacachelifetime:{label:"Temps de conservation des donn\xE9es dans le cache (en ms)",labelPos:"left",type:"input",default:12e4},checksessionalreadyexists:{section:["Application","Base de donn\xE9e"],label:"sessions: v\xE9rifier existence avant insertion",labelPos:"left",type:"checkbox",default:!0},sizeofcontentlist:{section:["Interface","th\xE8me"],label:"taille de la police des listes",labelPos:"left",type:"input",default:"1em;"},use_custom_css:{label:"utiliser des styles personnalis\xE9s",labelPos:"left",type:"checkbox",default:!1},custom_css_url:{label:"url de la feuille de style (si plusieurs les s\xE9parer par des virgules)",labelPos:"left",type:"input",default:""},custom_css_data:{label:"saisir ici le code css \xE0 injecter directement dans la page",title:"Je me demande bien \xE0 quoi sert le titre",labelPos:"left",type:"input",default:""},alwaysaddcbox:{section:["Interface","Gadget"],label:"Toujours ajouter les checkbox sur l'interface",labelPos:"left",type:"checkbox",default:!0},hackheaderzindex:{section:["","Hack"],label:"Changer le zindex du bandeau haut",title:"le bandeau haut \xE0 un z-index  (1000) qui le place au dessus de tout ce qui est pr\xE9sent \xE0 l'\xE9cran, ce qui g\xEAne la barre de menu ; activer cette option r\xE9duit ce chiffre \xE0 0",labelPos:"left",type:"checkbox",default:!0},support:{section:["","Support"],label:"StephaneTy-Pro.github.io",title:"more info on https://github.com/StephaneTy-Pro",type:"button",click:()=>{GM_openInTab("https://github.com/StephaneTy-Pro/OC-Mentors-AccountAddon",{active:!0,insert:!0,setParent:!0})}}},css:Vn,events:{save:function(){GM_config.close()}}},Rt=function(){GM_config.open(),OCAddonsCfg.style=Jn};var Tt=class{};U(Tt,"longTaskTiming",function(){if(window.self===window.top){console.log("LongTasks: Initializing");var o=new window.PerformanceObserver(function(n){for(var d=n.getEntries(),e=0;e<d.length;e++)console.log("LongTasks: ",d[e].name,d[e].duration,d[e].attribution.length,d[e].attribution.length>0?d[e].attribution[0].containerType:null,d[e].attribution.length>0?d[e].attribution[0].containerName:null,d[e].attribution.length>0?d[e].attribution[0].containerSrc:null,d[e].attribution.length>0?d[e].attribution[0].containerId:null,d[e])});typeof window.PerformanceLongTaskTiming!="undefined"?console.log("LongTasks: Appears to be supported"):console.log("LongTasks: Not supported");try{o.observe({entryTypes:["longtask"]})}catch(n){console.log("LongTasks: Not supported")}}}),U(Tt,"paintTiming",function(){if(window.self===window.top){console.log("PaintTiming: Initializing");var o=new window.PerformanceObserver(function(n){for(var d=n.getEntries(),e=0;e<d.length;e++)console.log("PaintTiming: ",d[e].name,d[e].startTime)});if(typeof window.PerformancePaintTiming!="undefined")console.log("PaintTiming: Appears to be supported");else{console.log("PaintTiming: Not supported");return}try{o.observe({entryTypes:["paint"],buffered:!0})}catch(n){console.log("PaintTiming: Not supported")}}});var Pt=Tt;var Ft=function(p,o,n,d,e,t,u){t=o.createElement(n),u=o.getElementsByTagName(n)[0],t.appendChild(o.createTextNode(d.text)),t.onload=e(d),u?u.parentNode.insertBefore(t,u):o.head.appendChild(t)};var Zn=function(p,o){if(!arguments.length)return Promise.reject(new ReferenceError("Failed to execute 'fetchInject': 1 argument required but only 0 present."));if(arguments[0]&&arguments[0].constructor!==Array)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 1 must be of type 'Array'."));if(arguments[1]&&arguments[1].constructor!==Promise)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 2 must be of type 'Promise'."));let n=[],d=o?[].concat(o):[],e=[];return p.forEach(t=>d.push(window.fetch(t).then(u=>[u.clone().text(),u.blob()]).then(u=>Promise.all(u).then(l=>{n.push({text:l[0],blob:l[1]})})))),Promise.all(d).then(()=>(n.forEach(t=>{e.push({then:u=>{t.blob.type.includes("text/css")?Ft(window,document,"style",t,u):Ft(window,document,"script",t,u)}})}),Promise.all(e)))},lt=Zn;var Vi=function(p,o,n){"use strict";if(!p.MutationObserver||typeof HTMLElement=="undefined")return;var d=0,e=function(){var m=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(b,g){return b instanceof HTMLElement&&m.call(b,g)},addMethod:function(b,g,x){var T=b[g];b[g]=function(){if(x.length==arguments.length)return x.apply(this,arguments);if(typeof T=="function")return T.apply(this,arguments)}},callCallbacks:function(b,g){g&&g.options.onceOnly&&g.firedElems.length==1&&(b=[b[0]]);for(var x=0,T;T=b[x];x++)T&&T.callback&&T.callback.call(T.elem,T.elem);g&&g.options.onceOnly&&g.firedElems.length==1&&g.me.unbindEventWithSelectorAndCallback.call(g.target,g.selector,g.callback)},checkChildNodesRecursively:function(b,g,x,T){for(var B=0,D;D=b[B];B++)x(D,g,T)&&T.push({callback:g.callback,elem:D}),D.childNodes.length>0&&e.checkChildNodesRecursively(D.childNodes,g,x,T)},mergeArrays:function(b,g){var x={},T;for(T in b)b.hasOwnProperty(T)&&(x[T]=b[T]);for(T in g)g.hasOwnProperty(T)&&(x[T]=g[T]);return x},toElementsArray:function(b){return typeof b!="undefined"&&(typeof b.length!="number"||b===p)&&(b=[b]),b}}}(),t=function(){var m=function(){this._eventsBucket=[],this._beforeAdding=null,this._beforeRemoving=null};return m.prototype.addEvent=function(b,g,x,T){var B={target:b,selector:g,options:x,callback:T,firedElems:[]};return this._beforeAdding&&this._beforeAdding(B),this._eventsBucket.push(B),B},m.prototype.removeEvent=function(b){for(var g=this._eventsBucket.length-1,x;x=this._eventsBucket[g];g--)if(b(x)){this._beforeRemoving&&this._beforeRemoving(x);var T=this._eventsBucket.splice(g,1);T&&T.length&&(T[0].callback=null)}},m.prototype.beforeAdding=function(b){this._beforeAdding=b},m.prototype.beforeRemoving=function(b){this._beforeRemoving=b},m}(),u=function(m,b){var g=new t,x=this,T={fireOnAttributesModification:!1};return g.beforeAdding(function(B){var D=B.target,y;(D===p.document||D===p)&&(D=document.getElementsByTagName("html")[0]),y=new MutationObserver(function(s){b.call(this,s,B)});var h=m(B.options);y.observe(D,h),B.observer=y,B.me=x}),g.beforeRemoving(function(B){B.observer.disconnect()}),this.bindEvent=function(B,D,y){D=e.mergeArrays(T,D);for(var h=e.toElementsArray(this),s=0;s<h.length;s++)g.addEvent(h[s],B,D,y)},this.unbindEvent=function(){var B=e.toElementsArray(this);g.removeEvent(function(D){for(var y=0;y<B.length;y++)if(this===n||D.target===B[y])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function(B){var D=e.toElementsArray(this),y=B,h;typeof B=="function"?h=function(s){for(var w=0;w<D.length;w++)if((this===n||s.target===D[w])&&s.callback===y)return!0;return!1}:h=function(s){for(var w=0;w<D.length;w++)if((this===n||s.target===D[w])&&s.selector===B)return!0;return!1},g.removeEvent(h)},this.unbindEventWithSelectorAndCallback=function(B,D){var y=e.toElementsArray(this);g.removeEvent(function(h){for(var s=0;s<y.length;s++)if((this===n||h.target===y[s])&&h.selector===B&&h.callback===D)return!0;return!1})},this},l=function(){var m={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function b(B){var D={attributes:!1,childList:!0,subtree:!0};return B.fireOnAttributesModification&&(D.attributes=!0),D}function g(B,D){B.forEach(function(y){var h=y.addedNodes,s=y.target,w=[],C;h!==null&&h.length>0?e.checkChildNodesRecursively(h,D,x,w):y.type==="attributes"&&x(s,D,w)&&w.push({callback:D.callback,elem:s}),e.callCallbacks(w,D)})}function x(B,D,y){return e.matchesSelector(B,D.selector)&&(B._id===n&&(B._id=d++),D.firedElems.indexOf(B._id)==-1)?(D.firedElems.push(B._id),!0):!1}a=new u(b,g);var T=a.bindEvent;return a.bindEvent=function(B,D,y){typeof y=="undefined"?(y=D,D=m):D=e.mergeArrays(m,D);var h=e.toElementsArray(this);if(D.existing){for(var s=[],w=0;w<h.length;w++)for(var C=h[w].querySelectorAll(B),R=0;R<C.length;R++)s.push({callback:y,elem:C[R]});if(D.onceOnly&&s.length)return y.call(s[0].elem,s[0].elem);setTimeout(e.callCallbacks,1,s)}T.call(this,B,D,y)},a},f=function(){var m={};function b(){var B={childList:!0,subtree:!0};return B}function g(B,D){B.forEach(function(y){var h=y.removedNodes,s=[];h!==null&&h.length>0&&e.checkChildNodesRecursively(h,D,x,s),e.callCallbacks(s,D)})}function x(B,D){return e.matchesSelector(B,D.selector)}c=new u(b,g);var T=c.bindEvent;return c.bindEvent=function(B,D,y){typeof y=="undefined"?(y=D,D=m):D=e.mergeArrays(m,D),T.call(this,B,D,y)},c},a=new l,c=new f;function i(m,b,g){e.addMethod(b,g,m.unbindEvent),e.addMethod(b,g,m.unbindEventWithSelectorOrCallback),e.addMethod(b,g,m.unbindEventWithSelectorAndCallback)}function v(m){m.arrive=a.bindEvent,i(a,m,"unbindArrive"),m.leave=c.bindEvent,i(c,m,"unbindLeave")}o&&v(o.fn),v(HTMLElement.prototype),v(NodeList.prototype),v(HTMLCollection.prototype),v(HTMLDocument.prototype),v(Window.prototype);var $={};return i(a,$,"unbindAllArrive"),i(c,$,"unbindAllLeave"),$}(window,typeof jQuery=="undefined"?null:jQuery,void 0);var Sn={data:"DwCwLgtgNgfAUKApgQwCb2BRZkAIDGIyATgM7YC8ARAK5gBmAtABxUYCEjjuADgPY1iARxp8AlrjEA7fFEGJcURKUViARitSIaAD1z1xKgPy5GMXgOIWaAN3FWlKgFYDEVxFNwQ+W3KRxSqMhQfFIKXBik+MRiPGB+xPjU4GA8pABcAPSZ+KhSAHROpFpQYjbE+WFgmVI8EJmkAO6I2MFuYABMAAIAjAAMbMAN0bFgkSNxCUlUKWlZmTS1ANYA5vn4fPVBAJ5FvfnM+R09mTtF+RDShaRUuFr0brgwQ1ExcRxcuNZWAJIAoj0eqYzAhXqMpskwKkMtlcgUiiUyhUqpkViBMsEeNJEEUMVAsWEujYOvkdKTTmJ-HiCYhGGJEIDrrd7m5nsM3mMEJxuPxBIplLhkHRiAKpMgbGIVsgwNoyMDxhyITMoXNYXlrojypVsKj0Zjsbj9YTiaTyahKdUjYgmWywe84KCwNslPA1D5trgAN5wL4GKRgRj0ZCXKDbdK4KgAeR4HlwAGVkFIbgAaUzIHg8JSMUjbfyICCpgBCpSkSwAssh8HHczKIAAxUJgVNUOOIFZ8BQAVR+VFTACU+G6wHxU5GdNsVh5GAmk6nO2pFmAaKmAMKJnAiqBQZsACUQUBs2DE+DwADltIhe7g9wejyfUwBBGLBVOkROkbNuMT0ADcuDgAC+CANE6LrASAKDoA6wBuqg2zwAg5o2AQUDIKQpDULWmbSpeGAUjYCGghMnJwI00ioHwjT5CyxAADJ8Gg0grA++LYrgFD6Is+BgGIoS4AAFCeW5qJWSwAJRenAACQUkbEmfBKPkIQrPxVA0YoDHmlIKxUGJP4+l8hlfGRgSUfkaCoH8h7+rRFoeG4-EAORNMEjmpvQXE8Xx-GIBJ3pGUZsmhKQCnWspqmINZ8TOY0rm4CK+CIGUiCoKmFEEMEUAifgSy6fpAWGUF8mKeFvn5QVAVCVlon8XpBkFQBdUVQQwWhUpfAqY5kUePE5BgI5TWGQB+lySFJUdapNH0Yx2ksTSfjYDKqB5XAHkyF5niTmAnbEFAABqJCkLVklGTYJC4GdcocZ6w31Rd508CQYAqBxJkUVRIQnht+QgCK9D5CK2GJfxmQANpGAAZAAugA1PxoMAHoUNDMNiRQ8MI9DABUYmomI7mebxUj8QWSyINsyZnXIvknRVl2kKDZPbFD7H3dT5VfI1HPxdggiePT+lAathN8VtO1QAACiQwb8Y9xDBtgbhpYgQY0FAYBUzQvn+YZl24II+LS1gMpWBx9xCurmuINz378W9ZmfdKRM-X9+TkYgOiRvQstG4rxASeYjA9GJOsFQbcsKybrNi7tB1kLVoMR8bbhQ9zRlAUZIpLsQnjh77JuCw6esURAfaQR6HFrdxRMCX50lZ3zuBhI0uAS8QmyUog-EimNh7seY3oyd+AkUfgNBYP6APl3GOAyuxHFUCEM06XXMlSaP489eZqCWVFtl5mExCqQAIpGZYro2PXTVoy2pj3CmHmJ0lSQBuD7uQklr-ft61fpMlAS-J+t04D8TQtsGQx0KAD2kqNNq4UqAAFJ8D5HyP4J6V4qAbBCMQdIGx5ZQBWlJZAsUxDxBLmXNA2xf4wNauNFSiDch8HwJIFQIpKEYKwXwHBeDgiEP4DwGgPBqFFTGmFCaDCUH5A8LfCMnDuFcN4XVKSgExLULgJkLGPosb6x4qUJ0nF1o1xoOQVAkhTFnBUJSRy-p9YmK0f+XA2ivgNxzgQQQIobFBBlKmR6O8Uq4DImAEAuA+iSHoE3FoN8tGZDgHrLaAAVCCx8cLsSrhtY6g80k118fxUgfkebZ08Lk3AwBcD9AkiYRyfRHK4Bhn4XA4ZSB-gAcXVmzdcDJJlLVeuvNXGg1QPkLadY1ZQAAJooCPhJHxaB+IDK2mWRsIBaow2DtM1AszBnYE6V3MSYkoaFHEMTRyjABqASLg9PgAieCszATIAx1dQi1UHsPfiToYx8HCXGWKUBcDsAoBxRyWTQgDUHiItqbh25HwYT8YgCU+CHnlmoJQb9YVcIwdlVY7dFioEYHI9IIpUp4qRaJQhUkXFSD-i-aS2RgR3AAJf0GkKQmuWgVD7nzD1FQGwIAQEWKQalORgq9RlGkVmoNHI9DcrgRyHQpWOQAMyOShtJJQwrECio4uKyVyYZVKpoUmXq3yACKWstYz3VazL5wQLhiB0NIfioKAD6WE44ZCbiM5MBkZJyUZcQCAhY6DDikPEj2YBwyOTjDQMo65cAQ3lrCn8bkvWyUTIlKAAaoShBDToMN0q250vwHSrQNiIaoQTUmr4MkeDtxWD3Ug5q5h+BFaQT1layXdTIIgDNQa3VgGIFrVtuAZJUzEF4omZZlBvknOGlcChCDBlFcoeIIoRBWM9TJc0qBoweHDECop3gghQFXmvWBdDVKSKtVAdIm7t1SFJTJe2VFzSkEemAQgVker8WfmvdpK5jHDggB+-0TkXJQCld+mSnpcALjUEi5Q4Y+0DruK0MQV6vS4BlDm8MUYADS+RbivwAWvKST9iNKJfqmZ+ZEty3t3SLYm2tv2nrEfQi93z0jUagLe0lAF13r1HWXQIbg6OGO8ge4IIcIPMfaqxtjwRr0CekW4e9UlH3UUpK+99UV+K-v-ZsIDYAQPfKlVBmDcHe39sQMrHAqHwxQcw7myB5gHMkBQPkK2uBCO7OfrxqjqGoArhCOQETDzibiaPaC71tCWPnskfkS9HH-OBb4OQHjfHN3JeC-c9J4XJPEek-AuLKCEsZaC5ecjvmN2juPku9uYZstExJj4CTkWwVnqoEV4r7HN01f8HVtLz9pJc2kvq-wbMtYvVwKDVOKrsBuNhT1Btf9RvxEemEKAjrGggFCpGYgrYlDcVZqCniYBkVSXDSahQdg1aIAAF4XQECoN8tg2wkC0MQJNMlwDQCMuGAABs-YAShJyBBgCubblJKTkHu2BulMpAhayGMD6R8AZLAEZfuVAfVUdSWAEhFCaEMJUAMH62to62CA+kAI+Io7qCEHEIlW4YosB04h4zjD2wYzJFHcW24VtqBSBGYMbkRBAjIoXJmzwshjxLAIGz8IIIZLxIEPED2-BiAmxgoGvitOqDvmaMQHozJpTIEYJWDa1A1dcLAI6zKtxZCE+oKBjo2ZQIpVuG8xA1AJdBrYJGHDQwfehBx3GOlUAC0bUPvyFQOBzNa8l2Y6g+u3AdGNzgM3oXLc6HVzb0Il4CfoSd98l3-hnTu451zqgQe70wH94H7XUgcdDAx1ALH2Am+ohiFBGSf2+PVsQBfKQvqIAhfScgVMahkz4GTKlGmn8ovFRi+Pyf0-Z-kakqq3Azr8w8Fdd+vtHpWvb4gLvw6rMABScZIynnyHLcgsymGb0niINw2x9uIG4lwpyoNmde8wfLqgKGAadzYILWdfKSWEaLGTVSENE-dIK8Y-U-MgdfV+L6QgHyY9GSSAxfaAv7JBP4HQRKOIGuAAEk9EQAAl72lTxR4SgB-AxVrQEECFxQUi4XxRSgGkpRkkvVQW20aAOlKDHVCAnXQmQEnH4j+wnUSAkF8Hp0hysEWAUFZWQ10FwEuQ2lID+3APJX0GCHIC4KIzaxi0v2v1v0Oi7g3gnjAHyBf2IDf3ZU-yPkch-wVlZwZ0vCALEhAOpl2S4OyFtk9w+S3xdTP3+QBWxRVmxFQBqQAB8Yjgid9XV54OJBctw8sh5vYEiT8kiwj3U0jWseDSA+CBDR0nZhDJ0xCu5JC3B8AZC50IdSAxAFCwhkNNBtA9B1CiZNDtDelPAgwoB9Dv1X5v1sDRFcCkFYCkCWFcAyDEDXVKDkxMFWD5F8F70dDPQ8weB0gehUwrZ0g5jDohZ-4+MNFn4nArtkBKRkM7AmjeAnpbjSA+RFDkMZRQs7hHI6VrIOUbE5smhSFCBHhHiHBHJFg1CaBFBHIhQ+0lCBR2UrC2jFA8AX8tY34+jQhQsziFAYxVCtBXio5UIWoDU7j1tNttslBdt39uJUxzivAupPByANc7h0TvheB25HpJwHAFBiA6VHj1ZpRcBJFcAABzvAFov0ULFox6FQZ+LGGJB9fzWjBrbyfcTAgrcROTK9Tjbjdfb9fcGwrWOwyk4cJw-IEnCAMnaIrwiyAzfeeHByRyaXHKKVR1UXVAJQU2JUhjSTKTKA8KPA-AAzXAeJEgLacMMg60DcLaBYpY7BXBBRAhcAn0okq3DXFiDbc3GuSuejHyGwMAdIteW2SKawyM7AC4aUAEo6RyavfpE3DPC3KgFMm3O3Tw-Mk9X0iaf0ggnPXAB8WiWiOXdw3vGMtg2glTLAzINbfcUknbPbBw6wg4q6aVRs23LcRyP8GlDYNWPIRyeIYxBQUhCDGSIs9YdxHqYM4gLafU1-I0r-Zw3-Nw48Dw4AjzDiEwm-PrJib8KhT0PYhs7Pa3FcghRqQ8iA04RABcFYDkrgmSIdHgx0pYQfYfYRYjIdQwmSclaC26fLIVN+f8jXSMMIW3N4rM0TBjXM1sqSQs3M-IEs6ww8iAcsiCSs6srxU3DM0ILPHPR1PPQAgaCi0CycjbLbGco0-IBcybLqPC3PMINc3ADcgQVvKQHc2xfcsAEC48seBbf0c8y82w+wg7Y07-e8--dw3irwl83AN81BPtT8+gb8385cni4C4jKSIdNUlSf0n4JMdoQUJtC1fk-gRojaBpGYz0HgraS7M1EVZZHoaMmg+Msc2C75N2byjXSKxABtH2EkrbaUZXBMQ8ZMcK7AdKzKsSFZUjFyzY0gVBTMR8-iIqsAEq6KsqnYkJVMCVNQTgkCng6QBkxq01DK6KwSx1M06UQq5KiKga0qmGDoCq4jKqmq0oYGBqpq9VZZDoVMPodqnofALqlyoybITfR1NQMATwDiBqxCpo-1BvZCteIdbIY6069YJapYW6mCqSOCl6y6v1N6l+f8YjDCiDLCteDRQUN40hRxOUteRstMoi9JMqCDRsgixAOGxrBGteYbf+IbB0ERVbRMKcnKsAPK8UBQa6Z+E7M7C7FE67JQe7a7J7IUQ8KUYgd7T7KSb7KAc7XAAHNePHMoZNKSHQRgVi6gUOIdGSWPRwOzO6NtKSHoOzMxcMfoVMMAJFdIZyJcYtZ6KVBzcNP4TWsQdcUgGpXzAqNeDoBW0dcMDoLajDNW5ySdLonW0NcNVsdCJ2zzQdQKGSeVS21AcMeVW21Wq9DWmgLW0gF0i0LhbYZ2rDaVHcKOmIF-FQOHMOw2-0Y2z2mW8WqSAAFj9vDFzqDvtpAETu2EdXIHdtCEdRPABNjtzUcgrGEBRPZIUErsaOChNq9sKhkgAFYC7cBe7i6Q7jZkB67w1j5QgpA6UWgVB0xaqvpkpM7Tae6qVZaAIqBv0cdcc1Z4BZbgBuQeYxsgisJUI54Ig7pebT6cJs614haSdqBQZR1djQDEAWZpBcBIw1BzjuIpF-QYhlBXlkBzMxJN6zaZJ0gmZqBydL6ZI96ApebSh4Hva0cqc6AK8-8ASco3QdBbh0hdcrY3ZloGljLCHg6+dX7qAKdwG0dUI1B9wGkH6qBCHydcAhaHNqAyHQ1BhMg6H9xkHV6kcxABHebMhr6ZRt7ccFhYBv0hgkIcde9n5+9vqR9a5+559QLBQY8IIRRpi8AsGlgcGAlSFgkpA+AzFJAvB-19BUMo4ddTFhw+AmMcLuLLUJrsAJZLlBFaorzDS5yuE0zv9PcKADGcGoYn7UBPCuDN8JAOJuKlIPAVgglUxbdYU2lEAW4nx5YqExA9J-qZISd+I-wxAuA-xUniAn6WZrorbuLKmiHUxf99i+A6nf8p8IIcoUomm6mDGUpMb0Lej0NNj0gNrxtEBwxymiMAEsLRo8aSSvFSb58KbEAuaqBLstwBR5mUxn4OauaebcdS8wIsDtEhJpEAGrA0B0wwA6VkNcBZgYRBVsFSg1B1hNhMhsB8BMgRQVgzSHmuEnnGAvmzTGAOhe7MhbmVR7m5EnmXmthKIpAl5UBMgegABOVFsF2U5+DRPhqAaiHCdIdIZAegKOT0OSeHXNKgAAHUQGYHlQADYqAfxArmVQhwxNwnZDwfwlAiXC6+geAdAfxhwtjB6+WfwAIMWCmuEIAvRn1sJ6sLTGWLImIlb8x6DRJGDsVwwABiegZFnVnV+grhd7JWvlvwBSUdXATV-AHa61n8Bii86Qa2kUKVqE8x0JF1215AIWsiVAIJcMWlvoXl-l3xLSFYZViAUV5+M0yQWodBz0BgrFQILV+gZNg1lm4TMpE1sac1zV5F-AXN3NiNiVv1aDBvL0eNpg-21QNEMAWtcmBVneJVkJfIAAdhVe9d9bKQDYQVTaNZCULakijer3SG2wRTLbVYTcrfbFb37ajexa9GDcbb6HyF7vzCbZXalaXfXb7aIyjbQfiE9AXe0nDCXdbfDbtZWGkEYCHAA2PeXadZnclejep3SAMDHhUE9BVxLDGdwHlUzbNdMSndQH7a6CwHNDwBJkvfbZAB5cDb8lNMldtx3j4k9AtMYHEdpCwXHiTGtoDZNZ6HoGIB-FQ6lCFZ6FpZFdfng79UQ4ok8Dnc9AczN1KBWCkFZclHACI67xYLkAgFY7KTktwA6FFYFLNJo51xjabBE4Q4sj4mry9FQ8w94+toE-lVFaIxeDdyb13dQGoD7AfAAC17dUJC9idpOkO70wb6yKdUGJOMHWcP9DG+BcHE8q8jS082LM8qA+oK65yjB7d2myZu9cc52mH8A1AjTdtTw+AwA2BQ8DKiYo9nieA6UYgfAFAjAkdgH+HAcQuuFqAfW6x24IAjPHc1IcI2BtkbnUA6UJdMv6GZGbPqcXOCuiuPdOc-95nbgGKdBqAbbA6g4Xd5UjcvBpBeu+h+gBvGAhv3O6yiYndsBHV5mRrWu7hazUJtIaBKiKBAUPsm9cviB8uia+ASuTPOuYBKvfBGUpA6vsvGv0HdcfXlc2vK9OuvBPWxv+uehBvhvLgpAxuJuvupvhvWLZuOKvOFulvhwZv1uVhNvJxtuCPHIO8zSm8X1EwYAouZRwxkVGV1ZdGgTETVu54WjShLg54X9o8Foq6kwClLBp7lAXg1sFG+8RQVHwwnMNHv01BzwUpKuzZH8rDNkwA-glArDCxtgfh1kqyjTgCemgPv0WvNhWZLCt4toRfviwBxfJenJFeIBnzX6uDHvzH+ex5Be1fReeotepfdf9f2Zv1v1bZufIk+f-kMNLNY0IYBI7gwBCulfciqBbg4jvfldkiIxdJcBWzCjijghSiNoRCp0qipDaibnSAw8P9I9Hhnj5mwT6UNgASYd9G0IYS-A0-QstDoKdD+jBiMb8nlEv4BnWshn5VKNiM9jQZDyVfJ5zeNerenJwu5zZeAuUo+M15O-rDu+xeJfrefeivgDn1gGlBTFcjEN0u8iflwwx+hf1fJ-tfHIbfzLX6R+N0BfVfsBt-Lep+deju5-KQF--Fl-3eTBUj1+mTTfT-heLf-Re+9-r+D-qYINlUGNSlJVn4xboYwfHHyEenUZi1AoepPSjeRNKicZOSlK0jvBtJ2RD4TkedNpEQDOlXS7pVmHugwIwCKouNBaGAG2S+8IAqNPiCRVCw5k8yrWSit7GPK0Uyyb6Jit-hB7sU-u4PG3EtwI6bAzKFFTfBYlZh1hzcggekBUCebVUru6yY3uYD4BEN540qCxHtWIy2wxBuRCIldxSj8V3KqkJBD8D7B9g-gK4SMHtD+B6dCwtEP4LgGsF9hIwfYXAKeD+B-Bj4PZFcCuD+Bxg4wQZSMPGDPj2CHwEsCWLRB+ArgHw8SH4NflwB7QHwfYOML2BApVlx2FbbjmwQJR-giUqEHKImhArgF+mhSaClShcraDVuuwaqnEGIAd8T+XfM-p-016X8f+yuW3iiQ4ggULED+N-g0I-498Wh+-bwmARAp-0t03sRyN4H9AgBgCo1QzFQFGSLDRkjAMsGWEYDHxj4Y5KSOQCgD-RxKYqT0IINUab8J+F-XfkMKtgq0+A16eoeP0aEDDzhv-YYRQUAEoU0K7aEoUDWgpJkxsfUB8HBjypzk+enpBgRRSorFkQypZBihwMAbOFuBnnbzjsPT5+cWyTAoyEdTUDK9bhW-Jod-374GVB+DnFKKUPXjYjThX-QYTP02A383wcGJfr8i3xqAuhZI+4Tv2n5tCvC8-OkazHYCMjDyaFYGkc0s41wIa4rNeH1EoFFcaBXpaCn8IBF8AjS2yDAmnAqjDZmoB1QVDgXgRIJQgt6CwFcg4TLE4yqxQaKqO7pGRSsKWb9pAIkhQJaY6ogKHAINL6V0+t5KjtQOQHAEnW8KRAOgIPgOR-8iYScAgVFyt43ApogKJViGx-wZmxJKcnMKOzk1SElNaVGs30CStpQbNHZv9kBxIQBaQtEWlQDFprxJa8Ge0avXlroYranbdyBmLDSOQigwKFWi7WlSNilKWdGhhbSrGVsbatYv1NKHVr4BSANgcetQWHFd1b6MkWBmvRzob0t6sjXegLQPqfAe48QE+jvjPoK4RGaOdDpOMFqBg8uVACJi-Wpjv1PAX9H+tYR6gAMjopYvJGAwQYQMoGVAGBigwEb70kGe43HHuzs7-4HOODPBgQ1fpEM8GpDYCXMIobUwqG74nOsFyy7r8mGLDYhuw1DScNgJDmHhtixgmiNPxKDIYOh0kZDBFxojeRoNh7ws8B8oQYfOz1tHQIQaYLNCBhh0b7k56cuf8U52MZBIm45jc1hIF5RjZcedjTwOa0cY-D4grjc6u4zACeMrkPjeAf42ICBNnCwTUJk53CajoomEGGJqzHiZKBtIyTLfCQA9LtIsmyAHJnkwgyFNimpTQybCkqZHYamzTMQPsmfpNwFYXTZyZUAVhtMiR-tWpp5Ll59NihjcKDEM1zonitY4zIyYYSmbLZthxqKaiKivJax4YSjfGkJTJKIAKSc5PvOlMW44R10UMLwkEg8D8QBIPcNWHmWgHPxRBjqY+CJA-gcQJB3EKQW4HyBLBjOcg8iPxEUFqEVBrvRyPVKL4aCtBdUhqaTVd66Coi+ZQwdClMHmDLB1gh8LYPsGODnBrg9wZ4IfDeDfB-g+JIEKvxlgQhYQiIVEJiFxCEhSQlIWvDSE5R1WzBPFNkJaixliUOUY2t+nXyA0saG6MaUX2V6-TyAt+PtM-BeQVT1YzwzAjSj7TvgzSjwMDIOHOKq5PA5oCUpcRFDfojqKM1mGDOsKEMCUNAYGKAmTA6BaJAkT0JInHxTYyQmxKGOGDJBWxGoqYG6BJChnywkwUbBGenwwzmMUZQaMUHYQEhMx0gmxCKWMythzVN8pAHcJACgDUApSNzbkryVngMsMZc2XXm0g9TB9jea-LgiMTBaNF+QcuBdJoBSRLpUSa-VMASWz5KUzZ8s6tJ3HNnco4giAB3uEn4iLdjwoMeVOEz6BVNXeK-TAuvCpFSspIcTFGV7PCY9AZsxGI3kOjDmezvZoMDoNHLbJaiOySCHng43MZ7kieCgMgrr1fjcB85R3BYrIiNGjkUC9vAspkQ9n4BQYUcj3l8Frn1z9kL5V3n+S4p24Q4clMFg2jKQQYaUOc0uioATH0MTwOciGrFG0YKA88KlUxB-StACQScb8MBC1B4DbA5qZAu8YmJcqVioM1Y5WnbRDr+Aw6nKUcY5H1pp0jaE4lyl2P3k9jh66tduk7WbFx0I0jtTulnRcq+1uxAdR+aHXDqR1-A0dc+QnWAVJ0JsuAVOmBwzo3ziM+dX+bgCLoq0S6ZdHztTxrqVgII58puhT1bpU8O6SYOBWvH7qIKh6KCkeq0HPmT0pA9PAUPPSWrstlAxCmcbLSOr3YOIF49Pn-RsqAM7xLMsFoU14nnjv63C68fSFvF388kIcQwXeIiZFTX4HiG4goGeIQpZQ7xd2HoD-DIpe6b8MbPLL7QCAbAdKLSb8S7LW4qGf4SyV-j1hiAKAjqW7Ak30kgAg4xTGABQD6DWTGAIg34sGTgyngFYOk27JUxbk0UkUpQ2aZxlwo54rwpAPxUoACVYAihpAcxYyRhivkr875GytpC-IOpSxws+JYgESVWZWK16AGdaEbLxIkUyuN8rkkKXFK0owcxpcrjEhBSyh4o6WdAEsUQYpZMs9JX9mAB4AHucLBFrcF+gqx8uJudIA5gnKoRpAP4edJ2jAAUA6ATAZgMmHDIyA0unYPsJEM2D8AwgwGFJVJVaXMgRlmkTigBTIIJIkkOEWqABGuChA2Ay5a5dgESSIAlRrSx5ddwxAwA-s0FbIL0ugD9LgAPAGAFc3DyLLJwVhG5i8s9BmMqIcwpyEsNGSrCNhA0B5W2MdmWBqqkiIYGCv+Vrwhib8AYgoCgw0pmgASRMGKGiXW5fKSIt4ifTv4DzeGFobGcoEqnPCyyQiPQHaIdSJgxADFNDDoEajgEaUnwUsdzNpUa5TF4k27BQGmzQVJZIqR1I2R0nhzk5Vi7CmnJUi1zN5EGNQA2H7FgA3y6qz2bnX2TyCypvU5Qb-lUENiQoKA9YEP1QAGqjV0IlcHGD2hfB45dci1aaW6lqF1GtqwJQNKHEjivCcvCDI73dXShPVe0CioUyOp2LbajqCABQE2KqqpKTipJiAB-COoxAwANNWUzEAwxUYTAowtAUzWNlQYBaoqSSNtjVqpKtagKS6v4pSQHFt+YxEslr4uVPQNTfGCBQ3RTKPAGwLQDsr2Un488wGVAOUqkRSUqlUAZXPGtyQqqa1daryVgEaVUDmlfAXZEf2IyNMm1OeFtfslaZDqpILYh0uOIvXvCZIRQ9pRjSBrRrvYhqusW+UTVf5k1HilJumuPXW4c1QSfNYWuLVb5S15akCoYP-Ua5T1D6xtWuubUbq5e7aztQIiKJlSL1-avyYOpcqj8R1Wy8dbsovhTrDlhmKyh+RyV2VZkc6ypdUr4C1LoNYAU9Zuqsze8d1Ws3ZGJAPU-p3JjG5jeetw1Hk35bYxyLeqHUPr3hAoiDD0s6WyyqAwAXeirOIxJq5sBan9VvilZxNHFek3NSWqLXhswNZanxb1DrCoYiloa7mnCocX8aFYAER1K8qJq3KukXy2YsEo3WhpKCh5IFVAH6WHkgcwjECoMua7nK0AYyv6JMpwDTLQ0syy4hSkWV9QVlDAFgBss9DWaN1rFOcYJvejwsLlVAMgqQFM0JLbNbAVzTZqwAAR+IpW9zTmmcq4bAtvyvzayr+XPr5qsm9JfJukYwAlNWNb2jwV9RdwSBEtZMd+0cimbCA0glQCsDpTT1FZ7ACtI+I5o5jmodfNHPI3y2yaAIcjMoNhKkiKNwGPqK6t2izRXr6Ih4UMHNtgZ9MpmdUV+IZGAh2hOQged0HhA5rwAgAA",method:"decompressFromEncodedURIComponent"};var En=function(){var p=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",d={};function e(u,l){if(!d[u]){d[u]={};for(var f=0;f<u.length;f++)d[u][u.charAt(f)]=f}return d[u][l]}var t={compressToBase64:function(u){if(u==null)return"";var l=t._compress(u,6,function(f){return o.charAt(f)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(u){return u==null?"":u==""?null:t._decompress(u.length,32,function(l){return e(o,u.charAt(l))})},compressToUTF16:function(u){return u==null?"":t._compress(u,15,function(l){return p(l+32)})+" "},decompressFromUTF16:function(u){return u==null?"":u==""?null:t._decompress(u.length,16384,function(l){return u.charCodeAt(l)-32})},compressToUint8Array:function(u){for(var l=t.compress(u),f=new Uint8Array(l.length*2),a=0,c=l.length;a<c;a++){var i=l.charCodeAt(a);f[a*2]=i>>>8,f[a*2+1]=i%256}return f},decompressFromUint8Array:function(u){if(u==null)return t.decompress(u);for(var l=new Array(u.length/2),f=0,a=l.length;f<a;f++)l[f]=u[f*2]*256+u[f*2+1];var c=[];return l.forEach(function(i){c.push(p(i))}),t.decompress(c.join(""))},compressToEncodedURIComponent:function(u){return u==null?"":t._compress(u,6,function(l){return n.charAt(l)})},decompressFromEncodedURIComponent:function(u){return u==null?"":u==""?null:(u=u.replace(/ /g,"+"),t._decompress(u.length,32,function(l){return e(n,u.charAt(l))}))},compress:function(u){return t._compress(u,16,function(l){return p(l)})},_compress:function(u,l,f){if(u==null)return"";var a,c,i={},v={},$="",m="",b="",g=2,x=3,T=2,B=[],D=0,y=0,h;for(h=0;h<u.length;h+=1)if($=u.charAt(h),Object.prototype.hasOwnProperty.call(i,$)||(i[$]=x++,v[$]=!0),m=b+$,Object.prototype.hasOwnProperty.call(i,m))b=m;else{if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(a=0;a<T;a++)D=D<<1,y==l-1?(y=0,B.push(f(D)),D=0):y++;for(c=b.charCodeAt(0),a=0;a<8;a++)D=D<<1|c&1,y==l-1?(y=0,B.push(f(D)),D=0):y++,c=c>>1}else{for(c=1,a=0;a<T;a++)D=D<<1|c,y==l-1?(y=0,B.push(f(D)),D=0):y++,c=0;for(c=b.charCodeAt(0),a=0;a<16;a++)D=D<<1|c&1,y==l-1?(y=0,B.push(f(D)),D=0):y++,c=c>>1}g--,g==0&&(g=Math.pow(2,T),T++),delete v[b]}else for(c=i[b],a=0;a<T;a++)D=D<<1|c&1,y==l-1?(y=0,B.push(f(D)),D=0):y++,c=c>>1;g--,g==0&&(g=Math.pow(2,T),T++),i[m]=x++,b=String($)}if(b!==""){if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(a=0;a<T;a++)D=D<<1,y==l-1?(y=0,B.push(f(D)),D=0):y++;for(c=b.charCodeAt(0),a=0;a<8;a++)D=D<<1|c&1,y==l-1?(y=0,B.push(f(D)),D=0):y++,c=c>>1}else{for(c=1,a=0;a<T;a++)D=D<<1|c,y==l-1?(y=0,B.push(f(D)),D=0):y++,c=0;for(c=b.charCodeAt(0),a=0;a<16;a++)D=D<<1|c&1,y==l-1?(y=0,B.push(f(D)),D=0):y++,c=c>>1}g--,g==0&&(g=Math.pow(2,T),T++),delete v[b]}else for(c=i[b],a=0;a<T;a++)D=D<<1|c&1,y==l-1?(y=0,B.push(f(D)),D=0):y++,c=c>>1;g--,g==0&&(g=Math.pow(2,T),T++)}for(c=2,a=0;a<T;a++)D=D<<1|c&1,y==l-1?(y=0,B.push(f(D)),D=0):y++,c=c>>1;for(;;)if(D=D<<1,y==l-1){B.push(f(D));break}else y++;return B.join("")},decompress:function(u){return u==null?"":u==""?null:t._decompress(u.length,32768,function(l){return u.charCodeAt(l)})},_decompress:function(u,l,f){var a=[],c,i=4,v=4,$=3,m="",b=[],g,x,T,B,D,y,h,s={val:f(0),position:l,index:1};for(g=0;g<3;g+=1)a[g]=g;for(T=0,D=Math.pow(2,2),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=f(s.index++)),T|=(B>0?1:0)*y,y<<=1;switch(c=T){case 0:for(T=0,D=Math.pow(2,8),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=f(s.index++)),T|=(B>0?1:0)*y,y<<=1;h=p(T);break;case 1:for(T=0,D=Math.pow(2,16),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=f(s.index++)),T|=(B>0?1:0)*y,y<<=1;h=p(T);break;case 2:return""}for(a[3]=h,x=h,b.push(h);;){if(s.index>u)return"";for(T=0,D=Math.pow(2,$),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=f(s.index++)),T|=(B>0?1:0)*y,y<<=1;switch(h=T){case 0:for(T=0,D=Math.pow(2,8),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=f(s.index++)),T|=(B>0?1:0)*y,y<<=1;a[v++]=p(T),h=v-1,i--;break;case 1:for(T=0,D=Math.pow(2,16),y=1;y!=D;)B=s.val&s.position,s.position>>=1,s.position==0&&(s.position=l,s.val=f(s.index++)),T|=(B>0?1:0)*y,y<<=1;a[v++]=p(T),h=v-1,i--;break;case 2:return b.join("")}if(i==0&&(i=Math.pow(2,$),$++),a[h])m=a[h];else if(h===v)m=x+x.charAt(0);else return null;b.push(m),a[v++]=x+m.charAt(0),i--,x=m,i==0&&(i=Math.pow(2,$),$++)}}};return t}();var Xn=function(){var p=[{id:"/views/test-swal-sauvegarde",path:"views",file:"test-swal-sauvegarde",ptr:Sn}],o=function(n){oCurView=p.find(t=>t.id==n),oCurView===void 0&&console.log(`%cError view ${n} could't be found`,le),oCurView=oCurView.ptr;let d=oCurView.data;return En[oCurView.method](d)};return Object.freeze({load:o})},eo=Xn(),xn=eo;var J={Cfg:{dbase:null},raf:null,cssMainDataSelector:gt,ID_MENU_FORCE_LOADING:null,start:async function(){await Xt();let p=J.checkSupport();console.log(`%cAre all functions supported ? : ${p}`,M);var o="header [class*=MuiAvatar-img]";document.querySelector(o)===null?(console.log(`%c All condition not met, waiting element '${o}' `,M),document.arrive(o,J._warmup),J.ID_MENU_FORCE_LOADING=GM_registerMenuCommand("force - loading",J._warmup)):(console.log("%c All condition already met go",M),J._warmup())},checkSupport:function(){return!0},_warmup:function(){console.log("%c in _warmup",M),document.unbindArrive(J._warmup),GM_unregisterMenuCommand(J.ID_MENU_FORCE_LOADING),GM===void 0?(console.log("%cI am not in a tamper env",M),J._userscriptless()):console.log(`%cTamper environment detected the version is ${GM.info.version}`,M),GM_addStyle(GM_getResourceText("jspanelcss")),GM_addStyle(GM_getResourceText("toastifycss")),GM_addStyle(GM_getResourceText("simpledatatablecss")),GM_addStyle(GM_getResourceText("loading_barcss")),GM_addStyle(GM_getResourceText("nprogress_css")),GM_config.init(An),GM_registerMenuCommand("collectauto",Rt,"a"),GM_registerMenuCommand("configure",Rt,"a"),GM_config.get("hackheaderzindex")===!0&&(document.getElementById("header").style.zIndex=0),GM_addStyle(".swal2-title{font-size:1.275em)");var p=J.cssMainDataSelector;document.querySelector(p)===null?(console.log(`%c All condition not met, waiting element '${p}' `,M),document.arrive(p,J._main)):(console.log("%c All condition already met go",M),J._main())},_forceCbox:function(){J._applyInjectionForSessionsHistory()},pathname:document.location.pathname,_getOCMainClass:function(){try{let o=document.querySelector(J.cssMainDataSelector).classList.value.match(/dom-services-(\d)/);if(o.length==2)return`dom-services-${o[1]}`;throw new Error("_aOCMainSrvId.length must be 2")}catch(p){return console.error("%cError in _getOCMainClass():%s",le,p),""}},_sOCMainSrvClassName:"",_eventMonitor:function(){var p=document.querySelector("body"),o=new MutationObserver(function(d){d.forEach(function(e){e.target.classList.contains(`${J._sOCMainSrvClassName}-MuiTouchRipple-root`),e.target.nodeName==="TBODY"&&e.target.parentElement.nodeName==="TABLE"&&(console.log("%cTable data changed (TBODy,TABLE)",M),console.log("%c=============> Changed data : %o",M,e),Et(J._applyInjectionOnPathNameMutation())),e.target.nodeName==="BUTTON"&&e.target.parentElement.parentElement.parentElement.firstElementChild.nodeName==="TABLE"&&(console.log("%cTable data changed (BUTTON, TABLE)",M),console.log("%c=============> Changed data : %o",M,e),Et(J._applyInjectionOnPathNameMutation())),e.target.ariaLabel==="Page pr\xE9c\xE9dente",J.pathname!=document.location.pathname&&(J.pathname=document.location.pathname,Et(J._applyInjectionOnPathNameMutation()))})}),n={childList:!0,subtree:!0};o.observe(p,n)},_applyInjectionOnPathNameMutation:function(){let p=!1;p===!1&&document.location.pathname.match(/\/sessions$/)&&(p=!0,J._applyInjectionForSessionsToComplete()),p===!1&&document.location.pathname.match(/\/booked-mentorship-sessions$/)&&(p=!0,J._applyInjectionForSessionsBooked()),p===!1&&document.location.pathname.match(/\/mentorship-sessions-history$/)&&(p=!0,J._applyInjectionForSessionsHistory()),p===!1&&console.log("%cUnknow Route so could't guess what to do",le)},_lastMutation:0,_applyInjectionForSessionsToComplete:function(){document.querySelector(J.cssMainDataSelector+" thead")!==null&&(document.querySelector(J.cssMainDataSelector+" thead").style.display="none");var p=Array.from(document.querySelectorAll(J.cssMainDataSelector+" tbody a[href*=sessions]")),o;p.forEach(function(n){let d=n.querySelector("span span");d.innerText=".:"+d.innerText+":.",n.addEventListener("click",o=function(e){e.stopPropagation(),e.preventDefault();var t=n.parentElement.parentElement.parentElement,u=t.children[1].querySelector("time").dateTime.trim(),l=Ke(t.children[2],-2),f=t.children[3].querySelector("a").getAttribute("href-sav"),a=(f||"/").split("/"),c=a[a.length-1];u=dayjs(u).toISOString();var i=xe.getHashId(u,l);let v=parseInt(c,10),$=Ee.exists(v,1,Ee.TYPE.SESSIONID_DATEREFID),m=Ee.exists(i,2,Ee.TYPE.SESSIONID_DATEREFID);$&&(m||(console.log(`[SESSIONID_DATEREFID] iSessionId ${v} est connu mais pas iHash${i}`),Ee.updKey2(v,i,Ee.TYPE.SESSIONID_DATEREFID))),m&&($||(console.log(`[SESSIONID_DATEREFID] iHash${i} est connu mais pas iSessionId ${v}`),Ee.updKey1(v,i,Ee.TYPE.SESSIONID_DATEREFID))),!$&&!m&&(console.log(`[SESSIONID_DATEREFID] iHash${i} et iSessionId ${v} sont INconnus`),Ee.add(v,i,Ee.TYPE.SESSIONID_DATEREFID)),window.open(f,"blank").focus()}),n.setAttribute("href-sav",n.getAttribute("href")),n.removeAttribute("href")})},_applyInjectionForSessionsBooked:function(){document.querySelector(J.cssMainDataSelector+" thead")!==null&&(document.querySelector(J.cssMainDataSelector+" thead").style.display="none")},_applyInjectionForSessionsHistory:function(p=100){if(console.log("%c[index._applyInjectionForSessionsHistory()] Le panel de gestion des sessions en historique a \xE9t\xE9 activ\xE9, la derni\xE8re mutation date de %i",M,J._lastMutation),document.querySelector(J.cssMainDataSelector+" thead")!==null&&(document.querySelector(J.cssMainDataSelector+" thead").style.display="block"),dayjs().valueOf()-J._lastMutation<p){console.log("%c[index._applyInjectionForSessionsHistory()] Traitement abandonn\xE9e le dernier refresh date de %o limite:%o ms",M,J._lastMutation,p),J._lastMutation=dayjs.valueOf();return}Mt()},_addHeader:function(){J._sOCMainSrvClassName.length===0&&(J._sOCMainSrvClassName=J._getOCMainClass()),J._sOCMainSrvClassName.length===0&&(console.error("%c[index._addHeader()] _sOCMainSrvClassName is still unknow",le),console.log("[index._addHeader()]check this %o",document.querySelector(J.cssMainDataSelector)));let p=`
<a href="" class="${J._sOCMainSrvClassName}-MuiButtonBase-root
 ${J._sOCMainSrvClassName}-MuiTab-root
 ${J._sOCMainSrvClassName}-dom-services73
 ${J._sOCMainSrvClassName}-MuiTab-textColorInherit"
 style="margin-left: auto;">
 <span class="${J._sOCMainSrvClassName}-MuiTab-wrapper">En base de donn\xE9e (21/24)</span>
 <span class="${J._sOCMainSrvClassName}-MuiTouchRipple-root"></span></a>
`,o=document.querySelector("#mainContent > :not(div:empty)").children,n=document.createElement("span");n.innerText="Facturier v."+GM.info.script.version,n.classList.add(`${J._sOCMainSrvClassName}-MuiTab-wrapper`);let d;n.addEventListener("click",d=function(a){document.querySelectorAll("tbody input[type=checkbox]").forEach(c=>c.checked=!c.checked)});let e=document.createElement("span");e.classList.add(`${J._sOCMainSrvClassName}-MuiTouchRipple-root`);let t=document.createElement("a");t.alt="tout s\xE9l\xE9ctionner",t.appendChild(n),t.appendChild(e),t.classList.add(`${J._sOCMainSrvClassName}-MuiButtonBase-root`),t.classList.add(`${J._sOCMainSrvClassName}-MuiTab-root`),t.classList.add(`${J._sOCMainSrvClassName}-MuiTab-textColorInherit`);let u=`
font-size: 1rem;
max-width: 280px;
font-family: Montserrat;
font-weight: 400;
line-height: 1.625rem;
text-transform: inherit;
`;t.style=u+"margin-left: auto";let l;for(var f of o){let a=[...f.children].find(c=>c.classList.toString().match(/MuiTabs/));l=a!==void 0?a:l}l.appendChild(t)},_userscriptless(){console.log("%cIm'not in a Tamper environment so i need to load js scripts",M)},_main:function(){console.log("\u200B\u200B\u200B%c[index._main()]MainLoaded\u200B\u200B\u200B",M),document.unbindArrive(J._main),J._eventMonitor(),Pt.paintTiming(),Pt.longTaskTiming();let p=new LocalStorage("db");var o=low(p);o.defaults({students:[],sessions:[],f_archives:[],history_session_cache:[],meta:[],refs:[],students_history:[]}).write(),J.Cfg.dbase=o,dayjs.extend(dayjs_plugin_isSameOrAfter),dayjs.extend(dayjs_plugin_isSameOrBefore),dayjs.extend(dayjs_plugin_isBetween),dayjs.extend(dayjs_plugin_localeData),dayjs.extend(dayjs_plugin_localeData),dayjs.extend(dayjs_plugin_customParseFormat),dayjs.locale("fr"),Ee.checkSupport(),Te.checkSupport(),document.querySelector(".panel.menuBar.flex.draggable")===null&&wn.init(),J._addHeader(),J._applyInjectionOnPathNameMutation();let n=Te.getDbVersion();if(yt(GM.info.script.version,n)==1&&(console.log(`%cDB is in version: ${Te.getDbVersion()} need to go to version ${GM.info.script.version}`,M),dt.update(GM.info.script.version)),lt(["https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"]).then(async function(d){console.log("%cALPINE js fetched",M)}),lt(["https://unpkg.com/htmx.org@1.1.0","https://unpkg.com/htmx.org@1.1.0/dist/ext/debug.js"]).then(async function(d){htmx.on("htmx:configRequest",function(e){}),htmx.on("htmx:beforeRequest",function(e){if(e.detail.pathInfo.finalPath&&tn(e.detail.pathInfo.finalPath)!=="html"){e.detail.xhr.addEventListener("abort",function(){}),e.detail.xhr.onloadstart=function(a){this.abort()};let l=xn.load(e.detail.pathInfo.finalPath),f=e.detail.target;var t=e.detail.elt.getAttribute("hx-select");if(t){let a=new DOMParser().parseFromString(l,"text/html");oNode=a.querySelector(t),oNode?l=oNode.outerHTML:console.log(`%cWanna select target ${t} in data received from calling ${e.detail.pathInfo.finalPath} but this node could'nt be found so return the whole string`,le)}var u=function(a,c){var i=document.createRange(),v=i.createContextualFragment(a);console.log(v);for(var $=v.childNodes.length-1;$>=0;$--){var m=v.childNodes[$];c.appendChild(m),htmx.process(m)}return c.lastChild};u(l,e.detail.target)}}),htmx.on("htmx:xhr:loadstart",function(e){})}),lt(["https://cdn.jsdelivr.net/npm/sweetalert2@10"]).then(async function(d){console.log("%cSweetAlert fetched",M)}),GM_config.get("use_custom_css")===!0){let e=GM_config.get("custom_css_url").split(",");if(e.length!==0)console.log(`%cWanna inject Custom CSS from URL:${e}`,M),lt(e).then(()=>{console.log(`%cCustom CSS from URL:${e} loaded`,M)}).catch(t=>console.log(`%cError detected when loading dependencies ${t}`,le));else{let t=GM_config.get("custom_css_data");if(t.length()>0){console.log(`%cNeed to inject a custom css in application content is ${t}`,M);let u=document.createElement("style");u.innerHTML=t,document.head.insertAdjacentElement("beforeend",u)}}}unsafeWindow.Facturier={libs:[],cfg:{dbase:null},klass:[]},unsafeWindow.Facturier.cfg.dbase=J.Cfg.dbase,unsafeWindow.Facturier.libs.push({id:"fetchInject",ptr:lt}),unsafeWindow.Facturier.libs.push({id:"dayjs",ptr:dayjs}),unsafeWindow.Facturier.klass.push({id:"Student",ptr:ge}),unsafeWindow.Facturier.klass.push({id:"Session",ptr:xe}),unsafeWindow.Facturier.klass.push({id:"Archive",ptr:it}),unsafeWindow.Facturier.klass.push({id:"History",ptr:at}),unsafeWindow.Facturier.klass.push({id:"StudentHistory",ptr:je}),unsafeWindow.Facturier.klass.push({id:"Ref",ptr:Ee}),unsafeWindow.Facturier.klass.push({id:"Dbase",ptr:dt}),unsafeWindow.Facturier.klass.push({id:"Meta",ptr:Te}),unsafeWindow.Facturier.klass.push({id:"Ref",ptr:Ee}),unsafeWindow.Facturier.klass.push({id:"Api",ptr:xt}),unsafeWindow.Facturier.libs.push({id:"NProgress",ptr:NProgress}),GM.info.script.downloadURL==="http://localhost:8000/dist/app-facturier.iife.js"?(console.log("%cALERTE .... version locale !!!!!! ","background-color:coral;color:white"),console.log("%c test readfile",M),nn("file:////media/pwyll/USB120Go/DevStt/UserScripts/SttAddon/src/update_data_base.js",function(d){console.log(d)}),J.loadDependencies()):console.log(`%c GM.info.script.downloadURL url : ${GM.info.script.downloadURL}`,M)},loadDependencies:function(){let p=[];p.push("http://localhost:8000/src/branch01/sandbox.js"),p.push("http://localhost:8000/src/branch01/sandbox.css"),lt(p).then(()=>{console.log(`dependencies ${p} loaded`)})},dbUpdate:function(){console.log("%c Need to update DB",M),yt(GM.info.script.version,"1.00.0006")==0&&(console.log("%c Need to update DB to version '1.00.0006'",M),dt.update("1.00.0006"))}};window.Facturier!==void 0?window.Facturier.start():J.start();var q=J;})();
/* @license
Papa Parse
v5.3.0
https://github.com/mholt/PapaParse
License: MIT
*/
/**
 * Fetch Inject module.
 *
 * @module fetchInject
 * @license Zlib
 * @param {(USVString[]|Request[])} inputs Resources you wish to fetch.
 * @param {Promise} [promise] A promise to await before attempting injection.
 * @throws {Promise<ReferenceError>} Rejects with error when given no arguments.
 * @throws {Promise<TypeError>} Rejects with error on invalid arguments.
 * @throws {Promise<Error>} Whatever `fetch` decides to throw.
 * @throws {SyntaxError} Via DOM upon attempting to parse unexpected tokens.
 * @returns {Promise<Object[]>} A promise which resolves to an `Array` of
 *     Objects containing `Response` `Body` properties used by the module.
 */
//# sourceMappingURL=app.min.js.map
